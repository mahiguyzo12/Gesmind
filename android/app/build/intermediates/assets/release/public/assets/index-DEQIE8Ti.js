var lg=Object.defineProperty,cg=Object.defineProperties;var ug=Object.getOwnPropertyDescriptors;var Lu=Object.getOwnPropertySymbols,dg=Object.getPrototypeOf,hg=Object.prototype.hasOwnProperty,mg=Object.prototype.propertyIsEnumerable,fg=Reflect.get;var Mu=(n,e,t)=>e in n?lg(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,je=(n,e)=>{for(var t in e||(e={}))hg.call(e,t)&&Mu(n,t,e[t]);if(Lu)for(var t of Lu(e))mg.call(e,t)&&Mu(n,t,e[t]);return n},Ue=(n,e)=>cg(n,ug(e));var pg=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var cn=(n,e,t)=>fg(dg(n),t,e);var I=(n,e,t)=>new Promise((s,r)=>{var a=u=>{try{c(t.next(u))}catch(h){r(h)}},o=u=>{try{c(t.throw(u))}catch(h){r(h)}},c=u=>u.done?s(u.value):Promise.resolve(u.value).then(a,o);c((t=t.apply(n,e)).next())});import{r as w,a as gg,E as en,S as Xn,X as Vt,P as Ya,A as kr,F as Cs,U as vs,L as xg,b as Dh,T as ki,W as Fr,C as bg,c as rc,B as yl,d as _g,e as Qn,f as Vh,g as Xa,H as Oh,h as ic,i as Lh,j as Mh,k as yg,l as Fh,m as vg,R as Uh,n as wg,o as Ng,p as Ig,Y as Eg,q as Bh,s as Tg,t as qh,u as $h,G as Sg,D as ac,v as Za,w as Gh,x as zh,y as Qs,z as eo,I as Kh,J as Wi,K as Vs,M as Ag,N as jg,O as oc,Q as Cg,V as Eo,Z as Rg,_ as to,$ as Ur,a0 as Hh,a1 as bn,a2 as vl,a3 as Di,a4 as lc,a5 as so,a6 as Fu,a7 as To,a8 as cc,a9 as wl,aa as Rr,ab as Uu,ac as rl,ad as Wh,ae as Pg,af as il,ag as no,ah as Nl,ai as kg,aj as Bu,ak as Il,al as qu,am as $u,an as Dg,ao as Gu,ap as Vg,aq as Og,ar as Lg,as as Qh,at as Mg,au as Fg,av as Ug,aw as Bg,ax as qg,ay as $g,az as Gg,aA as Jh,aB as zu,aC as zg,aD as Kg,aE as Hg,aF as Wg,aG as Qg,aH as Jg}from"./vendor-M-YxhjWr.js";var GN=pg(Me=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();var Yh={exports:{}},So={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yg=w,Xg=Symbol.for("react.element"),Zg=Symbol.for("react.fragment"),ex=Object.prototype.hasOwnProperty,tx=Yg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,sx={key:!0,ref:!0,__self:!0,__source:!0};function Xh(n,e,t){var s,r={},a=null,o=null;t!==void 0&&(a=""+t),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)ex.call(e,s)&&!sx.hasOwnProperty(s)&&(r[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:Xg,type:n,key:a,ref:o,props:r,_owner:tx.current}}So.Fragment=Zg;So.jsx=Xh;So.jsxs=Xh;Yh.exports=So;var i=Yh.exports,El={},Ku=gg;El.createRoot=Ku.createRoot,El.hydrateRoot=Ku.hydrateRoot;var le=(n=>(n.LOGIN="LOGIN",n.MENU="MENU",n.DASHBOARD="DASHBOARD",n.INVENTORY="INVENTORY",n.COMMERCIAL="COMMERCIAL",n.EXPENSES="EXPENSES",n.PERSONNEL="PERSONNEL",n.CUSTOMERS="CUSTOMERS",n.SUPPLIERS="SUPPLIERS",n.TREASURY="TREASURY",n.USERS="USERS",n.AI_INSIGHTS="AI_INSIGHTS",n.SETTINGS="SETTINGS",n))(le||{});const Hu={fr:{login_title:"Connexion",login_subtitle:"Veuillez vous identifier pour continuer",username:"Utilisateur",password:"Mot de passe",login_button:"Se connecter",login_error:"Nom d'utilisateur ou mot de passe incorrect.",no_store:"Aucune entreprise n'est configurée.",create_first_store:"Créer ma première entreprise",demo_accounts:"Comptes démo disponibles :",delete_store:"Supprimer cette entreprise",create_other_store:"Créer une autre entreprise",change_store:"Changer d'entreprise",new_store_title:"Nouvelle Entreprise",new_store_subtitle:"Ajoutez un nouvel espace de travail indépendant.",store_name:"Nom de l'entreprise",logo_optional:"Logo (Optionnel)",choose_image:"Choisir une image",admin_account:"Compte Administrateur",admin_name:"Nom Admin",pin_code:"Code PIN",create_store_btn:"Créer l'entreprise",cancel:"Annuler",confirm:"Confirmer",delete_store_title:"Supprimer l'entreprise ?",delete_store_warning:"Cette action est irréversible. Toutes les données de CETTE entreprise seront effacées.",delete_confirm_admin:"Confirmation Administrateur",delete_btn:"Supprimer",menu_dashboard:"Tableau de bord",menu_dashboard_desc:"Vue d'ensemble",menu_inventory:"Stocks",menu_inventory_desc:"Produits",menu_commercial:"Ventes/Achats",menu_commercial_desc:"Facturation",menu_expenses:"Dépenses",menu_expenses_desc:"Charges & Frais",menu_treasury:"Trésorerie",menu_treasury_desc:"Caisse",menu_customers:"Clients",menu_customers_desc:"Fidélité",menu_suppliers:"Fournisseurs",menu_suppliers_desc:"Achats",menu_personnel:"Personnel",menu_personnel_desc:"RH & Paie",menu_users:"Utilisateurs",menu_users_desc:"Gestion",menu_ai:"IA",menu_ai_desc:"Assistant",menu_settings:"Paramètres",menu_settings_desc:"Config",logout:"Se déconnecter",hello:"Bonjour",back_menu:"Menu",settings_title:"Paramètres",settings_subtitle:"Gérez votre profil personnel, la configuration de l'entreprise et vos sauvegardes.",tab_profile:"Mon Profil",tab_store:"Boutique & IA",tab_data:"Cloud & Data",edit_profile:"Modifier mes informations",connected_account:"Compte connecté",save_profile:"Sauvegarder mon profil",profile_saved:"Profil mis à jour !",general_config:"Configuration Générale",appearance:"Apparence",light:"Clair",dark:"Sombre",primary_color:"Couleur Principale",company_logo:"Logo de l'entreprise",load_logo:"Charger un logo",remove:"Supprimer",ai_active:"Intelligence Artificielle Activée",ai_ready:"Le moteur Gemini AI est configuré et prêt à l'emploi.",software_update:"Mise à jour Logicielle (GitHub)",check_update:"Vérifier",currency_lang:"Devise & Langue",company_details:"Coordonnées de l'entreprise",address:"Adresse complète",phone:"Téléphone",email:"Email",update_btn:"Mettre à jour",settings_saved:"Paramètres enregistrés !",cloud_sync:"Synchronisation Cloud",android_mode:"Mode Android",android_desc:"En cliquant sur 'Connecter', l'application générera un fichier de sauvegarde à enregistrer manuellement.",local_backup:"Sauvegardes Locales",local_desc:"Les données sont stockées dans ce téléphone. Exportez régulièrement.",export_json:"Exporter JSON",import_json:"Importer JSON",restore_backup:"Restaurer sauvegarde",internal_backup:"Sauvegarde interne",save:"Sauvegarder",active:"Actif"},en:{login_title:"Login",login_subtitle:"Please identify yourself to continue",username:"Username",password:"Password",login_button:"Sign In",login_error:"Incorrect username or password.",no_store:"No company configured.",create_first_store:"Create my first company",demo_accounts:"Demo accounts available:",delete_store:"Delete this company",create_other_store:"Create another company",change_store:"Switch Company",new_store_title:"New Company",new_store_subtitle:"Add a new independent workspace.",store_name:"Company Name",logo_optional:"Logo (Optional)",choose_image:"Choose image",admin_account:"Admin Account",admin_name:"Admin Name",pin_code:"PIN Code",create_store_btn:"Create Company",cancel:"Cancel",confirm:"Confirm",delete_store_title:"Delete Company?",delete_store_warning:"This action is irreversible. All data for THIS company will be erased.",delete_confirm_admin:"Admin Confirmation",delete_btn:"Delete",menu_dashboard:"Dashboard",menu_dashboard_desc:"Overview",menu_inventory:"Inventory",menu_inventory_desc:"Products",menu_commercial:"Sales/Purchases",menu_commercial_desc:"Billing",menu_expenses:"Expenses",menu_expenses_desc:"Costs & Fees",menu_treasury:"Treasury",menu_treasury_desc:"Cash Flow",menu_customers:"Customers",menu_customers_desc:"Loyalty",menu_suppliers:"Suppliers",menu_suppliers_desc:"Purchasing",menu_personnel:"Personnel",menu_personnel_desc:"HR & Payroll",menu_users:"Users",menu_users_desc:"Access",menu_ai:"AI",menu_ai_desc:"Assistant",menu_settings:"Settings",menu_settings_desc:"Config",logout:"Logout",hello:"Hello",back_menu:"Menu",settings_title:"Settings",settings_subtitle:"Manage your profile, company configuration and backups.",tab_profile:"My Profile",tab_store:"Store & AI",tab_data:"Cloud & Data",edit_profile:"Edit Information",connected_account:"Connected Account",save_profile:"Save Profile",profile_saved:"Profile updated!",general_config:"General Configuration",appearance:"Appearance",light:"Light",dark:"Dark",primary_color:"Primary Color",company_logo:"Company Logo",load_logo:"Upload Logo",remove:"Remove",ai_active:"Artificial Intelligence Active",ai_ready:"Gemini AI engine is configured and ready.",software_update:"Software Update (GitHub)",check_update:"Check",currency_lang:"Currency & Language",company_details:"Company Details",address:"Full Address",phone:"Phone",email:"Email",update_btn:"Update",settings_saved:"Settings saved!",cloud_sync:"Cloud Synchronization",android_mode:"Android Mode",android_desc:"Clicking 'Connect' will generate a backup file to save manually.",local_backup:"Local Backups",local_desc:"Data is stored on this phone. Export regularly.",export_json:"Export JSON",import_json:"Import JSON",restore_backup:"Restore Backup",internal_backup:"Internal Backup",save:"Save",active:"Active"},es:{login_title:"Acceso",login_subtitle:"Identifíquese para continuar",username:"Usuario",password:"Contraseña",login_button:"Iniciar Sesión",login_error:"Usuario o contraseña incorrectos.",no_store:"Ninguna empresa configurada.",create_first_store:"Crear mi primera empresa",demo_accounts:"Cuentas demo disponibles:",delete_store:"Eliminar esta empresa",create_other_store:"Crear otra empresa",change_store:"Cambiar Empresa",new_store_title:"Nueva Empresa",new_store_subtitle:"Añadir un nuevo espacio de trabajo.",store_name:"Nombre de la empresa",logo_optional:"Logo (Opcional)",choose_image:"Elegir imagen",admin_account:"Cuenta Administrador",admin_name:"Nombre Admin",pin_code:"Código PIN",create_store_btn:"Crear Empresa",cancel:"Cancelar",confirm:"Confirmar",delete_store_title:"¿Eliminar Empresa?",delete_store_warning:"Esta acción es irreversible. Se borrarán todos los datos de ESTA empresa.",delete_confirm_admin:"Confirmación Admin",delete_btn:"Eliminar",menu_dashboard:"Tablero",menu_dashboard_desc:"Resumen",menu_inventory:"Inventario",menu_inventory_desc:"Productos",menu_commercial:"Ventas/Compras",menu_commercial_desc:"Facturación",menu_expenses:"Gastos",menu_expenses_desc:"Cargos y Tasas",menu_treasury:"Tesorería",menu_treasury_desc:"Caja",menu_customers:"Clientes",menu_customers_desc:"Fidelidad",menu_suppliers:"Proveedores",menu_suppliers_desc:"Compras",menu_personnel:"Personal",menu_personnel_desc:"RRHH",menu_users:"Usuarios",menu_users_desc:"Acceso",menu_ai:"IA",menu_ai_desc:"Asistente",menu_settings:"Ajustes",menu_settings_desc:"Config",logout:"Salir",hello:"Hola",back_menu:"Menú",settings_title:"Ajustes",settings_subtitle:"Gestione su perfil, configuración de empresa y copias de seguridad.",tab_profile:"Mi Perfil",tab_store:"Tienda e IA",tab_data:"Nube y Datos",edit_profile:"Editar Información",connected_account:"Cuenta conectada",save_profile:"Guardar Perfil",profile_saved:"¡Perfil actualizado!",general_config:"Configuración General",appearance:"Apariencia",light:"Claro",dark:"Oscuro",primary_color:"Color Principal",company_logo:"Logo de la empresa",load_logo:"Cargar logo",remove:"Eliminar",ai_active:"Inteligencia Artificial Activa",ai_ready:"El motor Gemini AI está listo para usar.",software_update:"Actualización de Software (GitHub)",check_update:"Verificar",currency_lang:"Moneda e Idioma",company_details:"Detalles de la empresa",address:"Dirección completa",phone:"Teléfono",email:"Correo",update_btn:"Actualizar",settings_saved:"¡Ajustes guardados!",cloud_sync:"Sincronización en Nube",android_mode:"Modo Android",android_desc:"Al hacer clic en 'Conectar', se generará un archivo de respaldo.",local_backup:"Copias Locales",local_desc:"Los datos se guardan en este teléfono. Exporte regularmente.",export_json:"Exportar JSON",import_json:"Importar JSON",restore_backup:"Restaurar Copia",internal_backup:"Copia Interna",save:"Guardar",active:"Activo"},de:{login_title:"Anmeldung",login_subtitle:"Bitte identifizieren Sie sich",username:"Benutzername",password:"Passwort",login_button:"Anmelden",login_error:"Falscher Benutzername oder Passwort.",no_store:"Kein Unternehmen konfiguriert.",create_first_store:"Mein erstes Unternehmen erstellen",demo_accounts:"Demo-Konten verfügbar:",delete_store:"Unternehmen löschen",create_other_store:"Weiteres Unternehmen erstellen",change_store:"Unternehmen wechseln",new_store_title:"Neues Unternehmen",new_store_subtitle:"Fügen Sie einen neuen unabhängigen Arbeitsbereich hinzu.",store_name:"Firmenname",logo_optional:"Logo (Optional)",choose_image:"Bild wählen",admin_account:"Admin-Konto",admin_name:"Admin-Name",pin_code:"PIN-Code",create_store_btn:"Unternehmen erstellen",cancel:"Abbrechen",confirm:"Bestätigen",delete_store_title:"Unternehmen löschen?",delete_store_warning:"Diese Aktion ist unwiderruflich. Alle Daten dieses Unternehmens werden gelöscht.",delete_confirm_admin:"Admin-Bestätigung",delete_btn:"Löschen",menu_dashboard:"Dashboard",menu_dashboard_desc:"Übersicht",menu_inventory:"Lagerbestand",menu_inventory_desc:"Produkte",menu_commercial:"Verkauf/Einkauf",menu_commercial_desc:"Rechnungsstellung",menu_expenses:"Ausgaben",menu_expenses_desc:"Kosten & Gebühren",menu_treasury:"Finanzen",menu_treasury_desc:"Kassenbuch",menu_customers:"Kunden",menu_customers_desc:"Treue",menu_suppliers:"Lieferanten",menu_suppliers_desc:"Beschaffung",menu_personnel:"Personal",menu_personnel_desc:"HR & Gehalt",menu_users:"Benutzer",menu_users_desc:"Zugriff",menu_ai:"KI",menu_ai_desc:"Assistent",menu_settings:"Einstellungen",menu_settings_desc:"Konfig",logout:"Abmelden",hello:"Hallo",back_menu:"Menü",settings_title:"Einstellungen",settings_subtitle:"Verwalten Sie Ihr Profil, die Unternehmenskonfiguration und Backups.",tab_profile:"Mein Profil",tab_store:"Shop & KI",tab_data:"Cloud & Daten",edit_profile:"Infos bearbeiten",connected_account:"Verbundenes Konto",save_profile:"Profil speichern",profile_saved:"Profil aktualisiert!",general_config:"Allgemeine Konfiguration",appearance:"Erscheinungsbild",light:"Hell",dark:"Dunkel",primary_color:"Hauptfarbe",company_logo:"Firmenlogo",load_logo:"Logo hochladen",remove:"Entfernen",ai_active:"Künstliche Intelligenz aktiv",ai_ready:"Gemini AI-Engine ist bereit.",software_update:"Software-Update (GitHub)",check_update:"Prüfen",currency_lang:"Währung & Sprache",company_details:"Firmendetails",address:"Vollständige Adresse",phone:"Telefon",email:"E-Mail",update_btn:"Aktualisieren",settings_saved:"Einstellungen gespeichert!",cloud_sync:"Cloud-Synchronisierung",android_mode:"Android-Modus",android_desc:"Klicken Sie auf 'Verbinden', um eine Backup-Datei zu generieren.",local_backup:"Lokale Backups",local_desc:"Daten werden auf diesem Telefon gespeichert. Regelmäßig exportieren.",export_json:"JSON exportieren",import_json:"JSON importieren",restore_backup:"Backup wiederherstellen",internal_backup:"Internes Backup",save:"Speichern",active:"Aktiv"},it:{login_title:"Accesso",login_subtitle:"Identificati per continuare",username:"Nome utente",password:"Password",login_button:"Accedi",login_error:"Nome utente o password errati.",no_store:"Nessuna azienda configurata.",create_first_store:"Crea la mia prima azienda",demo_accounts:"Account demo disponibili:",delete_store:"Elimina questa azienda",create_other_store:"Crea un'altra azienda",change_store:"Cambia azienda",new_store_title:"Nuova Azienda",new_store_subtitle:"Aggiungi un nuovo spazio di lavoro indipendente.",store_name:"Nome Azienda",logo_optional:"Logo (Opzionale)",choose_image:"Scegli immagine",admin_account:"Account Amministratore",admin_name:"Nome Admin",pin_code:"Codice PIN",create_store_btn:"Crea Azienda",cancel:"Annulla",confirm:"Conferma",delete_store_title:"Eliminare Azienda?",delete_store_warning:"Questa azione è irreversibile. Tutti i dati di QUESTA azienda saranno cancellati.",delete_confirm_admin:"Conferma Admin",delete_btn:"Elimina",menu_dashboard:"Dashboard",menu_dashboard_desc:"Panoramica",menu_inventory:"Inventario",menu_inventory_desc:"Prodotti",menu_commercial:"Vendite/Acquisti",menu_commercial_desc:"Fatturazione",menu_expenses:"Spese",menu_expenses_desc:"Costi & Commissioni",menu_treasury:"Tesoreria",menu_treasury_desc:"Cassa",menu_customers:"Clienti",menu_customers_desc:"Fedeltà",menu_suppliers:"Fornitori",menu_suppliers_desc:"Acquisti",menu_personnel:"Personale",menu_personnel_desc:"HR & Stipendi",menu_users:"Utenti",menu_users_desc:"Accesso",menu_ai:"IA",menu_ai_desc:"Assistente",menu_settings:"Impostazioni",menu_settings_desc:"Config",logout:"Esci",hello:"Ciao",back_menu:"Menu",settings_title:"Impostazioni",settings_subtitle:"Gestisci il tuo profilo, la configurazione aziendale e i backup.",tab_profile:"Il mio Profilo",tab_store:"Negozio & IA",tab_data:"Cloud & Dati",edit_profile:"Modifica Informazioni",connected_account:"Account connesso",save_profile:"Salva Profilo",profile_saved:"Profilo aggiornato!",general_config:"Configurazione Generale",appearance:"Aspetto",light:"Chiaro",dark:"Scuro",primary_color:"Colore Principale",company_logo:"Logo Azienda",load_logo:"Carica Logo",remove:"Rimuovi",ai_active:"Intelligenza Artificiale Attiva",ai_ready:"Il motore Gemini AI è pronto.",software_update:"Aggiornamento Software (GitHub)",check_update:"Verifica",currency_lang:"Valuta & Lingua",company_details:"Dettagli Azienda",address:"Indirizzo completo",phone:"Telefono",email:"Email",update_btn:"Aggiorna",settings_saved:"Impostazioni salvate!",cloud_sync:"Sincronizzazione Cloud",android_mode:"Modalità Android",android_desc:"Cliccando su 'Connetti' verrà generato un file di backup.",local_backup:"Backup Locali",local_desc:"I dati sono salvati su questo telefono. Esporta regolarmente.",export_json:"Esporta JSON",import_json:"Importa JSON",restore_backup:"Ripristina Backup",internal_backup:"Backup Interno",save:"Salva",active:"Attivo"},pt:{login_title:"Login",login_subtitle:"Identifique-se para continuar",username:"Usuário",password:"Senha",login_button:"Entrar",login_error:"Usuário ou senha incorretos.",no_store:"Nenhuma empresa configurada.",create_first_store:"Criar minha primeira empresa",demo_accounts:"Contas demo disponíveis:",delete_store:"Excluir esta empresa",create_other_store:"Criar outra empresa",change_store:"Mudar de Empresa",new_store_title:"Nova Empresa",new_store_subtitle:"Adicione um novo espaço de trabalho independente.",store_name:"Nome da Empresa",logo_optional:"Logo (Opcional)",choose_image:"Escolher imagem",admin_account:"Conta Administrador",admin_name:"Nome Admin",pin_code:"Código PIN",create_store_btn:"Criar Empresa",cancel:"Cancelar",confirm:"Confirmar",delete_store_title:"Excluir Empresa?",delete_store_warning:"Esta ação é irreversível. Todos os dados DESTA empresa serão apagados.",delete_confirm_admin:"Confirmação Admin",delete_btn:"Excluir",menu_dashboard:"Painel",menu_dashboard_desc:"Visão Geral",menu_inventory:"Estoque",menu_inventory_desc:"Produtos",menu_commercial:"Vendas/Compras",menu_commercial_desc:"Faturamento",menu_expenses:"Despesas",menu_expenses_desc:"Custos",menu_treasury:"Tesouraria",menu_treasury_desc:"Caixa",menu_customers:"Clientes",menu_customers_desc:"Fidelidade",menu_suppliers:"Fornecedores",menu_suppliers_desc:"Compras",menu_personnel:"Pessoal",menu_personnel_desc:"RH & Folha",menu_users:"Usuários",menu_users_desc:"Acesso",menu_ai:"IA",menu_ai_desc:"Assistente",menu_settings:"Configurações",menu_settings_desc:"Config",logout:"Sair",hello:"Olá",back_menu:"Menu",settings_title:"Configurações",settings_subtitle:"Gerencie seu perfil, configuração da empresa e backups.",tab_profile:"Meu Perfil",tab_store:"Loja & IA",tab_data:"Nuvem & Dados",edit_profile:"Editar Informações",connected_account:"Conta conectada",save_profile:"Salvar Perfil",profile_saved:"Perfil atualizado!",general_config:"Configuração Geral",appearance:"Aparência",light:"Claro",dark:"Escuro",primary_color:"Cor Principal",company_logo:"Logo da Empresa",load_logo:"Carregar Logo",remove:"Remover",ai_active:"Inteligência Artificial Ativa",ai_ready:"O motor Gemini AI está pronto para uso.",software_update:"Atualização de Software (GitHub)",check_update:"Verificar",currency_lang:"Moeda & Idioma",company_details:"Detalhes da Empresa",address:"Endereço completo",phone:"Telefone",email:"E-mail",update_btn:"Atualizar",settings_saved:"Configurações salvas!",cloud_sync:"Sincronização na Nuvem",android_mode:"Modo Android",android_desc:"Ao clicar em 'Conectar', um arquivo de backup será gerado.",local_backup:"Backups Locais",local_desc:"Os dados são armazenados neste telefone. Exporte regularmente.",export_json:"Exportar JSON",import_json:"Importar JSON",restore_backup:"Restaurar Backup",internal_backup:"Backup Interno",save:"Salvar",active:"Ativo"},zh:{login_title:"登录",login_subtitle:"请验证身份以继续",username:"用户名",password:"密码",login_button:"登录",login_error:"用户名或密码错误。",no_store:"未配置公司。",create_first_store:"创建我的第一家公司",demo_accounts:"可用演示账户：",delete_store:"删除此公司",create_other_store:"创建另一家公司",change_store:"切换公司",new_store_title:"新公司",new_store_subtitle:"添加一个新的独立工作区。",store_name:"公司名称",logo_optional:"Logo（可选）",choose_image:"选择图片",admin_account:"管理员账户",admin_name:"管理员姓名",pin_code:"PIN码",create_store_btn:"创建公司",cancel:"取消",confirm:"确认",delete_store_title:"删除公司？",delete_store_warning:"此操作不可逆。此公司的所有数据将被删除。",delete_confirm_admin:"管理员确认",delete_btn:"删除",menu_dashboard:"仪表盘",menu_dashboard_desc:"概览",menu_inventory:"库存",menu_inventory_desc:"产品",menu_commercial:"销售/采购",menu_commercial_desc:"开票",menu_expenses:"支出",menu_expenses_desc:"成本与费用",menu_treasury:"资金",menu_treasury_desc:"现金流",menu_customers:"客户",menu_customers_desc:"忠诚度",menu_suppliers:"供应商",menu_suppliers_desc:"采购",menu_personnel:"人事",menu_personnel_desc:"人力资源与薪资",menu_users:"用户",menu_users_desc:"访问权限",menu_ai:"AI",menu_ai_desc:"助手",menu_settings:"设置",menu_settings_desc:"配置",logout:"退出",hello:"你好",back_menu:"菜单",settings_title:"设置",settings_subtitle:"管理您的个人资料、公司配置和备份。",tab_profile:"我的资料",tab_store:"店铺与AI",tab_data:"云与数据",edit_profile:"编辑信息",connected_account:"已连接账户",save_profile:"保存资料",profile_saved:"资料已更新！",general_config:"常规配置",appearance:"外观",light:"浅色",dark:"深色",primary_color:"主色调",company_logo:"公司Logo",load_logo:"上传Logo",remove:"移除",ai_active:"人工智能已激活",ai_ready:"Gemini AI引擎已就绪。",software_update:"软件更新 (GitHub)",check_update:"检查",currency_lang:"货币与语言",company_details:"公司详情",address:"详细地址",phone:"电话",email:"邮箱",update_btn:"更新",settings_saved:"设置已保存！",cloud_sync:"云同步",android_mode:"安卓模式",android_desc:"点击“连接”将生成备份文件。",local_backup:"本地备份",local_desc:"数据存储在此手机上。请定期导出。",export_json:"导出JSON",import_json:"导入JSON",restore_backup:"恢复备份",internal_backup:"内部备份",save:"保存",active:"活跃"},ja:{login_title:"ログイン",login_subtitle:"続行するには認証してください",username:"ユーザー名",password:"パスワード",login_button:"サインイン",login_error:"ユーザー名またはパスワードが間違っています。",no_store:"会社が設定されていません。",create_first_store:"最初の会社を作成",demo_accounts:"デモアカウント:",delete_store:"この会社を削除",create_other_store:"別の会社を作成",change_store:"会社を切り替え",new_store_title:"新しい会社",new_store_subtitle:"新しい独立したワークスペースを追加します。",store_name:"会社名",logo_optional:"ロゴ（任意）",choose_image:"画像を選択",admin_account:"管理者アカウント",admin_name:"管理者名",pin_code:"PINコード",create_store_btn:"会社を作成",cancel:"キャンセル",confirm:"確認",delete_store_title:"会社を削除しますか？",delete_store_warning:"この操作は取り消せません。この会社のすべてのデータが消去されます。",delete_confirm_admin:"管理者確認",delete_btn:"削除",menu_dashboard:"ダッシュボード",menu_dashboard_desc:"概要",menu_inventory:"在庫",menu_inventory_desc:"製品",menu_commercial:"販売/購入",menu_commercial_desc:"請求",menu_expenses:"経費",menu_expenses_desc:"コスト＆手数料",menu_treasury:"財務",menu_treasury_desc:"キャッシュフロー",menu_customers:"顧客",menu_customers_desc:"ロイヤルティ",menu_suppliers:"サプライヤー",menu_suppliers_desc:"調達",menu_personnel:"人事",menu_personnel_desc:"HR＆給与",menu_users:"ユーザー",menu_users_desc:"アクセス",menu_ai:"AI",menu_ai_desc:"アシスタント",menu_settings:"設定",menu_settings_desc:"構成",logout:"ログアウト",hello:"こんにちは",back_menu:"メニュー",settings_title:"設定",settings_subtitle:"プロフィール、会社設定、バックアップを管理します。",tab_profile:"プロフィール",tab_store:"ストア＆AI",tab_data:"クラウド＆データ",edit_profile:"情報を編集",connected_account:"接続されたアカウント",save_profile:"プロフィールを保存",profile_saved:"プロフィールを更新しました！",general_config:"一般設定",appearance:"外観",light:"ライト",dark:"ダーク",primary_color:"メインカラー",company_logo:"会社ロゴ",load_logo:"ロゴをアップロード",remove:"削除",ai_active:"人工知能がアクティブ",ai_ready:"Gemini AIエンジンが準備完了です。",software_update:"ソフトウェア更新 (GitHub)",check_update:"確認",currency_lang:"通貨と言語",company_details:"会社詳細",address:"完全な住所",phone:"電話番号",email:"メール",update_btn:"更新",settings_saved:"設定を保存しました！",cloud_sync:"クラウド同期",android_mode:"Androidモード",android_desc:"「接続」をクリックするとバックアップファイルが生成されます。",local_backup:"ローカルバックアップ",local_desc:"データはこの電話に保存されます。定期的にエクスポートしてください。",export_json:"JSONをエクスポート",import_json:"JSONをインポート",restore_backup:"バックアップを復元",internal_backup:"内部バックアップ",save:"保存",active:"アクティブ"},ru:{login_title:"Вход",login_subtitle:"Пожалуйста, авторизуйтесь",username:"Имя пользователя",password:"Пароль",login_button:"Войти",login_error:"Неверное имя пользователя или пароль.",no_store:"Компания не настроена.",create_first_store:"Создать мою первую компанию",demo_accounts:"Доступные демо-аккаунты:",delete_store:"Удалить эту компанию",create_other_store:"Создать другую компанию",change_store:"Сменить компанию",new_store_title:"Новая компания",new_store_subtitle:"Добавьте новое независимое рабочее пространство.",store_name:"Название компании",logo_optional:"Логотип (необязательно)",choose_image:"Выбрать изображение",admin_account:"Аккаунт администратора",admin_name:"Имя админа",pin_code:"PIN-код",create_store_btn:"Создать компанию",cancel:"Отмена",confirm:"Подтвердить",delete_store_title:"Удалить компанию?",delete_store_warning:"Это действие необратимо. Все данные ЭТОЙ компании будут удалены.",delete_confirm_admin:"Подтверждение админа",delete_btn:"Удалить",menu_dashboard:"Дашборд",menu_dashboard_desc:"Обзор",menu_inventory:"Склад",menu_inventory_desc:"Товары",menu_commercial:"Продажи/Закупки",menu_commercial_desc:"Счета",menu_expenses:"Расходы",menu_expenses_desc:"Затраты",menu_treasury:"Казначейство",menu_treasury_desc:"Денежный поток",menu_customers:"Клиенты",menu_customers_desc:"Лояльность",menu_suppliers:"Поставщики",menu_suppliers_desc:"Закупки",menu_personnel:"Персонал",menu_personnel_desc:"Кадры и Зарплата",menu_users:"Пользователи",menu_users_desc:"Доступ",menu_ai:"ИИ",menu_ai_desc:"Ассистент",menu_settings:"Настройки",menu_settings_desc:"Конфигурация",logout:"Выйти",hello:"Привет",back_menu:"Меню",settings_title:"Настройки",settings_subtitle:"Управление профилем, настройками компании и резервными копиями.",tab_profile:"Мой профиль",tab_store:"Магазин и ИИ",tab_data:"Облако и Данные",edit_profile:"Редактировать информацию",connected_account:"Подключенный аккаунт",save_profile:"Сохранить профиль",profile_saved:"Профиль обновлен!",general_config:"Общая конфигурация",appearance:"Внешний вид",light:"Светлый",dark:"Темный",primary_color:"Основной цвет",company_logo:"Логотип компании",load_logo:"Загрузить логотип",remove:"Удалить",ai_active:"Искусственный интеллект активен",ai_ready:"Движок Gemini AI готов к работе.",software_update:"Обновление ПО (GitHub)",check_update:"Проверить",currency_lang:"Валюта и Язык",company_details:"Реквизиты компании",address:"Полный адрес",phone:"Телефон",email:"Email",update_btn:"Обновить",settings_saved:"Настройки сохранены!",cloud_sync:"Облачная синхронизация",android_mode:"Режим Android",android_desc:"Нажатие 'Подключить' создаст файл резервной копии.",local_backup:"Локальные копии",local_desc:"Данные хранятся на этом телефоне. Регулярно экспортируйте.",export_json:"Экспорт JSON",import_json:"Импорт JSON",restore_backup:"Восстановить копию",internal_backup:"Внутренняя копия",save:"Сохранить",active:"Активен"},ar:{login_title:"تسجيل الدخول",login_subtitle:"يرجى تعريف نفسك للمتابعة",username:"اسم المستخدم",password:"كلمة المرور",login_button:"تسجيل الدخول",login_error:"اسم المستخدم أو كلمة المرور غير صحيحة.",no_store:"لم يتم تكوين أي شركة.",create_first_store:"إنشاء شركتي الأولى",demo_accounts:"حسابات تجريبية متاحة:",delete_store:"حذف هذه الشركة",create_other_store:"إنشاء شركة أخرى",change_store:"تغيير الشركة",new_store_title:"شركة جديدة",new_store_subtitle:"أضف مساحة عمل مستقلة جديدة.",store_name:"اسم الشركة",logo_optional:"شعار (اختياري)",choose_image:"اختر صورة",admin_account:"حساب المسؤول",admin_name:"اسم المسؤول",pin_code:"رمز PIN",create_store_btn:"إنشاء الشركة",cancel:"إلغاء",confirm:"تأكيد",delete_store_title:"حذف الشركة؟",delete_store_warning:"هذا الإجراء لا رجعة فيه. سيتم مسح جميع بيانات هذه الشركة.",delete_confirm_admin:"تأكيد المسؤول",delete_btn:"حذف",menu_dashboard:"لوحة القيادة",menu_dashboard_desc:"نظرة عامة",menu_inventory:"المخزون",menu_inventory_desc:"المنتجات",menu_commercial:"المبيعات/المشتريات",menu_commercial_desc:"الفواتير",menu_expenses:"النفقات",menu_expenses_desc:"التكاليف والرسوم",menu_treasury:"الخزينة",menu_treasury_desc:"التدفق النقدي",menu_customers:"العملاء",menu_customers_desc:"الولاء",menu_suppliers:"الموردين",menu_suppliers_desc:"الشراء",menu_personnel:"الموظفين",menu_personnel_desc:"الموارد البشرية والرواتب",menu_users:"المستخدمين",menu_users_desc:"الوصول",menu_ai:"الذكاء الاصطناعي",menu_ai_desc:"مساعد",menu_settings:"الإعدادات",menu_settings_desc:"تكوين",logout:"تسجيل الخروج",hello:"مرحبا",back_menu:"القائمة",settings_title:"الإعدادات",settings_subtitle:"إدارة ملف التعريف الخاص بك وتكوين الشركة والنسخ الاحتياطي.",tab_profile:"ملفي الشخصي",tab_store:"المتجر والذكاء الاصطناعي",tab_data:"السحابة والبيانات",edit_profile:"تعديل المعلومات",connected_account:"الحساب المتصل",save_profile:"حفظ الملف الشخصي",profile_saved:"تم تحديث الملف الشخصي!",general_config:"تكوين عام",appearance:"المظهر",light:"فاتح",dark:"داكن",primary_color:"اللون الأساسي",company_logo:"شعار الشركة",load_logo:"تحميل الشعار",remove:"إزالة",ai_active:"الذكاء الاصطناعي نشط",ai_ready:"محرك Gemini AI جاهز.",software_update:"تحديث البرنامج (GitHub)",check_update:"تحقق",currency_lang:"العملة واللغة",company_details:"تفاصيل الشركة",address:"العنوان الكامل",phone:"الهاتف",email:"البريد الإلكتروني",update_btn:"تحديث",settings_saved:"تم حفظ الإعدادات!",cloud_sync:"مزامنة سحابية",android_mode:"وضع أندرويد",android_desc:"النقر فوق 'اتصال' سيؤدي إلى إنشاء ملف نسخ احتياطي.",local_backup:"نسخ احتياطي محلي",local_desc:"يتم تخزين البيانات على هذا الهاتف. قم بالتصدير بانتظام.",export_json:"تصدير JSON",import_json:"استيراد JSON",restore_backup:"استعادة النسخة الاحتياطية",internal_backup:"نسخ احتياطي داخلي",save:"حفظ",active:"نشط"}},Qi=(n,e)=>{const t=Hu[n]?n:"fr";return Hu[t][e]||e},Zh=({inventory:n,transactions:e,users:t,onNavigate:s,currency:r,currentUser:a,supervisionTarget:o})=>{const[c,u]=w.useState(""),[h,f]=w.useState(!1),p=w.useRef(null),_=(a==null?void 0:a.role)==="ADMIN",A=!!o,P=o?o.id:a==null?void 0:a.id;w.useEffect(()=>{function g(v){p.current&&!p.current.contains(v.target)&&f(!1)}return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[p]);const k=g=>{u(g.target.value),f(g.target.value.length>0)},T=()=>{u(""),f(!1)},U=g=>{s(g),T()},K=g=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:r.code}).format(g*r.rate),D=_&&!A?e:e.filter(g=>g.sellerId===P),$=_&&!A?n:n.filter(g=>g.createdBy===P),H=c?$.filter(g=>g.name.toLowerCase().includes(c.toLowerCase())||g.sku.toLowerCase().includes(c.toLowerCase())||g.category.toLowerCase().includes(c.toLowerCase())).slice(0,3):[],Q=c?D.filter(g=>g.id.toLowerCase().includes(c.toLowerCase())||g.sellerName.toLowerCase().includes(c.toLowerCase())||g.items.some(v=>v.productName.toLowerCase().includes(c.toLowerCase()))).slice(0,3):[],N=c&&_&&!A?t.filter(g=>g.name.toLowerCase().includes(c.toLowerCase())||g.role.toLowerCase().includes(c.toLowerCase())).slice(0,2):[],b=H.length>0||Q.length>0||N.length>0;return i.jsxs("div",{ref:p,className:"relative w-full mb-4 z-30",children:[i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:A?i.jsx(en,{className:"h-4 w-4 text-amber-500 animate-pulse"}):i.jsx(Xn,{className:"h-4 w-4 text-slate-400"})}),i.jsx("input",{type:"text",className:`block w-full pl-10 pr-10 py-2.5 border-0 rounded-xl leading-5 bg-white text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 shadow-sm transition-all text-sm ${A?"focus:ring-amber-500/30":"focus:ring-indigo-500/20"}`,placeholder:_&&!A?"Rechercher partout...":`Rechercher dans les données de ${o?o.name:"VOS données"}...`,value:c,onChange:k,onFocus:()=>{c&&f(!0)}}),c&&i.jsx("button",{onClick:T,className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"h-4 w-4"})})]}),h&&c&&i.jsx("div",{className:"absolute mt-2 w-full bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-100 animate-fade-in-up origin-top",children:b?i.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[H.length>0&&i.jsxs("div",{className:"py-2",children:[i.jsxs("h4",{className:"px-4 py-2 text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center",children:[i.jsx(Ya,{className:"w-3 h-3 mr-2"})," Stocks"]}),H.map(g=>i.jsxs("button",{onClick:()=>U(le.INVENTORY),className:"w-full text-left px-4 py-3 hover:bg-indigo-50 flex justify-between items-center group transition-colors",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-slate-800",children:g.name}),i.jsxs("p",{className:"text-xs text-slate-500",children:[g.sku," • ",g.category]})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full mr-3 ${g.quantity<=g.minQuantity?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:["Stock: ",g.quantity]}),i.jsx(kr,{className:"w-4 h-4 text-slate-300 group-hover:text-indigo-500"})]})]},g.id))]}),Q.length>0&&i.jsxs("div",{className:"py-2 border-t border-slate-50",children:[i.jsxs("h4",{className:"px-4 py-2 text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center",children:[i.jsx(Cs,{className:"w-3 h-3 mr-2"})," ",_&&!A?"Transactions":"Vos Transactions"]}),Q.map(g=>i.jsxs("button",{onClick:()=>U(le.COMMERCIAL),className:"w-full text-left px-4 py-3 hover:bg-indigo-50 flex justify-between items-center group transition-colors",children:[i.jsxs("div",{children:[i.jsxs("p",{className:"font-medium text-slate-800",children:["Ref ",g.id]}),i.jsxs("p",{className:"text-xs text-slate-500",children:[new Date(g.date).toLocaleDateString()," • par ",g.sellerName]})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:"text-xs font-bold text-slate-700 mr-3",children:K(g.totalAmount)}),i.jsx(kr,{className:"w-4 h-4 text-slate-300 group-hover:text-indigo-500"})]})]},g.id))]}),N.length>0&&i.jsxs("div",{className:"py-2 border-t border-slate-50",children:[i.jsxs("h4",{className:"px-4 py-2 text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center",children:[i.jsx(vs,{className:"w-3 h-3 mr-2"})," Utilisateurs"]}),N.map(g=>i.jsxs("button",{onClick:()=>U(le.USERS),className:"w-full text-left px-4 py-3 hover:bg-indigo-50 flex justify-between items-center group transition-colors",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("img",{src:g.avatar,alt:"",className:"w-8 h-8 rounded-full border border-slate-200 mr-3"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-slate-800",children:g.name}),i.jsx("p",{className:"text-xs text-slate-500",children:g.role})]})]}),i.jsx(kr,{className:"w-4 h-4 text-slate-300 group-hover:text-indigo-500"})]},g.id))]})]}):i.jsxs("div",{className:"p-8 text-center text-slate-500",children:['Aucun résultat trouvé pour "',c,'"']})})]})},em=({className:n="w-32 h-32",withText:e=!0})=>i.jsxs("div",{className:`flex flex-col items-center justify-center ${n}`,children:[i.jsxs("svg",{viewBox:"0 0 500 500",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-full drop-shadow-xl",children:[i.jsxs("defs",{children:[i.jsxs("linearGradient",{id:"gradCyan",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[i.jsx("stop",{offset:"0%",style:{stopColor:"#2dd4bf",stopOpacity:1}}),i.jsx("stop",{offset:"100%",style:{stopColor:"#0ea5e9",stopOpacity:1}})]}),i.jsxs("linearGradient",{id:"gradBlue",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[i.jsx("stop",{offset:"0%",style:{stopColor:"#1e3a8a",stopOpacity:1}}),i.jsx("stop",{offset:"100%",style:{stopColor:"#3b82f6",stopOpacity:1}})]}),i.jsxs("linearGradient",{id:"gradGreen",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[i.jsx("stop",{offset:"0%",style:{stopColor:"#4ade80",stopOpacity:1}}),i.jsx("stop",{offset:"100%",style:{stopColor:"#16a34a",stopOpacity:1}})]})]}),i.jsx("path",{d:"M 250 50 C 280 50, 350 150, 400 220 L 330 260 C 290 200, 250 130, 250 130 C 250 130, 210 200, 170 260 L 100 220 C 150 150, 220 50, 250 50 Z",fill:"url(#gradCyan)"}),i.jsx("path",{d:"M 400 220 C 430 270, 450 350, 420 400 C 390 450, 300 450, 250 450 L 250 370 C 290 370, 340 370, 360 340 C 380 310, 330 260, 330 260 Z",fill:"url(#gradGreen)"}),i.jsx("path",{d:"M 100 220 C 70 270, 50 350, 80 400 C 110 450, 200 450, 250 450 L 250 370 C 210 370, 160 370, 140 340 C 120 310, 170 260, 170 260 Z",fill:"url(#gradBlue)"}),i.jsxs("g",{transform:"translate(190, 100) scale(0.8)",fill:"white",opacity:"0.9",children:[i.jsx("rect",{x:"10",y:"10",width:"5",height:"40"}),i.jsx("rect",{x:"20",y:"10",width:"2",height:"40"}),i.jsx("rect",{x:"25",y:"10",width:"8",height:"40"}),i.jsx("rect",{x:"38",y:"10",width:"3",height:"40"}),i.jsx("rect",{x:"45",y:"10",width:"6",height:"40"}),i.jsx("rect",{x:"55",y:"10",width:"4",height:"40"}),i.jsx("rect",{x:"65",y:"10",width:"10",height:"40"}),i.jsx("text",{x:"40",y:"65",fontSize:"10",textAnchor:"middle",fontWeight:"bold",children:"||||||"})]}),i.jsx("g",{transform:"translate(350, 300) scale(0.6)",fill:"white",opacity:"0.9",children:i.jsx("path",{d:"M40 0 L50 0 L55 15 A25 25 0 0 1 65 20 L80 15 L85 25 L75 35 A25 25 0 0 1 75 45 L85 55 L80 65 L65 60 A25 25 0 0 1 55 65 L50 80 L40 80 L35 65 A25 25 0 0 1 25 60 L10 65 L5 55 L15 45 A25 25 0 0 1 15 35 L5 25 L10 15 L25 20 A25 25 0 0 1 35 15 L40 0 Z M 45 30 A 15 15 0 1 0 45 60 A 15 15 0 1 0 45 30 Z"})}),i.jsxs("g",{transform:"translate(90, 300) scale(0.6)",fill:"white",opacity:"0.9",children:[i.jsx("path",{d:"M10 40 L30 60 L60 30 L50 20 L30 40 L20 30 Z"}),i.jsx("path",{d:"M40 70 L60 50 L80 70",stroke:"white",strokeWidth:"5",fill:"none"})]}),i.jsxs("g",{transform:"translate(210, 230) scale(1.5)",children:[i.jsx("path",{d:"M10 10 L20 10 L30 40 L55 40 L60 20 L25 20",stroke:"#0f172a",strokeWidth:"3",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"}),i.jsx("text",{x:"40",y:"35",fontSize:"20",fontWeight:"bold",fill:"#0ea5e9",textAnchor:"middle",children:"€"}),i.jsx("circle",{cx:"30",cy:"45",r:"3",fill:"#0f172a"}),i.jsx("circle",{cx:"55",cy:"45",r:"3",fill:"#0f172a"})]})]}),e&&i.jsxs("div",{className:"text-center -mt-4",children:[i.jsx("h1",{className:"font-sans text-3xl font-extrabold text-slate-800 tracking-tight",children:"Gesmind"}),i.jsx("p",{className:"font-sans text-xs text-slate-500 font-medium tracking-widest uppercase mt-1",children:"Smart Business Hub"})]})]}),nx=({currentUser:n,onNavigate:e,onLogout:t,appName:s,themeColor:r,logoUrl:a,lang:o="fr",inventory:c,transactions:u,users:h,currency:f})=>{const p=k=>Qi(o,k),A=[{id:le.DASHBOARD,label:p("menu_dashboard"),description:p("menu_dashboard_desc"),icon:xg,requiredPerm:"dashboard.view"},{id:le.INVENTORY,label:p("menu_inventory"),description:p("menu_inventory_desc"),icon:Ya,requiredPerm:"inventory.view"},{id:le.COMMERCIAL,label:p("menu_commercial"),description:p("menu_commercial_desc"),icon:Dh,requiredPerm:"commercial.view"},{id:le.EXPENSES,label:p("menu_expenses"),description:p("menu_expenses_desc"),icon:ki,requiredPerm:"expenses.view"},{id:le.TREASURY,label:p("menu_treasury"),description:p("menu_treasury_desc"),icon:Fr,requiredPerm:"treasury.view"},{id:le.CUSTOMERS,label:p("menu_customers"),description:p("menu_customers_desc"),icon:bg,requiredPerm:"customers.view"},{id:le.SUPPLIERS,label:p("menu_suppliers"),description:p("menu_suppliers_desc"),icon:rc,requiredPerm:"suppliers.view"},{id:le.PERSONNEL,label:p("menu_personnel"),description:p("menu_personnel_desc"),icon:yl,requiredPerm:"personnel.view"},{id:le.USERS,label:p("menu_users"),description:p("menu_users_desc"),icon:_g,requiredPerm:"users.view"},{id:le.AI_INSIGHTS,label:p("menu_ai"),description:p("menu_ai_desc"),icon:Qn,requiredPerm:"ai.view"},{id:le.SETTINGS,label:p("menu_settings"),description:p("menu_settings_desc"),icon:Vh,requiredPerm:"settings.view"}].filter(k=>n.permissions.includes(k.requiredPerm)),P=()=>{t()};return i.jsxs("div",{className:"h-screen bg-slate-50 dark:bg-slate-900 flex flex-col items-center justify-between p-4 overflow-hidden transition-colors duration-300",children:[i.jsxs("div",{className:"text-center mt-2 mb-2 flex-shrink-0 flex flex-col items-center w-full max-w-xl",children:[a?i.jsx("img",{src:a,alt:"Logo Entreprise",className:"w-16 h-16 object-contain mb-2 drop-shadow-md"}):i.jsx("div",{className:"mb-2",children:i.jsx(em,{className:"w-16 h-16",withText:!1})}),i.jsx("h1",{className:"text-xl font-bold text-slate-800 dark:text-white leading-tight",children:s}),i.jsxs("div",{className:"mt-1 text-[10px] bg-slate-200 dark:bg-slate-800 px-3 py-0.5 rounded-full text-slate-600 dark:text-slate-300",children:[p("hello"),", ",i.jsx("span",{className:"font-bold",style:{color:r},children:n.name})]}),i.jsx("div",{className:"w-full mt-3 px-2",children:i.jsx(Zh,{inventory:c,transactions:u,users:h,currency:f,onNavigate:e})})]}),i.jsx("div",{className:"flex-1 w-full max-w-6xl flex items-start justify-center overflow-y-auto py-2 px-1",children:i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 w-full",children:A.map(k=>{const T=k.icon;return i.jsxs("button",{onClick:()=>e(k.id),className:"bg-white dark:bg-slate-800 p-3 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 hover:shadow-xl hover:-translate-y-1 transition-all duration-200 flex flex-col items-center text-center group relative overflow-hidden aspect-[4/3] md:aspect-square justify-center",style:{borderColor:"transparent"},children:[i.jsx("div",{className:"absolute inset-0 border-2 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",style:{borderColor:r}}),i.jsx("div",{className:"p-2.5 rounded-xl text-white mb-2 shadow-md group-hover:scale-110 transition-transform",style:{backgroundColor:r},children:i.jsx(T,{className:"w-6 h-6"})}),i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm",children:k.label}),i.jsx("p",{className:"text-[9px] text-slate-400 dark:text-slate-500 mt-0.5 leading-tight",children:k.description})]},k.id)})})}),i.jsxs("div",{className:"mt-2 flex flex-col items-center flex-shrink-0 pb-2",children:[i.jsxs("button",{onClick:P,className:"flex items-center text-slate-400 hover:text-red-500 transition-colors px-4 py-1.5 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 text-xs",children:[i.jsx(Xa,{className:"w-3 h-3 mr-1.5"}),p("logout")]}),i.jsxs("div",{className:"mt-1 text-[9px] text-slate-300 dark:text-slate-600",children:["v","1.0.4"]})]})]})},rx=({currentView:n,onNavigate:e,currentUser:t,onLogout:s,title:r,themeColor:a="#1e293b",lang:o="fr"})=>{const c=()=>{s()},u=h=>Qi(o,h);return i.jsx("header",{className:"text-white shadow-md sticky top-0 z-40 w-full transition-colors duration-300",style:{backgroundColor:a},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsxs("button",{onClick:()=>e(le.MENU),className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 text-white transition-colors flex items-center",title:u("back_menu"),children:[i.jsx(Oh,{className:"w-5 h-5"}),i.jsx("span",{className:"ml-2 text-sm font-medium hidden sm:inline",children:u("back_menu")})]}),r&&i.jsx("div",{className:"h-6 w-px bg-white/20 mx-2 hidden sm:block"}),r&&i.jsx("h1",{className:"text-lg font-bold text-white truncate",children:r})]}),i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsxs("div",{className:"flex items-center space-x-3 bg-white/10 py-1.5 px-3 rounded-full border border-white/10",children:[i.jsx("img",{src:t.avatar,alt:"",className:"w-6 h-6 rounded-full"}),i.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:t.name})]}),i.jsx("button",{onClick:c,className:"text-white/70 hover:text-white p-2 transition-colors",title:u("logout"),children:i.jsx(Xa,{className:"w-5 h-5"})})]})]})})},ix=({inventory:n,currency:e,transactions:t=[],expenses:s=[],currentUser:r,supervisionTarget:a})=>{const o=(r==null?void 0:r.role)==="ADMIN",c=a||r,u=!!a,h=!o||u,f=c==null?void 0:c.id,p=h?t.filter(g=>g.sellerId===f):t,_=h?s.filter(g=>g.paidBy.includes((c==null?void 0:c.name)||"")):s,A=h?n.filter(g=>g.createdBy===f):n,P=p.filter(g=>g.type==="SALE").reduce((g,v)=>g+v.totalAmount,0)*e.rate,k=p.filter(g=>g.type==="PURCHASE").reduce((g,v)=>g+v.totalAmount,0)*e.rate;let T=0;p.filter(g=>g.type==="SALE").forEach(g=>{g.items.forEach(v=>{const S=n.find(ke=>ke.id===v.productId),E=S&&S.purchasePrice||0,y=v.unitPrice-E;T+=y*v.quantity})});const U=T*e.rate,K=p.filter(g=>g.type==="SALE").reduce((g,v)=>g+v.amountPaid,0)*e.rate,D=p.filter(g=>g.type==="PURCHASE").reduce((g,v)=>g+v.amountPaid,0)*e.rate,$=_.reduce((g,v)=>g+v.amount,0)*e.rate,H=K-D-$;A.length;const Q=A.filter(g=>g.quantity<=g.minQuantity),N=g=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:e.code,minimumFractionDigits:e.code==="XOF"?0:2,maximumFractionDigits:e.code==="XOF"?0:2}).format(g),b=A.map(g=>({name:g.name.length>10?g.name.substring(0,10)+"...":g.name,stock:g.quantity,min:g.minQuantity})).slice(0,8);return i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsx("header",{className:"mb-8",children:i.jsxs("div",{className:"flex justify-between items-end",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Tableau de Bord"}),i.jsx("p",{className:"text-slate-500",children:o&&!u?"Vue Globale de l'entreprise":`Performances de ${c==null?void 0:c.name}`})]}),u?i.jsxs("span",{className:"bg-amber-100 text-amber-700 px-3 py-1 rounded-full text-xs font-bold border border-amber-200 flex items-center",children:[i.jsx(en,{className:"w-3 h-3 mr-1"})," Supervision Active"]}):!o&&i.jsxs("span",{className:"bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-xs font-bold border border-indigo-100 flex items-center",children:[i.jsx(ic,{className:"w-3 h-3 mr-1"})," Vue Personnelle"]})]})}),i.jsxs("div",{className:"mb-2 flex items-center space-x-2",children:[i.jsx(Lh,{className:"w-5 h-5 text-indigo-600"}),i.jsx("h3",{className:"text-lg font-bold text-slate-700",children:"Activité Globale (Facturé)"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col justify-between relative overflow-hidden group",children:[i.jsx("div",{className:"absolute right-0 top-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-slate-500",children:"Chiffre d'Affaires"}),i.jsx("h3",{className:"text-2xl font-bold text-blue-700 mt-1",children:N(P)})]}),i.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:i.jsx(Mh,{className:"w-5 h-5"})})]}),i.jsx("p",{className:"mt-4 text-xs text-slate-400",children:"Total ventes (encaissées ou non)"})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col justify-between relative overflow-hidden group",children:[i.jsx("div",{className:"absolute right-0 top-0 w-24 h-24 bg-purple-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-slate-500",children:"Volume d'Achats"}),i.jsx("h3",{className:"text-2xl font-bold text-purple-700 mt-1",children:N(k)})]}),i.jsx("div",{className:"p-2 bg-purple-100 rounded-lg text-purple-600",children:i.jsx(yg,{className:"w-5 h-5"})})]}),i.jsx("p",{className:"mt-4 text-xs text-slate-400",children:"Total factures fournisseurs"})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col justify-between relative overflow-hidden group",children:[i.jsx("div",{className:"absolute right-0 top-0 w-24 h-24 bg-emerald-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-slate-500",children:"Marge Commerciale"}),i.jsx("h3",{className:"text-2xl font-bold text-emerald-700 mt-1",children:N(U)})]}),i.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg text-emerald-600",children:i.jsx(Fh,{className:"w-5 h-5"})})]}),i.jsx("p",{className:"mt-4 text-xs text-slate-400",children:"Sur ventes réalisées"})]})]})]}),i.jsxs("div",{className:"mb-2 flex items-center space-x-2",children:[i.jsx(Fr,{className:"w-5 h-5 text-emerald-600"}),i.jsx("h3",{className:"text-lg font-bold text-slate-700",children:"Flux de Trésorerie (Réel)"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[i.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[i.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Entrées (Ventes)"}),i.jsxs("div",{className:"text-lg font-bold text-emerald-600 mt-1",children:["+",N(K)]})]}),i.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[i.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Sorties (Achats)"}),i.jsxs("div",{className:"text-lg font-bold text-rose-500 mt-1",children:["-",N(D)]})]}),i.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[i.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Dépenses (Charges)"}),i.jsxs("div",{className:"text-lg font-bold text-orange-500 mt-1",children:["-",N($)]})]}),i.jsxs("div",{className:`p-4 rounded-xl border ${H>=0?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[i.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Flux Net Opérationnel"}),i.jsxs("div",{className:`text-xl font-bold mt-1 ${H>=0?"text-emerald-700":"text-red-700"}`,children:[H>0?"+":"",N(H)]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center",children:[i.jsx(vg,{className:"w-5 h-5 mr-2 text-indigo-500"}),"Niveaux de Stock ",o&&!u?"(Global)":`(${c==null?void 0:c.name})`]}),i.jsx("div",{className:"h-80 w-full",children:b.length>0?i.jsx(Uh,{width:"100%",height:"100%",children:i.jsxs(wg,{data:b,margin:{top:20,right:30,left:20,bottom:5},children:[i.jsx(Ng,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),i.jsx(Ig,{dataKey:"name",stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1}),i.jsx(Eg,{stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1}),i.jsx(Bh,{cursor:{fill:"#f1f5f9"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),i.jsx(Tg,{dataKey:"stock",fill:"#6366f1",radius:[4,4,0,0],barSize:40,children:b.map((g,v)=>i.jsx(qh,{fill:g.stock<=g.min?"#f59e0b":"#6366f1"},`cell-${v}`))})]})}):i.jsxs("div",{className:"h-full flex items-center justify-center text-slate-400 text-sm",children:["Aucun produit dans ",o&&!u?"l'inventaire":"ce stock","."]})})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex justify-between items-center",children:[i.jsx("span",{children:"Alertes Stock"}),Q.length>0&&i.jsx("span",{className:"bg-amber-100 text-amber-800 text-xs px-2 py-1 rounded-full",children:Q.length})]}),i.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto pr-2",children:Q.length===0?i.jsx("p",{className:"text-sm text-slate-500 italic text-center py-8",children:"Tout est en ordre. Aucun stock critique."}):Q.map(g=>i.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-amber-50/50 rounded-lg border border-amber-100",children:[i.jsx($h,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-slate-800",children:g.name}),i.jsxs("p",{className:"text-xs text-slate-600",children:["Stock: ",i.jsx("span",{className:"font-bold text-red-600",children:g.quantity})," (Min: ",g.minQuantity,")"]})]})]},g.id))})]})]})]})},uc=[{id:"dashboard",label:"Tableau de Bord",actions:[{id:"view",label:"Voir le Dashboard"}]},{id:"inventory",label:"Stocks (Inventaire)",actions:[{id:"view",label:"Consulter"},{id:"add",label:"Ajouter Produit"},{id:"edit",label:"Modifier Produit"},{id:"delete",label:"Supprimer Produit"},{id:"view_profit",label:"Voir Marges & Prix Achat"}]},{id:"commercial",label:"Ventes/Achats",actions:[{id:"view",label:"Voir Historique"},{id:"sale",label:"Saisir Vente"},{id:"purchase",label:"Saisir Achat"},{id:"delete",label:"Supprimer Transaction"}]},{id:"expenses",label:"Dépenses",actions:[{id:"view",label:"Consulter"},{id:"manage",label:"Gérer Dépenses"}]},{id:"treasury",label:"Trésorerie",actions:[{id:"view",label:"Consulter"},{id:"manage",label:"Mouvements & Clôture"}]},{id:"customers",label:"Clients",actions:[{id:"view",label:"Consulter"},{id:"manage",label:"Ajouter/Modifier"}]},{id:"suppliers",label:"Fournisseurs",actions:[{id:"view",label:"Consulter"},{id:"manage",label:"Ajouter/Modifier"}]},{id:"personnel",label:"Personnel (RH)",actions:[{id:"view",label:"Consulter"},{id:"manage",label:"Gérer & Payer"}]},{id:"users",label:"Utilisateurs",actions:[{id:"view",label:"Voir"},{id:"manage",label:"Créer/Modifier Comptes"}]},{id:"ai",label:"Assistant IA",actions:[{id:"view",label:"Utiliser"}]},{id:"settings",label:"Paramètres",actions:[{id:"view",label:"Accès Menu"},{id:"view_profile",label:"Mon Profil"},{id:"view_store",label:"Config Boutique & IA"},{id:"view_data",label:"Cloud & Sauvegardes"}]}],mi=["Électronique","Mobilier","Accessoires","Bureautique","Réseau","Autre"],Tl={EUR:{code:"EUR",label:"Euro",symbol:"€",rate:1},GBP:{code:"GBP",label:"Livre Sterling",symbol:"£",rate:.85},CHF:{code:"CHF",label:"Franc Suisse",symbol:"CHF",rate:.95},SEK:{code:"SEK",label:"Couronne Suédoise",symbol:"kr",rate:11.2},NOK:{code:"NOK",label:"Couronne Norvégienne",symbol:"kr",rate:11.4},DKK:{code:"DKK",label:"Couronne Danoise",symbol:"kr",rate:7.45},PLN:{code:"PLN",label:"Złoty Polonais",symbol:"zł",rate:4.3},HUF:{code:"HUF",label:"Forint Hongrois",symbol:"Ft",rate:385},CZK:{code:"CZK",label:"Couronne Tchèque",symbol:"Kč",rate:24.5},RON:{code:"RON",label:"Leu Roumain",symbol:"lei",rate:4.97},RUB:{code:"RUB",label:"Rouble Russe",symbol:"₽",rate:98.5},TRY:{code:"TRY",label:"Lire Turque",symbol:"₺",rate:33.5},USD:{code:"USD",label:"Dollar Américain",symbol:"$",rate:1.08},CAD:{code:"CAD",label:"Dollar Canadien",symbol:"CA$",rate:1.48},MXN:{code:"MXN",label:"Peso Mexicain",symbol:"Mex$",rate:18.5},BRL:{code:"BRL",label:"Réal Brésilien",symbol:"R$",rate:5.35},ARS:{code:"ARS",label:"Peso Argentin",symbol:"$",rate:900},CLP:{code:"CLP",label:"Peso Chilien",symbol:"$",rate:990},COP:{code:"COP",label:"Peso Colombien",symbol:"$",rate:4200},PEN:{code:"PEN",label:"Sol Péruvien",symbol:"S/",rate:4.05},CNY:{code:"CNY",label:"Yuan Chinois",symbol:"¥",rate:7.8},JPY:{code:"JPY",label:"Yen Japonais",symbol:"¥",rate:163},INR:{code:"INR",label:"Roupie Indienne",symbol:"₹",rate:90},KRW:{code:"KRW",label:"Won Sud-Coréen",symbol:"₩",rate:1450},AUD:{code:"AUD",label:"Dollar Australien",symbol:"A$",rate:1.65},NZD:{code:"NZD",label:"Dollar Néo-Zélandais",symbol:"NZ$",rate:1.78},SGD:{code:"SGD",label:"Dollar de Singapour",symbol:"S$",rate:1.45},HKD:{code:"HKD",label:"Dollar de Hong Kong",symbol:"HK$",rate:8.45},IDR:{code:"IDR",label:"Roupie Indonésienne",symbol:"Rp",rate:17e3},MYR:{code:"MYR",label:"Ringgit Malaisien",symbol:"RM",rate:5.15},PHP:{code:"PHP",label:"Peso Philippin",symbol:"₱",rate:60.5},THB:{code:"THB",label:"Baht Thaïlandais",symbol:"฿",rate:39.5},VND:{code:"VND",label:"Dong Vietnamien",symbol:"₫",rate:26500},XOF:{code:"XOF",label:"Franc CFA (UEMOA)",symbol:"F CFA",rate:655.957},XAF:{code:"XAF",label:"Franc CFA (CEMAC)",symbol:"F CFA",rate:655.957},MAD:{code:"MAD",label:"Dirham Marocain",symbol:"DH",rate:10.8},DZD:{code:"DZD",label:"Dinar Algérien",symbol:"DA",rate:145},TND:{code:"TND",label:"Dinar Tunisien",symbol:"DT",rate:3.35},EGP:{code:"EGP",label:"Livre Égyptienne",symbol:"E£",rate:33.5},NGN:{code:"NGN",label:"Naira Nigérian",symbol:"₦",rate:1600},ZAR:{code:"ZAR",label:"Rand Sud-Africain",symbol:"R",rate:20.5},KES:{code:"KES",label:"Shilling Kényan",symbol:"KSh",rate:145},GHS:{code:"GHS",label:"Cedi Ghanéen",symbol:"GH₵",rate:13.5},AED:{code:"AED",label:"Dirham EAU",symbol:"dh",rate:4},SAR:{code:"SAR",label:"Riyal Saoudien",symbol:"﷼",rate:4.05},ILS:{code:"ILS",label:"Shekel Israélien",symbol:"₪",rate:4}},ax=[{id:"indigo",label:"Indigo",hex:"#4f46e5"},{id:"emerald",label:"Émeraude",hex:"#059669"},{id:"blue",label:"Azur",hex:"#2563eb"},{id:"violet",label:"Violet",hex:"#7c3aed"},{id:"rose",label:"Rose",hex:"#e11d48"},{id:"amber",label:"Ambre",hex:"#d97706"},{id:"slate",label:"Graphite",hex:"#475569"}],ox=()=>{const n=[];return uc.forEach(e=>{e.actions.forEach(t=>{n.push(`${e.id}.${t.id}`)})}),n};ox(),new Date().toISOString();new Date(Date.now()-1e3*60*30).toISOString(),new Date(Date.now()-1e3*60*60*24).toISOString();const lx="AIzaSyASr_E3TGXSCynKXDqaEAUCnO768BFAOyU",dc=new Sg(lx),cx=(n,e)=>I(Me,null,function*(){try{const t=JSON.stringify(n.map(u=>({name:u.name,qty:u.quantity,min:u.minQuantity,price_unit:Math.round(u.price*e.rate),total_val:Math.round(u.price*u.quantity*e.rate),cat:u.category,supplier:u.supplier}))),s=`
        Analyse cette liste de stock (JSON) et fournis un rapport de gestion stratégique.
        La devise actuelle est : ${e.label} (${e.code}).
        Tous les montants fournis dans le JSON sont déjà convertis en ${e.code}.
        
        Identifie les risques de rupture, les surstocks potentiels et donne des conseils pour optimiser la valeur du stock.
        Prends en compte la diversité des fournisseurs si mentionnés.
        
        RÉPONDS UNIQUEMENT AVEC UN OBJET JSON VALIDE suivant ce schéma, sans markdown (pas de \`\`\`json) :
        {
          "summary": "Résumé global de l'état du stock avec mention de la valeur totale",
          "alerts": ["Liste des alertes (rupture, stock bas, etc.)"],
          "suggestions": ["Conseils pour optimiser le stock"]
        }
        
        Données: ${t}
      `,c=((yield dc.getGenerativeModel({model:"gemini-2.5-flash"}).generateContent(s)).response.text()||"").replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(c)}catch(t){throw console.error("Erreur Gemini Analysis:",t),new Error(t.message||"Erreur lors de l'analyse IA")}}),ux=n=>I(Me,null,function*(){try{const e=`
      Génère des données de stock réalistes pour un produit nommé : "${n}".
      
      RÉPONDS UNIQUEMENT AVEC UN OBJET JSON VALIDE suivant ce schéma, sans markdown :
      {
        "category": "Catégorie estimée",
        "description": "Description courte marketing",
        "suggestedPrice": 0.00,
        "minQuantitySuggestion": 5,
        "suggestedSupplier": "Nom fournisseur suggéré",
        "suggestedLocation": "Emplacement type suggéré"
      }
      Note: suggestedPrice doit être un nombre en EUROS.
    `,a=((yield dc.getGenerativeModel({model:"gemini-2.5-flash"}).generateContent(e)).response.text()||"").replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(a)}catch(e){throw console.error("Erreur Gemini Generation:",e),new Error(e.message||"Erreur génération détails")}}),tm=(n,e,t)=>I(Me,null,function*(){try{const s=e?`Style/Description souhaitée : "${e}".`:"Style : Moderne, Minimaliste, Professionnel.";let r=`
      Tu es un expert en design de logo vectoriel (SVG).
      Crée un logo pour une entreprise nommée "${n}".
      
      Instructions de design :
      1. ${s}
      2. Le logo doit être vectoriel (SVG), simple, iconique et professionnel.
      3. Dimensions: viewBox="0 0 512 512".
      4. Utilise des couleurs attrayantes.
      5. IMPORTANT: Retourne SEULEMENT le code XML du <svg>. Pas de balises markdown (\`\`\`xml ou \`\`\`svg), pas de texte introductif.
      
      Code SVG :
    `,a=[{text:r}];if(t){const p=t.split(","),_=p[1]||t;let A="image/jpeg";p[0].includes(":")&&(A=p[0].split(":")[1].split(";")[0]),r+=`

Inspire-toi de l'image fournie.`,a.push({inlineData:{mimeType:A,data:_}})}let u=(yield dc.getGenerativeModel({model:"gemini-2.5-flash"}).generateContent(a)).response.text()||"";const h=u.indexOf("<svg"),f=u.lastIndexOf("</svg>");if(h!==-1&&f!==-1?u=u.substring(h,f+6):u=u.replace(/```xml/g,"").replace(/```svg/g,"").replace(/```/g,"").trim(),!u.includes("<svg"))throw new Error("Le modèle n'a pas généré de code SVG valide.");return u}catch(s){throw console.error("Erreur Gemini Logo Generation:",s),new Error(s.message||"Erreur de génération du logo")}}),dx=({items:n,onAddItem:e,onDeleteItem:t,onUpdateItem:s,currency:r,currentUser:a,suppliers:o=[],supervisionTarget:c})=>{const[u,h]=w.useState(""),[f,p]=w.useState("All"),[_,A]=w.useState(!1),[P,k]=w.useState(!1),[T,U]=w.useState(null),[K,D]=w.useState(!1),[$,H]=w.useState(""),[Q,N]=w.useState(""),[b,g]=w.useState(mi[0]),[v,S]=w.useState(0),[E,y]=w.useState(5),[ke,Y]=w.useState(0),[Fe,J]=w.useState(0),[_e,Ce]=w.useState(""),[Re,Xe]=w.useState(""),[Ee,Ne]=w.useState(""),W=(a==null?void 0:a.role)==="ADMIN",ue=a==null?void 0:a.permissions.includes("inventory.add"),Te=a==null?void 0:a.permissions.includes("inventory.edit"),ye=a==null?void 0:a.permissions.includes("inventory.delete"),re=a==null?void 0:a.permissions.includes("inventory.view_profit"),Be=!!c,Ze=c?c.id:a==null?void 0:a.id,de=(W&&!Be?n:n.filter(M=>M.createdBy===Ze)).filter(M=>{const ge=M.name.toLowerCase().includes(u.toLowerCase())||M.category.toLowerCase().includes(u.toLowerCase())||M.sku.toLowerCase().includes(u.toLowerCase())||M.supplier.toLowerCase().includes(u.toLowerCase()),De=f==="All"||M.category===f;return ge&&De}),dt=de.reduce((M,ge)=>M+(ge.purchasePrice||0)*ge.quantity,0)*r.rate,et=de.reduce((M,ge)=>{const De=ge.price-(ge.purchasePrice||0);return M+De*ge.quantity},0)*r.rate,st=()=>{H(""),N(""),g(mi[0]),S(0),y(5),Y(0),J(0),Ce(""),Xe(""),Ne(""),U(null)},ft=()=>{ue&&(st(),A(!0))},yt=M=>{Te&&(!W&&M.createdBy!==(a==null?void 0:a.id)||(U(M.id),H(M.name),N(M.sku),g(M.category),S(M.quantity),y(M.minQuantity),Y(parseFloat(((M.purchasePrice||0)*r.rate).toFixed(2))),J(parseFloat((M.price*r.rate).toFixed(2))),Ce(M.description),Xe(M.supplier),Ne(M.location),A(!0)))},Qe=M=>{ye&&window.confirm("Êtes-vous sûr de vouloir supprimer ce produit ? Cette action est irréversible.")&&t(M)},ot=()=>I(Me,null,function*(){if($.trim()){k(!0);try{const M=yield ux($);if(M){g(M.category||mi[0]),Ce(M.description||"");const ge=parseFloat((M.suggestedPrice*r.rate).toFixed(2))||0;J(ge),Y(parseFloat((ge*.7).toFixed(2))),y(M.minQuantitySuggestion||5),Ne(M.suggestedLocation||"")}}catch(M){console.error("Failed to generate details",M)}finally{k(!1)}}}),Et=M=>{M.preventDefault();const ge=Fe/r.rate,De=ke/r.rate;if(T&&Te)s(T,{name:$,sku:Q,category:b,quantity:v,minQuantity:E,purchasePrice:De,price:ge,description:_e,supplier:Re,location:Ee,lastUpdated:new Date().toISOString()});else if(ue){const fe={id:Date.now().toString(),name:$,sku:Q||`SKU-${Date.now()}`,category:b,quantity:v,minQuantity:E,purchasePrice:De,price:ge,supplier:Re||"N/A",location:Ee||"N/A",description:_e,lastUpdated:new Date().toISOString(),createdBy:a==null?void 0:a.id};e(fe)}A(!1),st()},ut=()=>{const M=["Nom","SKU","Catégorie","Quantité",`Prix Achat (${r.code})`,`Prix Vente (${r.code})`,"Fournisseur","Emplacement"],ge=de.map(xe=>[`"${xe.name.replace(/"/g,'""')}"`,xe.sku,xe.category,xe.quantity,((xe.purchasePrice||0)*r.rate).toFixed(2),(xe.price*r.rate).toFixed(2),`"${xe.supplier.replace(/"/g,'""')}"`,`"${xe.location.replace(/"/g,'""')}"`]),De=[M.join(","),...ge.map(xe=>xe.join(","))].join(`
`),fe=new Blob(["\uFEFF",De],{type:"text/csv;charset=utf-8;"});lt(fe,`inventaire_${new Date().toISOString().split("T")[0]}.csv`),D(!1)},Se=()=>{let M=`RAPPORT D'INVENTAIRE - ${new Date().toLocaleDateString()}
`;M+=`Généré par Gesmind
`,M+=`=================================================

`,de.forEach(De=>{M+=`Produit: ${De.name} (${De.sku})
`,M+=`Catégorie: ${De.category} | Stock: ${De.quantity}
`,M+=`Prix Vente: ${(De.price*r.rate).toFixed(2)} ${r.code}
`,M+=`Fournisseur: ${De.supplier} | Emplacement: ${De.location}
`,M+=`-------------------------------------------------
`});const ge=new Blob([M],{type:"text/plain;charset=utf-8;"});lt(ge,`inventaire_${new Date().toISOString().split("T")[0]}.txt`),D(!1)},oe=()=>{const M=de.map(fe=>`
      <tr>
        <td>${fe.name}</td>
        <td>${fe.sku}</td>
        <td>${fe.category}</td>
        <td style="text-align:center">${fe.quantity}</td>
        <td style="text-align:right">${(fe.price*r.rate).toFixed(2)} ${r.code}</td>
        <td>${fe.supplier}</td>
      </tr>
    `).join(""),ge=`
      <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
      <head>
        <meta charset='utf-8'>
        <title>Inventaire Export</title>
        <style>
          body { font-family: 'Arial', sans-serif; }
          table { width: 100%; border-collapse: collapse; }
          th { background-color: #f3f4f6; color: #1f2937; border: 1px solid #d1d5db; padding: 8px; text-align: left; }
          td { border: 1px solid #d1d5db; padding: 8px; }
          h1 { color: #4f46e5; }
        </style>
      </head>
      <body>
        <h1>Liste des Stocks</h1>
        <p>Date: ${new Date().toLocaleDateString()}</p>
        <table>
          <thead>
            <tr>
              <th>Nom</th>
              <th>Ref</th>
              <th>Catégorie</th>
              <th>Qté</th>
              <th>Prix</th>
              <th>Fournisseur</th>
            </tr>
          </thead>
          <tbody>
            ${M}
          </tbody>
        </table>
      </body>
      </html>
    `,De=new Blob([ge],{type:"application/msword"});lt(De,`inventaire_${new Date().toISOString().split("T")[0]}.doc`),D(!1)},lt=(M,ge)=>{const De=URL.createObjectURL(M),fe=document.createElement("a");fe.href=De,fe.download=ge,document.body.appendChild(fe),fe.click(),document.body.removeChild(fe)},B=Fe-ke,ie=ke*v,ve=Fe*v,nt=ve-ie;return i.jsxs("div",{className:"space-y-4 animate-fade-in flex flex-col h-[85vh]",children:[K&&i.jsx("div",{className:"fixed inset-0 z-20",onClick:()=>D(!1)}),i.jsxs("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-2 flex-shrink-0",children:[i.jsx("div",{children:i.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center",children:["Liste des Stocks",Be?i.jsxs("span",{className:"ml-2 text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded-full border border-amber-200 flex items-center",children:[i.jsx(en,{className:"w-3 h-3 mr-1"})," Supervision: ",c==null?void 0:c.name]}):!W&&i.jsxs("span",{className:"ml-2 text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full border border-indigo-200 flex items-center",children:[i.jsx(ic,{className:"w-3 h-3 mr-1"})," Personnel"]})]})}),i.jsxs("div",{className:"flex items-center gap-2 relative",children:[i.jsxs("div",{className:"relative z-30",children:[i.jsxs("button",{onClick:()=>D(!K),className:"bg-slate-100 hover:bg-slate-200 text-slate-700 px-3 py-2 rounded-lg font-medium flex items-center transition-colors text-sm",children:[i.jsx(ac,{className:"w-4 h-4 mr-1.5"}),i.jsx("span",{className:"hidden sm:inline mr-1",children:"Exporter"}),i.jsx(Za,{className:"w-3 h-3"})]}),K&&i.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden animate-fade-in-up",children:[i.jsxs("button",{onClick:ut,className:"w-full text-left px-4 py-3 hover:bg-emerald-50 hover:text-emerald-700 flex items-center transition-colors",children:[i.jsx(Gh,{className:"w-4 h-4 mr-2 text-emerald-600"}),i.jsx("span",{className:"text-sm font-medium",children:"Excel (.csv)"})]}),i.jsxs("button",{onClick:oe,className:"w-full text-left px-4 py-3 hover:bg-blue-50 hover:text-blue-700 flex items-center transition-colors border-t border-slate-50",children:[i.jsx(Cs,{className:"w-4 h-4 mr-2 text-blue-600"}),i.jsx("span",{className:"text-sm font-medium",children:"Word (.doc)"})]}),i.jsxs("button",{onClick:Se,className:"w-full text-left px-4 py-3 hover:bg-slate-50 hover:text-slate-700 flex items-center transition-colors border-t border-slate-50",children:[i.jsx(zh,{className:"w-4 h-4 mr-2 text-slate-500"}),i.jsx("span",{className:"text-sm font-medium",children:"Texte (.txt)"})]})]})]}),ue&&i.jsxs("button",{onClick:ft,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg font-medium flex items-center shadow-md shadow-indigo-200 transition-all hover:scale-105 text-sm",children:[i.jsx(Qs,{className:"w-4 h-4 mr-1.5"}),i.jsx("span",{className:"hidden sm:inline",children:"Ajouter produit"}),i.jsx("span",{className:"sm:hidden",children:"Ajouter"})]})]})]}),re&&i.jsxs("div",{className:"grid grid-cols-2 gap-3 flex-shrink-0",children:[i.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm border border-slate-100 flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:"Valeur Achat Totale"}),i.jsx("p",{className:"text-base font-bold text-slate-700",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:r.code}).format(dt)})]}),i.jsx("div",{className:"bg-blue-50 p-1.5 rounded-md",children:i.jsx(Ya,{className:"w-4 h-4 text-blue-500"})})]}),i.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm border border-slate-100 flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:"Bénéfice Potentiel"}),i.jsx("p",{className:"text-base font-bold text-emerald-600",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:r.code}).format(et)})]}),i.jsx("div",{className:"bg-emerald-50 p-1.5 rounded-md",children:i.jsx(eo,{className:"w-4 h-4 text-emerald-500"})})]})]}),i.jsxs("div",{className:"flex flex-col md:flex-row gap-2 bg-white p-2 rounded-lg shadow-sm border border-slate-100 flex-shrink-0",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(Xn,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"}),i.jsx("input",{type:"text",placeholder:W&&!Be?"Rechercher un produit...":"Rechercher dans le stock...",className:"w-full pl-9 pr-4 py-1.5 text-sm border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500",value:u,onChange:M=>h(M.target.value)})]}),i.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto pb-1 md:pb-0",children:[i.jsx(Kh,{className:"text-slate-400 w-4 h-4 flex-shrink-0"}),i.jsx("button",{onClick:()=>p("All"),className:`px-2 py-1 rounded-md text-xs whitespace-nowrap transition-colors ${f==="All"?"bg-slate-800 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:"Tout"}),mi.map(M=>i.jsx("button",{onClick:()=>p(M),className:`px-2 py-1 rounded-md text-xs whitespace-nowrap transition-colors ${f===M?"bg-indigo-100 text-indigo-700 font-medium":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:M},M))]})]}),i.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden flex-1 flex flex-col min-h-[60vh]",children:i.jsx("div",{className:"overflow-auto flex-1",children:i.jsxs("table",{className:"w-full text-left border-collapse",children:[i.jsx("thead",{className:"bg-slate-50 border-b border-slate-200 sticky top-0 z-10 shadow-sm",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50",children:"Produit"}),i.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50",children:"Stock"}),i.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right bg-slate-50",children:"Prix Achat"}),i.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right bg-slate-50",children:"Prix Vente"}),re&&i.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right bg-slate-50",children:"Bénéfice Unitaire"}),i.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right bg-slate-50",children:"Actions"})]})}),i.jsxs("tbody",{className:"divide-y divide-slate-100",children:[de.map(M=>{const ge=(M.price-(M.purchasePrice||0))*r.rate;return i.jsxs("tr",{className:"hover:bg-slate-50 transition-colors group",children:[i.jsx("td",{className:"px-6 py-4",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-bold text-slate-800",children:M.name}),i.jsx("span",{className:"text-xs text-slate-500 font-mono mb-1",children:M.sku}),i.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium bg-slate-100 text-slate-600 w-fit",children:M.category})]})}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${M.quantity<=M.minQuantity?"bg-red-500 animate-pulse":"bg-emerald-500"}`}),i.jsx("span",{className:`font-bold ${M.quantity<=M.minQuantity?"text-red-600":"text-slate-700"}`,children:M.quantity})]}),M.quantity<=M.minQuantity&&i.jsx("span",{className:"text-[10px] text-red-500 font-medium block mt-0.5",children:"Stock Faible"})]}),i.jsx("td",{className:"px-6 py-4 text-right text-sm text-slate-500",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:r.code}).format((M.purchasePrice||0)*r.rate)}),i.jsx("td",{className:"px-6 py-4 text-right font-bold text-sm text-slate-700",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:r.code}).format(M.price*r.rate)}),re&&i.jsx("td",{className:"px-6 py-4 text-right font-mono text-sm font-bold",children:i.jsxs("span",{className:ge>=0?"text-emerald-600":"text-red-600",children:[ge>0?"+":"",new Intl.NumberFormat("fr-FR",{style:"currency",currency:r.code}).format(ge)]})}),i.jsxs("td",{className:"px-6 py-4 text-right space-x-2",children:[Te&&i.jsx("button",{onClick:()=>yt(M),className:"p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Modifier",children:i.jsx(Wi,{className:"w-4 h-4"})}),ye&&i.jsx("button",{onClick:()=>Qe(M.id),className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Supprimer",children:i.jsx(Vs,{className:"w-4 h-4"})}),!Te&&!ye&&i.jsx("span",{className:"text-xs text-slate-400 italic",children:"Lecture seule"})]})]},M.id)}),de.length===0&&i.jsx("tr",{children:i.jsxs("td",{colSpan:re?6:5,className:"px-6 py-12 text-center text-slate-400",children:[i.jsx(Ya,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),i.jsx("p",{children:"Aucun produit trouvé."})]})})]})]})})}),_&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-6 animate-fade-in-up my-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-slate-100 pb-4",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800",children:T?"Modifier le produit":"Ajouter un nouveau produit"}),i.jsx("button",{onClick:()=>A(!1),className:"text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"w-6 h-6"})})]}),i.jsxs("form",{onSubmit:Et,className:"space-y-6",children:[!T&&i.jsx("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100 relative overflow-hidden",children:i.jsxs("div",{className:"relative z-10",children:[i.jsxs("label",{className:"block text-sm font-bold text-indigo-900 mb-2 flex items-center",children:[i.jsx(Ag,{className:`w-4 h-4 mr-2 ${P?"animate-spin":""}`}),"Remplissage Automatique IA"]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"text",placeholder:"Ex: iPhone 15 Pro Max 256Go...",className:"flex-1 px-3 py-2 border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20",value:$,onChange:M=>H(M.target.value)}),i.jsx("button",{type:"button",onClick:ot,disabled:!$||P,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-indigo-700 disabled:opacity-70",children:P?"Génération...":"Auto-remplir"})]}),i.jsx("p",{className:"text-xs text-indigo-600 mt-2",children:"Entrez un nom et laissez Gemini générer la catégorie, le prix estimé, la description et l'emplacement."})]})}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nom du produit"}),i.jsx("input",{required:!0,type:"text",className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:$,onChange:M=>H(M.target.value)})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1 flex items-center",children:[i.jsx(jg,{className:"w-3 h-3 mr-1"})," SKU / Référence"]}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-slate-200 rounded-lg font-mono text-sm",value:Q,onChange:M=>N(M.target.value),placeholder:"AUTO-GEN si vide"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Catégorie"}),i.jsx("select",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:b,onChange:M=>g(M.target.value),children:mi.map(M=>i.jsx("option",{value:M,children:M},M))})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1 flex items-center",children:[i.jsx(rc,{className:"w-3 h-3 mr-1"})," Fournisseur"]}),i.jsxs("select",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:Re,onChange:M=>Xe(M.target.value),children:[i.jsx("option",{value:"",children:"-- Sélectionner --"}),o.map(M=>i.jsx("option",{value:M.name,children:M.name},M.id)),i.jsx("option",{value:"Autre",children:"Autre / Inconnu"})]})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Quantité"}),i.jsx("input",{required:!0,type:"number",min:"0",className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:v,onChange:M=>S(parseInt(M.target.value)||0)})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Min. Alerte"}),i.jsx("input",{required:!0,type:"number",min:"0",className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:E,onChange:M=>y(parseInt(M.target.value)||0)})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 bg-slate-50 p-3 rounded-lg border border-slate-100",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Prix Achat Unitaire"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{required:!0,type:"number",min:"0",step:"0.01",className:"w-full px-2 py-1.5 border border-slate-200 rounded-md text-sm pr-6",value:ke,onChange:M=>Y(parseFloat(M.target.value)||0)}),i.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:r.code})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-indigo-600 mb-1",children:"Prix Vente Unitaire"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{required:!0,type:"number",min:"0",step:"0.01",className:"w-full px-2 py-1.5 border border-indigo-200 rounded-md text-sm font-bold text-indigo-700 pr-6",value:Fe,onChange:M=>J(parseFloat(M.target.value)||0)}),i.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-indigo-400",children:r.code})]})]}),i.jsxs("div",{className:"col-span-2 flex justify-between items-center text-xs pt-1 border-t border-slate-200",children:[i.jsx("span",{className:"text-slate-500",children:"Marge unitaire :"}),i.jsxs("span",{className:`font-bold ${B>=0?"text-emerald-600":"text-red-500"}`,children:[B>=0?"+":"",B.toFixed(2)," ",r.code]})]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1 flex items-center",children:[i.jsx(oc,{className:"w-3 h-3 mr-1"})," Emplacement"]}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:Ee,onChange:M=>Ne(M.target.value),placeholder:"Ex: Rayon A, Etagère 2"})]})]})]}),i.jsxs("div",{className:"bg-slate-100 p-4 rounded-xl border border-slate-200",children:[i.jsxs("h4",{className:"text-xs font-bold text-slate-500 uppercase mb-2 flex items-center",children:[i.jsx(Cg,{className:"w-3 h-3 mr-1"})," Valeurs Totales du Lot (",v," unités)"]}),i.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm text-center",children:[i.jsxs("div",{className:"bg-white p-2 rounded-lg border border-slate-100",children:[i.jsx("span",{className:"block text-slate-500 text-xs mb-1",children:"Achat Global"}),i.jsx("span",{className:"font-bold text-slate-700",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:r.code}).format(ie)})]}),i.jsxs("div",{className:"bg-white p-2 rounded-lg border border-slate-100",children:[i.jsx("span",{className:"block text-indigo-500 text-xs mb-1",children:"Vente Global"}),i.jsx("span",{className:"font-bold text-indigo-700",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:r.code}).format(ve)})]}),i.jsxs("div",{className:"bg-white p-2 rounded-lg border border-slate-100",children:[i.jsx("span",{className:"block text-emerald-600 text-xs mb-1",children:"Bénéfice Global"}),i.jsxs("span",{className:`font-bold ${nt>=0?"text-emerald-600":"text-red-600"}`,children:[nt>=0?"+":"",new Intl.NumberFormat("fr-FR",{style:"currency",currency:r.code}).format(nt)]})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Description"}),i.jsx("textarea",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg h-24 resize-none",value:_e,onChange:M=>Ce(M.target.value)})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-slate-100",children:[i.jsx("button",{type:"button",onClick:()=>A(!1),className:"px-6 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Annuler"}),i.jsxs("button",{type:"submit",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 shadow-lg shadow-indigo-200 flex items-center",children:[i.jsx(Eo,{className:"w-4 h-4 mr-2"}),T?"Enregistrer les modifications":"Ajouter au stock"]})]})]})]})})]})},hx=({items:n,currency:e})=>{const[t,s]=w.useState(null),[r,a]=w.useState(!1),[o,c]=w.useState(null),u=()=>I(Me,null,function*(){a(!0),c(null);try{const h=yield cx(n,e);s(h)}catch(h){c("Impossible d'obtenir l'analyse IA. Vérifiez votre clé API ou réessayez plus tard.")}finally{a(!1)}});return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("header",{className:"mb-8",children:[i.jsxs("h2",{className:"text-3xl font-bold text-slate-800 flex items-center",children:[i.jsx(Rg,{className:"w-8 h-8 text-indigo-600 mr-3"}),"Assistant Intelligent"]}),i.jsx("p",{className:"text-slate-500 mt-2",children:"Utilisez la puissance de Gemini pour détecter les anomalies et optimiser votre stock."})]}),!t&&!r&&i.jsxs("div",{className:"bg-white rounded-2xl p-10 text-center shadow-sm border border-slate-100",children:[i.jsx("div",{className:"bg-indigo-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6",children:i.jsx(Qn,{className:"w-10 h-10 text-indigo-600"})}),i.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Prêt à analyser votre inventaire ?"}),i.jsxs("p",{className:"text-slate-500 mb-8 max-w-md mx-auto",children:["Notre IA va scanner vos ",n.length," produits pour identifier les risques de rupture, les surstocks et les opportunités d'optimisation (Analyse en ",e.label,")."]}),i.jsx("button",{onClick:u,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-xl shadow-indigo-200 transition-all hover:scale-105 active:scale-95",children:"Lancer l'Analyse Intelligente"})]}),r&&i.jsxs("div",{className:"bg-white rounded-2xl p-16 text-center shadow-sm border border-slate-100",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),i.jsx("p",{className:"text-lg font-medium text-slate-700",children:"Gemini analyse vos données..."}),i.jsx("p",{className:"text-sm text-slate-400 mt-2",children:"Cela ne prend que quelques secondes."})]}),o&&i.jsxs("div",{className:"bg-red-50 text-red-700 p-6 rounded-xl border border-red-100 flex items-start space-x-3",children:[i.jsx(to,{className:"w-6 h-6 flex-shrink-0"}),i.jsx("p",{children:o})]}),t&&!r&&i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 animate-fade-in",children:[i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 lg:col-span-2",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center",children:[i.jsx(Qn,{className:"w-5 h-5 text-indigo-500 mr-2"}),"Synthèse Stratégique"]}),i.jsx("p",{className:"text-slate-600 leading-relaxed text-lg",children:t.summary})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 border-l-4 border-l-amber-500",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center",children:[i.jsx(to,{className:"w-5 h-5 text-amber-500 mr-2"}),"Alertes Critiques"]}),i.jsx("ul",{className:"space-y-3",children:t.alerts.map((h,f)=>i.jsxs("li",{className:"flex items-start bg-amber-50/50 p-3 rounded-lg",children:[i.jsx("span",{className:"w-2 h-2 mt-2 bg-amber-500 rounded-full mr-3 flex-shrink-0"}),i.jsx("span",{className:"text-slate-700",children:h})]},f))})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 border-l-4 border-l-green-500",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center",children:[i.jsx(Ur,{className:"w-5 h-5 text-green-500 mr-2"}),"Recommandations d'Optimisation"]}),i.jsx("ul",{className:"space-y-3",children:t.suggestions.map((h,f)=>i.jsxs("li",{className:"flex items-start bg-green-50/50 p-3 rounded-lg",children:[i.jsx(kr,{className:"w-4 h-4 mt-1 text-green-600 mr-3 flex-shrink-0"}),i.jsx("span",{className:"text-slate-700",children:h})]},f))})]}),i.jsx("div",{className:"lg:col-span-2 flex justify-end",children:i.jsxs("button",{onClick:u,className:"text-indigo-600 hover:text-indigo-800 font-medium text-sm flex items-center bg-indigo-50 px-4 py-2 rounded-lg",children:[i.jsx(Qn,{className:"w-4 h-4 mr-2"})," Actualiser l'analyse"]})})]})]})};var Wu={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sm=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},mx=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const a=n[t++];e[s++]=String.fromCharCode((r&31)<<6|a&63)}else if(r>239&&r<365){const a=n[t++],o=n[t++],c=n[t++],u=((r&7)<<18|(a&63)<<12|(o&63)<<6|c&63)-65536;e[s++]=String.fromCharCode(55296+(u>>10)),e[s++]=String.fromCharCode(56320+(u&1023))}else{const a=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(a&63)<<6|o&63)}}return e.join("")},nm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const a=n[r],o=r+1<n.length,c=o?n[r+1]:0,u=r+2<n.length,h=u?n[r+2]:0,f=a>>2,p=(a&3)<<4|c>>4;let _=(c&15)<<2|h>>6,A=h&63;u||(A=64,o||(_=64)),s.push(t[f],t[p],t[_],t[A])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(sm(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):mx(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const a=t[n.charAt(r++)],c=r<n.length?t[n.charAt(r)]:0;++r;const h=r<n.length?t[n.charAt(r)]:64;++r;const p=r<n.length?t[n.charAt(r)]:64;if(++r,a==null||c==null||h==null||p==null)throw new fx;const _=a<<2|c>>4;if(s.push(_),h!==64){const A=c<<4&240|h>>2;if(s.push(A),p!==64){const P=h<<6&192|p;s.push(P)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class fx extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const px=function(n){const e=sm(n);return nm.encodeByteArray(e,!0)},ro=function(n){return px(n).replace(/\./g,"")},rm=function(n){try{return nm.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gx(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xx=()=>gx().__FIREBASE_DEFAULTS__,bx=()=>{if(typeof process=="undefined"||typeof Wu=="undefined")return;const n=Wu.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},_x=()=>{if(typeof document=="undefined")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=n&&rm(n[1]);return e&&JSON.parse(e)},Ao=()=>{try{return xx()||bx()||_x()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},im=n=>{var e,t;return(t=(e=Ao())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},yx=n=>{const e=im(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},am=()=>{var n;return(n=Ao())===null||n===void 0?void 0:n.config},om=n=>{var e;return(e=Ao())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vx{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wx(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,a=n.sub||n.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}}},n);return[ro(JSON.stringify(t)),ro(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jt(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Nx(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(jt())}function Ix(){var n;const e=(n=Ao())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(t){return!1}}function Ex(){return typeof navigator!="undefined"&&navigator.userAgent==="Cloudflare-Workers"}function Tx(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Sx(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ax(){const n=jt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function lm(){return!Ix()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function cm(){try{return typeof indexedDB=="object"}catch(n){return!1}}function jx(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var a;e(((a=r.error)===null||a===void 0?void 0:a.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cx="FirebaseError";class tn extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Cx,Object.setPrototypeOf(this,tn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ji.prototype.create)}}class Ji{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,a=this.errors[e],o=a?Rx(a,s):"Error",c=`${this.serviceName}: ${o} (${r}).`;return new tn(r,c,s)}}function Rx(n,e){return n.replace(Px,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const Px=/\{\$([^}]+)}/g;function kx(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function io(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const a=n[r],o=e[r];if(Qu(a)&&Qu(o)){if(!io(a,o))return!1}else if(a!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function Qu(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yi(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Dx(n,e){const t=new Vx(n,e);return t.subscribe.bind(t)}class Vx{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");Ox(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=al),r.error===void 0&&(r.error=al),r.complete===void 0&&(r.complete=al);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(o){}}),this.observers.push(r),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console!="undefined"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ox(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function al(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ot(n){return n&&n._delegate?n._delegate:n}class Zn{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $n="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lx{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new vx;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch(r){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(a){if(r)return null;throw a}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Fx(e))try{this.getOrInitializeService({instanceIdentifier:$n})}catch(t){}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:r});s.resolve(a)}catch(a){}}}}clearInstance(e=$n){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return I(this,null,function*(){const e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=$n){return this.instances.has(e)}getOptions(e=$n){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[a,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(a);s===c&&o.resolve(r)}return r}onInit(e,t){var s;const r=this.normalizeInstanceIdentifier(t),a=(s=this.onInitCallbacks.get(r))!==null&&s!==void 0?s:new Set;a.add(e),this.onInitCallbacks.set(r,a);const o=this.instances.get(r);return o&&e(o,r),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch(a){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Mx(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch(r){}return s||null}normalizeInstanceIdentifier(e=$n){return this.component?this.component.multipleInstances?e:$n:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Mx(n){return n===$n?void 0:n}function Fx(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Lx(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Oe||(Oe={}));const Bx={debug:Oe.DEBUG,verbose:Oe.VERBOSE,info:Oe.INFO,warn:Oe.WARN,error:Oe.ERROR,silent:Oe.SILENT},qx=Oe.INFO,$x={[Oe.DEBUG]:"log",[Oe.VERBOSE]:"log",[Oe.INFO]:"info",[Oe.WARN]:"warn",[Oe.ERROR]:"error"},Gx=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=$x[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class hc{constructor(e){this.name=e,this._logLevel=qx,this._logHandler=Gx,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Oe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Bx[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Oe.DEBUG,...e),this._logHandler(this,Oe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Oe.VERBOSE,...e),this._logHandler(this,Oe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Oe.INFO,...e),this._logHandler(this,Oe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Oe.WARN,...e),this._logHandler(this,Oe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Oe.ERROR,...e),this._logHandler(this,Oe.ERROR,...e)}}const zx=(n,e)=>e.some(t=>n instanceof t);let Ju,Yu;function Kx(){return Ju||(Ju=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Hx(){return Yu||(Yu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const um=new WeakMap,Sl=new WeakMap,dm=new WeakMap,ol=new WeakMap,mc=new WeakMap;function Wx(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",a),n.removeEventListener("error",o)},a=()=>{t(yn(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",a),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&um.set(t,n)}).catch(()=>{}),mc.set(e,n),e}function Qx(n){if(Sl.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",o),n.removeEventListener("abort",o)},a=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",a),n.addEventListener("error",o),n.addEventListener("abort",o)});Sl.set(n,e)}let Al={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Sl.get(n);if(e==="objectStoreNames")return n.objectStoreNames||dm.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return yn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Jx(n){Al=n(Al)}function Yx(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(ll(this),e,...t);return dm.set(s,e.sort?e.sort():[e]),yn(s)}:Hx().includes(n)?function(...e){return n.apply(ll(this),e),yn(um.get(this))}:function(...e){return yn(n.apply(ll(this),e))}}function Xx(n){return typeof n=="function"?Yx(n):(n instanceof IDBTransaction&&Qx(n),zx(n,Kx())?new Proxy(n,Al):n)}function yn(n){if(n instanceof IDBRequest)return Wx(n);if(ol.has(n))return ol.get(n);const e=Xx(n);return e!==n&&(ol.set(n,e),mc.set(e,n)),e}const ll=n=>mc.get(n);function Zx(n,e,{blocked:t,upgrade:s,blocking:r,terminated:a}={}){const o=indexedDB.open(n,e),c=yn(o);return s&&o.addEventListener("upgradeneeded",u=>{s(yn(o.result),u.oldVersion,u.newVersion,yn(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{a&&u.addEventListener("close",()=>a()),r&&u.addEventListener("versionchange",h=>r(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const e0=["get","getKey","getAll","getAllKeys","count"],t0=["put","add","delete","clear"],cl=new Map;function Xu(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(cl.get(e))return cl.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=t0.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||e0.includes(t)))return;const a=function(o,...c){return I(this,null,function*(){const u=this.transaction(o,r?"readwrite":"readonly");let h=u.store;return s&&(h=h.index(c.shift())),(yield Promise.all([h[t](...c),r&&u.done]))[0]})};return cl.set(e,a),a}Jx(n=>Ue(je({},n),{get:(e,t,s)=>Xu(e,t)||n.get(e,t,s),has:(e,t)=>!!Xu(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(n0(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function n0(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const jl="@firebase/app",Zu="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Js=new hc("@firebase/app"),r0="@firebase/app-compat",i0="@firebase/analytics-compat",a0="@firebase/analytics",o0="@firebase/app-check-compat",l0="@firebase/app-check",c0="@firebase/auth",u0="@firebase/auth-compat",d0="@firebase/database",h0="@firebase/data-connect",m0="@firebase/database-compat",f0="@firebase/functions",p0="@firebase/functions-compat",g0="@firebase/installations",x0="@firebase/installations-compat",b0="@firebase/messaging",_0="@firebase/messaging-compat",y0="@firebase/performance",v0="@firebase/performance-compat",w0="@firebase/remote-config",N0="@firebase/remote-config-compat",I0="@firebase/storage",E0="@firebase/storage-compat",T0="@firebase/firestore",S0="@firebase/vertexai-preview",A0="@firebase/firestore-compat",j0="firebase",C0="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl="[DEFAULT]",R0={[jl]:"fire-core",[r0]:"fire-core-compat",[a0]:"fire-analytics",[i0]:"fire-analytics-compat",[l0]:"fire-app-check",[o0]:"fire-app-check-compat",[c0]:"fire-auth",[u0]:"fire-auth-compat",[d0]:"fire-rtdb",[h0]:"fire-data-connect",[m0]:"fire-rtdb-compat",[f0]:"fire-fn",[p0]:"fire-fn-compat",[g0]:"fire-iid",[x0]:"fire-iid-compat",[b0]:"fire-fcm",[_0]:"fire-fcm-compat",[y0]:"fire-perf",[v0]:"fire-perf-compat",[w0]:"fire-rc",[N0]:"fire-rc-compat",[I0]:"fire-gcs",[E0]:"fire-gcs-compat",[T0]:"fire-fst",[A0]:"fire-fst-compat",[S0]:"fire-vertex","fire-js":"fire-js",[j0]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ao=new Map,P0=new Map,Rl=new Map;function ed(n,e){try{n.container.addComponent(e)}catch(t){Js.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Br(n){const e=n.name;if(Rl.has(e))return Js.debug(`There were multiple attempts to register component ${e}.`),!1;Rl.set(e,n);for(const t of ao.values())ed(t,n);for(const t of P0.values())ed(t,n);return!0}function fc(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Gs(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k0={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vn=new Ji("app","Firebase",k0);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(e,t,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Zn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yr=C0;function hm(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s=Object.assign({name:Cl,automaticDataCollectionEnabled:!1},e),r=s.name;if(typeof r!="string"||!r)throw vn.create("bad-app-name",{appName:String(r)});if(t||(t=am()),!t)throw vn.create("no-options");const a=ao.get(r);if(a){if(io(t,a.options)&&io(s,a.config))return a;throw vn.create("duplicate-app",{appName:r})}const o=new Ux(r);for(const u of Rl.values())o.addComponent(u);const c=new D0(t,s,o);return ao.set(r,c),c}function mm(n=Cl){const e=ao.get(n);if(!e&&n===Cl&&am())return hm();if(!e)throw vn.create("no-app",{appName:n});return e}function wn(n,e,t){var s;let r=(s=R0[n])!==null&&s!==void 0?s:n;t&&(r+=`-${t}`);const a=r.match(/\s|\//),o=e.match(/\s|\//);if(a||o){const c=[`Unable to register library "${r}" with version "${e}":`];a&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),a&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Js.warn(c.join(" "));return}Br(new Zn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V0="firebase-heartbeat-database",O0=1,Vi="firebase-heartbeat-store";let ul=null;function fm(){return ul||(ul=Zx(V0,O0,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Vi)}catch(t){console.warn(t)}}}}).catch(n=>{throw vn.create("idb-open",{originalErrorMessage:n.message})})),ul}function L0(n){return I(this,null,function*(){try{const t=(yield fm()).transaction(Vi),s=yield t.objectStore(Vi).get(pm(n));return yield t.done,s}catch(e){if(e instanceof tn)Js.warn(e.message);else{const t=vn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Js.warn(t.message)}}})}function td(n,e){return I(this,null,function*(){try{const s=(yield fm()).transaction(Vi,"readwrite");yield s.objectStore(Vi).put(e,pm(n)),yield s.done}catch(t){if(t instanceof tn)Js.warn(t.message);else{const s=vn.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Js.warn(s.message)}}})}function pm(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M0=1024,F0=30*24*60*60*1e3;class U0{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new q0(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}triggerHeartbeat(){return I(this,null,function*(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=sd();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(o=>o.date===a)?void 0:(this._heartbeatsCache.heartbeats.push({date:a,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const c=new Date(o.date).valueOf();return Date.now()-c<=F0}),this._storage.overwrite(this._heartbeatsCache))}catch(s){Js.warn(s)}})}getHeartbeatsHeader(){return I(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=sd(),{heartbeatsToSend:s,unsentEntries:r}=B0(this._heartbeatsCache.heartbeats),a=ro(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return Js.warn(t),""}})}}function sd(){return new Date().toISOString().substring(0,10)}function B0(n,e=M0){const t=[];let s=n.slice();for(const r of n){const a=t.find(o=>o.agent===r.agent);if(a){if(a.dates.push(r.date),nd(t)>e){a.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),nd(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class q0{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return I(this,null,function*(){return cm()?jx().then(()=>!0).catch(()=>!1):!1})}read(){return I(this,null,function*(){if(yield this._canUseIndexedDBPromise){const t=yield L0(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return I(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const r=yield this.read();return td(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return I(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const r=yield this.read();return td(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}}function nd(n){return ro(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $0(n){Br(new Zn("platform-logger",e=>new s0(e),"PRIVATE")),Br(new Zn("heartbeat",e=>new U0(e),"PRIVATE")),wn(jl,Zu,n),wn(jl,Zu,"esm2017"),wn("fire-js","")}$0("");var rd=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Jn,gm;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(N,b){function g(){}g.prototype=b.prototype,N.D=b.prototype,N.prototype=new g,N.prototype.constructor=N,N.C=function(v,S,E){for(var y=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)y[ke-2]=arguments[ke];return b.prototype[S].apply(v,y)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,t),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(N,b,g){g||(g=0);var v=Array(16);if(typeof b=="string")for(var S=0;16>S;++S)v[S]=b.charCodeAt(g++)|b.charCodeAt(g++)<<8|b.charCodeAt(g++)<<16|b.charCodeAt(g++)<<24;else for(S=0;16>S;++S)v[S]=b[g++]|b[g++]<<8|b[g++]<<16|b[g++]<<24;b=N.g[0],g=N.g[1],S=N.g[2];var E=N.g[3],y=b+(E^g&(S^E))+v[0]+3614090360&4294967295;b=g+(y<<7&4294967295|y>>>25),y=E+(S^b&(g^S))+v[1]+3905402710&4294967295,E=b+(y<<12&4294967295|y>>>20),y=S+(g^E&(b^g))+v[2]+606105819&4294967295,S=E+(y<<17&4294967295|y>>>15),y=g+(b^S&(E^b))+v[3]+3250441966&4294967295,g=S+(y<<22&4294967295|y>>>10),y=b+(E^g&(S^E))+v[4]+4118548399&4294967295,b=g+(y<<7&4294967295|y>>>25),y=E+(S^b&(g^S))+v[5]+1200080426&4294967295,E=b+(y<<12&4294967295|y>>>20),y=S+(g^E&(b^g))+v[6]+2821735955&4294967295,S=E+(y<<17&4294967295|y>>>15),y=g+(b^S&(E^b))+v[7]+4249261313&4294967295,g=S+(y<<22&4294967295|y>>>10),y=b+(E^g&(S^E))+v[8]+1770035416&4294967295,b=g+(y<<7&4294967295|y>>>25),y=E+(S^b&(g^S))+v[9]+2336552879&4294967295,E=b+(y<<12&4294967295|y>>>20),y=S+(g^E&(b^g))+v[10]+4294925233&4294967295,S=E+(y<<17&4294967295|y>>>15),y=g+(b^S&(E^b))+v[11]+2304563134&4294967295,g=S+(y<<22&4294967295|y>>>10),y=b+(E^g&(S^E))+v[12]+1804603682&4294967295,b=g+(y<<7&4294967295|y>>>25),y=E+(S^b&(g^S))+v[13]+4254626195&4294967295,E=b+(y<<12&4294967295|y>>>20),y=S+(g^E&(b^g))+v[14]+2792965006&4294967295,S=E+(y<<17&4294967295|y>>>15),y=g+(b^S&(E^b))+v[15]+1236535329&4294967295,g=S+(y<<22&4294967295|y>>>10),y=b+(S^E&(g^S))+v[1]+4129170786&4294967295,b=g+(y<<5&4294967295|y>>>27),y=E+(g^S&(b^g))+v[6]+3225465664&4294967295,E=b+(y<<9&4294967295|y>>>23),y=S+(b^g&(E^b))+v[11]+643717713&4294967295,S=E+(y<<14&4294967295|y>>>18),y=g+(E^b&(S^E))+v[0]+3921069994&4294967295,g=S+(y<<20&4294967295|y>>>12),y=b+(S^E&(g^S))+v[5]+3593408605&4294967295,b=g+(y<<5&4294967295|y>>>27),y=E+(g^S&(b^g))+v[10]+38016083&4294967295,E=b+(y<<9&4294967295|y>>>23),y=S+(b^g&(E^b))+v[15]+3634488961&4294967295,S=E+(y<<14&4294967295|y>>>18),y=g+(E^b&(S^E))+v[4]+3889429448&4294967295,g=S+(y<<20&4294967295|y>>>12),y=b+(S^E&(g^S))+v[9]+568446438&4294967295,b=g+(y<<5&4294967295|y>>>27),y=E+(g^S&(b^g))+v[14]+3275163606&4294967295,E=b+(y<<9&4294967295|y>>>23),y=S+(b^g&(E^b))+v[3]+4107603335&4294967295,S=E+(y<<14&4294967295|y>>>18),y=g+(E^b&(S^E))+v[8]+1163531501&4294967295,g=S+(y<<20&4294967295|y>>>12),y=b+(S^E&(g^S))+v[13]+2850285829&4294967295,b=g+(y<<5&4294967295|y>>>27),y=E+(g^S&(b^g))+v[2]+4243563512&4294967295,E=b+(y<<9&4294967295|y>>>23),y=S+(b^g&(E^b))+v[7]+1735328473&4294967295,S=E+(y<<14&4294967295|y>>>18),y=g+(E^b&(S^E))+v[12]+2368359562&4294967295,g=S+(y<<20&4294967295|y>>>12),y=b+(g^S^E)+v[5]+4294588738&4294967295,b=g+(y<<4&4294967295|y>>>28),y=E+(b^g^S)+v[8]+2272392833&4294967295,E=b+(y<<11&4294967295|y>>>21),y=S+(E^b^g)+v[11]+1839030562&4294967295,S=E+(y<<16&4294967295|y>>>16),y=g+(S^E^b)+v[14]+4259657740&4294967295,g=S+(y<<23&4294967295|y>>>9),y=b+(g^S^E)+v[1]+2763975236&4294967295,b=g+(y<<4&4294967295|y>>>28),y=E+(b^g^S)+v[4]+1272893353&4294967295,E=b+(y<<11&4294967295|y>>>21),y=S+(E^b^g)+v[7]+4139469664&4294967295,S=E+(y<<16&4294967295|y>>>16),y=g+(S^E^b)+v[10]+3200236656&4294967295,g=S+(y<<23&4294967295|y>>>9),y=b+(g^S^E)+v[13]+681279174&4294967295,b=g+(y<<4&4294967295|y>>>28),y=E+(b^g^S)+v[0]+3936430074&4294967295,E=b+(y<<11&4294967295|y>>>21),y=S+(E^b^g)+v[3]+3572445317&4294967295,S=E+(y<<16&4294967295|y>>>16),y=g+(S^E^b)+v[6]+76029189&4294967295,g=S+(y<<23&4294967295|y>>>9),y=b+(g^S^E)+v[9]+3654602809&4294967295,b=g+(y<<4&4294967295|y>>>28),y=E+(b^g^S)+v[12]+3873151461&4294967295,E=b+(y<<11&4294967295|y>>>21),y=S+(E^b^g)+v[15]+530742520&4294967295,S=E+(y<<16&4294967295|y>>>16),y=g+(S^E^b)+v[2]+3299628645&4294967295,g=S+(y<<23&4294967295|y>>>9),y=b+(S^(g|~E))+v[0]+4096336452&4294967295,b=g+(y<<6&4294967295|y>>>26),y=E+(g^(b|~S))+v[7]+1126891415&4294967295,E=b+(y<<10&4294967295|y>>>22),y=S+(b^(E|~g))+v[14]+2878612391&4294967295,S=E+(y<<15&4294967295|y>>>17),y=g+(E^(S|~b))+v[5]+4237533241&4294967295,g=S+(y<<21&4294967295|y>>>11),y=b+(S^(g|~E))+v[12]+1700485571&4294967295,b=g+(y<<6&4294967295|y>>>26),y=E+(g^(b|~S))+v[3]+2399980690&4294967295,E=b+(y<<10&4294967295|y>>>22),y=S+(b^(E|~g))+v[10]+4293915773&4294967295,S=E+(y<<15&4294967295|y>>>17),y=g+(E^(S|~b))+v[1]+2240044497&4294967295,g=S+(y<<21&4294967295|y>>>11),y=b+(S^(g|~E))+v[8]+1873313359&4294967295,b=g+(y<<6&4294967295|y>>>26),y=E+(g^(b|~S))+v[15]+4264355552&4294967295,E=b+(y<<10&4294967295|y>>>22),y=S+(b^(E|~g))+v[6]+2734768916&4294967295,S=E+(y<<15&4294967295|y>>>17),y=g+(E^(S|~b))+v[13]+1309151649&4294967295,g=S+(y<<21&4294967295|y>>>11),y=b+(S^(g|~E))+v[4]+4149444226&4294967295,b=g+(y<<6&4294967295|y>>>26),y=E+(g^(b|~S))+v[11]+3174756917&4294967295,E=b+(y<<10&4294967295|y>>>22),y=S+(b^(E|~g))+v[2]+718787259&4294967295,S=E+(y<<15&4294967295|y>>>17),y=g+(E^(S|~b))+v[9]+3951481745&4294967295,N.g[0]=N.g[0]+b&4294967295,N.g[1]=N.g[1]+(S+(y<<21&4294967295|y>>>11))&4294967295,N.g[2]=N.g[2]+S&4294967295,N.g[3]=N.g[3]+E&4294967295}s.prototype.u=function(N,b){b===void 0&&(b=N.length);for(var g=b-this.blockSize,v=this.B,S=this.h,E=0;E<b;){if(S==0)for(;E<=g;)r(this,N,E),E+=this.blockSize;if(typeof N=="string"){for(;E<b;)if(v[S++]=N.charCodeAt(E++),S==this.blockSize){r(this,v),S=0;break}}else for(;E<b;)if(v[S++]=N[E++],S==this.blockSize){r(this,v),S=0;break}}this.h=S,this.o+=b},s.prototype.v=function(){var N=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);N[0]=128;for(var b=1;b<N.length-8;++b)N[b]=0;var g=8*this.o;for(b=N.length-8;b<N.length;++b)N[b]=g&255,g/=256;for(this.u(N),N=Array(16),b=g=0;4>b;++b)for(var v=0;32>v;v+=8)N[g++]=this.g[b]>>>v&255;return N};function a(N,b){var g=c;return Object.prototype.hasOwnProperty.call(g,N)?g[N]:g[N]=b(N)}function o(N,b){this.h=b;for(var g=[],v=!0,S=N.length-1;0<=S;S--){var E=N[S]|0;v&&E==b||(g[S]=E,v=!1)}this.g=g}var c={};function u(N){return-128<=N&&128>N?a(N,function(b){return new o([b|0],0>b?-1:0)}):new o([N|0],0>N?-1:0)}function h(N){if(isNaN(N)||!isFinite(N))return p;if(0>N)return T(h(-N));for(var b=[],g=1,v=0;N>=g;v++)b[v]=N/g|0,g*=4294967296;return new o(b,0)}function f(N,b){if(N.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(N.charAt(0)=="-")return T(f(N.substring(1),b));if(0<=N.indexOf("-"))throw Error('number format error: interior "-" character');for(var g=h(Math.pow(b,8)),v=p,S=0;S<N.length;S+=8){var E=Math.min(8,N.length-S),y=parseInt(N.substring(S,S+E),b);8>E?(E=h(Math.pow(b,E)),v=v.j(E).add(h(y))):(v=v.j(g),v=v.add(h(y)))}return v}var p=u(0),_=u(1),A=u(16777216);n=o.prototype,n.m=function(){if(k(this))return-T(this).m();for(var N=0,b=1,g=0;g<this.g.length;g++){var v=this.i(g);N+=(0<=v?v:4294967296+v)*b,b*=4294967296}return N},n.toString=function(N){if(N=N||10,2>N||36<N)throw Error("radix out of range: "+N);if(P(this))return"0";if(k(this))return"-"+T(this).toString(N);for(var b=h(Math.pow(N,6)),g=this,v="";;){var S=$(g,b).g;g=U(g,S.j(b));var E=((0<g.g.length?g.g[0]:g.h)>>>0).toString(N);if(g=S,P(g))return E+v;for(;6>E.length;)E="0"+E;v=E+v}},n.i=function(N){return 0>N?0:N<this.g.length?this.g[N]:this.h};function P(N){if(N.h!=0)return!1;for(var b=0;b<N.g.length;b++)if(N.g[b]!=0)return!1;return!0}function k(N){return N.h==-1}n.l=function(N){return N=U(this,N),k(N)?-1:P(N)?0:1};function T(N){for(var b=N.g.length,g=[],v=0;v<b;v++)g[v]=~N.g[v];return new o(g,~N.h).add(_)}n.abs=function(){return k(this)?T(this):this},n.add=function(N){for(var b=Math.max(this.g.length,N.g.length),g=[],v=0,S=0;S<=b;S++){var E=v+(this.i(S)&65535)+(N.i(S)&65535),y=(E>>>16)+(this.i(S)>>>16)+(N.i(S)>>>16);v=y>>>16,E&=65535,y&=65535,g[S]=y<<16|E}return new o(g,g[g.length-1]&-2147483648?-1:0)};function U(N,b){return N.add(T(b))}n.j=function(N){if(P(this)||P(N))return p;if(k(this))return k(N)?T(this).j(T(N)):T(T(this).j(N));if(k(N))return T(this.j(T(N)));if(0>this.l(A)&&0>N.l(A))return h(this.m()*N.m());for(var b=this.g.length+N.g.length,g=[],v=0;v<2*b;v++)g[v]=0;for(v=0;v<this.g.length;v++)for(var S=0;S<N.g.length;S++){var E=this.i(v)>>>16,y=this.i(v)&65535,ke=N.i(S)>>>16,Y=N.i(S)&65535;g[2*v+2*S]+=y*Y,K(g,2*v+2*S),g[2*v+2*S+1]+=E*Y,K(g,2*v+2*S+1),g[2*v+2*S+1]+=y*ke,K(g,2*v+2*S+1),g[2*v+2*S+2]+=E*ke,K(g,2*v+2*S+2)}for(v=0;v<b;v++)g[v]=g[2*v+1]<<16|g[2*v];for(v=b;v<2*b;v++)g[v]=0;return new o(g,0)};function K(N,b){for(;(N[b]&65535)!=N[b];)N[b+1]+=N[b]>>>16,N[b]&=65535,b++}function D(N,b){this.g=N,this.h=b}function $(N,b){if(P(b))throw Error("division by zero");if(P(N))return new D(p,p);if(k(N))return b=$(T(N),b),new D(T(b.g),T(b.h));if(k(b))return b=$(N,T(b)),new D(T(b.g),b.h);if(30<N.g.length){if(k(N)||k(b))throw Error("slowDivide_ only works with positive integers.");for(var g=_,v=b;0>=v.l(N);)g=H(g),v=H(v);var S=Q(g,1),E=Q(v,1);for(v=Q(v,2),g=Q(g,2);!P(v);){var y=E.add(v);0>=y.l(N)&&(S=S.add(g),E=y),v=Q(v,1),g=Q(g,1)}return b=U(N,S.j(b)),new D(S,b)}for(S=p;0<=N.l(b);){for(g=Math.max(1,Math.floor(N.m()/b.m())),v=Math.ceil(Math.log(g)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),E=h(g),y=E.j(b);k(y)||0<y.l(N);)g-=v,E=h(g),y=E.j(b);P(E)&&(E=_),S=S.add(E),N=U(N,y)}return new D(S,N)}n.A=function(N){return $(this,N).h},n.and=function(N){for(var b=Math.max(this.g.length,N.g.length),g=[],v=0;v<b;v++)g[v]=this.i(v)&N.i(v);return new o(g,this.h&N.h)},n.or=function(N){for(var b=Math.max(this.g.length,N.g.length),g=[],v=0;v<b;v++)g[v]=this.i(v)|N.i(v);return new o(g,this.h|N.h)},n.xor=function(N){for(var b=Math.max(this.g.length,N.g.length),g=[],v=0;v<b;v++)g[v]=this.i(v)^N.i(v);return new o(g,this.h^N.h)};function H(N){for(var b=N.g.length+1,g=[],v=0;v<b;v++)g[v]=N.i(v)<<1|N.i(v-1)>>>31;return new o(g,N.h)}function Q(N,b){var g=b>>5;b%=32;for(var v=N.g.length-g,S=[],E=0;E<v;E++)S[E]=0<b?N.i(E+g)>>>b|N.i(E+g+1)<<32-b:N.i(E+g);return new o(S,N.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,gm=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,Jn=o}).apply(typeof rd!="undefined"?rd:typeof self!="undefined"?self:typeof window!="undefined"?window:{});var Ra=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xm,yi,bm,Ma,Pl,_m,ym,vm;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,d,m){return l==Array.prototype||l==Object.prototype||(l[d]=m.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ra=="object"&&Ra];for(var d=0;d<l.length;++d){var m=l[d];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var s=t(this);function r(l,d){if(d)e:{var m=s;l=l.split(".");for(var x=0;x<l.length-1;x++){var C=l[x];if(!(C in m))break e;m=m[C]}l=l[l.length-1],x=m[l],d=d(x),d!=x&&d!=null&&e(m,l,{configurable:!0,writable:!0,value:d})}}function a(l,d){l instanceof String&&(l+="");var m=0,x=!1,C={next:function(){if(!x&&m<l.length){var O=m++;return{value:d(O,l[O]),done:!1}}return x=!0,{done:!0,value:void 0}}};return C[Symbol.iterator]=function(){return C},C}r("Array.prototype.values",function(l){return l||function(){return a(this,function(d,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},c=this||self;function u(l){var d=typeof l;return d=d!="object"?d:l?Array.isArray(l)?"array":d:"null",d=="array"||d=="object"&&typeof l.length=="number"}function h(l){var d=typeof l;return d=="object"&&l!=null||d=="function"}function f(l,d,m){return l.call.apply(l.bind,arguments)}function p(l,d,m){if(!l)throw Error();if(2<arguments.length){var x=Array.prototype.slice.call(arguments,2);return function(){var C=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(C,x),l.apply(d,C)}}return function(){return l.apply(d,arguments)}}function _(l,d,m){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,_.apply(null,arguments)}function A(l,d){var m=Array.prototype.slice.call(arguments,1);return function(){var x=m.slice();return x.push.apply(x,arguments),l.apply(this,x)}}function P(l,d){function m(){}m.prototype=d.prototype,l.aa=d.prototype,l.prototype=new m,l.prototype.constructor=l,l.Qb=function(x,C,O){for(var X=Array(arguments.length-2),at=2;at<arguments.length;at++)X[at-2]=arguments[at];return d.prototype[C].apply(x,X)}}function k(l){const d=l.length;if(0<d){const m=Array(d);for(let x=0;x<d;x++)m[x]=l[x];return m}return[]}function T(l,d){for(let m=1;m<arguments.length;m++){const x=arguments[m];if(u(x)){const C=l.length||0,O=x.length||0;l.length=C+O;for(let X=0;X<O;X++)l[C+X]=x[X]}else l.push(x)}}class U{constructor(d,m){this.i=d,this.j=m,this.h=0,this.g=null}get(){let d;return 0<this.h?(this.h--,d=this.g,this.g=d.next,d.next=null):d=this.i(),d}}function K(l){return/^[\s\xa0]*$/.test(l)}function D(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function $(l){return $[" "](l),l}$[" "]=function(){};var H=D().indexOf("Gecko")!=-1&&!(D().toLowerCase().indexOf("webkit")!=-1&&D().indexOf("Edge")==-1)&&!(D().indexOf("Trident")!=-1||D().indexOf("MSIE")!=-1)&&D().indexOf("Edge")==-1;function Q(l,d,m){for(const x in l)d.call(m,l[x],x,l)}function N(l,d){for(const m in l)d.call(void 0,l[m],m,l)}function b(l){const d={};for(const m in l)d[m]=l[m];return d}const g="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function v(l,d){let m,x;for(let C=1;C<arguments.length;C++){x=arguments[C];for(m in x)l[m]=x[m];for(let O=0;O<g.length;O++)m=g[O],Object.prototype.hasOwnProperty.call(x,m)&&(l[m]=x[m])}}function S(l){var d=1;l=l.split(":");const m=[];for(;0<d&&l.length;)m.push(l.shift()),d--;return l.length&&m.push(l.join(":")),m}function E(l){c.setTimeout(()=>{throw l},0)}function y(){var l=Ce;let d=null;return l.g&&(d=l.g,l.g=l.g.next,l.g||(l.h=null),d.next=null),d}class ke{constructor(){this.h=this.g=null}add(d,m){const x=Y.get();x.set(d,m),this.h?this.h.next=x:this.g=x,this.h=x}}var Y=new U(()=>new Fe,l=>l.reset());class Fe{constructor(){this.next=this.g=this.h=null}set(d,m){this.h=d,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let J,_e=!1,Ce=new ke,Re=()=>{const l=c.Promise.resolve(void 0);J=()=>{l.then(Xe)}};var Xe=()=>{for(var l;l=y();){try{l.h.call(l.g)}catch(m){E(m)}var d=Y;d.j(l),100>d.h&&(d.h++,l.next=d.g,d.g=l)}_e=!1};function Ee(){this.s=this.s,this.C=this.C}Ee.prototype.s=!1,Ee.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ee.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ne(l,d){this.type=l,this.g=this.target=d,this.defaultPrevented=!1}Ne.prototype.h=function(){this.defaultPrevented=!0};var W=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,d=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const m=()=>{};c.addEventListener("test",m,d),c.removeEventListener("test",m,d)}catch(m){}return l}();function ue(l,d){if(Ne.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var m=this.type=l.type,x=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=d,d=l.relatedTarget){if(H){e:{try{$(d.nodeName);var C=!0;break e}catch(O){}C=!1}C||(d=null)}}else m=="mouseover"?d=l.fromElement:m=="mouseout"&&(d=l.toElement);this.relatedTarget=d,x?(this.clientX=x.clientX!==void 0?x.clientX:x.pageX,this.clientY=x.clientY!==void 0?x.clientY:x.pageY,this.screenX=x.screenX||0,this.screenY=x.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:Te[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&ue.aa.h.call(this)}}P(ue,Ne);var Te={2:"touch",3:"pen",4:"mouse"};ue.prototype.h=function(){ue.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var ye="closure_listenable_"+(1e6*Math.random()|0),re=0;function Be(l,d,m,x,C){this.listener=l,this.proxy=null,this.src=d,this.type=m,this.capture=!!x,this.ha=C,this.key=++re,this.da=this.fa=!1}function Ze(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function ze(l){this.src=l,this.g={},this.h=0}ze.prototype.add=function(l,d,m,x,C){var O=l.toString();l=this.g[O],l||(l=this.g[O]=[],this.h++);var X=dt(l,d,x,C);return-1<X?(d=l[X],m||(d.fa=!1)):(d=new Be(d,this.src,O,!!x,C),d.fa=m,l.push(d)),d};function de(l,d){var m=d.type;if(m in l.g){var x=l.g[m],C=Array.prototype.indexOf.call(x,d,void 0),O;(O=0<=C)&&Array.prototype.splice.call(x,C,1),O&&(Ze(d),l.g[m].length==0&&(delete l.g[m],l.h--))}}function dt(l,d,m,x){for(var C=0;C<l.length;++C){var O=l[C];if(!O.da&&O.listener==d&&O.capture==!!m&&O.ha==x)return C}return-1}var et="closure_lm_"+(1e6*Math.random()|0),st={};function ft(l,d,m,x,C){if(Array.isArray(d)){for(var O=0;O<d.length;O++)ft(l,d[O],m,x,C);return null}return m=B(m),l&&l[ye]?l.K(d,m,h(x)?!!x.capture:!1,C):yt(l,d,m,!1,x,C)}function yt(l,d,m,x,C,O){if(!d)throw Error("Invalid event type");var X=h(C)?!!C.capture:!!C,at=oe(l);if(at||(l[et]=at=new ze(l)),m=at.add(d,m,x,X,O),m.proxy)return m;if(x=Qe(),m.proxy=x,x.src=l,x.listener=m,l.addEventListener)W||(C=X),C===void 0&&(C=!1),l.addEventListener(d.toString(),x,C);else if(l.attachEvent)l.attachEvent(ut(d.toString()),x);else if(l.addListener&&l.removeListener)l.addListener(x);else throw Error("addEventListener and attachEvent are unavailable.");return m}function Qe(){function l(m){return d.call(l.src,l.listener,m)}const d=Se;return l}function ot(l,d,m,x,C){if(Array.isArray(d))for(var O=0;O<d.length;O++)ot(l,d[O],m,x,C);else x=h(x)?!!x.capture:!!x,m=B(m),l&&l[ye]?(l=l.i,d=String(d).toString(),d in l.g&&(O=l.g[d],m=dt(O,m,x,C),-1<m&&(Ze(O[m]),Array.prototype.splice.call(O,m,1),O.length==0&&(delete l.g[d],l.h--)))):l&&(l=oe(l))&&(d=l.g[d.toString()],l=-1,d&&(l=dt(d,m,x,C)),(m=-1<l?d[l]:null)&&Et(m))}function Et(l){if(typeof l!="number"&&l&&!l.da){var d=l.src;if(d&&d[ye])de(d.i,l);else{var m=l.type,x=l.proxy;d.removeEventListener?d.removeEventListener(m,x,l.capture):d.detachEvent?d.detachEvent(ut(m),x):d.addListener&&d.removeListener&&d.removeListener(x),(m=oe(d))?(de(m,l),m.h==0&&(m.src=null,d[et]=null)):Ze(l)}}}function ut(l){return l in st?st[l]:st[l]="on"+l}function Se(l,d){if(l.da)l=!0;else{d=new ue(d,this);var m=l.listener,x=l.ha||l.src;l.fa&&Et(l),l=m.call(x,d)}return l}function oe(l){return l=l[et],l instanceof ze?l:null}var lt="__closure_events_fn_"+(1e9*Math.random()>>>0);function B(l){return typeof l=="function"?l:(l[lt]||(l[lt]=function(d){return l.handleEvent(d)}),l[lt])}function ie(){Ee.call(this),this.i=new ze(this),this.M=this,this.F=null}P(ie,Ee),ie.prototype[ye]=!0,ie.prototype.removeEventListener=function(l,d,m,x){ot(this,l,d,m,x)};function ve(l,d){var m,x=l.F;if(x)for(m=[];x;x=x.F)m.push(x);if(l=l.M,x=d.type||d,typeof d=="string")d=new Ne(d,l);else if(d instanceof Ne)d.target=d.target||l;else{var C=d;d=new Ne(x,l),v(d,C)}if(C=!0,m)for(var O=m.length-1;0<=O;O--){var X=d.g=m[O];C=nt(X,x,!0,d)&&C}if(X=d.g=l,C=nt(X,x,!0,d)&&C,C=nt(X,x,!1,d)&&C,m)for(O=0;O<m.length;O++)X=d.g=m[O],C=nt(X,x,!1,d)&&C}ie.prototype.N=function(){if(ie.aa.N.call(this),this.i){var l=this.i,d;for(d in l.g){for(var m=l.g[d],x=0;x<m.length;x++)Ze(m[x]);delete l.g[d],l.h--}}this.F=null},ie.prototype.K=function(l,d,m,x){return this.i.add(String(l),d,!1,m,x)},ie.prototype.L=function(l,d,m,x){return this.i.add(String(l),d,!0,m,x)};function nt(l,d,m,x){if(d=l.i.g[String(d)],!d)return!0;d=d.concat();for(var C=!0,O=0;O<d.length;++O){var X=d[O];if(X&&!X.da&&X.capture==m){var at=X.listener,Ft=X.ha||X.src;X.fa&&de(l.i,X),C=at.call(Ft,x)!==!1&&C}}return C&&!x.defaultPrevented}function M(l,d,m){if(typeof l=="function")m&&(l=_(l,m));else if(l&&typeof l.handleEvent=="function")l=_(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(d)?-1:c.setTimeout(l,d||0)}function ge(l){l.g=M(()=>{l.g=null,l.i&&(l.i=!1,ge(l))},l.l);const d=l.h;l.h=null,l.m.apply(null,d)}class De extends Ee{constructor(d,m){super(),this.m=d,this.l=m,this.h=null,this.i=!1,this.g=null}j(d){this.h=arguments,this.g?this.i=!0:ge(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function fe(l){Ee.call(this),this.h=l,this.g={}}P(fe,Ee);var xe=[];function Qt(l){Q(l.g,function(d,m){this.g.hasOwnProperty(m)&&Et(d)},l),l.g={}}fe.prototype.N=function(){fe.aa.N.call(this),Qt(this)},fe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Rt=c.JSON.stringify,ts=c.JSON.parse,ss=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function Lt(){}Lt.prototype.h=null;function G(l){return l.h||(l.h=l.i())}function Je(){}var qe={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ke(){Ne.call(this,"d")}P(Ke,Ne);function vt(){Ne.call(this,"c")}P(vt,Ne);var He={},Tt=null;function Jt(){return Tt=Tt||new ie}He.La="serverreachability";function V(l){Ne.call(this,He.La,l)}P(V,Ne);function j(l){const d=Jt();ve(d,new V(d))}He.STAT_EVENT="statevent";function se(l,d){Ne.call(this,He.STAT_EVENT,l),this.stat=d}P(se,Ne);function be(l){const d=Jt();ve(d,new se(d,l))}He.Ma="timingevent";function pt(l,d){Ne.call(this,He.Ma,l),this.size=d}P(pt,Ne);function Ve(l,d){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},d)}function Yt(){this.g=!0}Yt.prototype.xa=function(){this.g=!1};function cs(l,d,m,x,C,O){l.info(function(){if(l.g)if(O)for(var X="",at=O.split("&"),Ft=0;Ft<at.length;Ft++){var We=at[Ft].split("=");if(1<We.length){var $t=We[0];We=We[1];var Gt=$t.split("_");X=2<=Gt.length&&Gt[1]=="type"?X+($t+"="+We+"&"):X+($t+"=redacted&")}}else X=null;else X=O;return"XMLHTTP REQ ("+x+") [attempt "+C+"]: "+d+`
`+m+`
`+X})}function us(l,d,m,x,C,O,X){l.info(function(){return"XMLHTTP RESP ("+x+") [ attempt "+C+"]: "+d+`
`+m+`
`+O+" "+X})}function L(l,d,m,x){l.info(function(){return"XMLHTTP TEXT ("+d+"): "+me(l,m)+(x?" "+x:"")})}function ee(l,d){l.info(function(){return"TIMEOUT: "+d})}Yt.prototype.info=function(){};function me(l,d){if(!l.g)return d;if(!d)return null;try{var m=JSON.parse(d);if(m){for(l=0;l<m.length;l++)if(Array.isArray(m[l])){var x=m[l];if(!(2>x.length)){var C=x[1];if(Array.isArray(C)&&!(1>C.length)){var O=C[0];if(O!="noop"&&O!="stop"&&O!="close")for(var X=1;X<C.length;X++)C[X]=""}}}}return Rt(m)}catch(at){return d}}var pe={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},$e={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Pt;function St(){}P(St,Lt),St.prototype.g=function(){return new XMLHttpRequest},St.prototype.i=function(){return{}},Pt=new St;function ct(l,d,m,x){this.j=l,this.i=d,this.l=m,this.R=x||1,this.U=new fe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new gs}function gs(){this.i=null,this.g="",this.h=!1}var Us={},Mt={};function Bs(l,d,m){l.L=1,l.v=xr(xs(d)),l.m=m,l.P=!0,an(l,null)}function an(l,d){l.F=Date.now(),Dn(l),l.A=xs(l.v);var m=l.A,x=l.R;Array.isArray(x)||(x=[String(x)]),ns(m.i,"t",x),l.C=0,m=l.j.J,l.h=new gs,l.g=ku(l.j,m?d:null,!l.m),0<l.O&&(l.M=new De(_(l.Y,l,l.g),l.O)),d=l.U,m=l.g,x=l.ca;var C="readystatechange";Array.isArray(C)||(C&&(xe[0]=C.toString()),C=xe);for(var O=0;O<C.length;O++){var X=ft(m,C[O],x||d.handleEvent,!1,d.h||d);if(!X)break;d.g[X.key]=X}d=l.H?b(l.H):{},l.m?(l.u||(l.u="POST"),d["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,d)):(l.u="GET",l.g.ea(l.A,l.u,null,d)),j(),cs(l.i,l.u,l.A,l.l,l.R,l.m)}ct.prototype.ca=function(l){l=l.target;const d=this.M;d&&$s(l)==3?d.j():this.Y(l)},ct.prototype.Y=function(l){try{if(l==this.g)e:{const Gt=$s(this.g);var d=this.g.Ba();const yr=this.g.Z();if(!(3>Gt)&&(Gt!=3||this.g&&(this.h.h||this.g.oa()||wu(this.g)))){this.J||Gt!=4||d==7||(d==8||0>=yr?j(3):j(2)),hr(this);var m=this.g.Z();this.X=m;t:if(kn(this)){var x=wu(this.g);l="";var C=x.length,O=$s(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){Ts(this),on(this);var X="";break t}this.h.i=new c.TextDecoder}for(d=0;d<C;d++)this.h.h=!0,l+=this.h.i.decode(x[d],{stream:!(O&&d==C-1)});x.length=0,this.h.g+=l,this.C=0,X=this.h.g}else X=this.g.oa();if(this.o=m==200,us(this.i,this.u,this.A,this.l,this.R,Gt,m),this.o){if(this.T&&!this.K){t:{if(this.g){var at,Ft=this.g;if((at=Ft.g?Ft.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(at)){var We=at;break t}}We=null}if(m=We)L(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ni(this,m);else{this.o=!1,this.s=3,be(12),Ts(this),on(this);break e}}if(this.P){m=!0;let bs;for(;!this.J&&this.C<X.length;)if(bs=Jo(this,X),bs==Mt){Gt==4&&(this.s=4,be(14),m=!1),L(this.i,this.l,null,"[Incomplete Response]");break}else if(bs==Us){this.s=4,be(15),L(this.i,this.l,X,"[Invalid Chunk]"),m=!1;break}else L(this.i,this.l,bs,null),ni(this,bs);if(kn(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Gt!=4||X.length!=0||this.h.h||(this.s=1,be(16),m=!1),this.o=this.o&&m,!m)L(this.i,this.l,X,"[Invalid Chunked Response]"),Ts(this),on(this);else if(0<X.length&&!this.W){this.W=!0;var $t=this.j;$t.g==this&&$t.ba&&!$t.M&&($t.j.info("Great, no buffering proxy detected. Bytes received: "+X.length),sl($t),$t.M=!0,be(11))}}else L(this.i,this.l,X,null),ni(this,X);Gt==4&&Ts(this),this.o&&!this.J&&(Gt==4?ju(this.j,this):(this.o=!1,Dn(this)))}else ag(this.g),m==400&&0<X.indexOf("Unknown SID")?(this.s=3,be(12)):(this.s=0,be(13)),Ts(this),on(this)}}}catch(Gt){}finally{}};function kn(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function Jo(l,d){var m=l.C,x=d.indexOf(`
`,m);return x==-1?Mt:(m=Number(d.substring(m,x)),isNaN(m)?Us:(x+=1,x+m>d.length?Mt:(d=d.slice(x,x+m),l.C=x+m,d)))}ct.prototype.cancel=function(){this.J=!0,Ts(this)};function Dn(l){l.S=Date.now()+l.I,Vn(l,l.I)}function Vn(l,d){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Ve(_(l.ba,l),d)}function hr(l){l.B&&(c.clearTimeout(l.B),l.B=null)}ct.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(ee(this.i,this.A),this.L!=2&&(j(),be(17)),Ts(this),this.s=2,on(this)):Vn(this,this.S-l)};function on(l){l.j.G==0||l.J||ju(l.j,l)}function Ts(l){hr(l);var d=l.M;d&&typeof d.ma=="function"&&d.ma(),l.M=null,Qt(l.U),l.g&&(d=l.g,l.g=null,d.abort(),d.ma())}function ni(l,d){try{var m=l.j;if(m.G!=0&&(m.g==l||On(m.h,l))){if(!l.K&&On(m.h,l)&&m.G==3){try{var x=m.Da.g.parse(d)}catch(We){x=null}if(Array.isArray(x)&&x.length==3){var C=x;if(C[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<l.F)Aa(m),Ta(m);else break e;tl(m),be(18)}}else m.za=C[1],0<m.za-m.T&&37500>C[2]&&m.F&&m.v==0&&!m.C&&(m.C=Ve(_(m.Za,m),6e3));if(1>=ga(m.h)&&m.ca){try{m.ca()}catch(We){}m.ca=void 0}}else Bn(m,11)}else if((l.K||m.g==l)&&Aa(m),!K(d))for(C=m.Da.g.parse(d),d=0;d<C.length;d++){let We=C[d];if(m.T=We[0],We=We[1],m.G==2)if(We[0]=="c"){m.K=We[1],m.ia=We[2];const $t=We[3];$t!=null&&(m.la=$t,m.j.info("VER="+m.la));const Gt=We[4];Gt!=null&&(m.Aa=Gt,m.j.info("SVER="+m.Aa));const yr=We[5];yr!=null&&typeof yr=="number"&&0<yr&&(x=1.5*yr,m.L=x,m.j.info("backChannelRequestTimeoutMs_="+x)),x=m;const bs=l.g;if(bs){const Ca=bs.g?bs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ca){var O=x.h;O.g||Ca.indexOf("spdy")==-1&&Ca.indexOf("quic")==-1&&Ca.indexOf("h2")==-1||(O.j=O.l,O.g=new Set,O.h&&(fr(O,O.h),O.h=null))}if(x.D){const nl=bs.g?bs.g.getResponseHeader("X-HTTP-Session-Id"):null;nl&&(x.ya=nl,rt(x.I,x.D,nl))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-l.F,m.j.info("Handshake RTT: "+m.R+"ms")),x=m;var X=l;if(x.qa=Pu(x,x.J?x.ia:null,x.W),X.K){ri(x.h,X);var at=X,Ft=x.L;Ft&&(at.I=Ft),at.B&&(hr(at),Dn(at)),x.g=X}else Su(x);0<m.i.length&&Sa(m)}else We[0]!="stop"&&We[0]!="close"||Bn(m,7);else m.G==3&&(We[0]=="stop"||We[0]=="close"?We[0]=="stop"?Bn(m,7):el(m):We[0]!="noop"&&m.l&&m.l.ta(We),m.v=0)}}j(4)}catch(We){}}var fa=class{constructor(l,d){this.g=l,this.map=d}};function mr(l){this.l=l||10,c.PerformanceNavigationTiming?(l=c.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function pa(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function ga(l){return l.h?1:l.g?l.g.size:0}function On(l,d){return l.h?l.h==d:l.g?l.g.has(d):!1}function fr(l,d){l.g?l.g.add(d):l.h=d}function ri(l,d){l.h&&l.h==d?l.h=null:l.g&&l.g.has(d)&&l.g.delete(d)}mr.prototype.cancel=function(){if(this.i=ii(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function ii(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let d=l.i;for(const m of l.g.values())d=d.concat(m.D);return d}return k(l.i)}function xa(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map!="undefined"&&l instanceof Map||typeof Set!="undefined"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var d=[],m=l.length,x=0;x<m;x++)d.push(l[x]);return d}d=[],m=0;for(x in l)d[m++]=l[x];return d}function ba(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map!="undefined"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set!="undefined"&&l instanceof Set)){if(u(l)||typeof l=="string"){var d=[];l=l.length;for(var m=0;m<l;m++)d.push(m);return d}d=[],m=0;for(const x in l)d[m++]=x;return d}}}function ai(l,d){if(l.forEach&&typeof l.forEach=="function")l.forEach(d,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,d,void 0);else for(var m=ba(l),x=xa(l),C=x.length,O=0;O<C;O++)d.call(void 0,x[O],m&&m[O],l)}var oi=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qt(l,d){if(l){l=l.split("&");for(var m=0;m<l.length;m++){var x=l[m].indexOf("="),C=null;if(0<=x){var O=l[m].substring(0,x);C=l[m].substring(x+1)}else O=l[m];d(O,C?decodeURIComponent(C.replace(/\+/g," ")):"")}}}function qs(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof qs){this.h=l.h,pr(this,l.j),this.o=l.o,this.g=l.g,gr(this,l.s),this.l=l.l;var d=l.i,m=new Fn;m.i=d.i,d.g&&(m.g=new Map(d.g),m.h=d.h),_a(this,m),this.m=l.m}else l&&(d=String(l).match(oi))?(this.h=!1,pr(this,d[1]||"",!0),this.o=Ln(d[2]||""),this.g=Ln(d[3]||"",!0),gr(this,d[4]),this.l=Ln(d[5]||"",!0),_a(this,d[6]||"",!0),this.m=Ln(d[7]||"")):(this.h=!1,this.i=new Fn(null,this.h))}qs.prototype.toString=function(){var l=[],d=this.j;d&&l.push(Mn(d,va,!0),":");var m=this.g;return(m||d=="file")&&(l.push("//"),(d=this.o)&&l.push(Mn(d,va,!0),"@"),l.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&l.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&l.push("/"),l.push(Mn(m,m.charAt(0)=="/"?Yo:li,!0))),(m=this.i.toString())&&l.push("?",m),(m=this.m)&&l.push("#",Mn(m,wa)),l.join("")};function xs(l){return new qs(l)}function pr(l,d,m){l.j=m?Ln(d,!0):d,l.j&&(l.j=l.j.replace(/:$/,""))}function gr(l,d){if(d){if(d=Number(d),isNaN(d)||0>d)throw Error("Bad port number "+d);l.s=d}else l.s=null}function _a(l,d,m){d instanceof Fn?(l.i=d,br(l.i,l.h)):(m||(d=Mn(d,Xo)),l.i=new Fn(d,l.h))}function rt(l,d,m){l.i.set(d,m)}function xr(l){return rt(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Ln(l,d){return l?d?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Mn(l,d,m){return typeof l=="string"?(l=encodeURI(l).replace(d,ya),m&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function ya(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var va=/[#\/\?@]/g,li=/[#\?:]/g,Yo=/[#\?]/g,Xo=/[#\?@]/g,wa=/#/g;function Fn(l,d){this.h=this.g=null,this.i=l||null,this.j=!!d}function Ss(l){l.g||(l.g=new Map,l.h=0,l.i&&qt(l.i,function(d,m){l.add(decodeURIComponent(d.replace(/\+/g," ")),m)}))}n=Fn.prototype,n.add=function(l,d){Ss(this),this.i=null,l=ds(this,l);var m=this.g.get(l);return m||this.g.set(l,m=[]),m.push(d),this.h+=1,this};function q(l,d){Ss(l),d=ds(l,d),l.g.has(d)&&(l.i=null,l.h-=l.g.get(d).length,l.g.delete(d))}function wt(l,d){return Ss(l),d=ds(l,d),l.g.has(d)}n.forEach=function(l,d){Ss(this),this.g.forEach(function(m,x){m.forEach(function(C){l.call(d,C,x,this)},this)},this)},n.na=function(){Ss(this);const l=Array.from(this.g.values()),d=Array.from(this.g.keys()),m=[];for(let x=0;x<d.length;x++){const C=l[x];for(let O=0;O<C.length;O++)m.push(d[x])}return m},n.V=function(l){Ss(this);let d=[];if(typeof l=="string")wt(this,l)&&(d=d.concat(this.g.get(ds(this,l))));else{l=Array.from(this.g.values());for(let m=0;m<l.length;m++)d=d.concat(l[m])}return d},n.set=function(l,d){return Ss(this),this.i=null,l=ds(this,l),wt(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[d]),this.h+=1,this},n.get=function(l,d){return l?(l=this.V(l),0<l.length?String(l[0]):d):d};function ns(l,d,m){q(l,d),0<m.length&&(l.i=null,l.g.set(ds(l,d),k(m)),l.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],d=Array.from(this.g.keys());for(var m=0;m<d.length;m++){var x=d[m];const O=encodeURIComponent(String(x)),X=this.V(x);for(x=0;x<X.length;x++){var C=O;X[x]!==""&&(C+="="+encodeURIComponent(String(X[x]))),l.push(C)}}return this.i=l.join("&")};function ds(l,d){return d=String(d),l.j&&(d=d.toLowerCase()),d}function br(l,d){d&&!l.j&&(Ss(l),l.i=null,l.g.forEach(function(m,x){var C=x.toLowerCase();x!=C&&(q(this,x),ns(this,C,m))},l)),l.j=d}function Un(l,d){const m=new Yt;if(c.Image){const x=new Image;x.onload=A(ln,m,"TestLoadImage: loaded",!0,d,x),x.onerror=A(ln,m,"TestLoadImage: error",!1,d,x),x.onabort=A(ln,m,"TestLoadImage: abort",!1,d,x),x.ontimeout=A(ln,m,"TestLoadImage: timeout",!1,d,x),c.setTimeout(function(){x.ontimeout&&x.ontimeout()},1e4),x.src=l}else d(!1)}function tg(l,d){const m=new Yt,x=new AbortController,C=setTimeout(()=>{x.abort(),ln(m,"TestPingServer: timeout",!1,d)},1e4);fetch(l,{signal:x.signal}).then(O=>{clearTimeout(C),O.ok?ln(m,"TestPingServer: ok",!0,d):ln(m,"TestPingServer: server error",!1,d)}).catch(()=>{clearTimeout(C),ln(m,"TestPingServer: error",!1,d)})}function ln(l,d,m,x,C){try{C&&(C.onload=null,C.onerror=null,C.onabort=null,C.ontimeout=null),x(m)}catch(O){}}function sg(){this.g=new ss}function ng(l,d,m){const x=m||"";try{ai(l,function(C,O){let X=C;h(C)&&(X=Rt(C)),d.push(x+O+"="+encodeURIComponent(X))})}catch(C){throw d.push(x+"type="+encodeURIComponent("_badmap")),C}}function Na(l){this.l=l.Ub||null,this.j=l.eb||!1}P(Na,Lt),Na.prototype.g=function(){return new Ia(this.l,this.j)},Na.prototype.i=function(l){return function(){return l}}({});function Ia(l,d){ie.call(this),this.D=l,this.o=d,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}P(Ia,ie),n=Ia.prototype,n.open=function(l,d){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=d,this.readyState=1,ui(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const d={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(d.body=l),(this.D||c).fetch(new Request(this.A,d)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ci(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,ui(this)),this.g&&(this.readyState=3,ui(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream!="undefined"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;gu(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function gu(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var d=l.value?l.value:new Uint8Array(0);(d=this.v.decode(d,{stream:!l.done}))&&(this.response=this.responseText+=d)}l.done?ci(this):ui(this),this.readyState==3&&gu(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,ci(this))},n.Qa=function(l){this.g&&(this.response=l,ci(this))},n.ga=function(){this.g&&ci(this)};function ci(l){l.readyState=4,l.l=null,l.j=null,l.v=null,ui(l)}n.setRequestHeader=function(l,d){this.u.append(l,d)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],d=this.h.entries();for(var m=d.next();!m.done;)m=m.value,l.push(m[0]+": "+m[1]),m=d.next();return l.join(`\r
`)};function ui(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Ia.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function xu(l){let d="";return Q(l,function(m,x){d+=x,d+=":",d+=m,d+=`\r
`}),d}function Zo(l,d,m){e:{for(x in m){var x=!1;break e}x=!0}x||(m=xu(m),typeof l=="string"?m!=null&&encodeURIComponent(String(m)):rt(l,d,m))}function bt(l){ie.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}P(bt,ie);var rg=/^https?$/i,ig=["POST","PUT"];n=bt.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,d,m,x){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);d=d?d.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Pt.g(),this.v=this.o?G(this.o):G(Pt),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(d,String(l),!0),this.B=!1}catch(O){bu(this,O);return}if(l=m||"",m=new Map(this.headers),x)if(Object.getPrototypeOf(x)===Object.prototype)for(var C in x)m.set(C,x[C]);else if(typeof x.keys=="function"&&typeof x.get=="function")for(const O of x.keys())m.set(O,x.get(O));else throw Error("Unknown input type for opt_headers: "+String(x));x=Array.from(m.keys()).find(O=>O.toLowerCase()=="content-type"),C=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(ig,d,void 0))||x||C||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[O,X]of m)this.g.setRequestHeader(O,X);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{vu(this),this.u=!0,this.g.send(l),this.u=!1}catch(O){bu(this,O)}};function bu(l,d){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=d,l.m=5,_u(l),Ea(l)}function _u(l){l.A||(l.A=!0,ve(l,"complete"),ve(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,ve(this,"complete"),ve(this,"abort"),Ea(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ea(this,!0)),bt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?yu(this):this.bb())},n.bb=function(){yu(this)};function yu(l){if(l.h&&typeof o!="undefined"&&(!l.v[1]||$s(l)!=4||l.Z()!=2)){if(l.u&&$s(l)==4)M(l.Ea,0,l);else if(ve(l,"readystatechange"),$s(l)==4){l.h=!1;try{const X=l.Z();e:switch(X){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var d=!0;break e;default:d=!1}var m;if(!(m=d)){var x;if(x=X===0){var C=String(l.D).match(oi)[1]||null;!C&&c.self&&c.self.location&&(C=c.self.location.protocol.slice(0,-1)),x=!rg.test(C?C.toLowerCase():"")}m=x}if(m)ve(l,"complete"),ve(l,"success");else{l.m=6;try{var O=2<$s(l)?l.g.statusText:""}catch(at){O=""}l.l=O+" ["+l.Z()+"]",_u(l)}}finally{Ea(l)}}}}function Ea(l,d){if(l.g){vu(l);const m=l.g,x=l.v[0]?()=>{}:null;l.g=null,l.v=null,d||ve(l,"ready");try{m.onreadystatechange=x}catch(C){}}}function vu(l){l.I&&(c.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function $s(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<$s(this)?this.g.status:-1}catch(l){return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(l){return""}},n.Oa=function(l){if(this.g){var d=this.g.responseText;return l&&d.indexOf(l)==0&&(d=d.substring(l.length)),ts(d)}};function wu(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch(d){return null}}function ag(l){const d={};l=(l.g&&2<=$s(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let x=0;x<l.length;x++){if(K(l[x]))continue;var m=S(l[x]);const C=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const O=d[C]||[];d[C]=O,O.push(m)}N(d,function(x){return x.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function di(l,d,m){return m&&m.internalChannelParams&&m.internalChannelParams[l]||d}function Nu(l){this.Aa=0,this.i=[],this.j=new Yt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=di("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=di("baseRetryDelayMs",5e3,l),this.cb=di("retryDelaySeedMs",1e4,l),this.Wa=di("forwardChannelMaxRetries",2,l),this.wa=di("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new mr(l&&l.concurrentRequestLimit),this.Da=new sg,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Nu.prototype,n.la=8,n.G=1,n.connect=function(l,d,m,x){be(0),this.W=l,this.H=d||{},m&&x!==void 0&&(this.H.OSID=m,this.H.OAID=x),this.F=this.X,this.I=Pu(this,null,this.W),Sa(this)};function el(l){if(Iu(l),l.G==3){var d=l.U++,m=xs(l.I);if(rt(m,"SID",l.K),rt(m,"RID",d),rt(m,"TYPE","terminate"),hi(l,m),d=new ct(l,l.j,d),d.L=2,d.v=xr(xs(m)),m=!1,c.navigator&&c.navigator.sendBeacon)try{m=c.navigator.sendBeacon(d.v.toString(),"")}catch(x){}!m&&c.Image&&(new Image().src=d.v,m=!0),m||(d.g=ku(d.j,null),d.g.ea(d.v)),d.F=Date.now(),Dn(d)}Ru(l)}function Ta(l){l.g&&(sl(l),l.g.cancel(),l.g=null)}function Iu(l){Ta(l),l.u&&(c.clearTimeout(l.u),l.u=null),Aa(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&c.clearTimeout(l.s),l.s=null)}function Sa(l){if(!pa(l.h)&&!l.s){l.s=!0;var d=l.Ga;J||Re(),_e||(J(),_e=!0),Ce.add(d,l),l.B=0}}function og(l,d){return ga(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=d.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Ve(_(l.Ga,l,d),Cu(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const C=new ct(this,this.j,l);let O=this.o;if(this.S&&(O?(O=b(O),v(O,this.S)):O=this.S),this.m!==null||this.O||(C.H=O,O=null),this.P)e:{for(var d=0,m=0;m<this.i.length;m++){t:{var x=this.i[m];if("__data__"in x.map&&(x=x.map.__data__,typeof x=="string")){x=x.length;break t}x=void 0}if(x===void 0)break;if(d+=x,4096<d){d=m;break e}if(d===4096||m===this.i.length-1){d=m+1;break e}}d=1e3}else d=1e3;d=Tu(this,C,d),m=xs(this.I),rt(m,"RID",l),rt(m,"CVER",22),this.D&&rt(m,"X-HTTP-Session-Id",this.D),hi(this,m),O&&(this.O?d="headers="+encodeURIComponent(String(xu(O)))+"&"+d:this.m&&Zo(m,this.m,O)),fr(this.h,C),this.Ua&&rt(m,"TYPE","init"),this.P?(rt(m,"$req",d),rt(m,"SID","null"),C.T=!0,Bs(C,m,null)):Bs(C,m,d),this.G=2}}else this.G==3&&(l?Eu(this,l):this.i.length==0||pa(this.h)||Eu(this))};function Eu(l,d){var m;d?m=d.l:m=l.U++;const x=xs(l.I);rt(x,"SID",l.K),rt(x,"RID",m),rt(x,"AID",l.T),hi(l,x),l.m&&l.o&&Zo(x,l.m,l.o),m=new ct(l,l.j,m,l.B+1),l.m===null&&(m.H=l.o),d&&(l.i=d.D.concat(l.i)),d=Tu(l,m,1e3),m.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),fr(l.h,m),Bs(m,x,d)}function hi(l,d){l.H&&Q(l.H,function(m,x){rt(d,x,m)}),l.l&&ai({},function(m,x){rt(d,x,m)})}function Tu(l,d,m){m=Math.min(l.i.length,m);var x=l.l?_(l.l.Na,l.l,l):null;e:{var C=l.i;let O=-1;for(;;){const X=["count="+m];O==-1?0<m?(O=C[0].g,X.push("ofs="+O)):O=0:X.push("ofs="+O);let at=!0;for(let Ft=0;Ft<m;Ft++){let We=C[Ft].g;const $t=C[Ft].map;if(We-=O,0>We)O=Math.max(0,C[Ft].g-100),at=!1;else try{ng($t,X,"req"+We+"_")}catch(Gt){x&&x($t)}}if(at){x=X.join("&");break e}}}return l=l.i.splice(0,m),d.D=l,x}function Su(l){if(!l.g&&!l.u){l.Y=1;var d=l.Fa;J||Re(),_e||(J(),_e=!0),Ce.add(d,l),l.v=0}}function tl(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Ve(_(l.Fa,l),Cu(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,Au(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Ve(_(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,be(10),Ta(this),Au(this))};function sl(l){l.A!=null&&(c.clearTimeout(l.A),l.A=null)}function Au(l){l.g=new ct(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var d=xs(l.qa);rt(d,"RID","rpc"),rt(d,"SID",l.K),rt(d,"AID",l.T),rt(d,"CI",l.F?"0":"1"),!l.F&&l.ja&&rt(d,"TO",l.ja),rt(d,"TYPE","xmlhttp"),hi(l,d),l.m&&l.o&&Zo(d,l.m,l.o),l.L&&(l.g.I=l.L);var m=l.g;l=l.ia,m.L=1,m.v=xr(xs(d)),m.m=null,m.P=!0,an(m,l)}n.Za=function(){this.C!=null&&(this.C=null,Ta(this),tl(this),be(19))};function Aa(l){l.C!=null&&(c.clearTimeout(l.C),l.C=null)}function ju(l,d){var m=null;if(l.g==d){Aa(l),sl(l),l.g=null;var x=2}else if(On(l.h,d))m=d.D,ri(l.h,d),x=1;else return;if(l.G!=0){if(d.o)if(x==1){m=d.m?d.m.length:0,d=Date.now()-d.F;var C=l.B;x=Jt(),ve(x,new pt(x,m)),Sa(l)}else Su(l);else if(C=d.s,C==3||C==0&&0<d.X||!(x==1&&og(l,d)||x==2&&tl(l)))switch(m&&0<m.length&&(d=l.h,d.i=d.i.concat(m)),C){case 1:Bn(l,5);break;case 4:Bn(l,10);break;case 3:Bn(l,6);break;default:Bn(l,2)}}}function Cu(l,d){let m=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(m*=2),m*d}function Bn(l,d){if(l.j.info("Error code "+d),d==2){var m=_(l.fb,l),x=l.Xa;const C=!x;x=new qs(x||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||pr(x,"https"),xr(x),C?Un(x.toString(),m):tg(x.toString(),m)}else be(2);l.G=0,l.l&&l.l.sa(d),Ru(l),Iu(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),be(2)):(this.j.info("Failed to ping google.com"),be(1))};function Ru(l){if(l.G=0,l.ka=[],l.l){const d=ii(l.h);(d.length!=0||l.i.length!=0)&&(T(l.ka,d),T(l.ka,l.i),l.h.i.length=0,k(l.i),l.i.length=0),l.l.ra()}}function Pu(l,d,m){var x=m instanceof qs?xs(m):new qs(m);if(x.g!="")d&&(x.g=d+"."+x.g),gr(x,x.s);else{var C=c.location;x=C.protocol,d=d?d+"."+C.hostname:C.hostname,C=+C.port;var O=new qs(null);x&&pr(O,x),d&&(O.g=d),C&&gr(O,C),m&&(O.l=m),x=O}return m=l.D,d=l.ya,m&&d&&rt(x,m,d),rt(x,"VER",l.la),hi(l,x),x}function ku(l,d,m){if(d&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return d=l.Ca&&!l.pa?new bt(new Na({eb:m})):new bt(l.pa),d.Ha(l.J),d}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Du(){}n=Du.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ja(){}ja.prototype.g=function(l,d){return new as(l,d)};function as(l,d){ie.call(this),this.g=new Nu(d),this.l=l,this.h=d&&d.messageUrlParams||null,l=d&&d.messageHeaders||null,d&&d.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=d&&d.initMessageHeaders||null,d&&d.messageContentType&&(l?l["X-WebChannel-Content-Type"]=d.messageContentType:l={"X-WebChannel-Content-Type":d.messageContentType}),d&&d.va&&(l?l["X-WebChannel-Client-Profile"]=d.va:l={"X-WebChannel-Client-Profile":d.va}),this.g.S=l,(l=d&&d.Sb)&&!K(l)&&(this.g.m=l),this.v=d&&d.supportsCrossDomainXhr||!1,this.u=d&&d.sendRawJson||!1,(d=d&&d.httpSessionIdParam)&&!K(d)&&(this.g.D=d,l=this.h,l!==null&&d in l&&(l=this.h,d in l&&delete l[d])),this.j=new _r(this)}P(as,ie),as.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},as.prototype.close=function(){el(this.g)},as.prototype.o=function(l){var d=this.g;if(typeof l=="string"){var m={};m.__data__=l,l=m}else this.u&&(m={},m.__data__=Rt(l),l=m);d.i.push(new fa(d.Ya++,l)),d.G==3&&Sa(d)},as.prototype.N=function(){this.g.l=null,delete this.j,el(this.g),delete this.g,as.aa.N.call(this)};function Vu(l){Ke.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var d=l.__sm__;if(d){e:{for(const m in d){l=m;break e}l=void 0}(this.i=l)&&(l=this.i,d=d!==null&&l in d?d[l]:void 0),this.data=d}else this.data=l}P(Vu,Ke);function Ou(){vt.call(this),this.status=1}P(Ou,vt);function _r(l){this.g=l}P(_r,Du),_r.prototype.ua=function(){ve(this.g,"a")},_r.prototype.ta=function(l){ve(this.g,new Vu(l))},_r.prototype.sa=function(l){ve(this.g,new Ou)},_r.prototype.ra=function(){ve(this.g,"b")},ja.prototype.createWebChannel=ja.prototype.g,as.prototype.send=as.prototype.o,as.prototype.open=as.prototype.m,as.prototype.close=as.prototype.close,vm=function(){return new ja},ym=function(){return Jt()},_m=He,Pl={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},pe.NO_ERROR=0,pe.TIMEOUT=8,pe.HTTP_ERROR=6,Ma=pe,$e.COMPLETE="complete",bm=$e,Je.EventType=qe,qe.OPEN="a",qe.CLOSE="b",qe.ERROR="c",qe.MESSAGE="d",ie.prototype.listen=ie.prototype.K,yi=Je,bt.prototype.listenOnce=bt.prototype.L,bt.prototype.getLastError=bt.prototype.Ka,bt.prototype.getLastErrorCode=bt.prototype.Ba,bt.prototype.getStatus=bt.prototype.Z,bt.prototype.getResponseJson=bt.prototype.Oa,bt.prototype.getResponseText=bt.prototype.oa,bt.prototype.send=bt.prototype.ea,bt.prototype.setWithCredentials=bt.prototype.Ha,xm=bt}).apply(typeof Ra!="undefined"?Ra:typeof self!="undefined"?self:typeof window!="undefined"?window:{});const id="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ut.UNAUTHENTICATED=new Ut(null),Ut.GOOGLE_CREDENTIALS=new Ut("google-credentials-uid"),Ut.FIRST_PARTY=new Ut("first-party-uid"),Ut.MOCK_USER=new Ut("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xr="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const er=new hc("@firebase/firestore");function Tr(){return er.logLevel}function z(n,...e){if(er.logLevel<=Oe.DEBUG){const t=e.map(pc);er.debug(`Firestore (${Xr}): ${n}`,...t)}}function Xt(n,...e){if(er.logLevel<=Oe.ERROR){const t=e.map(pc);er.error(`Firestore (${Xr}): ${n}`,...t)}}function tr(n,...e){if(er.logLevel<=Oe.WARN){const t=e.map(pc);er.warn(`Firestore (${Xr}): ${n}`,...t)}}function pc(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch(e){return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ae(n="Unexpected state"){const e=`FIRESTORE (${Xr}) INTERNAL ASSERTION FAILED: `+n;throw Xt(e),new Error(e)}function ce(n,e){n||ae()}function Ie(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Z extends tn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class G0{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ut.UNAUTHENTICATED))}shutdown(){}}class z0{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class K0{constructor(e){this.t=e,this.currentUser=Ut.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ce(this.o===void 0);let s=this.i;const r=u=>this.i!==s?(s=this.i,t(u)):Promise.resolve();let a=new Rs;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Rs,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const u=a;e.enqueueRetryable(()=>I(this,null,function*(){yield u.promise,yield r(this.currentUser)}))},c=u=>{z("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(z("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Rs)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(s=>this.i!==e?(z("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(ce(typeof s.accessToken=="string"),new wm(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ce(e===null||typeof e=="string"),new Ut(e)}}class H0{constructor(e,t,s){this.l=e,this.h=t,this.P=s,this.type="FirstParty",this.user=Ut.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class W0{constructor(e,t,s){this.l=e,this.h=t,this.P=s}getToken(){return Promise.resolve(new H0(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ut.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Q0{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class J0{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){ce(this.o===void 0);const s=a=>{a.error!=null&&z("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.R;return this.R=a.token,z("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable(()=>s(a))};const r=a=>{z("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(a=>r(a)),setTimeout(()=>{if(!this.appCheck){const a=this.A.getImmediate({optional:!0});a?r(a):z("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ce(typeof t.token=="string"),this.R=t.token,new Q0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y0(n){const e=typeof self!="undefined"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nm{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const r=Y0(40);for(let a=0;a<r.length;++a)s.length<20&&r[a]<t&&(s+=e.charAt(r[a]%e.length))}return s}}function Ae(n,e){return n<e?-1:n>e?1:0}function qr(n,e,t){return n.length===e.length&&n.every((s,r)=>t(s,e[r]))}function Im(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Z(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Z(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Z(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Z(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return xt.fromMillis(Date.now())}static fromDate(e){return xt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*t));return new xt(t,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ae(this.nanoseconds,e.nanoseconds):Ae(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{constructor(e){this.timestamp=e}static fromTimestamp(e){return new he(e)}static min(){return new he(new xt(0,0))}static max(){return new he(new xt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t,s){t===void 0?t=0:t>e.length&&ae(),s===void 0?s=e.length-t:s>e.length-t&&ae(),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return Oi.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Oi?e.forEach(s=>{t.push(s)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const a=e.get(r),o=t.get(r);if(a<o)return-1;if(a>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ye extends Oi{construct(e,t,s){return new Ye(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new Z(F.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(r=>r.length>0))}return new Ye(t)}static emptyPath(){return new Ye([])}}const X0=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class gt extends Oi{construct(e,t,s){return new gt(e,t,s)}static isValidIdentifier(e){return X0.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),gt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new gt(["__name__"])}static fromServerFormat(e){const t=[];let s="",r=0;const a=()=>{if(s.length===0)throw new Z(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const c=e[r];if(c==="\\"){if(r+1===e.length)throw new Z(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[r+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new Z(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=u,r+=2}else c==="`"?(o=!o,r++):c!=="."||o?(s+=c,r++):(a(),r++)}if(a(),o)throw new Z(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new gt(t)}static emptyPath(){return new gt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.path=e}static fromPath(e){return new te(Ye.fromString(e))}static fromName(e){return new te(Ye.fromString(e).popFirst(5))}static empty(){return new te(Ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ye.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new te(new Ye(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(e,t,s,r){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=r}}function kl(n){return n.fields.find(e=>e.kind===2)}function Gn(n){return n.fields.filter(e=>e.kind!==2)}oo.UNKNOWN_ID=-1;class Fa{constructor(e,t){this.fieldPath=e,this.kind=t}}class Li{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Li(0,ls.min())}}function Z0(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=he.fromTimestamp(s===1e9?new xt(t+1,0):new xt(t,s));return new ls(r,te.empty(),e)}function Em(n){return new ls(n.readTime,n.key,-1)}class ls{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new ls(he.min(),te.empty(),-1)}static max(){return new ls(he.max(),te.empty(),-1)}}function gc(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=te.comparator(n.documentKey,e.documentKey),t!==0?t:Ae(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Sm{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cr(n){return I(this,null,function*(){if(n.code!==F.FAILED_PRECONDITION||n.message!==Tm)throw n;z("LocalStore","Unexpectedly lost primary lease")})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ae(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new R((s,r)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(s,r)},this.catchCallback=a=>{this.wrapFailure(t,a).next(s,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof R?t:R.resolve(t)}catch(t){return R.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):R.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):R.reject(t)}static resolve(e){return new R((t,s)=>{t(e)})}static reject(e){return new R((t,s)=>{s(e)})}static waitFor(e){return new R((t,s)=>{let r=0,a=0,o=!1;e.forEach(c=>{++r,c.next(()=>{++a,o&&a===r&&t()},u=>s(u))}),o=!0,a===r&&t()})}static or(e){let t=R.resolve(!1);for(const s of e)t=t.next(r=>r?R.resolve(r):s());return t}static forEach(e,t){const s=[];return e.forEach((r,a)=>{s.push(t.call(this,r,a))}),this.waitFor(s)}static mapArray(e,t){return new R((s,r)=>{const a=e.length,o=new Array(a);let c=0;for(let u=0;u<a;u++){const h=u;t(e[h]).next(f=>{o[h]=f,++c,c===a&&s(o)},f=>r(f))}})}static doWhile(e,t){return new R((s,r)=>{const a=()=>{e()===!0?t().next(()=>{a()},r):s()};a()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Rs,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ti(e,t.error)):this.V.resolve()},this.transaction.onerror=s=>{const r=xc(s.target.error);this.V.reject(new Ti(e,r))}}static open(e,t,s,r){try{return new jo(t,e.transaction(r,s))}catch(a){throw new Ti(t,a)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(z("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new tb(t)}}class Nn{constructor(e,t,s){this.name=e,this.version=t,this.p=s,Nn.S(jt())===12.2&&Xt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return z("SimpleDb","Removing database:",e),zn(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!cm())return!1;if(Nn.v())return!0;const e=jt(),t=Nn.S(e),s=0<t&&t<10,r=Am(e),a=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||a)}static v(){var e;return typeof process!="undefined"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}M(e){return I(this,null,function*(){return this.db||(z("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,s)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=a=>{const o=a.target.result;t(o)},r.onblocked=()=>{s(new Ti(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=a=>{const o=a.target.error;o.name==="VersionError"?s(new Z(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?s(new Z(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):s(new Ti(e,o))},r.onupgradeneeded=a=>{z("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);const o=a.target.result;this.p.O(o,r.transaction,a.oldVersion,this.version).next(()=>{z("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,s,r){return I(this,null,function*(){const a=t==="readonly";let o=0;for(;;){++o;try{this.db=yield this.M(e);const c=jo.open(this.db,e,a?"readonly":"readwrite",s),u=r(c).next(h=>(c.g(),h)).catch(h=>(c.abort(h),R.reject(h))).toPromise();return u.catch(()=>{}),yield c.m,u}catch(c){const u=c,h=u.name!=="FirebaseError"&&o<3;if(z("SimpleDb","Transaction failed with error:",u.message,"Retrying:",h),this.close(),!h)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}}function Am(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class eb{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return zn(this.B.delete())}}class Ti extends Z{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Cn(n){return n.name==="IndexedDbTransactionError"}class tb{constructor(e){this.store=e}put(e,t){let s;return t!==void 0?(z("SimpleDb","PUT",this.store.name,e,t),s=this.store.put(t,e)):(z("SimpleDb","PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),zn(s)}add(e){return z("SimpleDb","ADD",this.store.name,e,e),zn(this.store.add(e))}get(e){return zn(this.store.get(e)).next(t=>(t===void 0&&(t=null),z("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return z("SimpleDb","DELETE",this.store.name,e),zn(this.store.delete(e))}count(){return z("SimpleDb","COUNT",this.store.name),zn(this.store.count())}U(e,t){const s=this.options(e,t),r=s.index?this.store.index(s.index):this.store;if(typeof r.getAll=="function"){const a=r.getAll(s.range);return new R((o,c)=>{a.onerror=u=>{c(u.target.error)},a.onsuccess=u=>{o(u.target.result)}})}{const a=this.cursor(s),o=[];return this.W(a,(c,u)=>{o.push(u)}).next(()=>o)}}G(e,t){const s=this.store.getAll(e,t===null?void 0:t);return new R((r,a)=>{s.onerror=o=>{a(o.target.error)},s.onsuccess=o=>{r(o.target.result)}})}j(e,t){z("SimpleDb","DELETE ALL",this.store.name);const s=this.options(e,t);s.H=!1;const r=this.cursor(s);return this.W(r,(a,o,c)=>c.delete())}J(e,t){let s;t?s=e:(s={},t=e);const r=this.cursor(s);return this.W(r,t)}Y(e){const t=this.cursor({});return new R((s,r)=>{t.onerror=a=>{const o=xc(a.target.error);r(o)},t.onsuccess=a=>{const o=a.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():s()}):s()}})}W(e,t){const s=[];return new R((r,a)=>{e.onerror=o=>{a(o.target.error)},e.onsuccess=o=>{const c=o.target.result;if(!c)return void r();const u=new eb(c),h=t(c.primaryKey,c.value,u);if(h instanceof R){const f=h.catch(p=>(u.done(),R.reject(p)));s.push(f)}u.isDone?r():u.K===null?c.continue():c.continue(u.K)}}).next(()=>R.waitFor(s))}options(e,t){let s;return e!==void 0&&(typeof e=="string"?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.H?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function zn(n){return new R((e,t)=>{n.onsuccess=s=>{const r=s.target.result;e(r)},n.onerror=s=>{const r=xc(s.target.error);t(r)}})}let ad=!1;function xc(n){const e=Nn.S(jt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const s=new Z("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ad||(ad=!0,setTimeout(()=>{throw s},0)),s}}return n}class sb{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){z("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>I(this,null,function*(){this.task=null;try{z("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Cn(t)?z("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield cr(t)}yield this.X(6e4)}))}}class nb{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return I(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){const s=new Set;let r=t,a=!0;return R.doWhile(()=>a===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!s.has(o))return z("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,r).next(c=>{r-=c,s.add(o)});a=!1})).next(()=>t-r)}ne(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,s).next(a=>{const o=a.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(r,a)).next(c=>(z("IndexBackfiller",`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}re(e,t){let s=e;return t.changes.forEach((r,a)=>{const o=Em(a);gc(o,s)>0&&(s=o)}),new ls(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ie(s),this.se=s=>t.writeSequenceNumber(s))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}fs.oe=-1;function Co(n){return n==null}function Mi(n){return n===0&&1/n==-1/0}function rb(n){return typeof n=="number"&&Number.isInteger(n)&&!Mi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=od(e)),e=ib(n.get(t),e);return od(e)}function ib(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const a=n.charAt(r);switch(a){case"\0":t+="";break;case"":t+="";break;default:t+=a}}return t}function od(n){return n+""}function As(n){const e=n.length;if(ce(e>=2),e===2)return ce(n.charAt(0)===""&&n.charAt(1)===""),Ye.emptyPath();const t=e-2,s=[];let r="";for(let a=0;a<e;){const o=n.indexOf("",a);switch((o<0||o>t)&&ae(),n.charAt(o+1)){case"":const c=n.substring(a,o);let u;r.length===0?u=c:(r+=c,u=r,r=""),s.push(u);break;case"":r+=n.substring(a,o),r+="\0";break;case"":r+=n.substring(a,o+1);break;default:ae()}a=o+2}return new Ye(s)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ld=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ua(n,e){return[n,Zt(e)]}function jm(n,e,t){return[n,Zt(e),t]}const ab={},ob=["prefixPath","collectionGroup","readTime","documentId"],lb=["prefixPath","collectionGroup","documentId"],cb=["collectionGroup","readTime","prefixPath","documentId"],ub=["canonicalId","targetId"],db=["targetId","path"],hb=["path","targetId"],mb=["collectionId","parent"],fb=["indexId","uid"],pb=["uid","sequenceNumber"],gb=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],xb=["indexId","uid","orderedDocumentKey"],bb=["userId","collectionPath","documentId"],_b=["userId","collectionPath","largestBatchId"],yb=["userId","collectionGroup","largestBatchId"],Cm=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],vb=[...Cm,"documentOverlays"],Rm=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Pm=Rm,bc=[...Pm,"indexConfiguration","indexState","indexEntries"],wb=bc,Nb=[...bc,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl extends Sm{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Ct(n,e){const t=Ie(n);return Nn.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cd(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ur(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function km(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e,t){this.comparator=e,this.root=t||Bt.EMPTY}insert(e,t){return new mt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Bt.BLACK,null,null))}remove(e){return new mt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Bt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pa(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pa(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pa(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pa(this.root,e,this.comparator,!0)}}class Pa{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=t?s(e.key,t):1,t&&r&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Bt{constructor(e,t,s,r,a){this.key=e,this.value=t,this.color=s!=null?s:Bt.RED,this.left=r!=null?r:Bt.EMPTY,this.right=a!=null?a:Bt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,a){return new Bt(e!=null?e:this.key,t!=null?t:this.value,s!=null?s:this.color,r!=null?r:this.left,a!=null?a:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const a=s(e,r.key);return r=a<0?r.copy(null,null,null,r.left.insert(e,t,s),null):a===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Bt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Bt.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Bt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Bt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ae();const e=this.left.check();if(e!==this.right.check())throw ae();return e+(this.isRed()?0:1)}}Bt.EMPTY=null,Bt.RED=!0,Bt.BLACK=!1;Bt.EMPTY=new class{constructor(){this.size=0}get key(){throw ae()}get value(){throw ae()}get color(){throw ae()}get left(){throw ae()}get right(){throw ae()}copy(e,t,s,r,a){return this}insert(e,t,s){return new Bt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e){this.comparator=e,this.data=new mt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ud(this.data.getIterator())}getIteratorFrom(e){return new ud(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(s=>{t=t.add(s)}),t}isEqual(e){if(!(e instanceof it)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,a=s.getNext().key;if(this.comparator(r,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new it(this.comparator);return t.data=e,t}}class ud{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function vr(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e){this.fields=e,e.sort(gt.comparator)}static empty(){return new is([])}unionWith(e){let t=new it(gt.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new is(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return qr(this.fields,e.fields,(t,s)=>t.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(a){throw typeof DOMException!="undefined"&&a instanceof DOMException?new Dm("Invalid base64 string: "+a):a}}(e);return new It(t)}static fromUint8Array(e){const t=function(r){let a="";for(let o=0;o<r.length;++o)a+=String.fromCharCode(r[o]);return a}(e);return new It(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ae(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}It.EMPTY_BYTE_STRING=new It("");const Ib=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ys(n){if(ce(!!n),typeof n=="string"){let e=0;const t=Ib.exec(n);if(ce(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ht(n.seconds),nanos:ht(n.nanos)}}function ht(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Tn(n){return typeof n=="string"?It.fromBase64String(n):It.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _c(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function yc(n){const e=n.mapValue.fields.__previous_value__;return _c(e)?yc(e):e}function Fi(n){const e=Ys(n.mapValue.fields.__local_write_time__.timestampValue);return new xt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eb{constructor(e,t,s,r,a,o,c,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h}}class sr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new sr("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof sr&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _n={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ba={nullValue:"NULL_VALUE"};function nr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?_c(n)?4:Vm(n)?9007199254740991:Ro(n)?10:11:ae()}function Os(n,e){if(n===e)return!0;const t=nr(n);if(t!==nr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Fi(n).isEqual(Fi(e));case 3:return function(r,a){if(typeof r.timestampValue=="string"&&typeof a.timestampValue=="string"&&r.timestampValue.length===a.timestampValue.length)return r.timestampValue===a.timestampValue;const o=Ys(r.timestampValue),c=Ys(a.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,a){return Tn(r.bytesValue).isEqual(Tn(a.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,a){return ht(r.geoPointValue.latitude)===ht(a.geoPointValue.latitude)&&ht(r.geoPointValue.longitude)===ht(a.geoPointValue.longitude)}(n,e);case 2:return function(r,a){if("integerValue"in r&&"integerValue"in a)return ht(r.integerValue)===ht(a.integerValue);if("doubleValue"in r&&"doubleValue"in a){const o=ht(r.doubleValue),c=ht(a.doubleValue);return o===c?Mi(o)===Mi(c):isNaN(o)&&isNaN(c)}return!1}(n,e);case 9:return qr(n.arrayValue.values||[],e.arrayValue.values||[],Os);case 10:case 11:return function(r,a){const o=r.mapValue.fields||{},c=a.mapValue.fields||{};if(cd(o)!==cd(c))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!Os(o[u],c[u])))return!1;return!0}(n,e);default:return ae()}}function Ui(n,e){return(n.values||[]).find(t=>Os(t,e))!==void 0}function Sn(n,e){if(n===e)return 0;const t=nr(n),s=nr(e);if(t!==s)return Ae(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ae(n.booleanValue,e.booleanValue);case 2:return function(a,o){const c=ht(a.integerValue||a.doubleValue),u=ht(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(n,e);case 3:return dd(n.timestampValue,e.timestampValue);case 4:return dd(Fi(n),Fi(e));case 5:return Ae(n.stringValue,e.stringValue);case 6:return function(a,o){const c=Tn(a),u=Tn(o);return c.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(a,o){const c=a.split("/"),u=o.split("/");for(let h=0;h<c.length&&h<u.length;h++){const f=Ae(c[h],u[h]);if(f!==0)return f}return Ae(c.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(a,o){const c=Ae(ht(a.latitude),ht(o.latitude));return c!==0?c:Ae(ht(a.longitude),ht(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return hd(n.arrayValue,e.arrayValue);case 10:return function(a,o){var c,u,h,f;const p=a.fields||{},_=o.fields||{},A=(c=p.value)===null||c===void 0?void 0:c.arrayValue,P=(u=_.value)===null||u===void 0?void 0:u.arrayValue,k=Ae(((h=A==null?void 0:A.values)===null||h===void 0?void 0:h.length)||0,((f=P==null?void 0:P.values)===null||f===void 0?void 0:f.length)||0);return k!==0?k:hd(A,P)}(n.mapValue,e.mapValue);case 11:return function(a,o){if(a===_n.mapValue&&o===_n.mapValue)return 0;if(a===_n.mapValue)return 1;if(o===_n.mapValue)return-1;const c=a.fields||{},u=Object.keys(c),h=o.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let p=0;p<u.length&&p<f.length;++p){const _=Ae(u[p],f[p]);if(_!==0)return _;const A=Sn(c[u[p]],h[f[p]]);if(A!==0)return A}return Ae(u.length,f.length)}(n.mapValue,e.mapValue);default:throw ae()}}function dd(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ae(n,e);const t=Ys(n),s=Ys(e),r=Ae(t.seconds,s.seconds);return r!==0?r:Ae(t.nanos,s.nanos)}function hd(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const a=Sn(t[r],s[r]);if(a)return a}return Ae(t.length,s.length)}function $r(n){return Vl(n)}function Vl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const s=Ys(t);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Tn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return te.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let s="[",r=!0;for(const a of t.values||[])r?r=!1:s+=",",s+=Vl(a);return s+"]"}(n.arrayValue):"mapValue"in n?function(t){const s=Object.keys(t.fields||{}).sort();let r="{",a=!0;for(const o of s)a?a=!1:r+=",",r+=`${o}:${Vl(t.fields[o])}`;return r+"}"}(n.mapValue):ae()}function Bi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ol(n){return!!n&&"integerValue"in n}function qi(n){return!!n&&"arrayValue"in n}function md(n){return!!n&&"nullValue"in n}function fd(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function qa(n){return!!n&&"mapValue"in n}function Ro(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Si(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return ur(n.mapValue.fields,(t,s)=>e.mapValue.fields[t]=Si(s)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Si(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Vm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const Om={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Tb(n){return"nullValue"in n?Ba:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Bi(sr.empty(),te.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Ro(n)?Om:{mapValue:{}}:ae()}function Sb(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Bi(sr.empty(),te.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Om:"mapValue"in n?Ro(n)?{mapValue:{}}:_n:ae()}function pd(n,e){const t=Sn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function gd(n,e){const t=Sn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.value=e}static empty(){return new Kt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!qa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Si(t)}setAll(e){let t=gt.emptyPath(),s={},r=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){const u=this.getFieldsMap(t);this.applyChanges(u,s,r),s={},r=[],t=c.popLast()}o?s[c.lastSegment()]=Si(o):r.push(c.lastSegment())});const a=this.getFieldsMap(t);this.applyChanges(a,s,r)}delete(e){const t=this.field(e.popLast());qa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Os(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];qa(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){ur(t,(r,a)=>e[r]=a);for(const r of s)delete e[r]}clone(){return new Kt(Si(this.value))}}function Lm(n){const e=[];return ur(n.fields,(t,s)=>{const r=new gt([t]);if(qa(s)){const a=Lm(s.mapValue).fields;if(a.length===0)e.push(r);else for(const o of a)e.push(r.child(o))}else e.push(r)}),new is(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,t,s,r,a,o,c){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=a,this.data=o,this.documentState=c}static newInvalidDocument(e){return new _t(e,0,he.min(),he.min(),he.min(),Kt.empty(),0)}static newFoundDocument(e,t,s,r){return new _t(e,1,t,he.min(),s,r,0)}static newNoDocument(e,t){return new _t(e,2,t,he.min(),he.min(),Kt.empty(),0)}static newUnknownDocument(e,t){return new _t(e,3,t,he.min(),he.min(),Kt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(he.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Kt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=he.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof _t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e,t){this.position=e,this.inclusive=t}}function xd(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const a=e[r],o=n.position[r];if(a.field.isKeyField()?s=te.comparator(te.fromName(o.referenceValue),t.key):s=Sn(o,t.data.field(a.field)),a.dir==="desc"&&(s*=-1),s!==0)break}return s}function bd(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Os(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ab(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{}class Le extends Mm{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new jb(e,t,s):t==="array-contains"?new Pb(e,s):t==="in"?new Gm(e,s):t==="not-in"?new kb(e,s):t==="array-contains-any"?new Db(e,s):new Le(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new Cb(e,s):new Rb(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Sn(t,this.value)):t!==null&&nr(this.value)===nr(t)&&this.matchesComparison(Sn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ae()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class tt extends Mm{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new tt(e,t)}matches(e){return zr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function zr(n){return n.op==="and"}function Ll(n){return n.op==="or"}function vc(n){return Fm(n)&&zr(n)}function Fm(n){for(const e of n.filters)if(e instanceof tt)return!1;return!0}function Ml(n){if(n instanceof Le)return n.field.canonicalString()+n.op.toString()+$r(n.value);if(vc(n))return n.filters.map(e=>Ml(e)).join(",");{const e=n.filters.map(t=>Ml(t)).join(",");return`${n.op}(${e})`}}function Um(n,e){return n instanceof Le?function(s,r){return r instanceof Le&&s.op===r.op&&s.field.isEqual(r.field)&&Os(s.value,r.value)}(n,e):n instanceof tt?function(s,r){return r instanceof tt&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce((a,o,c)=>a&&Um(o,r.filters[c]),!0):!1}(n,e):void ae()}function Bm(n,e){const t=n.filters.concat(e);return tt.create(t,n.op)}function qm(n){return n instanceof Le?function(t){return`${t.field.canonicalString()} ${t.op} ${$r(t.value)}`}(n):n instanceof tt?function(t){return t.op.toString()+" {"+t.getFilters().map(qm).join(" ,")+"}"}(n):"Filter"}class jb extends Le{constructor(e,t,s){super(e,t,s),this.key=te.fromName(s.referenceValue)}matches(e){const t=te.comparator(e.key,this.key);return this.matchesComparison(t)}}class Cb extends Le{constructor(e,t){super(e,"in",t),this.keys=$m("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Rb extends Le{constructor(e,t){super(e,"not-in",t),this.keys=$m("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function $m(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(s=>te.fromName(s.referenceValue))}class Pb extends Le{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return qi(t)&&Ui(t.arrayValue,this.value)}}class Gm extends Le{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ui(this.value.arrayValue,t)}}class kb extends Le{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ui(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Ui(this.value.arrayValue,t)}}class Db extends Le{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!qi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(s=>Ui(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vb{constructor(e,t=null,s=[],r=[],a=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=a,this.startAt=o,this.endAt=c,this.ue=null}}function Fl(n,e=null,t=[],s=[],r=null,a=null,o=null){return new Vb(n,e,t,s,r,a,o)}function rr(n){const e=Ie(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(s=>Ml(s)).join(","),t+="|ob:",t+=e.orderBy.map(s=>function(a){return a.field.canonicalString()+a.dir}(s)).join(","),Co(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>$r(s)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>$r(s)).join(",")),e.ue=t}return e.ue}function Xi(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Ab(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Um(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!bd(n.startAt,e.startAt)&&bd(n.endAt,e.endAt)}function lo(n){return te.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function co(n,e){return n.filters.filter(t=>t instanceof Le&&t.field.isEqual(e))}function _d(n,e,t){let s=Ba,r=!0;for(const a of co(n,e)){let o=Ba,c=!0;switch(a.op){case"<":case"<=":o=Tb(a.value);break;case"==":case"in":case">=":o=a.value;break;case">":o=a.value,c=!1;break;case"!=":case"not-in":o=Ba}pd({value:s,inclusive:r},{value:o,inclusive:c})<0&&(s=o,r=c)}if(t!==null){for(let a=0;a<n.orderBy.length;++a)if(n.orderBy[a].field.isEqual(e)){const o=t.position[a];pd({value:s,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}function yd(n,e,t){let s=_n,r=!0;for(const a of co(n,e)){let o=_n,c=!0;switch(a.op){case">=":case">":o=Sb(a.value),c=!1;break;case"==":case"in":case"<=":o=a.value;break;case"<":o=a.value,c=!1;break;case"!=":case"not-in":o=_n}gd({value:s,inclusive:r},{value:o,inclusive:c})>0&&(s=o,r=c)}if(t!==null){for(let a=0;a<n.orderBy.length;++a)if(n.orderBy[a].field.isEqual(e)){const o=t.position[a];gd({value:s,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr{constructor(e,t=null,s=[],r=[],a=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=a,this.limitType=o,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ob(n,e,t,s,r,a,o,c){return new Zr(n,e,t,s,r,a,o,c)}function Zi(n){return new Zr(n)}function vd(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function zm(n){return n.collectionGroup!==null}function Ai(n){const e=Ie(n);if(e.ce===null){e.ce=[];const t=new Set;for(const a of e.explicitOrderBy)e.ce.push(a),t.add(a.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new it(gt.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(a=>{t.has(a.canonicalString())||a.isKeyField()||e.ce.push(new $i(a,s))}),t.has(gt.keyField().canonicalString())||e.ce.push(new $i(gt.keyField(),s))}return e.ce}function ps(n){const e=Ie(n);return e.le||(e.le=Lb(e,Ai(n))),e.le}function Lb(n,e){if(n.limitType==="F")return Fl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const a=r.dir==="desc"?"asc":"desc";return new $i(r.field,a)});const t=n.endAt?new Gr(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Gr(n.startAt.position,n.startAt.inclusive):null;return Fl(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function Ul(n,e){const t=n.filters.concat([e]);return new Zr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Bl(n,e,t){return new Zr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Po(n,e){return Xi(ps(n),ps(e))&&n.limitType===e.limitType}function Km(n){return`${rr(ps(n))}|lt:${n.limitType}`}function Sr(n){return`Query(target=${function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map(r=>qm(r)).join(", ")}]`),Co(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(r=>$r(r)).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(r=>$r(r)).join(",")),`Target(${s})`}(ps(n))}; limitType=${n.limitType})`}function ea(n,e){return e.isFoundDocument()&&function(s,r){const a=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(a):te.isDocumentKey(s.path)?s.path.isEqual(a):s.path.isImmediateParentOf(a)}(n,e)&&function(s,r){for(const a of Ai(s))if(!a.field.isKeyField()&&r.data.field(a.field)===null)return!1;return!0}(n,e)&&function(s,r){for(const a of s.filters)if(!a.matches(r))return!1;return!0}(n,e)&&function(s,r){return!(s.startAt&&!function(o,c,u){const h=xd(o,c,u);return o.inclusive?h<=0:h<0}(s.startAt,Ai(s),r)||s.endAt&&!function(o,c,u){const h=xd(o,c,u);return o.inclusive?h>=0:h>0}(s.endAt,Ai(s),r))}(n,e)}function Mb(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Hm(n){return(e,t)=>{let s=!1;for(const r of Ai(n)){const a=Fb(r,e,t);if(a!==0)return a;s=s||r.field.isKeyField()}return 0}}function Fb(n,e,t){const s=n.field.isKeyField()?te.comparator(e.key,t.key):function(a,o,c){const u=o.data.field(a),h=c.data.field(a);return u!==null&&h!==null?Sn(u,h):ae()}(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return ae()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,a]of s)if(this.equalsFn(r,e))return a}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let a=0;a<r.length;a++)if(this.equalsFn(r[a][0],e))return void(r[a]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ur(this.inner,(t,s)=>{for(const[r,a]of s)e(r,a)})}isEmpty(){return km(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ub=new mt(te.comparator);function os(){return Ub}const Wm=new mt(te.comparator);function vi(...n){let e=Wm;for(const t of n)e=e.insert(t.key,t);return e}function Qm(n){let e=Wm;return n.forEach((t,s)=>e=e.insert(t,s.overlayedDocument)),e}function js(){return ji()}function Jm(){return ji()}function ji(){return new Rn(n=>n.toString(),(n,e)=>n.isEqual(e))}const Bb=new mt(te.comparator),qb=new it(te.comparator);function Pe(...n){let e=qb;for(const t of n)e=e.add(t);return e}const $b=new it(Ae);function Gb(){return $b}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wc(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mi(e)?"-0":e}}function Ym(n){return{integerValue:""+n}}function zb(n,e){return rb(e)?Ym(e):wc(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(){this._=void 0}}function Kb(n,e,t){return n instanceof Gi?function(r,a){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return a&&_c(a)&&(a=yc(a)),a&&(o.fields.__previous_value__=a),{mapValue:o}}(t,e):n instanceof Kr?Zm(n,e):n instanceof Hr?ef(n,e):function(r,a){const o=Xm(r,a),c=wd(o)+wd(r.Pe);return Ol(o)&&Ol(r.Pe)?Ym(c):wc(r.serializer,c)}(n,e)}function Hb(n,e,t){return n instanceof Kr?Zm(n,e):n instanceof Hr?ef(n,e):t}function Xm(n,e){return n instanceof zi?function(s){return Ol(s)||function(a){return!!a&&"doubleValue"in a}(s)}(e)?e:{integerValue:0}:null}class Gi extends ko{}class Kr extends ko{constructor(e){super(),this.elements=e}}function Zm(n,e){const t=tf(e);for(const s of n.elements)t.some(r=>Os(r,s))||t.push(s);return{arrayValue:{values:t}}}class Hr extends ko{constructor(e){super(),this.elements=e}}function ef(n,e){let t=tf(e);for(const s of n.elements)t=t.filter(r=>!Os(r,s));return{arrayValue:{values:t}}}class zi extends ko{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function wd(n){return ht(n.integerValue||n.doubleValue)}function tf(n){return qi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wb{constructor(e,t){this.field=e,this.transform=t}}function Qb(n,e){return n.field.isEqual(e.field)&&function(s,r){return s instanceof Kr&&r instanceof Kr||s instanceof Hr&&r instanceof Hr?qr(s.elements,r.elements,Os):s instanceof zi&&r instanceof zi?Os(s.Pe,r.Pe):s instanceof Gi&&r instanceof Gi}(n.transform,e.transform)}class Jb{constructor(e,t){this.version=e,this.transformResults=t}}class At{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new At}static exists(e){return new At(void 0,e)}static updateTime(e){return new At(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function $a(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Do{}function sf(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ta(n.key,At.none()):new ei(n.key,n.data,At.none());{const t=n.data,s=Kt.empty();let r=new it(gt.comparator);for(let a of e.fields)if(!r.has(a)){let o=t.field(a);o===null&&a.length>1&&(a=a.popLast(),o=t.field(a)),o===null?s.delete(a):s.set(a,o),r=r.add(a)}return new sn(n.key,s,new is(r.toArray()),At.none())}}function Yb(n,e,t){n instanceof ei?function(r,a,o){const c=r.value.clone(),u=Id(r.fieldTransforms,a,o.transformResults);c.setAll(u),a.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):n instanceof sn?function(r,a,o){if(!$a(r.precondition,a))return void a.convertToUnknownDocument(o.version);const c=Id(r.fieldTransforms,a,o.transformResults),u=a.data;u.setAll(nf(r)),u.setAll(c),a.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(r,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ci(n,e,t,s){return n instanceof ei?function(a,o,c,u){if(!$a(a.precondition,o))return c;const h=a.value.clone(),f=Ed(a.fieldTransforms,u,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(n,e,t,s):n instanceof sn?function(a,o,c,u){if(!$a(a.precondition,o))return c;const h=Ed(a.fieldTransforms,u,o),f=o.data;return f.setAll(nf(a)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(p=>p.field))}(n,e,t,s):function(a,o,c){return $a(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(n,e,t)}function Xb(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),a=Xm(s.transform,r||null);a!=null&&(t===null&&(t=Kt.empty()),t.set(s.field,a))}return t||null}function Nd(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&qr(s,r,(a,o)=>Qb(a,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ei extends Do{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class sn extends Do{constructor(e,t,s,r,a=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function nf(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}}),e}function Id(n,e,t){const s=new Map;ce(n.length===t.length);for(let r=0;r<t.length;r++){const a=n[r],o=a.transform,c=e.data.field(a.field);s.set(a.field,Hb(o,c,t[r]))}return s}function Ed(n,e,t){const s=new Map;for(const r of n){const a=r.transform,o=t.data.field(r.field);s.set(r.field,Kb(a,o,e))}return s}class ta extends Do{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class rf extends Do{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const a=this.mutations[r];a.key.isEqual(e.key)&&Yb(a,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Ci(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Ci(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=Jm();return this.mutations.forEach(r=>{const a=e.get(r.key),o=a.overlayedDocument;let c=this.applyToLocalView(o,a.mutatedFields);c=t.has(r.key)?null:c;const u=sf(o,c);u!==null&&s.set(r.key,u),o.isValidDocument()||o.convertToNoDocument(he.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Pe())}isEqual(e){return this.batchId===e.batchId&&qr(this.mutations,e.mutations,(t,s)=>Nd(t,s))&&qr(this.baseMutations,e.baseMutations,(t,s)=>Nd(t,s))}}class Ic{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){ce(e.mutations.length===s.length);let r=function(){return Bb}();const a=e.mutations;for(let o=0;o<a.length;o++)r=r.insert(a[o].key,s[o].version);return new Ic(e,t,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zb{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nt,Ge;function e_(n){switch(n){default:return ae();case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0}}function af(n){if(n===void 0)return Xt("GRPC error has no .code"),F.UNKNOWN;switch(n){case Nt.OK:return F.OK;case Nt.CANCELLED:return F.CANCELLED;case Nt.UNKNOWN:return F.UNKNOWN;case Nt.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case Nt.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case Nt.INTERNAL:return F.INTERNAL;case Nt.UNAVAILABLE:return F.UNAVAILABLE;case Nt.UNAUTHENTICATED:return F.UNAUTHENTICATED;case Nt.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case Nt.NOT_FOUND:return F.NOT_FOUND;case Nt.ALREADY_EXISTS:return F.ALREADY_EXISTS;case Nt.PERMISSION_DENIED:return F.PERMISSION_DENIED;case Nt.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case Nt.ABORTED:return F.ABORTED;case Nt.OUT_OF_RANGE:return F.OUT_OF_RANGE;case Nt.UNIMPLEMENTED:return F.UNIMPLEMENTED;case Nt.DATA_LOSS:return F.DATA_LOSS;default:return ae()}}(Ge=Nt||(Nt={}))[Ge.OK=0]="OK",Ge[Ge.CANCELLED=1]="CANCELLED",Ge[Ge.UNKNOWN=2]="UNKNOWN",Ge[Ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ge[Ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ge[Ge.NOT_FOUND=5]="NOT_FOUND",Ge[Ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ge[Ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ge[Ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ge[Ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ge[Ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ge[Ge.ABORTED=10]="ABORTED",Ge[Ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ge[Ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ge[Ge.INTERNAL=13]="INTERNAL",Ge[Ge.UNAVAILABLE=14]="UNAVAILABLE",Ge[Ge.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t_(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s_=new Jn([4294967295,4294967295],0);function Td(n){const e=t_().encode(n),t=new gm;return t.update(e),new Uint8Array(t.digest())}function Sd(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new Jn([t,s],0),new Jn([r,a],0)]}class Tc{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new wi(`Invalid padding: ${t}`);if(s<0)throw new wi(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new wi(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new wi(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Jn.fromNumber(this.Ie)}Ee(e,t,s){let r=e.add(t.multiply(Jn.fromNumber(s)));return r.compare(s_)===1&&(r=new Jn([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Td(e),[s,r]=Sd(t);for(let a=0;a<this.hashCount;a++){const o=this.Ee(s,r,a);if(!this.de(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new Tc(a,r,t);return s.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;const t=Td(e),[s,r]=Sd(t);for(let a=0;a<this.hashCount;a++){const o=this.Ee(s,r,a);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class wi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(e,t,s,r,a){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,sa.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Vo(he.min(),r,new mt(Ae),os(),Pe())}}class sa{constructor(e,t,s,r,a){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new sa(s,t,Pe(),Pe(),Pe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga{constructor(e,t,s,r){this.Re=e,this.removedTargetIds=t,this.key=s,this.Ve=r}}class of{constructor(e,t){this.targetId=e,this.me=t}}class lf{constructor(e,t,s=It.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class Ad{constructor(){this.fe=0,this.ge=Cd(),this.pe=It.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Pe(),t=Pe(),s=Pe();return this.ge.forEach((r,a)=>{switch(a){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:ae()}}),new sa(this.pe,this.ye,e,t,s)}Ce(){this.we=!1,this.ge=Cd()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ce(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class n_{constructor(e){this.Le=e,this.Be=new Map,this.ke=os(),this.qe=jd(),this.Qe=new mt(Ae)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const s=this.Ge(t);switch(e.state){case 0:this.ze(t)&&s.De(e.resumeToken);break;case 1:s.Oe(),s.Se||s.Ce(),s.De(e.resumeToken);break;case 2:s.Oe(),s.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(s.Ne(),s.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),s.De(e.resumeToken));break;default:ae()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((s,r)=>{this.ze(r)&&t(r)})}He(e){const t=e.targetId,s=e.me.count,r=this.Je(t);if(r){const a=r.target;if(lo(a))if(s===0){const o=new te(a.path);this.Ue(t,o,_t.newNoDocument(o,he.min()))}else ce(s===1);else{const o=this.Ye(t);if(o!==s){const c=this.Ze(e),u=c?this.Xe(c,e,o):1;if(u!==0){this.je(t);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:a=0}=t;let o,c;try{o=Tn(s).toUint8Array()}catch(u){if(u instanceof Dm)return tr("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Tc(o,r,a)}catch(u){return tr(u instanceof wi?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.Ie===0?null:c}Xe(e,t,s){return t.me.count===s-this.nt(e,t.targetId)?0:2}nt(e,t){const s=this.Le.getRemoteKeysForTarget(t);let r=0;return s.forEach(a=>{const o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,a,null),r++)}),r}rt(e){const t=new Map;this.Be.forEach((a,o)=>{const c=this.Je(o);if(c){if(a.current&&lo(c.target)){const u=new te(c.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,_t.newNoDocument(u,e))}a.be&&(t.set(o,a.ve()),a.Ce())}});let s=Pe();this.qe.forEach((a,o)=>{let c=!0;o.forEachWhile(u=>{const h=this.Je(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(s=s.add(a))}),this.ke.forEach((a,o)=>o.setReadTime(e));const r=new Vo(e,t,this.Qe,this.ke,s);return this.ke=os(),this.qe=jd(),this.Qe=new mt(Ae),r}$e(e,t){if(!this.ze(e))return;const s=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,s),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,s){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),s&&(this.ke=this.ke.insert(t,s))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Ad,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new it(Ae),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||z("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Ad),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function jd(){return new mt(te.comparator)}function Cd(){return new mt(te.comparator)}const r_={asc:"ASCENDING",desc:"DESCENDING"},i_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},a_={and:"AND",or:"OR"};class o_{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ql(n,e){return n.useProto3Json||Co(e)?e:{value:e}}function Wr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cf(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function l_(n,e){return Wr(n,e.toTimestamp())}function es(n){return ce(!!n),he.fromTimestamp(function(t){const s=Ys(t);return new xt(s.seconds,s.nanos)}(n))}function Sc(n,e){return $l(n,e).canonicalString()}function $l(n,e){const t=function(r){return new Ye(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function uf(n){const e=Ye.fromString(n);return ce(_f(e)),e}function uo(n,e){return Sc(n.databaseId,e.path)}function Yn(n,e){const t=uf(e);if(t.get(1)!==n.databaseId.projectId)throw new Z(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Z(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new te(mf(t))}function df(n,e){return Sc(n.databaseId,e)}function hf(n){const e=uf(n);return e.length===4?Ye.emptyPath():mf(e)}function Gl(n){return new Ye(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function mf(n){return ce(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Rd(n,e,t){return{name:uo(n,e),fields:t.value.mapValue.fields}}function c_(n,e,t){const s=Yn(n,e.name),r=es(e.updateTime),a=e.createTime?es(e.createTime):he.min(),o=new Kt({mapValue:{fields:e.fields}}),c=_t.newFoundDocument(s,r,a,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function u_(n,e){let t;if("targetChange"in e){e.targetChange;const s=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:ae()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],a=function(h,f){return h.useProto3Json?(ce(f===void 0||typeof f=="string"),It.fromBase64String(f||"")):(ce(f===void 0||f instanceof Buffer||f instanceof Uint8Array),It.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(h){const f=h.code===void 0?F.UNKNOWN:af(h.code);return new Z(f,h.message||"")}(o);t=new lf(s,r,a,c||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=Yn(n,s.document.name),a=es(s.document.updateTime),o=s.document.createTime?es(s.document.createTime):he.min(),c=new Kt({mapValue:{fields:s.document.fields}}),u=_t.newFoundDocument(r,a,o,c),h=s.targetIds||[],f=s.removedTargetIds||[];t=new Ga(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=Yn(n,s.document),a=s.readTime?es(s.readTime):he.min(),o=_t.newNoDocument(r,a),c=s.removedTargetIds||[];t=new Ga([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=Yn(n,s.document),a=s.removedTargetIds||[];t=new Ga([],a,r,null)}else{if(!("filter"in e))return ae();{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:a}=s,o=new Zb(r,a),c=s.targetId;t=new of(c,o)}}return t}function ho(n,e){let t;if(e instanceof ei)t={update:Rd(n,e.key,e.value)};else if(e instanceof ta)t={delete:uo(n,e.key)};else if(e instanceof sn)t={update:Rd(n,e.key,e.data),updateMask:g_(e.fieldMask)};else{if(!(e instanceof rf))return ae();t={verify:uo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(s=>function(a,o){const c=o.transform;if(c instanceof Gi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Kr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Hr)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof zi)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw ae()}(0,s))),e.precondition.isNone||(t.currentDocument=function(r,a){return a.updateTime!==void 0?{updateTime:l_(r,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:ae()}(n,e.precondition)),t}function zl(n,e){const t=e.currentDocument?function(a){return a.updateTime!==void 0?At.updateTime(es(a.updateTime)):a.exists!==void 0?At.exists(a.exists):At.none()}(e.currentDocument):At.none(),s=e.updateTransforms?e.updateTransforms.map(r=>function(o,c){let u=null;if("setToServerValue"in c)ce(c.setToServerValue==="REQUEST_TIME"),u=new Gi;else if("appendMissingElements"in c){const f=c.appendMissingElements.values||[];u=new Kr(f)}else if("removeAllFromArray"in c){const f=c.removeAllFromArray.values||[];u=new Hr(f)}else"increment"in c?u=new zi(o,c.increment):ae();const h=gt.fromServerFormat(c.fieldPath);return new Wb(h,u)}(n,r)):[];if(e.update){e.update.name;const r=Yn(n,e.update.name),a=new Kt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(u){const h=u.fieldPaths||[];return new is(h.map(f=>gt.fromServerFormat(f)))}(e.updateMask);return new sn(r,a,o,t,s)}return new ei(r,a,t,s)}if(e.delete){const r=Yn(n,e.delete);return new ta(r,t)}if(e.verify){const r=Yn(n,e.verify);return new rf(r,t)}return ae()}function d_(n,e){return n&&n.length>0?(ce(e!==void 0),n.map(t=>function(r,a){let o=r.updateTime?es(r.updateTime):es(a);return o.isEqual(he.min())&&(o=es(a)),new Jb(o,r.transformResults||[])}(t,e))):[]}function ff(n,e){return{documents:[df(n,e.path)]}}function pf(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=df(n,r);const a=function(h){if(h.length!==0)return bf(tt.create(h,"and"))}(e.filters);a&&(t.structuredQuery.where=a);const o=function(h){if(h.length!==0)return h.map(f=>function(_){return{field:Ar(_.field),direction:m_(_.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const c=ql(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:r}}function gf(n){let e=hf(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){ce(s===1);const f=t.from[0];f.allDescendants?r=f.collectionId:e=e.child(f.collectionId)}let a=[];t.where&&(a=function(p){const _=xf(p);return _ instanceof tt&&vc(_)?_.getFilters():[_]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(_=>function(P){return new $i(jr(P.field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(P.direction))}(_))}(t.orderBy));let c=null;t.limit&&(c=function(p){let _;return _=typeof p=="object"?p.value:p,Co(_)?null:_}(t.limit));let u=null;t.startAt&&(u=function(p){const _=!!p.before,A=p.values||[];return new Gr(A,_)}(t.startAt));let h=null;return t.endAt&&(h=function(p){const _=!p.before,A=p.values||[];return new Gr(A,_)}(t.endAt)),Ob(e,r,o,a,c,"F",u,h)}function h_(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ae()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function xf(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=jr(t.unaryFilter.field);return Le.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=jr(t.unaryFilter.field);return Le.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=jr(t.unaryFilter.field);return Le.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=jr(t.unaryFilter.field);return Le.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ae()}}(n):n.fieldFilter!==void 0?function(t){return Le.create(jr(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ae()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return tt.create(t.compositeFilter.filters.map(s=>xf(s)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return ae()}}(t.compositeFilter.op))}(n):ae()}function m_(n){return r_[n]}function f_(n){return i_[n]}function p_(n){return a_[n]}function Ar(n){return{fieldPath:n.canonicalString()}}function jr(n){return gt.fromServerFormat(n.fieldPath)}function bf(n){return n instanceof Le?function(t){if(t.op==="=="){if(fd(t.value))return{unaryFilter:{field:Ar(t.field),op:"IS_NAN"}};if(md(t.value))return{unaryFilter:{field:Ar(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(fd(t.value))return{unaryFilter:{field:Ar(t.field),op:"IS_NOT_NAN"}};if(md(t.value))return{unaryFilter:{field:Ar(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ar(t.field),op:f_(t.op),value:t.value}}}(n):n instanceof tt?function(t){const s=t.getFilters().map(r=>bf(r));return s.length===1?s[0]:{compositeFilter:{op:p_(t.op),filters:s}}}(n):ae()}function g_(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function _f(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e,t,s,r,a=he.min(),o=he.min(),c=It.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new zs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new zs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new zs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new zs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf{constructor(e){this.ct=e}}function x_(n,e){let t;if(e.document)t=c_(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=te.fromSegments(e.noDocument.path),r=ar(e.noDocument.readTime);t=_t.newNoDocument(s,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ae();{const s=te.fromSegments(e.unknownDocument.path),r=ar(e.unknownDocument.version);t=_t.newUnknownDocument(s,r)}}return e.readTime&&t.setReadTime(function(r){const a=new xt(r[0],r[1]);return he.fromTimestamp(a)}(e.readTime)),t}function Pd(n,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:mo(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=function(a,o){return{name:uo(a,o.key),fields:o.data.value.mapValue.fields,updateTime:Wr(a,o.version.toTimestamp()),createTime:Wr(a,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:ir(e.version)};else{if(!e.isUnknownDocument())return ae();s.unknownDocument={path:t.path.toArray(),version:ir(e.version)}}return s}function mo(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ir(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ar(n){const e=new xt(n.seconds,n.nanoseconds);return he.fromTimestamp(e)}function Kn(n,e){const t=(e.baseMutations||[]).map(a=>zl(n.ct,a));for(let a=0;a<e.mutations.length-1;++a){const o=e.mutations[a];if(a+1<e.mutations.length&&e.mutations[a+1].transform!==void 0){const c=e.mutations[a+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(a+1,1),++a}}const s=e.mutations.map(a=>zl(n.ct,a)),r=xt.fromMillis(e.localWriteTimeMs);return new Nc(e.batchId,r,t,s)}function Ni(n){const e=ar(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ar(n.lastLimboFreeSnapshotVersion):he.min();let s;return s=function(a){return a.documents!==void 0}(n.query)?function(a){return ce(a.documents.length===1),ps(Zi(hf(a.documents[0])))}(n.query):function(a){return ps(gf(a))}(n.query),new zs(s,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,It.fromBase64String(n.resumeToken))}function vf(n,e){const t=ir(e.snapshotVersion),s=ir(e.lastLimboFreeSnapshotVersion);let r;r=lo(e.target)?ff(n.ct,e.target):pf(n.ct,e.target)._t;const a=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:rr(e.target),readTime:t,resumeToken:a,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:r}}function wf(n){const e=gf({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Bl(e,e.limit,"L"):e}function dl(n,e){return new Ec(e.largestBatchId,zl(n.ct,e.overlayMutation))}function kd(n,e){const t=e.path.lastSegment();return[n,Zt(e.path.popLast()),t]}function Dd(n,e,t,s){return{indexId:n,uid:e,sequenceNumber:t,readTime:ir(s.readTime),documentKey:Zt(s.documentKey.path),largestBatchId:s.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b_{getBundleMetadata(e,t){return Vd(e).get(t).next(s=>{if(s)return function(a){return{id:a.bundleId,createTime:ar(a.createTime),version:a.version}}(s)})}saveBundleMetadata(e,t){return Vd(e).put(function(r){return{bundleId:r.id,createTime:ir(es(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return Od(e).get(t).next(s=>{if(s)return function(a){return{name:a.name,query:wf(a.bundledQuery),readTime:ar(a.readTime)}}(s)})}saveNamedQuery(e,t){return Od(e).put(function(r){return{name:r.name,readTime:ir(es(r.readTime)),bundledQuery:r.bundledQuery}}(t))}}function Vd(n){return Ct(n,"bundles")}function Od(n){return Ct(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const s=t.uid||"";return new Oo(e,s)}getOverlay(e,t){return fi(e).get(kd(this.userId,t)).next(s=>s?dl(this.serializer,s):null)}getOverlays(e,t){const s=js();return R.forEach(t,r=>this.getOverlay(e,r).next(a=>{a!==null&&s.set(r,a)})).next(()=>s)}saveOverlays(e,t,s){const r=[];return s.forEach((a,o)=>{const c=new Ec(t,o);r.push(this.ht(e,c))}),R.waitFor(r)}removeOverlaysForBatchId(e,t,s){const r=new Set;t.forEach(o=>r.add(Zt(o.getCollectionPath())));const a=[];return r.forEach(o=>{const c=IDBKeyRange.bound([this.userId,o,s],[this.userId,o,s+1],!1,!0);a.push(fi(e).j("collectionPathOverlayIndex",c))}),R.waitFor(a)}getOverlaysForCollection(e,t,s){const r=js(),a=Zt(t),o=IDBKeyRange.bound([this.userId,a,s],[this.userId,a,Number.POSITIVE_INFINITY],!0);return fi(e).U("collectionPathOverlayIndex",o).next(c=>{for(const u of c){const h=dl(this.serializer,u);r.set(h.getKey(),h)}return r})}getOverlaysForCollectionGroup(e,t,s,r){const a=js();let o;const c=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return fi(e).J({index:"collectionGroupOverlayIndex",range:c},(u,h,f)=>{const p=dl(this.serializer,h);a.size()<r||p.largestBatchId===o?(a.set(p.getKey(),p),o=p.largestBatchId):f.done()}).next(()=>a)}ht(e,t){return fi(e).put(function(r,a,o){const[c,u,h]=kd(a,o.mutation.key);return{userId:a,collectionPath:u,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ho(r.ct,o.mutation)}}(this.serializer,this.userId,t))}}function fi(n){return Ct(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __{Pt(e){return Ct(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const s=t==null?void 0:t.value;return s?It.fromUint8Array(s):It.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ht(e.integerValue));else if("doubleValue"in e){const s=ht(e.doubleValue);isNaN(s)?this.dt(t,13):(this.dt(t,15),Mi(s)?t.At(0):t.At(s))}else if("timestampValue"in e){let s=e.timestampValue;this.dt(t,20),typeof s=="string"&&(s=Ys(s)),t.Rt(`${s.seconds||""}`),t.At(s.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Tn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.dt(t,45),t.At(s.latitude||0),t.At(s.longitude||0)}else"mapValue"in e?Vm(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Ro(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):ae()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const s=e.fields||{};this.dt(t,55);for(const r of Object.keys(s))this.Vt(r,t),this.Tt(s[r],t)}wt(e,t){var s,r;const a=e.fields||{};this.dt(t,53);const o="value",c=((r=(s=a[o].arrayValue)===null||s===void 0?void 0:s.values)===null||r===void 0?void 0:r.length)||0;this.dt(t,15),t.At(ht(c)),this.Vt(o,t),this.Tt(a[o],t)}bt(e,t){const s=e.values||[];this.dt(t,50);for(const r of s)this.Tt(r,t)}yt(e,t){this.dt(t,37),te.fromName(e).path.forEach(s=>{this.dt(t,60),this.Dt(s,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Hn.vt=new Hn;function y_(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Ld(n){const e=64-function(s){let r=0;for(let a=0;a<8;++a){const o=y_(255&s[a]);if(r+=o,o!==8)break}return r}(n);return Math.ceil(e/8)}class v_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Ft(s.value),s=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Ot(s.value),s=t.next();this.Nt()}Lt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Ft(s);else if(s<2048)this.Ft(960|s>>>6),this.Ft(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s);else{const r=t.codePointAt(0);this.Ft(240|r>>>18),this.Ft(128|63&r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r)}}this.Mt()}Bt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Ot(s);else if(s<2048)this.Ot(960|s>>>6),this.Ot(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s);else{const r=t.codePointAt(0);this.Ot(240|r>>>18),this.Ot(128|63&r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r)}}this.Nt()}kt(e){const t=this.qt(e),s=Ld(t);this.Qt(1+s),this.buffer[this.position++]=255&s;for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Kt(e){const t=this.qt(e),s=Ld(t);this.Qt(1+s),this.buffer[this.position++]=~(255&s);for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(a){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,a,!1),new Uint8Array(o.buffer)}(e),s=(128&t[0])!=0;t[0]^=s?255:128;for(let r=1;r<t.length;++r)t[r]^=s?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const r=new Uint8Array(s);r.set(this.buffer),this.buffer=r}}class w_{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class N_{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class pi{constructor(){this.jt=new v_,this.Ht=new w_(this.jt),this.Jt=new N_(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e,t,s,r){this.indexId=e,this.documentKey=t,this.arrayValue=s,this.directionalValue=r}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,s=new Uint8Array(t);return s.set(this.directionalValue,0),t!==e?s.set([0],this.directionalValue.length):++s[s.length-1],new Wn(this.indexId,this.documentKey,this.arrayValue,s)}}function un(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Md(n.arrayValue,e.arrayValue),t!==0?t:(t=Md(n.directionalValue,e.directionalValue),t!==0?t:te.comparator(n.documentKey,e.documentKey)))}function Md(n,e){for(let t=0;t<n.length&&t<e.length;++t){const s=n[t]-e[t];if(s!==0)return s}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd{constructor(e){this.Xt=new it((t,s)=>gt.comparator(t.field,s.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const s=t;s.isInequality()?this.Xt=this.Xt.add(s):this.tn.push(s)}}get nn(){return this.Xt.size>1}rn(e){if(ce(e.collectionGroup===this.collectionId),this.nn)return!1;const t=kl(e);if(t!==void 0&&!this.sn(t))return!1;const s=Gn(e);let r=new Set,a=0,o=0;for(;a<s.length&&this.sn(s[a]);++a)r=r.add(s[a].fieldPath.canonicalString());if(a===s.length)return!0;if(this.Xt.size>0){const c=this.Xt.getIterator().getNext();if(!r.has(c.field.canonicalString())){const u=s[a];if(!this.on(c,u)||!this._n(this.en[o++],u))return!1}++a}for(;a<s.length;++a){const c=s[a];if(o>=this.en.length||!this._n(this.en[o++],c))return!1}return!0}an(){if(this.nn)return null;let e=new it(gt.comparator);const t=[];for(const s of this.tn)if(!s.field.isKeyField())if(s.op==="array-contains"||s.op==="array-contains-any")t.push(new Fa(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new Fa(s.field,0))}for(const s of this.en)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new Fa(s.field,s.dir==="asc"?0:1)));return new oo(oo.UNKNOWN_ID,this.collectionId,t,Li.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const s=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===s}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nf(n){var e,t;if(ce(n instanceof Le||n instanceof tt),n instanceof Le){if(n instanceof Gm){const r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(a=>Le.create(n.field,"==",a)))||[];return tt.create(r,"or")}return n}const s=n.filters.map(r=>Nf(r));return tt.create(s,n.op)}function I_(n){if(n.getFilters().length===0)return[];const e=Wl(Nf(n));return ce(If(e)),Kl(e)||Hl(e)?[e]:e.getFilters()}function Kl(n){return n instanceof Le}function Hl(n){return n instanceof tt&&vc(n)}function If(n){return Kl(n)||Hl(n)||function(t){if(t instanceof tt&&Ll(t)){for(const s of t.getFilters())if(!Kl(s)&&!Hl(s))return!1;return!0}return!1}(n)}function Wl(n){if(ce(n instanceof Le||n instanceof tt),n instanceof Le)return n;if(n.filters.length===1)return Wl(n.filters[0]);const e=n.filters.map(s=>Wl(s));let t=tt.create(e,n.op);return t=fo(t),If(t)?t:(ce(t instanceof tt),ce(zr(t)),ce(t.filters.length>1),t.filters.reduce((s,r)=>Ac(s,r)))}function Ac(n,e){let t;return ce(n instanceof Le||n instanceof tt),ce(e instanceof Le||e instanceof tt),t=n instanceof Le?e instanceof Le?function(r,a){return tt.create([r,a],"and")}(n,e):Ud(n,e):e instanceof Le?Ud(e,n):function(r,a){if(ce(r.filters.length>0&&a.filters.length>0),zr(r)&&zr(a))return Bm(r,a.getFilters());const o=Ll(r)?r:a,c=Ll(r)?a:r,u=o.filters.map(h=>Ac(h,c));return tt.create(u,"or")}(n,e),fo(t)}function Ud(n,e){if(zr(e))return Bm(e,n.getFilters());{const t=e.filters.map(s=>Ac(n,s));return tt.create(t,"or")}}function fo(n){if(ce(n instanceof Le||n instanceof tt),n instanceof Le)return n;const e=n.getFilters();if(e.length===1)return fo(e[0]);if(Fm(n))return n;const t=e.map(r=>fo(r)),s=[];return t.forEach(r=>{r instanceof Le?s.push(r):r instanceof tt&&(r.op===n.op?s.push(...r.filters):s.push(r))}),s.length===1?s[0]:tt.create(s,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_{constructor(){this.un=new jc}addToCollectionParentIndex(e,t){return this.un.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(ls.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(ls.min())}updateCollectionGroup(e,t,s){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}}class jc{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new it(Ye.comparator),a=!r.has(s);return this.index[t]=r.add(s),a}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new it(Ye.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ka=new Uint8Array(0);class T_{constructor(e,t){this.databaseId=t,this.cn=new jc,this.ln=new Rn(s=>rr(s),(s,r)=>Xi(s,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const s=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const a={collectionId:s,parent:Zt(r)};return Bd(e).put(a)}return R.resolve()}getCollectionParents(e,t){const s=[],r=IDBKeyRange.bound([t,""],[Im(t),""],!1,!0);return Bd(e).U(r).next(a=>{for(const o of a){if(o.collectionId!==t)break;s.push(As(o.parent))}return s})}addFieldIndex(e,t){const s=gi(e),r=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete r.indexId;const a=s.add(r);if(t.indexState){const o=Nr(e);return a.next(c=>{o.put(Dd(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return a.next()}deleteFieldIndex(e,t){const s=gi(e),r=Nr(e),a=wr(e);return s.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>a.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=gi(e),s=wr(e),r=Nr(e);return t.j().next(()=>s.j()).next(()=>r.j())}createTargetIndexes(e,t){return R.forEach(this.hn(t),s=>this.getIndexType(e,s).next(r=>{if(r===0||r===1){const a=new Fd(s).an();if(a!=null)return this.addFieldIndex(e,a)}}))}getDocumentsMatchingTarget(e,t){const s=wr(e);let r=!0;const a=new Map;return R.forEach(this.hn(t),o=>this.Pn(e,o).next(c=>{r&&(r=!!c),a.set(o,c)})).next(()=>{if(r){let o=Pe();const c=[];return R.forEach(a,(u,h)=>{z("IndexedDbIndexManager",`Using index ${function(D){return`id=${D.indexId}|cg=${D.collectionGroup}|f=${D.fields.map($=>`${$.fieldPath}:${$.kind}`).join(",")}`}(u)} to execute ${rr(t)}`);const f=function(D,$){const H=kl($);if(H===void 0)return null;for(const Q of co(D,H.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(h,u),p=function(D,$){const H=new Map;for(const Q of Gn($))for(const N of co(D,Q.fieldPath))switch(N.op){case"==":case"in":H.set(Q.fieldPath.canonicalString(),N.value);break;case"not-in":case"!=":return H.set(Q.fieldPath.canonicalString(),N.value),Array.from(H.values())}return null}(h,u),_=function(D,$){const H=[];let Q=!0;for(const N of Gn($)){const b=N.kind===0?_d(D,N.fieldPath,D.startAt):yd(D,N.fieldPath,D.startAt);H.push(b.value),Q&&(Q=b.inclusive)}return new Gr(H,Q)}(h,u),A=function(D,$){const H=[];let Q=!0;for(const N of Gn($)){const b=N.kind===0?yd(D,N.fieldPath,D.endAt):_d(D,N.fieldPath,D.endAt);H.push(b.value),Q&&(Q=b.inclusive)}return new Gr(H,Q)}(h,u),P=this.In(u,h,_),k=this.In(u,h,A),T=this.Tn(u,h,p),U=this.En(u.indexId,f,P,_.inclusive,k,A.inclusive,T);return R.forEach(U,K=>s.G(K,t.limit).next(D=>{D.forEach($=>{const H=te.fromSegments($.documentKey);o.has(H)||(o=o.add(H),c.push(H))})}))}).next(()=>c)}return R.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=I_(tt.create(e.filters,"and")).map(s=>Fl(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,s,r,a,o,c){const u=(t!=null?t.length:1)*Math.max(s.length,a.length),h=u/(t!=null?t.length:1),f=[];for(let p=0;p<u;++p){const _=t?this.dn(t[p/h]):ka,A=this.An(e,_,s[p%h],r),P=this.Rn(e,_,a[p%h],o),k=c.map(T=>this.An(e,_,T,!0));f.push(...this.createRange(A,P,k))}return f}An(e,t,s,r){const a=new Wn(e,te.empty(),t,s);return r?a:a.Zt()}Rn(e,t,s,r){const a=new Wn(e,te.empty(),t,s);return r?a.Zt():a}Pn(e,t){const s=new Fd(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(a=>{let o=null;for(const c of a)s.rn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let s=2;const r=this.hn(t);return R.forEach(r,a=>this.Pn(e,a).next(o=>{o?s!==0&&o.fields.length<function(u){let h=new it(gt.comparator),f=!1;for(const p of u.filters)for(const _ of p.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:h=h.add(_.field));for(const p of u.orderBy)p.field.isKeyField()||(h=h.add(p.field));return h.size+(f?1:0)}(a)&&(s=1):s=0})).next(()=>function(o){return o.limit!==null}(t)&&r.length>1&&s===2?1:s)}Vn(e,t){const s=new pi;for(const r of Gn(e)){const a=t.data.field(r.fieldPath);if(a==null)return null;const o=s.Yt(r.kind);Hn.vt.It(a,o)}return s.zt()}dn(e){const t=new pi;return Hn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const s=new pi;return Hn.vt.It(Bi(this.databaseId,t),s.Yt(function(a){const o=Gn(a);return o.length===0?0:o[o.length-1].kind}(e))),s.zt()}Tn(e,t,s){if(s===null)return[];let r=[];r.push(new pi);let a=0;for(const o of Gn(e)){const c=s[a++];for(const u of r)if(this.fn(t,o.fieldPath)&&qi(c))r=this.gn(r,o,c);else{const h=u.Yt(o.kind);Hn.vt.It(c,h)}}return this.pn(r)}In(e,t,s){return this.Tn(e,t,s.position)}pn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].zt();return t}gn(e,t,s){const r=[...e],a=[];for(const o of s.arrayValue.values||[])for(const c of r){const u=new pi;u.seed(c.zt()),Hn.vt.It(o,u.Yt(t.kind)),a.push(u)}return a}fn(e,t){return!!e.filters.find(s=>s instanceof Le&&s.field.isEqual(t)&&(s.op==="in"||s.op==="not-in"))}getFieldIndexes(e,t){const s=gi(e),r=Nr(e);return(t?s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):s.U()).next(a=>{const o=[];return R.forEach(a,c=>r.get([c.indexId,this.uid]).next(u=>{o.push(function(f,p){const _=p?new Li(p.sequenceNumber,new ls(ar(p.readTime),new te(As(p.documentKey)),p.largestBatchId)):Li.empty(),A=f.fields.map(([P,k])=>new Fa(gt.fromServerFormat(P),k));return new oo(f.indexId,f.collectionGroup,A,_)}(c,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((s,r)=>{const a=s.indexState.sequenceNumber-r.indexState.sequenceNumber;return a!==0?a:Ae(s.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,s){const r=gi(e),a=Nr(e);return this.yn(e).next(o=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(c=>R.forEach(c,u=>a.put(Dd(u.indexId,this.uid,o,s)))))}updateIndexEntries(e,t){const s=new Map;return R.forEach(t,(r,a)=>{const o=s.get(r.collectionGroup);return(o?R.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(c=>(s.set(r.collectionGroup,c),R.forEach(c,u=>this.wn(e,r,u).next(h=>{const f=this.Sn(a,u);return h.isEqual(f)?R.resolve():this.bn(e,a,u,h,f)}))))})}Dn(e,t,s,r){return wr(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(s,t.key),documentKey:t.key.path.toArray()})}vn(e,t,s,r){return wr(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(s,t.key),t.key.path.toArray()])}wn(e,t,s){const r=wr(e);let a=new it(un);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([s.indexId,this.uid,this.mn(s,t)])},(o,c)=>{a=a.add(new Wn(s.indexId,t,c.arrayValue,c.directionalValue))}).next(()=>a)}Sn(e,t){let s=new it(un);const r=this.Vn(t,e);if(r==null)return s;const a=kl(t);if(a!=null){const o=e.data.field(a.fieldPath);if(qi(o))for(const c of o.arrayValue.values||[])s=s.add(new Wn(t.indexId,e.key,this.dn(c),r))}else s=s.add(new Wn(t.indexId,e.key,ka,r));return s}bn(e,t,s,r,a){z("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,h,f,p,_){const A=u.getIterator(),P=h.getIterator();let k=vr(A),T=vr(P);for(;k||T;){let U=!1,K=!1;if(k&&T){const D=f(k,T);D<0?K=!0:D>0&&(U=!0)}else k!=null?K=!0:U=!0;U?(p(T),T=vr(P)):K?(_(k),k=vr(A)):(k=vr(A),T=vr(P))}}(r,a,un,c=>{o.push(this.Dn(e,t,s,c))},c=>{o.push(this.vn(e,t,s,c))}),R.waitFor(o)}yn(e){let t=1;return Nr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(s,r,a)=>{a.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,s){s=s.sort((o,c)=>un(o,c)).filter((o,c,u)=>!c||un(o,u[c-1])!==0);const r=[];r.push(e);for(const o of s){const c=un(o,e),u=un(o,t);if(c===0)r[0]=e.Zt();else if(c>0&&u<0)r.push(o),r.push(o.Zt());else if(u>0)break}r.push(t);const a=[];for(let o=0;o<r.length;o+=2){if(this.Cn(r[o],r[o+1]))return[];const c=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,ka,[]],u=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,ka,[]];a.push(IDBKeyRange.bound(c,u))}return a}Cn(e,t){return un(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(qd)}getMinOffset(e,t){return R.mapArray(this.hn(t),s=>this.Pn(e,s).next(r=>r||ae())).next(qd)}}function Bd(n){return Ct(n,"collectionParents")}function wr(n){return Ct(n,"indexEntries")}function gi(n){return Ct(n,"indexConfiguration")}function Nr(n){return Ct(n,"indexState")}function qd(n){ce(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<n.length;s++){const r=n[s].indexState.offset;gc(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new ls(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $d={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class rs{constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}static withCacheSize(e){return new rs(e,rs.DEFAULT_COLLECTION_PERCENTILE,rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ef(n,e,t){const s=n.store("mutations"),r=n.store("documentMutations"),a=[],o=IDBKeyRange.only(t.batchId);let c=0;const u=s.J({range:o},(f,p,_)=>(c++,_.delete()));a.push(u.next(()=>{ce(c===1)}));const h=[];for(const f of t.mutations){const p=jm(e,f.key.path,t.batchId);a.push(r.delete(p)),h.push(f.key)}return R.waitFor(a).next(()=>h)}function po(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ae();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rs.DEFAULT_COLLECTION_PERCENTILE=10,rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,rs.DEFAULT=new rs(41943040,rs.DEFAULT_COLLECTION_PERCENTILE,rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),rs.DISABLED=new rs(-1,0,0);class Lo{constructor(e,t,s,r){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=r,this.Fn={}}static lt(e,t,s,r){ce(e.uid!=="");const a=e.isAuthenticated()?e.uid:"";return new Lo(a,t,s,r)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return dn(e).J({index:"userMutationsIndex",range:s},(r,a,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,s,r){const a=Cr(e),o=dn(e);return o.add({}).next(c=>{ce(typeof c=="number");const u=new Nc(c,t,s,r),h=function(A,P,k){const T=k.baseMutations.map(K=>ho(A.ct,K)),U=k.mutations.map(K=>ho(A.ct,K));return{userId:P,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:T,mutations:U}}(this.serializer,this.userId,u),f=[];let p=new it((_,A)=>Ae(_.canonicalString(),A.canonicalString()));for(const _ of r){const A=jm(this.userId,_.key.path,c);p=p.add(_.key.path.popLast()),f.push(o.put(h)),f.push(a.put(A,ab))}return p.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Fn[c]=u.keys()}),R.waitFor(f).next(()=>u)})}lookupMutationBatch(e,t){return dn(e).get(t).next(s=>s?(ce(s.userId===this.userId),Kn(this.serializer,s)):null)}Mn(e,t){return this.Fn[t]?R.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(s=>{if(s){const r=s.keys();return this.Fn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=IDBKeyRange.lowerBound([this.userId,s]);let a=null;return dn(e).J({index:"userMutationsIndex",range:r},(o,c,u)=>{c.userId===this.userId&&(ce(c.batchId>=s),a=Kn(this.serializer,c)),u.done()}).next(()=>a)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=-1;return dn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(r,a,o)=>{s=a.batchId,o.done()}).next(()=>s)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return dn(e).U("userMutationsIndex",t).next(s=>s.map(r=>Kn(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=Ua(this.userId,t.path),r=IDBKeyRange.lowerBound(s),a=[];return Cr(e).J({range:r},(o,c,u)=>{const[h,f,p]=o,_=As(f);if(h===this.userId&&t.path.isEqual(_))return dn(e).get(p).next(A=>{if(!A)throw ae();ce(A.userId===this.userId),a.push(Kn(this.serializer,A))});u.done()}).next(()=>a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new it(Ae);const r=[];return t.forEach(a=>{const o=Ua(this.userId,a.path),c=IDBKeyRange.lowerBound(o),u=Cr(e).J({range:c},(h,f,p)=>{const[_,A,P]=h,k=As(A);_===this.userId&&a.path.isEqual(k)?s=s.add(P):p.done()});r.push(u)}),R.waitFor(r).next(()=>this.xn(e,s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1,a=Ua(this.userId,s),o=IDBKeyRange.lowerBound(a);let c=new it(Ae);return Cr(e).J({range:o},(u,h,f)=>{const[p,_,A]=u,P=As(_);p===this.userId&&s.isPrefixOf(P)?P.length===r&&(c=c.add(A)):f.done()}).next(()=>this.xn(e,c))}xn(e,t){const s=[],r=[];return t.forEach(a=>{r.push(dn(e).get(a).next(o=>{if(o===null)throw ae();ce(o.userId===this.userId),s.push(Kn(this.serializer,o))}))}),R.waitFor(r).next(()=>s)}removeMutationBatch(e,t){return Ef(e._e,this.userId,t).next(s=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),R.forEach(s,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();const s=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return Cr(e).J({range:s},(a,o,c)=>{if(a[0]===this.userId){const u=As(a[1]);r.push(u)}else c.done()}).next(()=>{ce(r.length===0)})})}containsKey(e,t){return Tf(e,this.userId,t)}Nn(e){return Sf(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Tf(n,e,t){const s=Ua(e,t.path),r=s[1],a=IDBKeyRange.lowerBound(s);let o=!1;return Cr(n).J({range:a,H:!0},(c,u,h)=>{const[f,p,_]=c;f===e&&p===r&&(o=!0),h.done()}).next(()=>o)}function dn(n){return Ct(n,"mutations")}function Cr(n){return Ct(n,"documentMutations")}function Sf(n){return Ct(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new or(0)}static kn(){return new or(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const s=new or(t.highestTargetId);return t.highestTargetId=s.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>he.fromTimestamp(new xt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,s){return this.qn(e).next(r=>(r.highestListenSequenceNumber=t,s&&(r.lastRemoteSnapshotVersion=s.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Qn(e,r)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(s=>(s.targetCount+=1,this.$n(t,s),this.Qn(e,s))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ir(e).delete(t.targetId)).next(()=>this.qn(e)).next(s=>(ce(s.targetCount>0),s.targetCount-=1,this.Qn(e,s)))}removeTargets(e,t,s){let r=0;const a=[];return Ir(e).J((o,c)=>{const u=Ni(c);u.sequenceNumber<=t&&s.get(u.targetId)===null&&(r++,a.push(this.removeTargetData(e,u)))}).next(()=>R.waitFor(a)).next(()=>r)}forEachTarget(e,t){return Ir(e).J((s,r)=>{const a=Ni(r);t(a)})}qn(e){return Gd(e).get("targetGlobalKey").next(t=>(ce(t!==null),t))}Qn(e,t){return Gd(e).put("targetGlobalKey",t)}Kn(e,t){return Ir(e).put(vf(this.serializer,t))}$n(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const s=rr(t),r=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let a=null;return Ir(e).J({range:r,index:"queryTargetsIndex"},(o,c,u)=>{const h=Ni(c);Xi(t,h.target)&&(a=h,u.done())}).next(()=>a)}addMatchingKeys(e,t,s){const r=[],a=mn(e);return t.forEach(o=>{const c=Zt(o.path);r.push(a.put({targetId:s,path:c})),r.push(this.referenceDelegate.addReference(e,s,o))}),R.waitFor(r)}removeMatchingKeys(e,t,s){const r=mn(e);return R.forEach(t,a=>{const o=Zt(a.path);return R.waitFor([r.delete([s,o]),this.referenceDelegate.removeReference(e,s,a)])})}removeMatchingKeysForTargetId(e,t){const s=mn(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(r)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),r=mn(e);let a=Pe();return r.J({range:s,H:!0},(o,c,u)=>{const h=As(o[1]),f=new te(h);a=a.add(f)}).next(()=>a)}containsKey(e,t){const s=Zt(t.path),r=IDBKeyRange.bound([s],[Im(s)],!1,!0);let a=0;return mn(e).J({index:"documentTargetsIndex",H:!0,range:r},([o,c],u,h)=>{o!==0&&(a++,h.done())}).next(()=>a>0)}ot(e,t){return Ir(e).get(t).next(s=>s?Ni(s):null)}}function Ir(n){return Ct(n,"targets")}function Gd(n){return Ct(n,"targetGlobal")}function mn(n){return Ct(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zd([n,e],[t,s]){const r=Ae(n,t);return r===0?Ae(e,s):r}class A_{constructor(e){this.Un=e,this.buffer=new it(zd),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();zd(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class j_{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){z("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>I(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Cn(t)?z("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield cr(t)}yield this.Hn(3e5)}))}}class C_{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(s=>Math.floor(t/100*s))}nthSequenceNumber(e,t){if(t===0)return R.resolve(fs.oe);const s=new A_(t);return this.Jn.forEachTarget(e,r=>s.zn(r.sequenceNumber)).next(()=>this.Jn.Zn(e,r=>s.zn(r))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.Jn.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(z("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve($d)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(z("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$d):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let s,r,a,o,c,u,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(z("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,o=Date.now(),this.nthSequenceNumber(e,r))).next(p=>(s=p,c=Date.now(),this.removeTargets(e,s,t))).next(p=>(a=p,u=Date.now(),this.removeOrphanedDocuments(e,s))).next(p=>(h=Date.now(),Tr()<=Oe.DEBUG&&z("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${r} in `+(c-o)+`ms
	Removed ${a} targets in `+(u-c)+`ms
	Removed ${p} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:a,documentsRemoved:p})))}}function R_(n,e){return new C_(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P_{constructor(e,t){this.db=e,this.garbageCollector=R_(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(s=>t.next(r=>s+r))}er(e){let t=0;return this.Zn(e,s=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(s,r)=>t(r))}addReference(e,t,s){return Da(e,s)}removeReference(e,t,s){return Da(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return Da(e,t)}nr(e,t){return function(r,a){let o=!1;return Sf(r).Y(c=>Tf(r,c,a).next(u=>(u&&(o=!0),R.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let a=0;return this.tr(e,(o,c)=>{if(c<=t){const u=this.nr(e,o).next(h=>{if(!h)return a++,s.getEntry(e,o).next(()=>(s.removeEntry(o,he.min()),mn(e).delete(function(p){return[0,Zt(p.path)]}(o))))});r.push(u)}}).next(()=>R.waitFor(r)).next(()=>s.apply(e)).next(()=>a)}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return Da(e,t)}tr(e,t){const s=mn(e);let r,a=fs.oe;return s.J({index:"documentTargetsIndex"},([o,c],{path:u,sequenceNumber:h})=>{o===0?(a!==fs.oe&&t(new te(As(r)),a),a=h,r=u):a=fs.oe}).next(()=>{a!==fs.oe&&t(new te(As(r)),a)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Da(n,e){return mn(n).put(function(s,r){return{targetId:0,path:Zt(s.path),sequenceNumber:r}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(){this.changes=new Rn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,_t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?R.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return qn(e).put(s)}removeEntry(e,t,s){return qn(e).delete(function(a,o){const c=a.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],mo(o),c[c.length-1]]}(t,s))}updateMetadata(e,t){return this.getMetadata(e).next(s=>(s.byteSize+=t,this.rr(e,s)))}getEntry(e,t){let s=_t.newInvalidDocument(t);return qn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xi(t))},(r,a)=>{s=this.ir(t,a)}).next(()=>s)}sr(e,t){let s={size:0,document:_t.newInvalidDocument(t)};return qn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xi(t))},(r,a)=>{s={document:this.ir(t,a),size:po(a)}}).next(()=>s)}getEntries(e,t){let s=os();return this._r(e,t,(r,a)=>{const o=this.ir(r,a);s=s.insert(r,o)}).next(()=>s)}ar(e,t){let s=os(),r=new mt(te.comparator);return this._r(e,t,(a,o)=>{const c=this.ir(a,o);s=s.insert(a,c),r=r.insert(a,po(o))}).next(()=>({documents:s,ur:r}))}_r(e,t,s){if(t.isEmpty())return R.resolve();let r=new it(Wd);t.forEach(u=>r=r.add(u));const a=IDBKeyRange.bound(xi(r.first()),xi(r.last())),o=r.getIterator();let c=o.getNext();return qn(e).J({index:"documentKeyIndex",range:a},(u,h,f)=>{const p=te.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;c&&Wd(c,p)<0;)s(c,null),c=o.getNext();c&&c.isEqual(p)&&(s(c,h),c=o.hasNext()?o.getNext():null),c?f.$(xi(c)):f.done()}).next(()=>{for(;c;)s(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,s,r,a){const o=t.path,c=[o.popLast().toArray(),o.lastSegment(),mo(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return qn(e).U(IDBKeyRange.bound(c,u,!0)).next(h=>{a==null||a.incrementDocumentReadCount(h.length);let f=os();for(const p of h){const _=this.ir(te.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);_.isFoundDocument()&&(ea(t,_)||r.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,s,r){let a=os();const o=Hd(t,s),c=Hd(t,ls.max());return qn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,c,!0)},(u,h,f)=>{const p=this.ir(te.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);a=a.insert(p.key,p),a.size===r&&f.done()}).next(()=>a)}newChangeBuffer(e){return new D_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Kd(e).get("remoteDocumentGlobalKey").next(t=>(ce(!!t),t))}rr(e,t){return Kd(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const s=x_(this.serializer,t);if(!(s.isNoDocument()&&s.version.isEqual(he.min())))return s}return _t.newInvalidDocument(e)}}function jf(n){return new k_(n)}class D_ extends Af{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Rn(s=>s.toString(),(s,r)=>s.isEqual(r))}applyChanges(e){const t=[];let s=0,r=new it((a,o)=>Ae(a.canonicalString(),o.canonicalString()));return this.changes.forEach((a,o)=>{const c=this.lr.get(a);if(t.push(this.cr.removeEntry(e,a,c.readTime)),o.isValidDocument()){const u=Pd(this.cr.serializer,o);r=r.add(a.path.popLast());const h=po(u);s+=h-c.size,t.push(this.cr.addEntry(e,a,u))}else if(s-=c.size,this.trackRemovals){const u=Pd(this.cr.serializer,o.convertToNoDocument(he.min()));t.push(this.cr.addEntry(e,a,u))}}),r.forEach(a=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,a))}),t.push(this.cr.updateMetadata(e,s)),R.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(s=>(this.lr.set(t,{size:s.size,readTime:s.document.readTime}),s.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:s,ur:r})=>(r.forEach((a,o)=>{this.lr.set(a,{size:o,readTime:s.get(a).readTime})}),s))}}function Kd(n){return Ct(n,"remoteDocumentGlobal")}function qn(n){return Ct(n,"remoteDocumentsV14")}function xi(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Hd(n,e){const t=e.documentKey.path.toArray();return[n,mo(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Wd(n,e){const t=n.path.toArray(),s=e.path.toArray();let r=0;for(let a=0;a<t.length-2&&a<s.length-2;++a)if(r=Ae(t[a],s[a]),r)return r;return r=Ae(t.length,s.length),r||(r=Ae(t[t.length-2],s[s.length-2]),r||Ae(t[t.length-1],s[s.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(s!==null&&Ci(s.mutation,r,is.empty(),xt.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.getLocalViewOfDocuments(e,s,Pe()).next(()=>s))}getLocalViewOfDocuments(e,t,s=Pe()){const r=js();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s).next(a=>{let o=vi();return a.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const s=js();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,Pe()))}populateOverlays(e,t,s){const r=[];return s.forEach(a=>{t.has(a)||r.push(a)}),this.documentOverlayCache.getOverlays(e,r).next(a=>{a.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,s,r){let a=os();const o=ji(),c=function(){return ji()}();return t.forEach((u,h)=>{const f=s.get(h.key);r.has(h.key)&&(f===void 0||f.mutation instanceof sn)?a=a.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Ci(f.mutation,h,f.mutation.getFieldMask(),xt.now())):o.set(h.key,is.empty())}),this.recalculateAndSaveOverlays(e,a).next(u=>(u.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var p;return c.set(h,new V_(f,(p=o.get(h))!==null&&p!==void 0?p:null))}),c))}recalculateAndSaveOverlays(e,t){const s=ji();let r=new mt((o,c)=>o-c),a=Pe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const c of o)c.keys().forEach(u=>{const h=t.get(u);if(h===null)return;let f=s.get(u)||is.empty();f=c.applyToLocalView(h,f),s.set(u,f);const p=(r.get(c.batchId)||Pe()).add(u);r=r.insert(c.batchId,p)})}).next(()=>{const o=[],c=r.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),h=u.key,f=u.value,p=Jm();f.forEach(_=>{if(!a.has(_)){const A=sf(t.get(_),s.get(_));A!==null&&p.set(_,A),a=a.add(_)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return R.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,t,s,r){return function(o){return te.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):zm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next(a=>{const o=r-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-a.size):R.resolve(js());let c=-1,u=a;return o.next(h=>R.forEach(h,(f,p)=>(c<p.largestBatchId&&(c=p.largestBatchId),a.get(f)?R.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{u=u.insert(f,_)}))).next(()=>this.populateOverlays(e,h,a)).next(()=>this.computeViews(e,u,h,Pe())).next(f=>({batchId:c,changes:Qm(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new te(t)).next(s=>{let r=vi();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const a=t.collectionGroup;let o=vi();return this.indexManager.getCollectionParents(e,a).next(c=>R.forEach(c,u=>{const h=function(p,_){return new Zr(_,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,u.child(a));return this.getDocumentsMatchingCollectionQuery(e,h,s,r).next(f=>{f.forEach((p,_)=>{o=o.insert(p,_)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,s,r){let a;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,a,r))).next(o=>{a.forEach((u,h)=>{const f=h.getKey();o.get(f)===null&&(o=o.insert(f,_t.newInvalidDocument(f)))});let c=vi();return o.forEach((u,h)=>{const f=a.get(u);f!==void 0&&Ci(f.mutation,h,is.empty(),xt.now()),ea(t,h)&&(c=c.insert(u,h))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return R.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:es(r.createTime)}}(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(r){return{name:r.name,query:wf(r.bundledQuery),readTime:es(r.readTime)}}(t)),R.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L_{constructor(){this.overlays=new mt(te.comparator),this.Ir=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){const s=js();return R.forEach(t,r=>this.getOverlay(e,r).next(a=>{a!==null&&s.set(r,a)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((r,a)=>{this.ht(e,t,a)}),R.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.Ir.get(s);return r!==void 0&&(r.forEach(a=>this.overlays=this.overlays.remove(a)),this.Ir.delete(s)),R.resolve()}getOverlaysForCollection(e,t,s){const r=js(),a=t.length+1,o=new te(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const u=c.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===a&&u.largestBatchId>s&&r.set(u.getKey(),u)}return R.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let a=new mt((h,f)=>h-f);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>s){let f=a.get(h.largestBatchId);f===null&&(f=js(),a=a.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const c=js(),u=a.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,f)=>c.set(h,f)),!(c.size()>=r)););return R.resolve(c)}ht(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.Ir.get(r.largestBatchId).delete(s.key);this.Ir.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new Ec(t,s));let a=this.Ir.get(t);a===void 0&&(a=Pe(),this.Ir.set(t,a)),this.Ir.set(t,a.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M_{constructor(){this.sessionToken=It.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc{constructor(){this.Tr=new it(kt.Er),this.dr=new it(kt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const s=new kt(e,t);this.Tr=this.Tr.add(s),this.dr=this.dr.add(s)}Rr(e,t){e.forEach(s=>this.addReference(s,t))}removeReference(e,t){this.Vr(new kt(e,t))}mr(e,t){e.forEach(s=>this.removeReference(s,t))}gr(e){const t=new te(new Ye([])),s=new kt(t,e),r=new kt(t,e+1),a=[];return this.dr.forEachInRange([s,r],o=>{this.Vr(o),a.push(o.key)}),a}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new te(new Ye([])),s=new kt(t,e),r=new kt(t,e+1);let a=Pe();return this.dr.forEachInRange([s,r],o=>{a=a.add(o.key)}),a}containsKey(e){const t=new kt(e,0),s=this.Tr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class kt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return te.comparator(e.key,t.key)||Ae(e.wr,t.wr)}static Ar(e,t){return Ae(e.wr,t.wr)||te.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new it(kt.Er)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const a=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Nc(a,t,s,r);this.mutationQueue.push(o);for(const c of r)this.br=this.br.add(new kt(c.key,a)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return R.resolve(o)}lookupMutationBatch(e,t){return R.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.vr(s),a=r<0?0:r;return R.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new kt(t,0),r=new kt(t,Number.POSITIVE_INFINITY),a=[];return this.br.forEachInRange([s,r],o=>{const c=this.Dr(o.wr);a.push(c)}),R.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new it(Ae);return t.forEach(r=>{const a=new kt(r,0),o=new kt(r,Number.POSITIVE_INFINITY);this.br.forEachInRange([a,o],c=>{s=s.add(c.wr)})}),R.resolve(this.Cr(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let a=s;te.isDocumentKey(a)||(a=a.child(""));const o=new kt(new te(a),0);let c=new it(Ae);return this.br.forEachWhile(u=>{const h=u.key.path;return!!s.isPrefixOf(h)&&(h.length===r&&(c=c.add(u.wr)),!0)},o),R.resolve(this.Cr(c))}Cr(e){const t=[];return e.forEach(s=>{const r=this.Dr(s);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){ce(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let s=this.br;return R.forEach(t.mutations,r=>{const a=new kt(r.key,t.batchId);return s=s.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=s})}On(e){}containsKey(e,t){const s=new kt(t,0),r=this.br.firstAfterOrEqual(s);return R.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U_{constructor(e){this.Mr=e,this.docs=function(){return new mt(te.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),a=r?r.size:0,o=this.Mr(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return R.resolve(s?s.document.mutableCopy():_t.newInvalidDocument(t))}getEntries(e,t){let s=os();return t.forEach(r=>{const a=this.docs.get(r);s=s.insert(r,a?a.document.mutableCopy():_t.newInvalidDocument(r))}),R.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let a=os();const o=t.path,c=new te(o.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:h,value:{document:f}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||gc(Em(f),s)<=0||(r.has(f.key)||ea(t,f))&&(a=a.insert(f.key,f.mutableCopy()))}return R.resolve(a)}getAllFromCollectionGroup(e,t,s,r){ae()}Or(e,t){return R.forEach(this.docs,s=>t(s))}newChangeBuffer(e){return new B_(this)}getSize(e){return R.resolve(this.size)}}class B_ extends Af{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(s)}),R.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q_{constructor(e){this.persistence=e,this.Nr=new Rn(t=>rr(t),Xi),this.lastRemoteSnapshotVersion=he.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Cc,this.targetCount=0,this.kr=or.Bn()}forEachTarget(e,t){return this.Nr.forEach((s,r)=>t(r)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.Lr&&(this.Lr=t),R.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new or(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.Kn(t),R.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,s){let r=0;const a=[];return this.Nr.forEach((o,c)=>{c.sequenceNumber<=t&&s.get(c.targetId)===null&&(this.Nr.delete(o),a.push(this.removeMatchingKeysForTargetId(e,c.targetId)),r++)}),R.waitFor(a).next(()=>r)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){const s=this.Nr.get(t)||null;return R.resolve(s)}addMatchingKeys(e,t,s){return this.Br.Rr(t,s),R.resolve()}removeMatchingKeys(e,t,s){this.Br.mr(t,s);const r=this.persistence.referenceDelegate,a=[];return r&&t.forEach(o=>{a.push(r.markPotentiallyOrphaned(e,o))}),R.waitFor(a)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),R.resolve()}getMatchingKeysForTargetId(e,t){const s=this.Br.yr(t);return R.resolve(s)}containsKey(e,t){return R.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(e,t){this.qr={},this.overlays={},this.Qr=new fs(0),this.Kr=!1,this.Kr=!0,this.$r=new M_,this.referenceDelegate=e(this),this.Ur=new q_(this),this.indexManager=new E_,this.remoteDocumentCache=function(r){return new U_(r)}(s=>this.referenceDelegate.Wr(s)),this.serializer=new yf(t),this.Gr=new O_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new L_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.qr[e.toKey()];return s||(s=new F_(t,this.referenceDelegate),this.qr[e.toKey()]=s),s}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,s){z("MemoryPersistence","Starting transaction:",e);const r=new $_(this.Qr.next());return this.referenceDelegate.zr(),s(r).next(a=>this.referenceDelegate.jr(r).next(()=>a)).toPromise().then(a=>(r.raiseOnCommittedEvent(),a))}Hr(e,t){return R.or(Object.values(this.qr).map(s=>()=>s.containsKey(e,t)))}}class $_ extends Sm{constructor(e){super(),this.currentSequenceNumber=e}}class Mo{constructor(e){this.persistence=e,this.Jr=new Cc,this.Yr=null}static Zr(e){return new Mo(e)}get Xr(){if(this.Yr)return this.Yr;throw ae()}addReference(e,t,s){return this.Jr.addReference(s,t),this.Xr.delete(s.toString()),R.resolve()}removeReference(e,t,s){return this.Jr.removeReference(s,t),this.Xr.add(s.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),R.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(r=>this.Xr.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(a=>this.Xr.add(a.toString()))}).next(()=>s.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Xr,s=>{const r=te.fromPath(s);return this.ei(e,r).next(a=>{a||t.removeEntry(r,he.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(s=>{s?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return R.or([()=>R.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(e){this.serializer=e}O(e,t,s,r){const a=new jo("createOrUpgrade",t);s<1&&r>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ld,{unique:!0}),u.createObjectStore("documentMutations")}(e),Qd(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=R.resolve();return s<3&&r>=3&&(s!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),Qd(e)),o=o.next(()=>function(u){const h=u.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:he.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(a))),s<4&&r>=4&&(s!==0&&(o=o.next(()=>function(u,h){return h.store("mutations").U().next(f=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ld,{unique:!0});const p=h.store("mutations"),_=f.map(A=>p.put(A));return R.waitFor(_)})}(e,a))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),s<5&&r>=5&&(o=o.next(()=>this.ni(a))),s<6&&r>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ri(a)))),s<7&&r>=7&&(o=o.next(()=>this.ii(a))),s<8&&r>=8&&(o=o.next(()=>this.si(e,a))),s<9&&r>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),s<10&&r>=10&&(o=o.next(()=>this.oi(a))),s<11&&r>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),s<12&&r>=12&&(o=o.next(()=>{(function(u){const h=u.createObjectStore("documentOverlays",{keyPath:bb});h.createIndex("collectionPathOverlayIndex",_b,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",yb,{unique:!1})})(e)})),s<13&&r>=13&&(o=o.next(()=>function(u){const h=u.createObjectStore("remoteDocumentsV14",{keyPath:ob});h.createIndex("documentKeyIndex",lb),h.createIndex("collectionGroupIndex",cb)}(e)).next(()=>this._i(e,a)).next(()=>e.deleteObjectStore("remoteDocuments"))),s<14&&r>=14&&(o=o.next(()=>this.ai(e,a))),s<15&&r>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:fb}).createIndex("sequenceNumberIndex",pb,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:gb}).createIndex("documentKeyIndex",xb,{unique:!1})}(e))),s<16&&r>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),s<17&&r>=17&&(o=o.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((s,r)=>{t+=po(r)}).next(()=>{const s={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",s)})}ni(e){const t=e.store("mutationQueues"),s=e.store("mutations");return t.U().next(r=>R.forEach(r,a=>{const o=IDBKeyRange.bound([a.userId,-1],[a.userId,a.lastAcknowledgedBatchId]);return s.U("userMutationsIndex",o).next(c=>R.forEach(c,u=>{ce(u.userId===a.userId);const h=Kn(this.serializer,u);return Ef(e,a.userId,h).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),s=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{const a=[];return s.J((o,c)=>{const u=new Ye(o),h=function(p){return[0,Zt(p)]}(u);a.push(t.get(h).next(f=>f?R.resolve():(p=>t.put({targetId:0,path:Zt(p),sequenceNumber:r.highestListenSequenceNumber}))(u)))}).next(()=>R.waitFor(a))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:mb});const s=t.store("collectionParents"),r=new jc,a=o=>{if(r.add(o)){const c=o.lastSegment(),u=o.popLast();return s.put({collectionId:c,parent:Zt(u)})}};return t.store("remoteDocuments").J({H:!0},(o,c)=>{const u=new Ye(o);return a(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,c,u],h)=>{const f=As(c);return a(f.popLast())}))}oi(e){const t=e.store("targets");return t.J((s,r)=>{const a=Ni(r),o=vf(this.serializer,a);return t.put(o)})}_i(e,t){const s=t.store("remoteDocuments"),r=[];return s.J((a,o)=>{const c=t.store("remoteDocumentsV14"),u=function(p){return p.document?new te(Ye.fromString(p.document.name).popFirst(5)):p.noDocument?te.fromSegments(p.noDocument.path):p.unknownDocument?te.fromSegments(p.unknownDocument.path):ae()}(o).path.toArray(),h={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(c.put(h))}).next(()=>R.waitFor(r))}ai(e,t){const s=t.store("mutations"),r=jf(this.serializer),a=new Rf(Mo.Zr,this.serializer.ct);return s.U().next(o=>{const c=new Map;return o.forEach(u=>{var h;let f=(h=c.get(u.userId))!==null&&h!==void 0?h:Pe();Kn(this.serializer,u).keys().forEach(p=>f=f.add(p)),c.set(u.userId,f)}),R.forEach(c,(u,h)=>{const f=new Ut(h),p=Oo.lt(this.serializer,f),_=a.getIndexManager(f),A=Lo.lt(f,this.serializer,_,a.referenceDelegate);return new Cf(r,A,p,_).recalculateAndSaveOverlaysForDocumentKeys(new Dl(t,fs.oe),u).next()})})}}function Qd(n){n.createObjectStore("targetDocuments",{keyPath:db}).createIndex("documentTargetsIndex",hb,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ub,{unique:!0}),n.createObjectStore("targetGlobal")}const hl="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Rc{constructor(e,t,s,r,a,o,c,u,h,f,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.ui=a,this.window=o,this.document=c,this.ci=h,this.li=f,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!Rc.D())throw new Z(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new P_(this,r),this.Ai=t+"main",this.serializer=new yf(u),this.Ri=new Nn(this.Ai,this.hi,new G_(this.serializer)),this.$r=new __,this.Ur=new S_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=jf(this.serializer),this.Gr=new b_,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,f===!1&&Xt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Z(F.FAILED_PRECONDITION,hl);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new fs(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>I(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>I(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>I(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Va(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Cn(e))return z("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return z("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return bi(e).get("owner").next(t=>R.resolve(this.vi(t)))}Ci(e){return Va(e).delete(this.clientId)}Fi(){return I(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const s=Ct(t,"clientMetadata");return s.U().next(r=>{const a=this.xi(r,18e5),o=r.filter(c=>a.indexOf(c)===-1);return R.forEach(o,c=>s.delete(c.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?R.resolve(!0):bi(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new Z(F.FAILED_PRECONDITION,hl);return!1}}return!(!this.networkEnabled||!this.inForeground)||Va(e).U().next(s=>this.xi(s,5e3).find(r=>{if(this.clientId!==r.clientId){const a=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,c=this.networkEnabled===r.networkEnabled;if(a||o&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&z("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return I(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Dl(e,fs.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(s=>this.Mi(s.updateTimeMs,t)&&!this.Ni(s.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Va(e).U().next(t=>this.xi(t,18e5).map(s=>s.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Lo.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new T_(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Oo.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,s){z("IndexedDbPersistence","Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",a=function(u){return u===17?Nb:u===16?wb:u===15?bc:u===14?Pm:u===13?Rm:u===12?vb:u===11?Cm:void ae()}(this.hi);let o;return this.Ri.runTransaction(e,r,a,c=>(o=new Dl(c,this.Qr?this.Qr.next():fs.oe),t==="readwrite-primary"?this.wi(o).next(u=>!!u||this.Si(o)).next(u=>{if(!u)throw Xt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new Z(F.FAILED_PRECONDITION,Tm);return s(o)}).next(u=>this.Di(o).next(()=>u)):this.Ki(o).next(()=>s(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}Ki(e){return bi(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Z(F.FAILED_PRECONDITION,hl)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return bi(e).put("owner",t)}static D(){return Nn.D()}bi(e){const t=bi(e);return t.get("owner").next(s=>this.vi(s)?(z("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):R.resolve())}Mi(e,t){const s=Date.now();return!(e<s-t)&&(!(e>s)||(Xt(`Detected an update time that is in the future: ${e} > ${s}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;lm()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const s=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return z("IndexedDbPersistence",`Client '${e}' ${s?"is":"is not"} zombied in LocalStorage`),s}catch(s){return Xt("IndexedDbPersistence","Failed to get zombied client id.",s),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Xt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch(e){}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function bi(n){return Ct(n,"owner")}function Va(n){return Ct(n,"clientMetadata")}function z_(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.$i=s,this.Ui=r}static Wi(e,t){let s=Pe(),r=Pe();for(const a of t.docChanges)switch(a.type){case 0:s=s.add(a.doc.key);break;case 1:r=r.add(a.doc.key)}return new Pc(e,t.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return lm()?8:Am(jt())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,s,r){const a={result:null};return this.Yi(e,t).next(o=>{a.result=o}).next(()=>{if(!a.result)return this.Zi(e,t,r,s).next(o=>{a.result=o})}).next(()=>{if(a.result)return;const o=new K_;return this.Xi(e,t,o).next(c=>{if(a.result=c,this.zi)return this.es(e,t,o,c.size)})}).next(()=>a.result)}es(e,t,s,r){return s.documentReadCount<this.ji?(Tr()<=Oe.DEBUG&&z("QueryEngine","SDK will not create cache indexes for query:",Sr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),R.resolve()):(Tr()<=Oe.DEBUG&&z("QueryEngine","Query:",Sr(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.Hi*r?(Tr()<=Oe.DEBUG&&z("QueryEngine","The SDK decides to create cache indexes for query:",Sr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ps(t))):R.resolve())}Yi(e,t){if(vd(t))return R.resolve(null);let s=ps(t);return this.indexManager.getIndexType(e,s).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=Bl(t,null,"F"),s=ps(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(a=>{const o=Pe(...a);return this.Ji.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,s).next(u=>{const h=this.ts(t,c);return this.ns(t,h,o,u.readTime)?this.Yi(e,Bl(t,null,"F")):this.rs(e,h,t,u)}))})))}Zi(e,t,s,r){return vd(t)||r.isEqual(he.min())?R.resolve(null):this.Ji.getDocuments(e,s).next(a=>{const o=this.ts(t,a);return this.ns(t,o,s,r)?R.resolve(null):(Tr()<=Oe.DEBUG&&z("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Sr(t)),this.rs(e,o,t,Z0(r,-1)).next(c=>c))})}ts(e,t){let s=new it(Hm(e));return t.forEach((r,a)=>{ea(e,a)&&(s=s.add(a))}),s}ns(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const a=e.limitType==="F"?t.last():t.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(r)>0)}Xi(e,t,s){return Tr()<=Oe.DEBUG&&z("QueryEngine","Using full collection scan to execute query:",Sr(t)),this.Ji.getDocumentsMatchingQuery(e,t,ls.min(),s)}rs(e,t,s,r){return this.Ji.getDocumentsMatchingQuery(e,s,r).next(a=>(t.forEach(o=>{a=a.insert(o.key,o)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H_{constructor(e,t,s,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new mt(Ae),this._s=new Rn(a=>rr(a),Xi),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(s)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Cf(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function kf(n,e,t,s){return new H_(n,e,t,s)}function Df(n,e){return I(this,null,function*(){const t=Ie(n);return yield t.persistence.runTransaction("Handle user change","readonly",s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next(a=>(r=a,t.ls(e),t.mutationQueue.getAllMutationBatches(s))).next(a=>{const o=[],c=[];let u=Pe();for(const h of r){o.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}for(const h of a){c.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(s,u).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:c}))})})})}function W_(n,e){const t=Ie(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),a=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,u,h,f){const p=h.batch,_=p.keys();let A=R.resolve();return _.forEach(P=>{A=A.next(()=>f.getEntry(u,P)).next(k=>{const T=h.docVersions.get(P);ce(T!==null),k.version.compareTo(T)<0&&(p.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))})}),A.next(()=>c.mutationQueue.removeMutationBatch(u,p))}(t,s,e,a).next(()=>a.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(c){let u=Pe();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(u=u.add(c.batch.mutations[h].key));return u}(e))).next(()=>t.localDocuments.getDocuments(s,r))})}function Vf(n){const e=Ie(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Q_(n,e){const t=Ie(n),s=e.snapshotVersion;let r=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});r=t.os;const c=[];e.targetChanges.forEach((f,p)=>{const _=r.get(p);if(!_)return;c.push(t.Ur.removeMatchingKeys(a,f.removedDocuments,p).next(()=>t.Ur.addMatchingKeys(a,f.addedDocuments,p)));let A=_.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(p)!==null?A=A.withResumeToken(It.EMPTY_BYTE_STRING,he.min()).withLastLimboFreeSnapshotVersion(he.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,s)),r=r.insert(p,A),function(k,T,U){return k.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(_,A,f)&&c.push(t.Ur.updateTargetData(a,A))});let u=os(),h=Pe();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(a,f))}),c.push(J_(a,o,e.documentUpdates).next(f=>{u=f.Ps,h=f.Is})),!s.isEqual(he.min())){const f=t.Ur.getLastRemoteSnapshotVersion(a).next(p=>t.Ur.setTargetsMetadata(a,a.currentSequenceNumber,s));c.push(f)}return R.waitFor(c).next(()=>o.apply(a)).next(()=>t.localDocuments.getLocalViewOfDocuments(a,u,h)).next(()=>u)}).then(a=>(t.os=r,a))}function J_(n,e,t){let s=Pe(),r=Pe();return t.forEach(a=>s=s.add(a)),e.getEntries(n,s).next(a=>{let o=os();return t.forEach((c,u)=>{const h=a.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(r=r.add(c)),u.isNoDocument()&&u.version.isEqual(he.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):z("LocalStore","Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)}),{Ps:o,Is:r}})}function Y_(n,e){const t=Ie(n);return t.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function X_(n,e){const t=Ie(n);return t.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return t.Ur.getTargetData(s,e).next(a=>a?(r=a,R.resolve(r)):t.Ur.allocateTargetId(s).next(o=>(r=new zs(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Ur.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=t.os.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.os=t.os.insert(s.targetId,s),t._s.set(e,s.targetId)),s})}function Ql(n,e,t){return I(this,null,function*(){const s=Ie(n),r=s.os.get(e),a=t?"readwrite":"readwrite-primary";try{t||(yield s.persistence.runTransaction("Release target",a,o=>s.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!Cn(o))throw o;z("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}s.os=s.os.remove(e),s._s.delete(r.target)})}function Jd(n,e,t){const s=Ie(n);let r=he.min(),a=Pe();return s.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,f){const p=Ie(u),_=p._s.get(f);return _!==void 0?R.resolve(p.os.get(_)):p.Ur.getTargetData(h,f)}(s,o,ps(e)).next(c=>{if(c)return r=c.lastLimboFreeSnapshotVersion,s.Ur.getMatchingKeysForTargetId(o,c.targetId).next(u=>{a=u})}).next(()=>s.ss.getDocumentsMatchingQuery(o,e,t?r:he.min(),t?a:Pe())).next(c=>(Z_(s,Mb(e),c),{documents:c,Ts:a})))}function Z_(n,e,t){let s=n.us.get(e)||he.min();t.forEach((r,a)=>{a.readTime.compareTo(s)>0&&(s=a.readTime)}),n.us.set(e,s)}class Yd{constructor(){this.activeTargetIds=Gb()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Of{constructor(){this.so=new Yd,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,s){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Yd,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ey{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){z("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){z("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Oa=null;function ml(){return Oa===null?Oa=function(){return 268435456+Math.round(2147483648*Math.random())}():Oa++,"0x"+Oa.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ty={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zt="WebChannelConnection";class ny extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Do=s+"://"+t.host,this.vo=`projects/${r}/databases/${a}`,this.Co=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${a}`}get Fo(){return!1}Mo(t,s,r,a,o){const c=ml(),u=this.xo(t,s.toUriEncodedString());z("RestConnection",`Sending RPC '${t}' ${c}:`,u,r);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,a,o),this.No(t,u,h,r).then(f=>(z("RestConnection",`Received RPC '${t}' ${c}: `,f),f),f=>{throw tr("RestConnection",`RPC '${t}' ${c} failed with error: `,f,"url: ",u,"request:",r),f})}Lo(t,s,r,a,o,c){return this.Mo(t,s,r,a,o)}Oo(t,s,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Xr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((a,o)=>t[o]=a),r&&r.headers.forEach((a,o)=>t[o]=a)}xo(t,s){const r=ty[t];return`${this.Do}/v1/${s}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,s,r){const a=ml();return new Promise((o,c)=>{const u=new xm;u.setWithCredentials(!0),u.listenOnce(bm.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Ma.NO_ERROR:const f=u.getResponseJson();z(zt,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(f)),o(f);break;case Ma.TIMEOUT:z(zt,`RPC '${e}' ${a} timed out`),c(new Z(F.DEADLINE_EXCEEDED,"Request time out"));break;case Ma.HTTP_ERROR:const p=u.getStatus();if(z(zt,`RPC '${e}' ${a} failed with status:`,p,"response text:",u.getResponseText()),p>0){let _=u.getResponseJson();Array.isArray(_)&&(_=_[0]);const A=_==null?void 0:_.error;if(A&&A.status&&A.message){const P=function(T){const U=T.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(U)>=0?U:F.UNKNOWN}(A.status);c(new Z(P,A.message))}else c(new Z(F.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new Z(F.UNAVAILABLE,"Connection failed."));break;default:ae()}}finally{z(zt,`RPC '${e}' ${a} completed.`)}});const h=JSON.stringify(r);z(zt,`RPC '${e}' ${a} sending request:`,r),u.send(t,"POST",h,s,15)})}Bo(e,t,s){const r=ml(),a=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=vm(),c=ym(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,t,s),u.encodeInitMessageHeaders=!0;const f=a.join("");z(zt,`Creating RPC '${e}' stream ${r}: ${f}`,u);const p=o.createWebChannel(f,u);let _=!1,A=!1;const P=new sy({Io:T=>{A?z(zt,`Not sending because RPC '${e}' stream ${r} is closed:`,T):(_||(z(zt,`Opening RPC '${e}' stream ${r} transport.`),p.open(),_=!0),z(zt,`RPC '${e}' stream ${r} sending:`,T),p.send(T))},To:()=>p.close()}),k=(T,U,K)=>{T.listen(U,D=>{try{K(D)}catch($){setTimeout(()=>{throw $},0)}})};return k(p,yi.EventType.OPEN,()=>{A||(z(zt,`RPC '${e}' stream ${r} transport opened.`),P.yo())}),k(p,yi.EventType.CLOSE,()=>{A||(A=!0,z(zt,`RPC '${e}' stream ${r} transport closed`),P.So())}),k(p,yi.EventType.ERROR,T=>{A||(A=!0,tr(zt,`RPC '${e}' stream ${r} transport errored:`,T),P.So(new Z(F.UNAVAILABLE,"The operation could not be completed")))}),k(p,yi.EventType.MESSAGE,T=>{var U;if(!A){const K=T.data[0];ce(!!K);const D=K,$=D.error||((U=D[0])===null||U===void 0?void 0:U.error);if($){z(zt,`RPC '${e}' stream ${r} received error:`,$);const H=$.status;let Q=function(g){const v=Nt[g];if(v!==void 0)return af(v)}(H),N=$.message;Q===void 0&&(Q=F.INTERNAL,N="Unknown error status: "+H+" with message "+$.message),A=!0,P.So(new Z(Q,N)),p.close()}else z(zt,`RPC '${e}' stream ${r} received:`,K),P.bo(K)}}),k(c,_m.STAT_EVENT,T=>{T.stat===Pl.PROXY?z(zt,`RPC '${e}' stream ${r} detected buffering proxy`):T.stat===Pl.NOPROXY&&z(zt,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{P.wo()},0),P}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ry(){return typeof window!="undefined"?window:null}function za(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fo(n){return new o_(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(e,t,s=1e3,r=1.5,a=6e4){this.ui=e,this.timerId=t,this.ko=s,this.qo=r,this.Qo=a,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),s=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-s);r>0&&z("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf{constructor(e,t,s,r,a,o,c,u){this.ui=e,this.Ho=s,this.Jo=r,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Lf(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return I(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return I(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return I(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(Xt(t.toString()),Xt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===F.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.Yo===t&&this.P_(s,r)},s=>{e(()=>{const r=new Z(F.UNKNOWN,"Fetching auth token failed: "+s.message);return this.I_(r)})})}P_(e,t){const s=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{s(()=>this.listener.Eo())}),this.stream.Ro(()=>{s(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(r=>{s(()=>this.I_(r))}),this.stream.onMessage(r=>{s(()=>++this.e_==1?this.E_(r):this.onNext(r))})}i_(){this.state=5,this.t_.Go(()=>I(this,null,function*(){this.state=0,this.start()}))}I_(e){return z("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(z("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class iy extends Mf{constructor(e,t,s,r,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=a}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=u_(this.serializer,e),s=function(a){if(!("targetChange"in a))return he.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?he.min():o.readTime?es(o.readTime):he.min()}(e);return this.listener.d_(t,s)}A_(e){const t={};t.database=Gl(this.serializer),t.addTarget=function(a,o){let c;const u=o.target;if(c=lo(u)?{documents:ff(a,u)}:{query:pf(a,u)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=cf(a,o.resumeToken);const h=ql(a,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(he.min())>0){c.readTime=Wr(a,o.snapshotVersion.toTimestamp());const h=ql(a,o.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);const s=h_(this.serializer,e);s&&(t.labels=s),this.a_(t)}R_(e){const t={};t.database=Gl(this.serializer),t.removeTarget=e,this.a_(t)}}class ay extends Mf{constructor(e,t,s,r,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=a}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ce(!!e.streamToken),this.lastStreamToken=e.streamToken,ce(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){ce(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=d_(e.writeResults,e.commitTime),s=es(e.commitTime);return this.listener.g_(s,t)}p_(){const e={};e.database=Gl(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(s=>ho(this.serializer,s))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oy extends class{}{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new Z(F.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,s,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Mo(e,$l(t,s),r,a,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Z(F.UNKNOWN,a.toString())})}Lo(e,t,s,r,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Lo(e,$l(t,s),r,o,c,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Z(F.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class ly{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Xt(t),this.D_=!1):z("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cy{constructor(e,t,s,r,a){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=a,this.k_._o(o=>{s.enqueueAndForget(()=>I(this,null,function*(){dr(this)&&(z("RemoteStore","Restarting streams for network reachability change."),yield function(u){return I(this,null,function*(){const h=Ie(u);h.L_.add(4),yield na(h),h.q_.set("Unknown"),h.L_.delete(4),yield Uo(h)})}(this))}))}),this.q_=new ly(s,r)}}function Uo(n){return I(this,null,function*(){if(dr(n))for(const e of n.B_)yield e(!0)})}function na(n){return I(this,null,function*(){for(const e of n.B_)yield e(!1)})}function Ff(n,e){const t=Ie(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Oc(t)?Vc(t):ti(t).r_()&&Dc(t,e))}function kc(n,e){const t=Ie(n),s=ti(t);t.N_.delete(e),s.r_()&&Uf(t,e),t.N_.size===0&&(s.r_()?s.o_():dr(t)&&t.q_.set("Unknown"))}function Dc(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(he.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ti(n).A_(e)}function Uf(n,e){n.Q_.xe(e),ti(n).R_(e)}function Vc(n){n.Q_=new n_({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ti(n).start(),n.q_.v_()}function Oc(n){return dr(n)&&!ti(n).n_()&&n.N_.size>0}function dr(n){return Ie(n).L_.size===0}function Bf(n){n.Q_=void 0}function uy(n){return I(this,null,function*(){n.q_.set("Online")})}function dy(n){return I(this,null,function*(){n.N_.forEach((e,t)=>{Dc(n,e)})})}function hy(n,e){return I(this,null,function*(){Bf(n),Oc(n)?(n.q_.M_(e),Vc(n)):n.q_.set("Unknown")})}function my(n,e,t){return I(this,null,function*(){if(n.q_.set("Online"),e instanceof lf&&e.state===2&&e.cause)try{yield function(r,a){return I(this,null,function*(){const o=a.cause;for(const c of a.targetIds)r.N_.has(c)&&(yield r.remoteSyncer.rejectListen(c,o),r.N_.delete(c),r.Q_.removeTarget(c))})}(n,e)}catch(s){z("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),yield go(n,s)}else if(e instanceof Ga?n.Q_.Ke(e):e instanceof of?n.Q_.He(e):n.Q_.We(e),!t.isEqual(he.min()))try{const s=yield Vf(n.localStore);t.compareTo(s)>=0&&(yield function(a,o){const c=a.Q_.rt(o);return c.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const f=a.N_.get(h);f&&a.N_.set(h,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,h)=>{const f=a.N_.get(u);if(!f)return;a.N_.set(u,f.withResumeToken(It.EMPTY_BYTE_STRING,f.snapshotVersion)),Uf(a,u);const p=new zs(f.target,u,h,f.sequenceNumber);Dc(a,p)}),a.remoteSyncer.applyRemoteEvent(c)}(n,t))}catch(s){z("RemoteStore","Failed to raise snapshot:",s),yield go(n,s)}})}function go(n,e,t){return I(this,null,function*(){if(!Cn(e))throw e;n.L_.add(1),yield na(n),n.q_.set("Offline"),t||(t=()=>Vf(n.localStore)),n.asyncQueue.enqueueRetryable(()=>I(this,null,function*(){z("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield Uo(n)}))})}function qf(n,e){return e().catch(t=>go(n,t,e))}function ra(n){return I(this,null,function*(){const e=Ie(n),t=An(e);let s=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;fy(e);)try{const r=yield Y_(e.localStore,s);if(r===null){e.O_.length===0&&t.o_();break}s=r.batchId,py(e,r)}catch(r){yield go(e,r)}$f(e)&&Gf(e)})}function fy(n){return dr(n)&&n.O_.length<10}function py(n,e){n.O_.push(e);const t=An(n);t.r_()&&t.V_&&t.m_(e.mutations)}function $f(n){return dr(n)&&!An(n).n_()&&n.O_.length>0}function Gf(n){An(n).start()}function gy(n){return I(this,null,function*(){An(n).p_()})}function xy(n){return I(this,null,function*(){const e=An(n);for(const t of n.O_)e.m_(t.mutations)})}function by(n,e,t){return I(this,null,function*(){const s=n.O_.shift(),r=Ic.from(s,e,t);yield qf(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield ra(n)})}function _y(n,e){return I(this,null,function*(){e&&An(n).V_&&(yield function(s,r){return I(this,null,function*(){if(function(o){return e_(o)&&o!==F.ABORTED}(r.code)){const a=s.O_.shift();An(s).s_(),yield qf(s,()=>s.remoteSyncer.rejectFailedWrite(a.batchId,r)),yield ra(s)}})}(n,e)),$f(n)&&Gf(n)})}function Zd(n,e){return I(this,null,function*(){const t=Ie(n);t.asyncQueue.verifyOperationInProgress(),z("RemoteStore","RemoteStore received new credentials");const s=dr(t);t.L_.add(3),yield na(t),s&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Uo(t)})}function yy(n,e){return I(this,null,function*(){const t=Ie(n);e?(t.L_.delete(2),yield Uo(t)):e||(t.L_.add(2),yield na(t),t.q_.set("Unknown"))})}function ti(n){return n.K_||(n.K_=function(t,s,r){const a=Ie(t);return a.w_(),new iy(s,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,r)}(n.datastore,n.asyncQueue,{Eo:uy.bind(null,n),Ro:dy.bind(null,n),mo:hy.bind(null,n),d_:my.bind(null,n)}),n.B_.push(e=>I(this,null,function*(){e?(n.K_.s_(),Oc(n)?Vc(n):n.q_.set("Unknown")):(yield n.K_.stop(),Bf(n))}))),n.K_}function An(n){return n.U_||(n.U_=function(t,s,r){const a=Ie(t);return a.w_(),new ay(s,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,r)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:gy.bind(null,n),mo:_y.bind(null,n),f_:xy.bind(null,n),g_:by.bind(null,n)}),n.B_.push(e=>I(this,null,function*(){e?(n.U_.s_(),yield ra(n)):(yield n.U_.stop(),n.O_.length>0&&(z("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e,t,s,r,a){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=a,this.deferred=new Rs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,a){const o=Date.now()+s,c=new Lc(e,t,o,r,a);return c.start(s),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Z(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Mc(n,e){if(Xt("AsyncQueue",`${e}: ${n}`),Cn(n))return new Z(F.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr{constructor(e){this.comparator=e?(t,s)=>e(t,s)||te.comparator(t.key,s.key):(t,s)=>te.comparator(t.key,s.key),this.keyedMap=vi(),this.sortedSet=new mt(this.comparator)}static emptySet(e){return new Dr(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Dr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,a=s.getNext().key;if(!r.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new Dr;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(){this.W_=new mt(te.comparator)}track(e){const t=e.doc.key,s=this.W_.get(t);s?e.type!==0&&s.type===3?this.W_=this.W_.insert(t,e):e.type===3&&s.type!==1?this.W_=this.W_.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.W_=this.W_.remove(t):e.type===1&&s.type===2?this.W_=this.W_.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):ae():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,s)=>{e.push(s)}),e}}class Qr{constructor(e,t,s,r,a,o,c,u,h){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,s,r,a){const o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new Qr(e,t,Dr.emptySet(t),o,s,r,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Po(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vy{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class wy{constructor(){this.queries=th(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,s){const r=Ie(t),a=r.queries;r.queries=th(),a.forEach((o,c)=>{for(const u of c.j_)u.onError(s)})})(this,new Z(F.ABORTED,"Firestore shutting down"))}}function th(){return new Rn(n=>Km(n),Po)}function Fc(n,e){return I(this,null,function*(){const t=Ie(n);let s=3;const r=e.query;let a=t.queries.get(r);a?!a.H_()&&e.J_()&&(s=2):(a=new vy,s=e.J_()?0:1);try{switch(s){case 0:a.z_=yield t.onListen(r,!0);break;case 1:a.z_=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r)}}catch(o){const c=Mc(o,`Initialization of query '${Sr(e.query)}' failed`);return void e.onError(c)}t.queries.set(r,a),a.j_.push(e),e.Z_(t.onlineState),a.z_&&e.X_(a.z_)&&Bc(t)})}function Uc(n,e){return I(this,null,function*(){const t=Ie(n),s=e.query;let r=3;const a=t.queries.get(s);if(a){const o=a.j_.indexOf(e);o>=0&&(a.j_.splice(o,1),a.j_.length===0?r=e.J_()?0:1:!a.H_()&&e.J_()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}})}function Ny(n,e){const t=Ie(n);let s=!1;for(const r of e){const a=r.query,o=t.queries.get(a);if(o){for(const c of o.j_)c.X_(r)&&(s=!0);o.z_=r}}s&&Bc(t)}function Iy(n,e,t){const s=Ie(n),r=s.queries.get(e);if(r)for(const a of r.j_)a.onError(t);s.queries.delete(e)}function Bc(n){n.Y_.forEach(e=>{e.next()})}var Jl,sh;(sh=Jl||(Jl={})).ea="default",sh.Cache="cache";class qc{constructor(e,t,s){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=s||{}}X_(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Qr(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const s=t!=="Offline";return(!this.options._a||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Qr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Jl.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(e){this.key=e}}class Kf{constructor(e){this.key=e}}class Ey{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Pe(),this.mutatedKeys=Pe(),this.Aa=Hm(e),this.Ra=new Dr(this.Aa)}get Va(){return this.Ta}ma(e,t){const s=t?t.fa:new eh,r=t?t.Ra:this.Ra;let a=t?t.mutatedKeys:this.mutatedKeys,o=r,c=!1;const u=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,h=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((f,p)=>{const _=r.get(f),A=ea(this.query,p)?p:null,P=!!_&&this.mutatedKeys.has(_.key),k=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let T=!1;_&&A?_.data.isEqual(A.data)?P!==k&&(s.track({type:3,doc:A}),T=!0):this.ga(_,A)||(s.track({type:2,doc:A}),T=!0,(u&&this.Aa(A,u)>0||h&&this.Aa(A,h)<0)&&(c=!0)):!_&&A?(s.track({type:0,doc:A}),T=!0):_&&!A&&(s.track({type:1,doc:_}),T=!0,(u||h)&&(c=!0)),T&&(A?(o=o.add(A),a=k?a.add(f):a.delete(f)):(o=o.delete(f),a=a.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),a=a.delete(f.key),s.track({type:1,doc:f})}return{Ra:o,fa:s,ns:c,mutatedKeys:a}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const a=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((f,p)=>function(A,P){const k=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ae()}};return k(A)-k(P)}(f.type,p.type)||this.Aa(f.doc,p.doc)),this.pa(s),r=r!=null&&r;const c=t&&!r?this.ya():[],u=this.da.size===0&&this.current&&!r?1:0,h=u!==this.Ea;return this.Ea=u,o.length!==0||h?{snapshot:new Qr(this.query,e.Ra,a,o,e.mutatedKeys,u===0,h,!1,!!s&&s.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new eh,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Pe(),this.Ra.forEach(s=>{this.Sa(s.key)&&(this.da=this.da.add(s.key))});const t=[];return e.forEach(s=>{this.da.has(s)||t.push(new Kf(s))}),this.da.forEach(s=>{e.has(s)||t.push(new zf(s))}),t}ba(e){this.Ta=e.Ts,this.da=Pe();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Qr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Ty{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Sy{constructor(e){this.key=e,this.va=!1}}class Ay{constructor(e,t,s,r,a,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Rn(c=>Km(c),Po),this.Ma=new Map,this.xa=new Set,this.Oa=new mt(te.comparator),this.Na=new Map,this.La=new Cc,this.Ba={},this.ka=new Map,this.qa=or.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}function jy(n,e,t=!0){return I(this,null,function*(){const s=Xf(n);let r;const a=s.Fa.get(e);return a?(s.sharedClientState.addLocalQueryTarget(a.targetId),r=a.view.Da()):r=yield Hf(s,e,t,!0),r})}function Cy(n,e){return I(this,null,function*(){const t=Xf(n);yield Hf(t,e,!0,!1)})}function Hf(n,e,t,s){return I(this,null,function*(){const r=yield X_(n.localStore,ps(e)),a=r.targetId,o=n.sharedClientState.addLocalQueryTarget(a,t);let c;return s&&(c=yield Ry(n,e,a,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&Ff(n.remoteStore,r),c})}function Ry(n,e,t,s,r){return I(this,null,function*(){n.Ka=(p,_,A)=>function(k,T,U,K){return I(this,null,function*(){let D=T.view.ma(U);D.ns&&(D=yield Jd(k.localStore,T.query,!1).then(({documents:N})=>T.view.ma(N,D)));const $=K&&K.targetChanges.get(T.targetId),H=K&&K.targetMismatches.get(T.targetId)!=null,Q=T.view.applyChanges(D,k.isPrimaryClient,$,H);return rh(k,T.targetId,Q.wa),Q.snapshot})}(n,p,_,A);const a=yield Jd(n.localStore,e,!0),o=new Ey(e,a.Ts),c=o.ma(a.documents),u=sa.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),h=o.applyChanges(c,n.isPrimaryClient,u);rh(n,t,h.wa);const f=new Ty(e,t,o);return n.Fa.set(e,f),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),h.snapshot})}function Py(n,e,t){return I(this,null,function*(){const s=Ie(n),r=s.Fa.get(e),a=s.Ma.get(r.targetId);if(a.length>1)return s.Ma.set(r.targetId,a.filter(o=>!Po(o,e))),void s.Fa.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Ql(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),t&&kc(s.remoteStore,r.targetId),Yl(s,r.targetId)}).catch(cr))):(Yl(s,r.targetId),yield Ql(s.localStore,r.targetId,!0))})}function ky(n,e){return I(this,null,function*(){const t=Ie(n),s=t.Fa.get(e),r=t.Ma.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),kc(t.remoteStore,s.targetId))})}function Dy(n,e,t){return I(this,null,function*(){const s=Zf(n);try{const r=yield function(o,c){const u=Ie(o),h=xt.now(),f=c.reduce((A,P)=>A.add(P.key),Pe());let p,_;return u.persistence.runTransaction("Locally write mutations","readwrite",A=>{let P=os(),k=Pe();return u.cs.getEntries(A,f).next(T=>{P=T,P.forEach((U,K)=>{K.isValidDocument()||(k=k.add(U))})}).next(()=>u.localDocuments.getOverlayedDocuments(A,P)).next(T=>{p=T;const U=[];for(const K of c){const D=Xb(K,p.get(K.key).overlayedDocument);D!=null&&U.push(new sn(K.key,D,Lm(D.value.mapValue),At.exists(!0)))}return u.mutationQueue.addMutationBatch(A,h,U,c)}).next(T=>{_=T;const U=T.applyToLocalDocumentSet(p,k);return u.documentOverlayCache.saveOverlays(A,T.batchId,U)})}).then(()=>({batchId:_.batchId,changes:Qm(p)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(o,c,u){let h=o.Ba[o.currentUser.toKey()];h||(h=new mt(Ae)),h=h.insert(c,u),o.Ba[o.currentUser.toKey()]=h}(s,r.batchId,t),yield ia(s,r.changes),yield ra(s.remoteStore)}catch(r){const a=Mc(r,"Failed to persist write");t.reject(a)}})}function Wf(n,e){return I(this,null,function*(){const t=Ie(n);try{const s=yield Q_(t.localStore,e);e.targetChanges.forEach((r,a)=>{const o=t.Na.get(a);o&&(ce(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.va=!0:r.modifiedDocuments.size>0?ce(o.va):r.removedDocuments.size>0&&(ce(o.va),o.va=!1))}),yield ia(t,s,e)}catch(s){yield cr(s)}})}function nh(n,e,t){const s=Ie(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Fa.forEach((a,o)=>{const c=o.view.Z_(e);c.snapshot&&r.push(c.snapshot)}),function(o,c){const u=Ie(o);u.onlineState=c;let h=!1;u.queries.forEach((f,p)=>{for(const _ of p.j_)_.Z_(c)&&(h=!0)}),h&&Bc(u)}(s.eventManager,e),r.length&&s.Ca.d_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}function Vy(n,e,t){return I(this,null,function*(){const s=Ie(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Na.get(e),a=r&&r.key;if(a){let o=new mt(te.comparator);o=o.insert(a,_t.newNoDocument(a,he.min()));const c=Pe().add(a),u=new Vo(he.min(),new Map,new mt(Ae),o,c);yield Wf(s,u),s.Oa=s.Oa.remove(a),s.Na.delete(e),$c(s)}else yield Ql(s.localStore,e,!1).then(()=>Yl(s,e,t)).catch(cr)})}function Oy(n,e){return I(this,null,function*(){const t=Ie(n),s=e.batch.batchId;try{const r=yield W_(t.localStore,e);Jf(t,s,null),Qf(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),yield ia(t,r)}catch(r){yield cr(r)}})}function Ly(n,e,t){return I(this,null,function*(){const s=Ie(n);try{const r=yield function(o,c){const u=Ie(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return u.mutationQueue.lookupMutationBatch(h,c).next(p=>(ce(p!==null),f=p.keys(),u.mutationQueue.removeMutationBatch(h,p))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>u.localDocuments.getDocuments(h,f))})}(s.localStore,e);Jf(s,e,t),Qf(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),yield ia(s,r)}catch(r){yield cr(r)}})}function Qf(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Jf(n,e,t){const s=Ie(n);let r=s.Ba[s.currentUser.toKey()];if(r){const a=r.get(e);a&&(t?a.reject(t):a.resolve(),r=r.remove(e)),s.Ba[s.currentUser.toKey()]=r}}function Yl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Ma.get(e))n.Fa.delete(s),t&&n.Ca.$a(s,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(s=>{n.La.containsKey(s)||Yf(n,s)})}function Yf(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(kc(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),$c(n))}function rh(n,e,t){for(const s of t)s instanceof zf?(n.La.addReference(s.key,e),My(n,s)):s instanceof Kf?(z("SyncEngine","Document no longer in limbo: "+s.key),n.La.removeReference(s.key,e),n.La.containsKey(s.key)||Yf(n,s.key)):ae()}function My(n,e){const t=e.key,s=t.path.canonicalString();n.Oa.get(t)||n.xa.has(s)||(z("SyncEngine","New document in limbo: "+t),n.xa.add(s),$c(n))}function $c(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new te(Ye.fromString(e)),s=n.qa.next();n.Na.set(s,new Sy(t)),n.Oa=n.Oa.insert(t,s),Ff(n.remoteStore,new zs(ps(Zi(t.path)),s,"TargetPurposeLimboResolution",fs.oe))}}function ia(n,e,t){return I(this,null,function*(){const s=Ie(n),r=[],a=[],o=[];s.Fa.isEmpty()||(s.Fa.forEach((c,u)=>{o.push(s.Ka(u,e,t).then(h=>{var f;if((h||t)&&s.isPrimaryClient){const p=h?!h.fromCache:(f=t==null?void 0:t.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;s.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(h){r.push(h);const p=Pc.Wi(u.targetId,h);a.push(p)}}))}),yield Promise.all(o),s.Ca.d_(r),yield function(u,h){return I(this,null,function*(){const f=Ie(u);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>R.forEach(h,_=>R.forEach(_.$i,A=>f.persistence.referenceDelegate.addReference(p,_.targetId,A)).next(()=>R.forEach(_.Ui,A=>f.persistence.referenceDelegate.removeReference(p,_.targetId,A)))))}catch(p){if(!Cn(p))throw p;z("LocalStore","Failed to update sequence numbers: "+p)}for(const p of h){const _=p.targetId;if(!p.fromCache){const A=f.os.get(_),P=A.snapshotVersion,k=A.withLastLimboFreeSnapshotVersion(P);f.os=f.os.insert(_,k)}}})}(s.localStore,a))})}function Fy(n,e){return I(this,null,function*(){const t=Ie(n);if(!t.currentUser.isEqual(e)){z("SyncEngine","User change. New user:",e.toKey());const s=yield Df(t.localStore,e);t.currentUser=e,function(a,o){a.ka.forEach(c=>{c.forEach(u=>{u.reject(new Z(F.CANCELLED,o))})}),a.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),yield ia(t,s.hs)}})}function Uy(n,e){const t=Ie(n),s=t.Na.get(e);if(s&&s.va)return Pe().add(s.key);{let r=Pe();const a=t.Ma.get(e);if(!a)return r;for(const o of a){const c=t.Fa.get(o);r=r.unionWith(c.view.Va)}return r}}function Xf(n){const e=Ie(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Wf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Uy.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Vy.bind(null,e),e.Ca.d_=Ny.bind(null,e.eventManager),e.Ca.$a=Iy.bind(null,e.eventManager),e}function Zf(n){const e=Ie(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Oy.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ly.bind(null,e),e}class Ki{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return I(this,null,function*(){this.serializer=Fo(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),yield this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)})}ja(e,t){return null}Ha(e,t){return null}za(e){return kf(this.persistence,new Pf,e.initialUser,this.serializer)}Ga(e){return new Rf(Mo.Zr,this.serializer)}Wa(e){return new Of}terminate(){return I(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}Ki.provider={build:()=>new Ki};class Gc extends Ki{constructor(e,t,s){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return I(this,null,function*(){yield cn(Gc.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield Zf(this.Ja.syncEngine),yield ra(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return kf(this.persistence,new Pf,e.initialUser,this.serializer)}ja(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new j_(s,e.asyncQueue,t)}Ha(e,t){const s=new nb(t,this.persistence);return new sb(e.asyncQueue,s)}Ga(e){const t=z_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=this.cacheSizeBytes!==void 0?rs.withCacheSize(this.cacheSizeBytes):rs.DEFAULT;return new Rc(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,ry(),za(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Of}}class xo{initialize(e,t){return I(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>nh(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Fy.bind(null,this.syncEngine),yield yy(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new wy}()}createDatastore(e){const t=Fo(e.databaseInfo.databaseId),s=function(a){return new ny(a)}(e.databaseInfo);return function(a,o,c,u){return new oy(a,o,c,u)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return function(s,r,a,o,c){return new cy(s,r,a,o,c)}(this.localStore,this.datastore,e.asyncQueue,t=>nh(this.syncEngine,t,0),function(){return Xd.D()?new Xd:new ey}())}createSyncEngine(e,t){return function(r,a,o,c,u,h,f){const p=new Ay(r,a,o,c,u,h);return f&&(p.Qa=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return I(this,null,function*(){var e,t;yield function(r){return I(this,null,function*(){const a=Ie(r);z("RemoteStore","RemoteStore shutting down."),a.L_.add(5),yield na(a),a.k_.shutdown(),a.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()})}}xo.provider={build:()=>new xo};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zc{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Xt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(e,t,s,r,a){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=Ut.UNAUTHENTICATED,this.clientId=Nm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(s,o=>I(this,null,function*(){z("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,o=>(z("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Rs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>I(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=Mc(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}function fl(n,e){return I(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),z("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;yield e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener(r=>I(this,null,function*(){s.isEqual(r)||(yield Df(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function ih(n,e){return I(this,null,function*(){n.asyncQueue.verifyOperationInProgress();const t=yield qy(n);z("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(s=>Zd(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>Zd(e.remoteStore,r)),n._onlineComponents=e})}function qy(n){return I(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){z("FirestoreClient","Using user provided OfflineComponentProvider");try{yield fl(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===F.FAILED_PRECONDITION||r.code===F.UNIMPLEMENTED:!(typeof DOMException!="undefined"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;tr("Error using user provided cache. Falling back to memory cache: "+t),yield fl(n,new Ki)}}else z("FirestoreClient","Using default OfflineComponentProvider"),yield fl(n,new Ki);return n._offlineComponents})}function ep(n){return I(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(z("FirestoreClient","Using user provided OnlineComponentProvider"),yield ih(n,n._uninitializedComponentsProvider._online)):(z("FirestoreClient","Using default OnlineComponentProvider"),yield ih(n,new xo))),n._onlineComponents})}function $y(n){return ep(n).then(e=>e.syncEngine)}function bo(n){return I(this,null,function*(){const e=yield ep(n),t=e.eventManager;return t.onListen=jy.bind(null,e.syncEngine),t.onUnlisten=Py.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Cy.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=ky.bind(null,e.syncEngine),t})}function Gy(n,e,t={}){const s=new Rs;return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){return function(a,o,c,u,h){const f=new zc({next:_=>{f.Za(),o.enqueueAndForget(()=>Uc(a,p));const A=_.docs.has(c);!A&&_.fromCache?h.reject(new Z(F.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&_.fromCache&&u&&u.source==="server"?h.reject(new Z(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),p=new qc(Zi(c.path),f,{includeMetadataChanges:!0,_a:!0});return Fc(a,p)}(yield bo(n),n.asyncQueue,e,t,s)})),s.promise}function zy(n,e,t={}){const s=new Rs;return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){return function(a,o,c,u,h){const f=new zc({next:_=>{f.Za(),o.enqueueAndForget(()=>Uc(a,p)),_.fromCache&&u.source==="server"?h.reject(new Z(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),p=new qc(c,f,{includeMetadataChanges:!0,_a:!0});return Fc(a,p)}(yield bo(n),n.asyncQueue,e,t,s)})),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tp(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ah=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sp(n,e,t){if(!t)throw new Z(F.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Ky(n,e,t,s){if(e===!0&&s===!0)throw new Z(F.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function oh(n){if(!te.isDocumentKey(n))throw new Z(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function lh(n){if(te.isDocumentKey(n))throw new Z(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Bo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ae()}function Ht(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Z(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Bo(n);throw new Z(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(e){var t,s;if(e.host===void 0){if(e.ssl!==void 0)throw new Z(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Z(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Ky("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=tp((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new Z(F.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new Z(F.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new Z(F.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class qo{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ch({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Z(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Z(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ch(e),e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new G0;switch(s.type){case"firstParty":return new W0(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Z(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return I(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const s=ah.get(t);s&&(z("ComponentProvider","Removing Datastore"),ah.delete(t),s.terminate())}(this),Promise.resolve()}}function Hy(n,e,t,s={}){var r;const a=(n=Ht(n,qo))._getSettings(),o=`${e}:${t}`;if(a.host!=="firestore.googleapis.com"&&a.host!==o&&tr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},a),{host:o,ssl:!1})),s.mockUserToken){let c,u;if(typeof s.mockUserToken=="string")c=s.mockUserToken,u=Ut.MOCK_USER;else{c=wx(s.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);const h=s.mockUserToken.sub||s.mockUserToken.user_id;if(!h)throw new Z(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Ut(h)}n._authCredentials=new z0(new wm(c,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Pn(this.firestore,e,this._query)}}class Wt{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new In(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Wt(this.firestore,e,this._key)}}class In extends Pn{constructor(e,t,s){super(e,t,Zi(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Wt(this.firestore,null,new te(e))}withConverter(e){return new In(this.firestore,e,this._path)}}function Is(n,e,...t){if(n=Ot(n),sp("collection","path",e),n instanceof qo){const s=Ye.fromString(e,...t);return lh(s),new In(n,null,s)}{if(!(n instanceof Wt||n instanceof In))throw new Z(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Ye.fromString(e,...t));return lh(s),new In(n.firestore,null,s)}}function Dt(n,e,...t){if(n=Ot(n),arguments.length===1&&(e=Nm.newId()),sp("doc","path",e),n instanceof qo){const s=Ye.fromString(e,...t);return oh(s),new Wt(n,null,new te(s))}{if(!(n instanceof Wt||n instanceof In))throw new Z(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Ye.fromString(e,...t));return oh(s),new Wt(n.firestore,n instanceof In?n.converter:null,new te(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uh{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Lf(this,"async_queue_retry"),this.Vu=()=>{const s=za();s&&z("AsyncQueue","Visibility state changed to "+s.visibilityState),this.t_.jo()},this.mu=e;const t=za();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=za();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Rs;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return I(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Cn(e))throw e;z("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(s=>{this.Eu=s,this.du=!1;const r=function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c}(s);throw Xt("INTERNAL UNHANDLED ERROR: ",r),s}).then(s=>(this.du=!1,s))));return this.mu=t,t}enqueueAfterDelay(e,t,s){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const r=Lc.createAndSchedule(this,e,t,s,a=>this.yu(a));return this.Tu.push(r),r}fu(){this.Eu&&ae()}verifyOperationInProgress(){}wu(){return I(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,s)=>t.targetTimeMs-s.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function dh(n){return function(t,s){if(typeof t!="object"||t===null)return!1;const r=t;for(const a of s)if(a in r&&typeof r[a]=="function")return!0;return!1}(n,["next","error","complete"])}class ws extends qo{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new uh,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}_terminate(){return I(this,null,function*(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new uh(e),this._firestoreClient=void 0,yield e}})}}function Wy(n,e){const t=typeof n=="object"?n:mm(),s=typeof n=="string"?n:"(default)",r=fc(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const a=yx("firestore");a&&Hy(r,...a)}return r}function aa(n){if(n._terminated)throw new Z(F.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||np(n),n._firestoreClient}function np(n){var e,t,s;const r=n._freezeSettings(),a=function(c,u,h,f){return new Eb(c,u,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,tp(f.experimentalLongPollingOptions),f.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((s=r.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new By(n._authCredentials,n._appCheckCredentials,n._queue,a,n._componentsProvider&&function(c){const u=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(u),_online:u}}(n._componentsProvider))}function Qy(n,e){tr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return Jy(n,xo.provider,{build:s=>new Gc(s,t.cacheSizeBytes,void 0)}),Promise.resolve()}function Jy(n,e,t){if((n=Ht(n,ws))._firestoreClient||n._terminated)throw new Z(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Z(F.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},np(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Jr(It.fromBase64String(e))}catch(t){throw new Z(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Jr(It.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Z(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Z(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Z(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ae(this._lat,e._lat)||Ae(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,r){if(s.length!==r.length)return!1;for(let a=0;a<s.length;++a)if(s[a]!==r[a])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yy=/^__.*__$/;class Xy{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new sn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ei(e,this.data,t,this.fieldTransforms)}}class rp{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new sn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ip(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ae()}}class Qc{constructor(e,t,s,r,a,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,a===void 0&&this.vu(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Qc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const s=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:s,xu:!1});return r.Ou(e),r}Nu(e){var t;const s=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:s,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return _o(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(ip(this.Cu)&&Yy.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Zy{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Fo(e)}Qu(e,t,s,r=!1){return new Qc({Cu:e,methodName:t,qu:s,path:gt.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function la(n){const e=n._freezeSettings(),t=Fo(n._databaseId);return new Zy(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Jc(n,e,t,s,r,a={}){const o=n.Qu(a.merge||a.mergeFields?2:0,e,t,r);Yc("Data must be an object, but it was:",o,s);const c=lp(s,o);let u,h;if(a.merge)u=new is(o.fieldMask),h=o.fieldTransforms;else if(a.mergeFields){const f=[];for(const p of a.mergeFields){const _=Xl(e,p,t);if(!o.contains(_))throw new Z(F.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);up(f,_)||f.push(_)}u=new is(f),h=o.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,h=o.fieldTransforms;return new Xy(new Kt(c),u,h)}class $o extends Kc{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof $o}}function ap(n,e,t,s){const r=n.Qu(1,e,t);Yc("Data must be an object, but it was:",r,s);const a=[],o=Kt.empty();ur(s,(u,h)=>{const f=Xc(e,u,t);h=Ot(h);const p=r.Nu(f);if(h instanceof $o)a.push(f);else{const _=ca(h,p);_!=null&&(a.push(f),o.set(f,_))}});const c=new is(a);return new rp(o,c,r.fieldTransforms)}function op(n,e,t,s,r,a){const o=n.Qu(1,e,t),c=[Xl(e,s,t)],u=[r];if(a.length%2!=0)throw new Z(F.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<a.length;_+=2)c.push(Xl(e,a[_])),u.push(a[_+1]);const h=[],f=Kt.empty();for(let _=c.length-1;_>=0;--_)if(!up(h,c[_])){const A=c[_];let P=u[_];P=Ot(P);const k=o.Nu(A);if(P instanceof $o)h.push(A);else{const T=ca(P,k);T!=null&&(h.push(A),f.set(A,T))}}const p=new is(h);return new rp(f,p,o.fieldTransforms)}function ev(n,e,t,s=!1){return ca(t,n.Qu(s?4:3,e))}function ca(n,e){if(cp(n=Ot(n)))return Yc("Unsupported field value:",e,n),lp(n,e);if(n instanceof Kc)return function(s,r){if(!ip(r.Cu))throw r.Bu(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Bu(`${s._methodName}() is not currently supported inside arrays`);const a=s._toFieldTransform(r);a&&r.fieldTransforms.push(a)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(s,r){const a=[];let o=0;for(const c of s){let u=ca(c,r.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),a.push(u),o++}return{arrayValue:{values:a}}}(n,e)}return function(s,r){if((s=Ot(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return zb(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const a=xt.fromDate(s);return{timestampValue:Wr(r.serializer,a)}}if(s instanceof xt){const a=new xt(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Wr(r.serializer,a)}}if(s instanceof Hc)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Jr)return{bytesValue:cf(r.serializer,s._byteString)};if(s instanceof Wt){const a=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(a))throw r.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:Sc(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof Wc)return function(o,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw c.Bu("VectorValues must only contain numeric values.");return wc(c.serializer,u)})}}}}}}(s,r);throw r.Bu(`Unsupported field value: ${Bo(s)}`)}(n,e)}function lp(n,e){const t={};return km(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ur(n,(s,r)=>{const a=ca(r,e.Mu(s));a!=null&&(t[s]=a)}),{mapValue:{fields:t}}}function cp(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof xt||n instanceof Hc||n instanceof Jr||n instanceof Wt||n instanceof Kc||n instanceof Wc)}function Yc(n,e,t){if(!cp(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){const s=Bo(t);throw s==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+s)}}function Xl(n,e,t){if((e=Ot(e))instanceof oa)return e._internalPath;if(typeof e=="string")return Xc(n,e);throw _o("Field path arguments must be of type string or ",n,!1,void 0,t)}const tv=new RegExp("[~\\*/\\[\\]]");function Xc(n,e,t){if(e.search(tv)>=0)throw _o(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new oa(...e.split("."))._internalPath}catch(s){throw _o(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function _o(n,e,t,s,r){const a=s&&!s.isEmpty(),o=r!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(a||o)&&(u+=" (found",a&&(u+=` in field ${s}`),o&&(u+=` in document ${r}`),u+=")"),new Z(F.INVALID_ARGUMENT,c+n+u)}function up(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(e,t,s,r,a){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Wt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new sv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Go("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class sv extends dp{data(){return super.data()}}function Go(n,e){return typeof e=="string"?Xc(n,e):e instanceof oa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hp(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Z(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Zc{}class mp extends Zc{}function Ls(n,e,...t){let s=[];e instanceof Zc&&s.push(e),s=s.concat(t),function(a){const o=a.filter(u=>u instanceof eu).length,c=a.filter(u=>u instanceof zo).length;if(o>1||o>0&&c>0)throw new Z(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const r of s)n=r._apply(n);return n}class zo extends mp{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new zo(e,t,s)}_apply(e){const t=this._parse(e);return fp(e._query,t),new Pn(e.firestore,e.converter,Ul(e._query,t))}_parse(e){const t=la(e.firestore);return function(a,o,c,u,h,f,p){let _;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new Z(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){mh(p,f);const A=[];for(const P of p)A.push(hh(u,a,P));_={arrayValue:{values:A}}}else _=hh(u,a,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||mh(p,f),_=ev(c,o,p,f==="in"||f==="not-in");return Le.create(h,f,_)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function nv(n,e,t){const s=e,r=Go("where",n);return zo._create(r,s,t)}class eu extends Zc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new eu(e,t)}_parse(e){const t=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return t.length===1?t[0]:tt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,a){let o=r;const c=a.getFlattenedFilters();for(const u of c)fp(o,u),o=Ul(o,u)}(e._query,t),new Pn(e.firestore,e.converter,Ul(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class tu extends mp{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new tu(e,t)}_apply(e){const t=function(r,a,o){if(r.startAt!==null)throw new Z(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new Z(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new $i(a,o)}(e._query,this._field,this._direction);return new Pn(e.firestore,e.converter,function(r,a){const o=r.explicitOrderBy.concat([a]);return new Zr(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function nn(n,e="asc"){const t=e,s=Go("orderBy",n);return tu._create(s,t)}function hh(n,e,t){if(typeof(t=Ot(t))=="string"){if(t==="")throw new Z(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zm(e)&&t.indexOf("/")!==-1)throw new Z(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(Ye.fromString(t));if(!te.isDocumentKey(s))throw new Z(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Bi(n,new te(s))}if(t instanceof Wt)return Bi(n,t._key);throw new Z(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Bo(t)}.`)}function mh(n,e){if(!Array.isArray(n)||n.length===0)throw new Z(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function fp(n,e){const t=function(r,a){for(const o of r)for(const c of o.getFlattenedFilters())if(a.indexOf(c.op)>=0)return c.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Z(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Z(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class rv{convertValue(e,t="none"){switch(nr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ht(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Tn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ae()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return ur(e,(r,a)=>{s[r]=this.convertValue(a,t)}),s}convertVectorValue(e){var t,s,r;const a=(r=(s=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||s===void 0?void 0:s.values)===null||r===void 0?void 0:r.map(o=>ht(o.doubleValue));return new Wc(a)}convertGeoPoint(e){return new Hc(ht(e.latitude),ht(e.longitude))}convertArray(e,t){return(e.values||[]).map(s=>this.convertValue(s,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=yc(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Fi(e));default:return null}}convertTimestamp(e){const t=Ys(e);return new xt(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Ye.fromString(e);ce(_f(s));const r=new sr(s.get(1),s.get(3)),a=new te(s.popFirst(5));return r.isEqual(t)||Xt(`Document ${a} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function su(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pp extends dp{constructor(e,t,s,r,a,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ka(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Go("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}}class Ka extends pp{data(e={}){return super.data(e)}}class gp{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Ii(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new Ka(this._firestore,this._userDataWriter,s.key,s,new Ii(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Z(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,a){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(c=>{const u=new Ka(r._firestore,r._userDataWriter,c.doc.key,c.doc,new Ii(r._snapshot.mutatedKeys.has(c.doc.key),r._snapshot.fromCache),r.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(c=>a||c.type!==3).map(c=>{const u=new Ka(r._firestore,r._userDataWriter,c.doc.key,c.doc,new Ii(r._snapshot.mutatedKeys.has(c.doc.key),r._snapshot.fromCache),r.query.converter);let h=-1,f=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:iv(c.type),doc:u,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function iv(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ae()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nu(n){n=Ht(n,Wt);const e=Ht(n.firestore,ws);return Gy(aa(e),n._key).then(t=>bp(e,n,t))}class ru extends rv{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Wt(this.firestore,null,t)}}function av(n){n=Ht(n,Pn);const e=Ht(n.firestore,ws),t=aa(e),s=new ru(e);return hp(n._query),zy(t,n._query).then(r=>new gp(e,s,n,r))}function Ei(n,e,t){n=Ht(n,Wt);const s=Ht(n.firestore,ws),r=su(n.converter,e,t);return ua(s,[Jc(la(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,At.none())])}function Zl(n,e,t,...s){n=Ht(n,Wt);const r=Ht(n.firestore,ws),a=la(r);let o;return o=typeof(e=Ot(e))=="string"||e instanceof oa?op(a,"updateDoc",n._key,e,t,s):ap(a,"updateDoc",n._key,e),ua(r,[o.toMutation(n._key,At.exists(!0))])}function xp(n){return ua(Ht(n.firestore,ws),[new ta(n._key,At.none())])}function ov(n,e){const t=Ht(n.firestore,ws),s=Dt(n),r=su(n.converter,e);return ua(t,[Jc(la(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,At.exists(!1))]).then(()=>s)}function Ms(n,...e){var t,s,r;n=Ot(n);let a={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||dh(e[o])||(a=e[o],o++);const c={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(dh(e[o])){const p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(s=p.error)===null||s===void 0?void 0:s.bind(p),e[o+2]=(r=p.complete)===null||r===void 0?void 0:r.bind(p)}let u,h,f;if(n instanceof Wt)h=Ht(n.firestore,ws),f=Zi(n._key.path),u={next:p=>{e[o]&&e[o](bp(h,n,p))},error:e[o+1],complete:e[o+2]};else{const p=Ht(n,Pn);h=Ht(p.firestore,ws),f=p._query;const _=new ru(h);u={next:A=>{e[o]&&e[o](new gp(h,_,p,A))},error:e[o+1],complete:e[o+2]},hp(n._query)}return function(_,A,P,k){const T=new zc(k),U=new qc(A,T,P);return _.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){return Fc(yield bo(_),U)})),()=>{T.Za(),_.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){return Uc(yield bo(_),U)}))}}(aa(h),f,c,u)}function ua(n,e){return function(s,r){const a=new Rs;return s.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){return Dy(yield $y(s),r,a)})),a.promise}(aa(n),e)}function bp(n,e,t){const s=t.docs.get(e._key),r=new ru(n);return new pp(n,r,e._key,s,new Ii(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=la(e)}set(e,t,s){this._verifyNotCommitted();const r=pl(e,this._firestore),a=su(r.converter,t,s),o=Jc(this._dataReader,"WriteBatch.set",r._key,a,r.converter!==null,s);return this._mutations.push(o.toMutation(r._key,At.none())),this}update(e,t,s,...r){this._verifyNotCommitted();const a=pl(e,this._firestore);let o;return o=typeof(t=Ot(t))=="string"||t instanceof oa?op(this._dataReader,"WriteBatch.update",a._key,t,s,r):ap(this._dataReader,"WriteBatch.update",a._key,t),this._mutations.push(o.toMutation(a._key,At.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=pl(e,this._firestore);return this._mutations=this._mutations.concat(new ta(t._key,At.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Z(F.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function pl(n,e){if((n=Ot(n)).firestore!==e)throw new Z(F.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _p(n){return aa(n=Ht(n,ws)),new lv(n,e=>ua(n,e))}(function(e,t=!0){(function(r){Xr=r})(Yr),Br(new Zn("firestore",(s,{instanceIdentifier:r,options:a})=>{const o=s.getProvider("app").getImmediate(),c=new ws(new K0(s.getProvider("auth-internal")),new J0(s.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Z(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sr(h.options.projectId,f)}(o,r),o);return a=Object.assign({useFetchStreams:t},a),c._setSettings(a),c},"PUBLIC").setMultipleInstances(!0)),wn(id,"4.7.3",e),wn(id,"4.7.3","esm2017")})();var cv="firebase",uv="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */wn(cv,uv,"app");function iu(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t}function yp(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const dv=yp,vp=new Ji("auth","Firebase",yp());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yo=new hc("@firebase/auth");function hv(n,...e){yo.logLevel<=Oe.WARN&&yo.warn(`Auth (${Yr}): ${n}`,...e)}function Ha(n,...e){yo.logLevel<=Oe.ERROR&&yo.error(`Auth (${Yr}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xs(n,...e){throw au(n,...e)}function Ps(n,...e){return au(n,...e)}function wp(n,e,t){const s=Object.assign(Object.assign({},dv()),{[e]:t});return new Ji("auth","Firebase",s).create(e,{appName:n.name})}function En(n){return wp(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function au(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return vp.create(n,...e)}function we(n,e,...t){if(!n)throw au(e,...t)}function Ks(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ha(e),new Error(e)}function Zs(n,e){n||Ks(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ec(){var n;return typeof self!="undefined"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function mv(){return fh()==="http:"||fh()==="https:"}function fh(){var n;return typeof self!="undefined"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fv(){return typeof navigator!="undefined"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(mv()||Tx()||"connection"in navigator)?navigator.onLine:!0}function pv(){if(typeof navigator=="undefined")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e,t){this.shortDelay=e,this.longDelay=t,Zs(t>e,"Short delay should be less than long delay!"),this.isMobile=Nx()||Sx()}get(){return fv()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ou(n,e){Zs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self!="undefined"&&"fetch"in self)return self.fetch;if(typeof globalThis!="undefined"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch!="undefined")return fetch;Ks("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self!="undefined"&&"Headers"in self)return self.Headers;if(typeof globalThis!="undefined"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers!="undefined")return Headers;Ks("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self!="undefined"&&"Response"in self)return self.Response;if(typeof globalThis!="undefined"&&globalThis.Response)return globalThis.Response;if(typeof Response!="undefined")return Response;Ks("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xv=new da(3e4,6e4);function Ko(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function si(a,o,c,u){return I(this,arguments,function*(n,e,t,s,r={}){return Ip(n,r,()=>I(this,null,function*(){let h={},f={};s&&(e==="GET"?f=s:h={body:JSON.stringify(s)});const p=Yi(Object.assign({key:n.config.apiKey},f)).slice(1),_=yield n._getAdditionalHeaders();_["Content-Type"]="application/json",n.languageCode&&(_["X-Firebase-Locale"]=n.languageCode);const A=Object.assign({method:e,headers:_},h);return Ex()||(A.referrerPolicy="no-referrer"),Np.fetch()(Tp(n,n.config.apiHost,t,p),A)}))})}function Ip(n,e,t){return I(this,null,function*(){n._canInitEmulator=!1;const s=Object.assign(Object.assign({},gv),e);try{const r=new bv(n),a=yield Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=yield a.json();if("needConfirmation"in o)throw La(n,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const c=a.ok?o.errorMessage:o.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw La(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw La(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw La(n,"user-disabled",o);const f=s[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw wp(n,f,h);Xs(n,f)}}catch(r){if(r instanceof tn)throw r;Xs(n,"network-request-failed",{message:String(r)})}})}function Ep(a,o,c,u){return I(this,arguments,function*(n,e,t,s,r={}){const h=yield si(n,e,t,s,r);return"mfaPendingCredential"in h&&Xs(n,"multi-factor-auth-required",{_serverResponse:h}),h})}function Tp(n,e,t,s){const r=`${e}${t}?${s}`;return n.config.emulator?ou(n.config,r):`${n.config.apiScheme}://${r}`}class bv{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(Ps(this.auth,"network-request-failed")),xv.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function La(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=Ps(n,e,s);return r.customData._tokenResponse=t,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _v(n,e){return I(this,null,function*(){return si(n,"POST","/v1/accounts:delete",e)})}function Sp(n,e){return I(this,null,function*(){return si(n,"POST","/v1/accounts:lookup",e)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ri(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch(e){}}function yv(n,e=!1){return I(this,null,function*(){const t=Ot(n),s=yield t.getIdToken(e),r=lu(s);we(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const a=typeof r.firebase=="object"?r.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:r,token:s,authTime:Ri(gl(r.auth_time)),issuedAtTime:Ri(gl(r.iat)),expirationTime:Ri(gl(r.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}})}function gl(n){return Number(n)*1e3}function lu(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return Ha("JWT malformed, contained fewer than 3 sections"),null;try{const r=rm(t);return r?JSON.parse(r):(Ha("Failed to decode base64 JWT payload"),null)}catch(r){return Ha("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function ph(n){const e=lu(n);return we(e,"internal-error"),we(typeof e.exp!="undefined","internal-error"),we(typeof e.iat!="undefined","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hi(n,e,t=!1){return I(this,null,function*(){if(t)return e;try{return yield e}catch(s){throw s instanceof tn&&vv(s)&&n.auth.currentUser===n&&(yield n.auth.signOut()),s}})}function vv({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(()=>I(this,null,function*(){yield this.iteration()}),t)}iteration(){return I(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ri(this.lastLoginAt),this.creationTime=Ri(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vo(n){return I(this,null,function*(){var e;const t=n.auth,s=yield n.getIdToken(),r=yield Hi(n,Sp(t,{idToken:s}));we(r==null?void 0:r.users.length,t,"internal-error");const a=r.users[0];n._notifyReloadListener(a);const o=!((e=a.providerUserInfo)===null||e===void 0)&&e.length?Ap(a.providerUserInfo):[],c=Iv(n.providerData,o),u=n.isAnonymous,h=!(n.email&&a.passwordHash)&&!(c!=null&&c.length),f=u?h:!1,p={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:c,metadata:new tc(a.createdAt,a.lastLoginAt),isAnonymous:f};Object.assign(n,p)})}function Nv(n){return I(this,null,function*(){const e=Ot(n);yield vo(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function Iv(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function Ap(n){return n.map(e=>{var{providerId:t}=e,s=iu(e,["providerId"]);return{providerId:t,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ev(n,e){return I(this,null,function*(){const t=yield Ip(n,{},()=>I(this,null,function*(){const s=Yi({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:a}=n.config,o=Tp(n,r,"/v1/token",`key=${a}`),c=yield n._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",Np.fetch()(o,{method:"POST",headers:c,body:s})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function Tv(n,e){return I(this,null,function*(){return si(n,"POST","/v2/accounts:revokeToken",Ko(n,e))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){we(e.idToken,"internal-error"),we(typeof e.idToken!="undefined","internal-error"),we(typeof e.refreshToken!="undefined","internal-error");const t="expiresIn"in e&&typeof e.expiresIn!="undefined"?Number(e.expiresIn):ph(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){we(e.length!==0,"internal-error");const t=ph(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return I(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(we(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return I(this,null,function*(){const{accessToken:s,refreshToken:r,expiresIn:a}=yield Ev(e,t);this.updateTokensAndExpiration(s,r,Number(a))})}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:a}=t,o=new Vr;return s&&(we(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(we(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),a&&(we(typeof a=="number","internal-error",{appName:e}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Vr,this.toJSON())}_performRefresh(){return Ks("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(n,e){we(typeof n=="string"||typeof n=="undefined","internal-error",{appName:e})}class Hs{constructor(e){var{uid:t,auth:s,stsTokenManager:r}=e,a=iu(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new wv(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=s,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new tc(a.createdAt||void 0,a.lastLoginAt||void 0)}getIdToken(e){return I(this,null,function*(){const t=yield Hi(this,this.stsTokenManager.getToken(this.auth,e));return we(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return yv(this,e)}reload(){return Nv(this)}_assign(e){this!==e&&(we(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Hs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){we(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return I(this,null,function*(){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&(yield vo(this)),yield this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)})}delete(){return I(this,null,function*(){if(Gs(this.auth.app))return Promise.reject(En(this.auth));const e=yield this.getIdToken();return yield Hi(this,_v(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var s,r,a,o,c,u,h,f;const p=(s=t.displayName)!==null&&s!==void 0?s:void 0,_=(r=t.email)!==null&&r!==void 0?r:void 0,A=(a=t.phoneNumber)!==null&&a!==void 0?a:void 0,P=(o=t.photoURL)!==null&&o!==void 0?o:void 0,k=(c=t.tenantId)!==null&&c!==void 0?c:void 0,T=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,U=(h=t.createdAt)!==null&&h!==void 0?h:void 0,K=(f=t.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:D,emailVerified:$,isAnonymous:H,providerData:Q,stsTokenManager:N}=t;we(D&&N,e,"internal-error");const b=Vr.fromJSON(this.name,N);we(typeof D=="string",e,"internal-error"),hn(p,e.name),hn(_,e.name),we(typeof $=="boolean",e,"internal-error"),we(typeof H=="boolean",e,"internal-error"),hn(A,e.name),hn(P,e.name),hn(k,e.name),hn(T,e.name),hn(U,e.name),hn(K,e.name);const g=new Hs({uid:D,auth:e,email:_,emailVerified:$,displayName:p,isAnonymous:H,photoURL:P,phoneNumber:A,tenantId:k,stsTokenManager:b,createdAt:U,lastLoginAt:K});return Q&&Array.isArray(Q)&&(g.providerData=Q.map(v=>Object.assign({},v))),T&&(g._redirectEventId=T),g}static _fromIdTokenResponse(e,t,s=!1){return I(this,null,function*(){const r=new Vr;r.updateFromServerResponse(t);const a=new Hs({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return yield vo(a),a})}static _fromGetAccountInfoResponse(e,t,s){return I(this,null,function*(){const r=t.users[0];we(r.localId!==void 0,"internal-error");const a=r.providerUserInfo!==void 0?Ap(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(a!=null&&a.length),c=new Vr;c.updateFromIdToken(s);const u=new Hs({uid:r.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new tc(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(a!=null&&a.length)};return Object.assign(u,h),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gh=new Map;function Ws(n){Zs(n instanceof Function,"Expected a class definition");let e=gh.get(n);return e?(Zs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,gh.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return I(this,null,function*(){return!0})}_set(e,t){return I(this,null,function*(){this.storage[e]=t})}_get(e){return I(this,null,function*(){const t=this.storage[e];return t===void 0?null:t})}_remove(e){return I(this,null,function*(){delete this.storage[e]})}_addListener(e,t){}_removeListener(e,t){}}jp.type="NONE";const xh=jp;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wa(n,e,t){return`firebase:${n}:${e}:${t}`}class Or{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:a}=this.auth;this.fullUserKey=Wa(this.userKey,r.apiKey,a),this.fullPersistenceKey=Wa("persistence",r.apiKey,a),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return I(this,null,function*(){const e=yield this.persistence._get(this.fullUserKey);return e?Hs._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return I(this,null,function*(){if(this.persistence===e)return;const t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,s="authUser"){return I(this,null,function*(){if(!t.length)return new Or(Ws(xh),e,s);const r=(yield Promise.all(t.map(h=>I(this,null,function*(){if(yield h._isAvailable())return h})))).filter(h=>h);let a=r[0]||Ws(xh);const o=Wa(s,e.config.apiKey,e.name);let c=null;for(const h of t)try{const f=yield h._get(o);if(f){const p=Hs._fromJSON(e,f);h!==a&&(c=p),a=h;break}}catch(f){}const u=r.filter(h=>h._shouldAllowMigration);return!a._shouldAllowMigration||!u.length?new Or(a,e,s):(a=u[0],c&&(yield a._set(o,c.toJSON())),yield Promise.all(t.map(h=>I(this,null,function*(){if(h!==a)try{yield h._remove(o)}catch(f){}}))),new Or(a,e,s))})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bh(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(kp(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Cp(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Vp(e))return"Blackberry";if(Op(e))return"Webos";if(Rp(e))return"Safari";if((e.includes("chrome/")||Pp(e))&&!e.includes("edge/"))return"Chrome";if(Dp(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function Cp(n=jt()){return/firefox\//i.test(n)}function Rp(n=jt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Pp(n=jt()){return/crios\//i.test(n)}function kp(n=jt()){return/iemobile/i.test(n)}function Dp(n=jt()){return/android/i.test(n)}function Vp(n=jt()){return/blackberry/i.test(n)}function Op(n=jt()){return/webos/i.test(n)}function cu(n=jt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Sv(n=jt()){var e;return cu(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Av(){return Ax()&&document.documentMode===10}function Lp(n=jt()){return cu(n)||Dp(n)||Op(n)||Vp(n)||/windows phone/i.test(n)||kp(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mp(n,e=[]){let t;switch(n){case"Browser":t=bh(jt());break;case"Worker":t=`${bh(jt())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Yr}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jv{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=a=>new Promise((o,c)=>{try{const u=e(a);o(u)}catch(u){c(u)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){return I(this,null,function*(){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)yield s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch(a){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}})}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cv(t){return I(this,arguments,function*(n,e={}){return si(n,"GET","/v2/passwordPolicy",Ko(n,e))})}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rv=6;class Pv{constructor(e){var t,s,r,a;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:Rv,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(a=e.forceUpgradeOnSignin)!==null&&a!==void 0?a:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,s,r,a,o,c;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(s=u.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(r=u.containsLowercaseLetter)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(a=u.containsUppercaseLetter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kv{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _h(this),this.idTokenSubscription=new _h(this),this.beforeStateQueue=new jv(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=vp,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ws(t)),this._initializationPromise=this.queue(()=>I(this,null,function*(){var s,r;if(!this._deleted&&(this.persistenceManager=yield Or.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch(a){}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return I(this,null,function*(){if(this._deleted)return;const e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return I(this,null,function*(){try{const t=yield Sp(this,{idToken:e}),s=yield Hs._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return I(this,null,function*(){var t;if(Gs(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}const s=yield this.assertedPersistence.getCurrentUser();let r=s,a=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=r==null?void 0:r._redirectEventId,u=yield this.tryRedirectSignIn(e);(!o||o===c)&&(u!=null&&u.user)&&(r=u.user,a=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(a)try{yield this.beforeStateQueue.runMiddleware(r)}catch(o){r=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return we(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return I(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(s){yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return I(this,null,function*(){try{yield vo(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=pv()}_delete(){return I(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return I(this,null,function*(){if(Gs(this.app))return Promise.reject(En(this));const t=e?Ot(e):null;return t&&we(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return I(this,null,function*(){if(!this._deleted)return e&&we(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>I(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return I(this,null,function*(){return Gs(this.app)?Promise.reject(En(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Gs(this.app)?Promise.reject(En(this)):this.queue(()=>I(this,null,function*(){yield this.assertedPersistence.setPersistence(Ws(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return I(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return I(this,null,function*(){const e=yield Cv(this),t=new Pv(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ji("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}revokeAccessToken(e){return I(this,null,function*(){if(this.currentUser){const t=yield this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),yield Tv(this,s)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return I(this,null,function*(){const s=yield this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return I(this,null,function*(){if(!this.redirectPersistenceManager){const t=e&&Ws(e)||this._popupRedirectResolver;we(t,this,"argument-error"),this.redirectPersistenceManager=yield Or.create(this,[Ws(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return I(this,null,function*(){var t,s;return this._isInitialized&&(yield this.queue(()=>I(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return I(this,null,function*(){if(e===this.currentUser)return this.queue(()=>I(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const a=typeof t=="function"?t:t.next.bind(t);let o=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(we(c,this,"internal-error"),c.then(()=>{o||a(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,s,r);return()=>{o=!0,u()}}else{const u=e.addObserver(t);return()=>{o=!0,u()}}}directlySetCurrentUser(e){return I(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return we(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Mp(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return I(this,null,function*(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const s=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();s&&(t["X-Firebase-Client"]=s);const r=yield this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t})}_getAppCheckToken(){return I(this,null,function*(){var e;const t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t!=null&&t.error&&hv(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token})}}function Ho(n){return Ot(n)}class _h{constructor(e){this.auth=e,this.observer=null,this.addObserver=Dx(t=>this.observer=t)}get next(){return we(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uu={loadJS(){return I(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Dv(n){uu=n}function Vv(n){return uu.loadJS(n)}function Ov(){return uu.gapiScript}function Lv(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mv(n,e){const t=fc(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),a=t.getOptions();if(io(a,e!=null?e:{}))return r;Xs(r,"already-initialized")}return t.initialize({options:e})}function Fv(n,e){const t=(e==null?void 0:e.persistence)||[],s=(Array.isArray(t)?t:[t]).map(Ws);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function Uv(n,e,t){const s=Ho(n);we(s._canInitEmulator,s,"emulator-config-failed"),we(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,a=Fp(e),{host:o,port:c}=Bv(e),u=c===null?"":`:${c}`;s.config.emulator={url:`${a}//${o}${u}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:o,port:c,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:r})}),qv()}function Fp(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Bv(n){const e=Fp(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const a=r[1];return{host:a,port:yh(s.substr(a.length+1))}}else{const[a,o]=s.split(":");return{host:a,port:yh(o)}}}function yh(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function qv(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console!="undefined"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window!="undefined"&&typeof document!="undefined"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ks("not implemented")}_getIdTokenResponse(e){return Ks("not implemented")}_linkToIdToken(e,t){return Ks("not implemented")}_getReauthenticationResolver(e){return Ks("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lr(n,e){return I(this,null,function*(){return Ep(n,"POST","/v1/accounts:signInWithIdp",Ko(n,e))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $v="http://localhost";class lr extends Up{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new lr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Xs("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r}=t,a=iu(t,["providerId","signInMethod"]);if(!s||!r)return null;const o=new lr(s,r);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Lr(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,Lr(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Lr(e,t)}buildRequest(){const e={requestUri:$v,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Yi(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bp{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha extends Bp{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn extends ha{constructor(){super("facebook.com")}static credential(e){return lr._fromParams({providerId:fn.PROVIDER_ID,signInMethod:fn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fn.credentialFromTaggedObject(e)}static credentialFromError(e){return fn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return fn.credential(e.oauthAccessToken)}catch(t){return null}}}fn.FACEBOOK_SIGN_IN_METHOD="facebook.com";fn.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn extends ha{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return lr._fromParams({providerId:pn.PROVIDER_ID,signInMethod:pn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return pn.credentialFromTaggedObject(e)}static credentialFromError(e){return pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return pn.credential(t,s)}catch(r){return null}}}pn.GOOGLE_SIGN_IN_METHOD="google.com";pn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn extends ha{constructor(){super("github.com")}static credential(e){return lr._fromParams({providerId:gn.PROVIDER_ID,signInMethod:gn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gn.credentialFromTaggedObject(e)}static credentialFromError(e){return gn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return gn.credential(e.oauthAccessToken)}catch(t){return null}}}gn.GITHUB_SIGN_IN_METHOD="github.com";gn.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn extends ha{constructor(){super("twitter.com")}static credential(e,t){return lr._fromParams({providerId:xn.PROVIDER_ID,signInMethod:xn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return xn.credentialFromTaggedObject(e)}static credentialFromError(e){return xn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return xn.credential(t,s)}catch(r){return null}}}xn.TWITTER_SIGN_IN_METHOD="twitter.com";xn.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gv(n,e){return I(this,null,function*(){return Ep(n,"POST","/v1/accounts:signUp",Ko(n,e))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,s,r=!1){return I(this,null,function*(){const a=yield Hs._fromIdTokenResponse(e,s,r),o=vh(s);return new jn({user:a,providerId:o,_tokenResponse:s,operationType:t})})}static _forOperation(e,t,s){return I(this,null,function*(){yield e._updateTokensIfNecessary(s,!0);const r=vh(s);return new jn({user:e,providerId:r,_tokenResponse:s,operationType:t})})}}function vh(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zv(n){return I(this,null,function*(){var e;if(Gs(n.app))return Promise.reject(En(n));const t=Ho(n);if(yield t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new jn({user:t.currentUser,providerId:null,operationType:"signIn"});const s=yield Gv(t,{returnSecureToken:!0}),r=yield jn._fromIdTokenResponse(t,"signIn",s,!0);return yield t._updateCurrentUser(r.user),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo extends tn{constructor(e,t,s,r){var a;super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,wo.prototype),this.customData={appName:e.name,tenantId:(a=e.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new wo(e,t,s,r)}}function qp(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?wo._fromErrorAndOperation(n,a,e,s):a})}function Kv(n,e,t=!1){return I(this,null,function*(){const s=yield Hi(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return jn._forOperation(n,"link",s)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hv(n,e,t=!1){return I(this,null,function*(){const{auth:s}=n;if(Gs(s.app))return Promise.reject(En(s));const r="reauthenticate";try{const a=yield Hi(n,qp(s,r,e,n),t);we(a.idToken,s,"internal-error");const o=lu(a.idToken);we(o,s,"internal-error");const{sub:c}=o;return we(n.uid===c,s,"user-mismatch"),jn._forOperation(n,r,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&Xs(s,"user-mismatch"),a}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wv(n,e,t=!1){return I(this,null,function*(){if(Gs(n.app))return Promise.reject(En(n));const s="signIn",r=yield qp(n,s,e),a=yield jn._fromIdTokenResponse(n,s,r);return t||(yield n._updateCurrentUser(a.user)),a})}function Qv(n,e,t,s){return Ot(n).onIdTokenChanged(e,t,s)}function Jv(n,e,t){return Ot(n).beforeAuthStateChanged(e,t)}const No="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(No,"1"),this.storage.removeItem(No),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yv=1e3,Xv=10;class Mr extends $p{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Lp(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,c,u)=>{this.notifyListeners(o,u)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},a=this.storage.getItem(s);Av()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,Xv):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},Yv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(e,t){return I(this,null,function*(){yield cn(Mr.prototype,this,"_set").call(this,e,t),this.localCache[e]=JSON.stringify(t)})}_get(e){return I(this,null,function*(){const t=yield cn(Mr.prototype,this,"_get").call(this,e);return this.localCache[e]=JSON.stringify(t),t})}_remove(e){return I(this,null,function*(){yield cn(Mr.prototype,this,"_remove").call(this,e),delete this.localCache[e]})}}Mr.type="LOCAL";const Zv=Mr;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp extends $p{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Gp.type="SESSION";const zp=Gp;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ew(n){return Promise.all(n.map(e=>I(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new Wo(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}handleEvent(e){return I(this,null,function*(){const t=e,{eventId:s,eventType:r,data:a}=t.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const c=Array.from(o).map(h=>I(this,null,function*(){return h(t.origin,a)})),u=yield ew(c);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:u})})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Wo.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function du(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,s=50){return I(this,null,function*(){const r=typeof MessageChannel!="undefined"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let a,o;return new Promise((c,u)=>{const h=du("",20);r.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(p){const _=p;if(_.data.eventId===h)switch(_.data.status){case"ack":clearTimeout(f),a=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),c(_.data.response);break;default:clearTimeout(f),clearTimeout(a),u(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ks(){return window}function sw(n){ks().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kp(){return typeof ks().WorkerGlobalScope!="undefined"&&typeof ks().importScripts=="function"}function nw(){return I(this,null,function*(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(n){return null}})}function rw(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function iw(){return Kp()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hp="firebaseLocalStorageDb",aw=1,Io="firebaseLocalStorage",Wp="fbase_key";class ma{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Qo(n,e){return n.transaction([Io],e?"readwrite":"readonly").objectStore(Io)}function ow(){const n=indexedDB.deleteDatabase(Hp);return new ma(n).toPromise()}function sc(){const n=indexedDB.open(Hp,aw);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Io,{keyPath:Wp})}catch(r){t(r)}}),n.addEventListener("success",()=>I(this,null,function*(){const s=n.result;s.objectStoreNames.contains(Io)?e(s):(s.close(),yield ow(),e(yield sc()))}))})}function wh(n,e,t){return I(this,null,function*(){const s=Qo(n,!0).put({[Wp]:e,value:t});return new ma(s).toPromise()})}function lw(n,e){return I(this,null,function*(){const t=Qo(n,!1).get(e),s=yield new ma(t).toPromise();return s===void 0?null:s.value})}function Nh(n,e){const t=Qo(n,!0).delete(e);return new ma(t).toPromise()}const cw=800,uw=3;class Qp{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return I(this,null,function*(){return this.db?this.db:(this.db=yield sc(),this.db)})}_withRetries(e){return I(this,null,function*(){let t=0;for(;;)try{const s=yield this._openDb();return yield e(s)}catch(s){if(t++>uw)throw s;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return I(this,null,function*(){return Kp()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return I(this,null,function*(){this.receiver=Wo._getInstance(iw()),this.receiver._subscribe("keyChanged",(e,t)=>I(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(t.key)}})),this.receiver._subscribe("ping",(e,t)=>I(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return I(this,null,function*(){var e,t;if(this.activeServiceWorker=yield nw(),!this.activeServiceWorker)return;this.sender=new tw(this.activeServiceWorker);const s=yield this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((t=s[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(e){return I(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||rw()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}})}_isAvailable(){return I(this,null,function*(){try{if(!indexedDB)return!1;const e=yield sc();return yield wh(e,No,"1"),yield Nh(e,No),!0}catch(e){}return!1})}_withPendingWrite(e){return I(this,null,function*(){this.pendingWrites++;try{yield e()}finally{this.pendingWrites--}})}_set(e,t){return I(this,null,function*(){return this._withPendingWrite(()=>I(this,null,function*(){return yield this._withRetries(s=>wh(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)}))})}_get(e){return I(this,null,function*(){const t=yield this._withRetries(s=>lw(s,e));return this.localCache[e]=t,t})}_remove(e){return I(this,null,function*(){return this._withPendingWrite(()=>I(this,null,function*(){return yield this._withRetries(t=>Nh(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)}))})}_poll(){return I(this,null,function*(){const e=yield this._withRetries(r=>{const a=Qo(r,!1).getAll();return new ma(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:a}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(a)&&(this.notifyListeners(r,a),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t})}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>I(this,null,function*(){return this._poll()}),cw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Qp.type="LOCAL";const dw=Qp;new da(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hw(n,e){return e?Ws(e):(we(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu extends Up{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Lr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Lr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Lr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function mw(n){return Wv(n.auth,new hu(n),n.bypassAuthState)}function fw(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),Hv(t,new hu(n),n.bypassAuthState)}function pw(n){return I(this,null,function*(){const{auth:e,user:t}=n;return we(t,e,"internal-error"),Kv(t,new hu(n),n.bypassAuthState)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(e,t,s,r,a=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>I(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}}))}onAuthEvent(e){return I(this,null,function*(){const{urlResponse:t,sessionId:s,postBody:r,tenantId:a,error:o,type:c}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:t,sessionId:s,tenantId:a||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(u))}catch(h){this.reject(h)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return mw;case"linkViaPopup":case"linkViaRedirect":return pw;case"reauthViaPopup":case"reauthViaRedirect":return fw;default:Xs(this.auth,"internal-error")}}resolve(e){Zs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Zs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gw=new da(2e3,1e4);class Pr extends Jp{constructor(e,t,s,r,a){super(e,t,r,a),this.provider=s,this.authWindow=null,this.pollId=null,Pr.currentPopupAction&&Pr.currentPopupAction.cancel(),Pr.currentPopupAction=this}executeNotNull(){return I(this,null,function*(){const e=yield this.execute();return we(e,this.auth,"internal-error"),e})}onExecution(){return I(this,null,function*(){Zs(this.filter.length===1,"Popup operations only handle one event");const e=du();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ps(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ps(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Pr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;if(!((s=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ps(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,gw.get())};e()}}Pr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xw="pendingRedirect",Qa=new Map;class Pi extends Jp{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}execute(){return I(this,null,function*(){let e=Qa.get(this.auth._key());if(!e){try{const s=(yield bw(this.resolver,this.auth))?yield cn(Pi.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Qa.set(this.auth._key(),e)}return this.bypassAuthState||Qa.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return I(this,null,function*(){if(e.type==="signInViaRedirect")return cn(Pi.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,cn(Pi.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return I(this,null,function*(){})}cleanUp(){}}function bw(n,e){return I(this,null,function*(){const t=vw(e),s=yw(n);if(!(yield s._isAvailable()))return!1;const r=(yield s._get(t))==="true";return yield s._remove(t),r})}function _w(n,e){Qa.set(n._key(),e)}function yw(n){return Ws(n._redirectPersistence)}function vw(n){return Wa(xw,n.config.apiKey,n.name)}function ww(n,e,t=!1){return I(this,null,function*(){if(Gs(n.app))return Promise.reject(En(n));const s=Ho(n),r=hw(s,e),o=yield new Pi(s,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield s._persistUserIfCurrent(o.user),yield s._setRedirectUser(null,e)),o})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nw=10*60*1e3;class Iw{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Ew(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!Yp(e)){const r=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";t.onError(Ps(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Nw&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ih(e))}saveEventToCache(e){this.cachedEventUids.add(Ih(e)),this.lastProcessedEventTime=Date.now()}}function Ih(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Yp({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Ew(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Yp(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tw(t){return I(this,arguments,function*(n,e={}){return si(n,"GET","/v1/projects",e)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sw=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Aw=/^https?/;function jw(n){return I(this,null,function*(){if(n.config.emulator)return;const{authorizedDomains:e}=yield Tw(n);for(const t of e)try{if(Cw(t))return}catch(s){}Xs(n,"unauthorized-domain")})}function Cw(n){const e=ec(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!Aw.test(t))return!1;if(Sw.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rw=new da(3e4,6e4);function Eh(){const n=ks().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Pw(n){return new Promise((e,t)=>{var s,r,a;function o(){Eh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Eh(),t(Ps(n,"network-request-failed"))},timeout:Rw.get()})}if(!((r=(s=ks().gapi)===null||s===void 0?void 0:s.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((a=ks().gapi)===null||a===void 0)&&a.load)o();else{const c=Lv("iframefcb");return ks()[c]=()=>{gapi.load?o():t(Ps(n,"network-request-failed"))},Vv(`${Ov()}?onload=${c}`).catch(u=>t(u))}}).catch(e=>{throw Ja=null,e})}let Ja=null;function kw(n){return Ja=Ja||Pw(n),Ja}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dw=new da(5e3,15e3),Vw="__/auth/iframe",Ow="emulator/auth/iframe",Lw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Mw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Fw(n){const e=n.config;we(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?ou(e,Ow):`https://${n.config.authDomain}/${Vw}`,s={apiKey:e.apiKey,appName:n.name,v:Yr},r=Mw.get(n.config.apiHost);r&&(s.eid=r);const a=n._getFrameworks();return a.length&&(s.fw=a.join(",")),`${t}?${Yi(s).slice(1)}`}function Uw(n){return I(this,null,function*(){const e=yield kw(n),t=ks().gapi;return we(t,n,"internal-error"),e.open({where:document.body,url:Fw(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Lw,dontclear:!0},s=>new Promise((r,a)=>I(this,null,function*(){yield s.restyle({setHideOnLeave:!1});const o=Ps(n,"network-request-failed"),c=ks().setTimeout(()=>{a(o)},Dw.get());function u(){ks().clearTimeout(c),r(s)}s.ping(u).then(u,()=>{a(o)})})))})}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bw={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},qw=500,$w=600,Gw="_blank",zw="http://localhost";class Th{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Kw(n,e,t,s=qw,r=$w){const a=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Bw),{width:s.toString(),height:r.toString(),top:a,left:o}),h=jt().toLowerCase();t&&(c=Pp(h)?Gw:t),Cp(h)&&(e=e||zw,u.scrollbars="yes");const f=Object.entries(u).reduce((_,[A,P])=>`${_}${A}=${P},`,"");if(Sv(h)&&c!=="_self")return Hw(e||"",c),new Th(null);const p=window.open(e||"",c,f);we(p,n,"popup-blocked");try{p.focus()}catch(_){}return new Th(p)}function Hw(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ww="__/auth/handler",Qw="emulator/auth/handler",Jw=encodeURIComponent("fac");function Sh(n,e,t,s,r,a){return I(this,null,function*(){we(n.config.authDomain,n,"auth-domain-config-required"),we(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:Yr,eventId:r};if(e instanceof Bp){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",kx(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,p]of Object.entries({}))o[f]=p}if(e instanceof ha){const f=e.getScopes().filter(p=>p!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);const c=o;for(const f of Object.keys(c))c[f]===void 0&&delete c[f];const u=yield n._getAppCheckToken(),h=u?`#${Jw}=${encodeURIComponent(u)}`:"";return`${Yw(n)}?${Yi(c).slice(1)}${h}`})}function Yw({config:n}){return n.emulator?ou(n,Qw):`https://${n.authDomain}/${Ww}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xl="webStorageSupport";class Xw{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=zp,this._completeRedirectFn=ww,this._overrideRedirectResult=_w}_openPopup(e,t,s,r){return I(this,null,function*(){var a;Zs((a=this.eventManagers[e._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const o=yield Sh(e,t,s,ec(),r);return Kw(e,o,du())})}_openRedirect(e,t,s,r){return I(this,null,function*(){yield this._originValidation(e);const a=yield Sh(e,t,s,ec(),r);return sw(a),new Promise(()=>{})})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:a}=this.eventManagers[t];return r?Promise.resolve(r):(Zs(a,"If manager is not set, promise should be"),a)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}initAndGetManager(e){return I(this,null,function*(){const t=yield Uw(e),s=new Iw(e);return t.register("authEvent",r=>(we(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(xl,{type:xl},r=>{var a;const o=(a=r==null?void 0:r[0])===null||a===void 0?void 0:a[xl];o!==void 0&&t(!!o),Xs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=jw(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Lp()||Rp()||cu()}}const Zw=Xw;var Ah="@firebase/auth",jh="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eN{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return I(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){we(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tN(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function sN(n){Br(new Zn("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=s.options;we(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const u={apiKey:o,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Mp(n)},h=new kv(s,r,a,u);return Fv(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Br(new Zn("auth-internal",e=>{const t=Ho(e.getProvider("auth").getImmediate());return(s=>new eN(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),wn(Ah,jh,tN(n)),wn(Ah,jh,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nN=5*60,rN=om("authIdTokenMaxAge")||nN;let Ch=null;const iN=n=>e=>I(Me,null,function*(){const t=e&&(yield e.getIdTokenResult()),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>rN)return;const r=t==null?void 0:t.token;Ch!==r&&(Ch=r,yield fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});function aN(n=mm()){const e=fc(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Mv(n,{popupRedirectResolver:Zw,persistence:[dw,Zv,zp]}),s=om("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(s,location.origin);if(location.origin===a.origin){const o=iN(a.toString());Jv(t,o,()=>o(t.currentUser)),Qv(t,c=>o(c))}}const r=im("auth");return r&&Uv(t,`http://${r}`),t}function oN(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Dv({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const a=Ps("internal-error");a.customData=r,t(a)},s.type="text/javascript",s.charset="UTF-8",oN().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});sN("Browser");let ne=null,bl=null,nc=null;const Rh={apiKey:"AIzaSyD52rhcJ6NZFCidCs21Ly3zX_v2MRZHFhI",authDomain:"maximal-plate-381513.firebaseapp.com",projectId:"maximal-plate-381513",storageBucket:"maximal-plate-381513.firebasestorage.app",messagingSenderId:"123822174953",appId:"1:123822174953:web:generic"},mu=n=>{try{if(n==="LOCAL")return localStorage.setItem("gesmind_db_mode","LOCAL"),ne=null,console.log("Mode Local activé."),!0;let e;try{e=typeof n=="string"?JSON.parse(n):n}catch(t){return console.warn("Format JSON invalide détecté lors de la configuration."),!1}return e&&e.apiKey&&e.projectId?(localStorage.setItem("gesmind_firebase_config",JSON.stringify(e)),localStorage.setItem("gesmind_db_mode","CLOUD"),Xp(e)):!1}catch(e){return console.error("Erreur configuration Firebase:",e),!1}},Xp=n=>{try{bl=hm(n);const e=aN(bl);return nc=zv(e).then(t=>{console.log("Connexion anonyme réussie (Auth) :",t.user.uid)}).catch(t=>{console.warn("La connexion anonyme a échoué. Vérifiez si 'Anonymous Auth' est activé dans la console Firebase.",t)}),ne=Wy(bl),typeof window!="undefined"&&Qy(ne).catch(t=>{t.code==="failed-precondition"?console.warn("Persistance Firestore désactivée : Plusieurs onglets ouverts."):t.code==="unimplemented"&&console.warn("Persistance Firestore non supportée par ce navigateur.")}),console.log("Firebase initialisé avec succès :",n.projectId),!0}catch(e){return console.error("Erreur lors de l'initialisation de l'instance Firebase:",e),!1}},Es=()=>I(Me,null,function*(){if(nc)try{yield nc}catch(n){console.error("Attente Auth échouée",n)}}),lN=localStorage.getItem("gesmind_db_mode"),Ph=localStorage.getItem("gesmind_firebase_config");lN==="LOCAL"?(console.log("Démarrage en mode Local."),ne=null):Ph?mu(Ph):(console.log("Tentative de connexion avec la configuration par défaut..."),Xp(Rh)&&(localStorage.setItem("gesmind_firebase_config",JSON.stringify(Rh)),localStorage.setItem("gesmind_db_mode","CLOUD")));const hs=n=>{const e=new WeakSet,t=s=>{if(s===null||typeof s!="object")return s;if(e.has(s))return null;if(e.add(s),s instanceof Date)return s.toISOString();if(Array.isArray(s))return s.map(t);const r={};for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)){const o=s[a];o!==void 0&&typeof o!="function"&&(r[a]=t(o))}return r};return t(n)},ms={},Zp=n=>{ms[n]&&ms[n].forEach(e=>e())},Ns=n=>{try{return JSON.parse(localStorage.getItem(n)||"[]")}catch(e){return[]}},Ds=(n,e)=>{try{localStorage.setItem(n,JSON.stringify(hs(e))),Zp(n)}catch(t){console.error("Storage Error (setLocalData):",t)}},Fs=n=>{let e=null,t=!1;return Es().then(()=>{t||(e=n())}),()=>{t=!0,e&&e()}},cN=(n,e,t,s,r)=>I(Me,null,function*(){if(!ne){const a=Ns("gesmind_local_stores_registry");return a.push(e),Ds("gesmind_local_stores_registry",a),localStorage.setItem(`gesmind_local_${n}_settings`,JSON.stringify(hs(t))),Ds(`gesmind_local_${n}_users`,[s]),Ds(`gesmind_local_${n}_employees`,[r]),!0}try{return yield Es(),yield Ei(Dt(ne,"stores_registry",n),hs(e)),yield Ei(Dt(ne,"stores",n),{settings:hs(t)}),yield Ei(Dt(ne,"stores",n,"users",s.id),hs(s)),yield Ei(Dt(ne,"stores",n,"employees",r.id),hs(r)),!0}catch(a){throw console.error("Erreur création boutique:",a),a}}),uN=n=>I(Me,null,function*(){if(!ne)return Ns("gesmind_local_stores_registry").find(t=>t.id===n)||null;try{yield Es();const e=Dt(ne,"stores_registry",n),t=yield nu(e);return t.exists()?t.data():null}catch(e){return null}}),dN=n=>I(Me,null,function*(){if(!ne){const e=Ns("gesmind_local_stores_registry").filter(t=>t.id!==n);return Ds("gesmind_local_stores_registry",e),!0}try{return yield Es(),yield xp(Dt(ne,"stores_registry",n)),!0}catch(e){throw e}}),rn=(n,e,t)=>{const s=`gesmind_local_${n}_${e}`,r=()=>t(Ns(s));return ms[s]||(ms[s]=[]),ms[s].push(r),r(),()=>{ms[s]=ms[s].filter(a=>a!==r)}},hN=(n,e)=>ne?Fs(()=>{if(!ne)return()=>{};const t=Ls(Is(ne,"stores",n,"inventory"),nn("name"));return Ms(t,s=>{e(s.docs.map(r=>Ue(je({},r.data()),{id:r.id})))})}):rn(n,"inventory",e),mN=(n,e)=>ne?Fs(()=>{if(!ne)return()=>{};const t=Ls(Is(ne,"stores",n,"transactions"),nn("date","desc"));return Ms(t,s=>{e(s.docs.map(r=>Ue(je({},r.data()),{id:r.id})))})}):rn(n,"transactions",e),fN=(n,e)=>ne?Fs(()=>{if(!ne)return()=>{};const t=Ls(Is(ne,"stores",n,"expenses"),nn("date","desc"));return Ms(t,s=>{e(s.docs.map(r=>Ue(je({},r.data()),{id:r.id})))})}):rn(n,"expenses",e),pN=(n,e)=>ne?Fs(()=>{if(!ne)return()=>{};const t=Ls(Is(ne,"stores",n,"users"),nn("name"));return Ms(t,s=>{e(s.docs.map(r=>Ue(je({},r.data()),{id:r.id})))})}):rn(n,"users",e),gN=(n,e)=>ne?Fs(()=>{if(!ne)return()=>{};const t=Ls(Is(ne,"stores",n,"employees"),nn("fullName"));return Ms(t,s=>{e(s.docs.map(r=>Ue(je({},r.data()),{id:r.id})))})}):rn(n,"employees",e),xN=(n,e)=>ne?Fs(()=>{if(!ne)return()=>{};const t=Ls(Is(ne,"stores",n,"customers"),nn("name"));return Ms(t,s=>{e(s.docs.map(r=>Ue(je({},r.data()),{id:r.id})))})}):rn(n,"customers",e),bN=(n,e)=>ne?Fs(()=>{if(!ne)return()=>{};const t=Ls(Is(ne,"stores",n,"suppliers"),nn("name"));return Ms(t,s=>{e(s.docs.map(r=>Ue(je({},r.data()),{id:r.id})))})}):rn(n,"suppliers",e),_N=(n,e)=>ne?Fs(()=>{if(!ne)return()=>{};const t=Ls(Is(ne,"stores",n,"cash_movements"),nn("date","desc"));return Ms(t,s=>{e(s.docs.map(r=>Ue(je({},r.data()),{id:r.id})))})}):rn(n,"cash_movements",e),yN=(n,e)=>ne?Fs(()=>{if(!ne)return()=>{};const t=Ls(Is(ne,"stores",n,"cashClosings"),nn("date","desc"));return Ms(t,s=>{e(s.docs.map(r=>Ue(je({},r.data()),{id:r.id})))})}):rn(n,"cashClosings",e),vN=(n,e)=>{if(!ne){const t=`gesmind_local_${n}_settings`,s=()=>{const r=localStorage.getItem(t);e(r?JSON.parse(r):null)};return ms[t]||(ms[t]=[]),ms[t].push(s),s(),()=>{ms[t]=ms[t].filter(r=>r!==s)}}return Fs(()=>ne?Ms(Dt(ne,"stores",n),t=>{t.exists()?e(t.data().settings):e(null)}):()=>{})},fu=(n,e)=>I(Me,null,function*(){const s=`${new Date().toISOString().split("T")[0]}_${e}`,r=new Date,a=new Date(r);if(a.setHours(24,0,0,0),!ne){const o=`gesmind_local_${n}_cashClosings`,u=Ns(o).some(h=>h.id===s);return{isLocked:u,reopenAt:u?a:void 0}}try{yield Es();const o=Dt(ne,"stores",n,"cashClosings",s),u=(yield nu(o)).exists();return{isLocked:u,reopenAt:u?a:void 0}}catch(o){return console.error("Erreur vérification clôture:",o),{isLocked:!1}}}),_s=(n,e,t)=>I(Me,null,function*(){const s=hs(t);if(!ne){const r=`gesmind_local_${n}_${e}`,a=Ns(r);a.push(s),Ds(r,a);return}yield Es(),t.id?yield Ei(Dt(ne,"stores",n,e,t.id),s):yield ov(Is(ne,"stores",n,e),s)}),ys=(n,e,t,s)=>I(Me,null,function*(){const r=hs(s);if(!ne){const a=`gesmind_local_${n}_${e}`;let o=Ns(a);o=o.map(c=>c.id===t?je(je({},c),r):c),Ds(a,o);return}yield Es(),yield Zl(Dt(ne,"stores",n,e,t),r)}),Er=(n,e,t)=>I(Me,null,function*(){if(!ne){const s=`gesmind_local_${n}_${e}`;let r=Ns(s);r=r.filter(a=>a.id!==t),Ds(s,r);return}yield Es(),yield xp(Dt(ne,"stores",n,e,t))}),wN=(n,e)=>I(Me,null,function*(){const t=hs(e);if(!ne){localStorage.setItem(`gesmind_local_${n}_settings`,JSON.stringify(t));const r="gesmind_local_stores_registry";let a=Ns(r);a=a.map(o=>o.id===n?Ue(je({},o),{name:e.name,logoUrl:e.logoUrl}):o),Ds(r,a),Zp(`gesmind_local_${n}_settings`);return}yield Es(),yield Zl(Dt(ne,"stores",n),{settings:t});const s={name:e.name,logoUrl:e.logoUrl};yield Zl(Dt(ne,"stores_registry",n),hs(s))}),NN=(n,e,t)=>I(Me,null,function*(){const s=hs(e);if(!ne){const r=`gesmind_local_${n}_cashClosings`,a=Ns(r);if(a.some(u=>u.id===e.id))throw new Error("Cette caisse est déjà clôturée pour cette date.");a.push(s),Ds(r,a);const o=`gesmind_local_${n}_transactions`;let c=Ns(o);return c=c.map(u=>t.includes(u.id)?Ue(je({},u),{isLocked:!0}):u),Ds(o,c),!0}try{if(yield Es(),!ne)throw new Error("Firestore non initializado");const r=_p(ne),a=Dt(ne,"stores",n,"cashClosings",e.id);return r.set(a,s),t.forEach(o=>{if(ne){const c=Dt(ne,"stores",n,"transactions",o);r.update(c,{isLocked:!0})}}),yield r.commit(),!0}catch(r){throw console.error("Erreur Clôture:",r),r.code==="permission-denied"||r.message.includes("permission")?new Error("Clôture impossible : Déjà clôturé ou permission refusée."):r}}),IN=(n,e,t)=>I(Me,null,function*(){if(!ne)return 0;yield Es();const s=new Date;s.setHours(0,0,0,0);const r=s.toISOString();try{const a=Ls(Is(ne,"stores",n,"transactions"),nv("sellerId","==",e)),o=yield av(a),c={};o.forEach(f=>{const p=je({id:f.id},f.data());if(p.date<r&&!p.isLocked){const _=new Date(p.date).toISOString().split("T")[0];c[_]||(c[_]=[]),c[_].push(p)}});const u=Object.keys(c);if(u.length===0)return 0;console.log(`[AUTO-CLOSE] Détection de ${u.length} jours oubliés pour ${t}.`);let h=0;for(const f of u){const p=c[f],_=`${f}_${e}`;if(!ne)break;const A=Dt(ne,"stores",n,"cashClosings",_),P=yield nu(A),k=_p(ne);if(P.exists())console.warn(`[AUTO-CLOSE] La clôture ${_} existe déjà. Verrouillage forcé des transactions orphelines.`);else{let T=0,U=0,K=0,D=0;p.forEach(H=>{T+=H.totalAmount,H.paymentMethod==="MOBILE_MONEY"?K+=H.amountPaid:H.paymentMethod==="CARD"?D+=H.amountPaid:U+=H.amountPaid});const $={id:_,date:new Date(`${f}T23:59:59`).toISOString(),registerId:e,closedBy:"system",totalSales:T,amountCash:U,amountMobileMoney:K,amountCard:D,cashExpected:U,cashReal:U,difference:0,status:"closed",autoClosed:!0,comment:"Clôture automatique (Oubli détecté)",totalCashIn:U,totalCashOut:0};k.set(A,hs($))}p.forEach(T=>{ne&&k.update(Dt(ne,"stores",n,"transactions",T.id),{isLocked:!0})}),yield k.commit(),h++}return h}catch(a){return console.error("Erreur processForgottenClosings:",a),0}}),EN=({inventory:n,transactions:e,onAddTransaction:t,currency:s,currentUser:r,customers:a=[],suppliers:o=[],storeSettings:c,supervisionTarget:u})=>{const[h,f]=w.useState("ALL"),[p,_]=w.useState("ALL"),[A,P]=w.useState(!1),[k,T]=w.useState("SALE"),[U,K]=w.useState([]),[D,$]=w.useState(""),[H,Q]=w.useState(0),[N,b]=w.useState(""),[g,v]=w.useState(!1),[S,E]=w.useState(-1),[y,ke]=w.useState(""),[Y,Fe]=w.useState(""),J=r.role==="ADMIN",_e=r.permissions.includes("commercial.sale"),Ce=r.permissions.includes("commercial.purchase"),[Re,Xe]=w.useState(!1),[Ee,Ne]=w.useState(null),W=!!u,ue=u?u.id:r.id,Te=J&&!W?e:e.filter(B=>B.sellerId===ue),ye=J&&!W?n:n.filter(B=>B.createdBy===ue),re=w.useRef(null),Be=w.useRef(null);w.useEffect(()=>{function B(ie){re.current&&!re.current.contains(ie.target)&&v(!1)}return document.addEventListener("mousedown",B),()=>document.removeEventListener("mousedown",B)},[re]);const Ze=B=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:s.code,minimumFractionDigits:s.code==="XOF"?0:2,maximumFractionDigits:s.code==="XOF"?0:2}).format(B*s.rate);Te.filter(B=>{const ie=h==="ALL"||B.type===h,ve=p==="ALL"||p==="PAID"&&B.paymentStatus==="PAID"||p==="UNPAID"&&B.paymentStatus!=="PAID";return ie&&ve});const ze=ye.filter(B=>B.name.toLowerCase().includes(N.toLowerCase())||B.sku.toLowerCase().includes(N.toLowerCase())).slice(0,50),de=()=>I(Me,null,function*(){const B=localStorage.getItem("gesmind_last_store_id");if(!B)return!1;const ie=yield fu(B,ue);if(ie.isLocked&&ie.reopenAt){const ve=ie.reopenAt,nt=new Date,M=ve.getTime()-nt.getTime(),ge=Math.floor(M/(1e3*60*60)),De=Math.floor(M%(1e3*60*60)/(1e3*60)),fe="00h00",xe=`${ge} heures ${De} minutes`;return Ne({reopeningTime:fe,remainingText:xe}),Xe(!0),!0}return!1}),dt=B=>I(Me,null,function*(){B==="SALE"&&!_e||B==="PURCHASE"&&!Ce||(yield de())||(T(B),K([]),ke(""),b(""),Fe(""),Q(0),P(!0),setTimeout(()=>{var ve;return(ve=Be.current)==null?void 0:ve.focus()},100))}),et=B=>{b(B.target.value),v(!0),E(0)},st=B=>{!g||ze.length===0||(B.key==="ArrowDown"?(B.preventDefault(),E(ie=>Math.min(ie+1,ze.length-1))):B.key==="ArrowUp"?(B.preventDefault(),E(ie=>Math.max(ie-1,0))):B.key==="Enter"?(B.preventDefault(),S>=0&&ze[S]&&ft(ze[S])):B.key==="Escape"&&v(!1))},ft=B=>{$(B.id),b(B.name),v(!1),E(-1)},yt=()=>{var ve;if(!D)return;if(H<=0){alert("Veuillez saisir une quantité valide supérieure à 0.");return}const B=n.find(nt=>nt.id===D);if(!B)return;if(k==="SALE"&&H>B.quantity){alert(`Stock insuffisant ! Disponible : ${B.quantity}`);return}const ie={productId:B.id,productName:B.name,quantity:H,unitPrice:B.price};K([...U,ie]),$(""),b(""),Q(0),(ve=Be.current)==null||ve.focus()},Qe=B=>{const ie=[...U];ie.splice(B,1),K(ie)},ot=()=>U.reduce((B,ie)=>B+ie.quantity*ie.unitPrice,0);w.useEffect(()=>{if(A){const B=ot();k==="SALE"?Fe((B*s.rate).toFixed(2)):Y===""&&Fe("0")}},[U,s.rate,A,k]);const Et=()=>{if(U.length===0)return;const B=ot(),ie=(parseFloat(Y)||0)/s.rate;let ve="UNPAID",nt;ie>=B-.01?(ve="PAID",nt=new Date().toISOString()):ie>0&&(ve="PARTIAL");let M={},ge={};if(k==="SALE"&&y){const fe=a.find(xe=>xe.id===y);fe&&(M={customerId:fe.id,customerName:fe.name})}else if(k==="PURCHASE"&&y){const fe=o.find(xe=>xe.id===y);fe&&(ge={supplierId:fe.id,supplierName:fe.name})}const De=je(je({id:`T-${Date.now()}`,type:k,date:new Date().toISOString(),items:U,totalAmount:B,amountPaid:ie,paymentStatus:ve,paidAt:nt,status:"COMPLETED",sellerId:r.id,sellerName:r.name},M),ge);t(De),P(!1)},ut=ot(),Se=ut*s.rate,oe=parseFloat(Y)||0,lt=Math.max(0,Se-oe);return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-bold text-slate-800 flex items-center",children:["Ventes/Achats",W&&i.jsxs("span",{className:"ml-3 text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded-full border border-amber-200 flex items-center shadow-sm",children:[i.jsx(en,{className:"w-3 h-3 mr-1"})," Supervision: ",u==null?void 0:u.name]})]}),i.jsx("p",{className:"text-slate-500",children:J&&!W?"Journal global des transactions.":"Historique des transactions."})]}),i.jsxs("div",{className:"flex gap-3",children:[_e&&i.jsxs("button",{onClick:()=>dt("SALE"),className:"bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2.5 rounded-xl font-medium flex items-center shadow-lg shadow-emerald-200 transition-colors",children:[i.jsx(eo,{className:"w-5 h-5 mr-2"})," Nouvelle Vente"]}),Ce&&i.jsxs("button",{onClick:()=>dt("PURCHASE"),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-xl font-medium flex items-center shadow-lg shadow-blue-200 transition-colors",children:[i.jsx(ki,{className:"w-5 h-5 mr-2"})," Nouvel Achat"]})]})]}),A&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-0 md:p-2 z-50 overflow-hidden",children:i.jsxs("div",{className:"bg-white rounded-none md:rounded-xl shadow-2xl w-full max-w-7xl h-full md:h-[95vh] flex flex-col animate-fade-in-up",children:[i.jsxs("div",{className:`flex justify-between items-center px-3 py-2 border-b shrink-0 ${k==="PURCHASE"?"bg-blue-50 border-blue-100":"bg-slate-50 border-slate-100"}`,children:[i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs("h3",{className:`text-base font-bold flex items-center ${k==="PURCHASE"?"text-blue-700":"text-slate-800"}`,children:[k==="SALE"?i.jsx(eo,{className:"w-4 h-4 mr-1 text-emerald-600"}):i.jsx(ki,{className:"w-4 h-4 mr-1 text-blue-600"}),"Nouvelle ",k==="SALE"?"Vente":"Facture d'Achat"]})}),i.jsx("button",{onClick:()=>P(!1),className:"text-slate-400 hover:text-red-500 bg-white p-1 rounded-full hover:bg-red-50 transition-colors",children:i.jsx(Vt,{className:"w-5 h-5"})})]}),k==="PURCHASE"&&i.jsxs("div",{className:"bg-blue-100 border-b border-blue-200 px-4 py-2 text-xs text-blue-800 flex items-center shrink-0",children:[i.jsx(Hh,{className:"w-4 h-4 mr-2 flex-shrink-0"}),i.jsxs("span",{children:["Cette facture sera comptabilisée dans l'activité globale (Chiffre d'Affaires/Volume), mais ",i.jsx("strong",{children:`n'impactera la caisse que si vous saisissez un "Montant Versé" ci-dessous`}),"."]})]}),i.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden bg-slate-50/30",children:[i.jsx("div",{className:"bg-white p-2 border-b border-slate-200 shrink-0 shadow-sm z-20",children:i.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[i.jsx("div",{className:"w-full md:w-48",children:i.jsxs("select",{className:"w-full h-9 px-2 border border-slate-300 rounded-lg bg-slate-50 focus:ring-1 focus:ring-indigo-500 text-sm font-medium",value:y,onChange:B=>ke(B.target.value),children:[i.jsxs("option",{value:"",children:["-- ",k==="SALE"?"Client":"Fournisseur"," --"]}),k==="SALE"?a.map(B=>i.jsx("option",{value:B.id,children:B.name},B.id)):o.map(B=>i.jsx("option",{value:B.id,children:B.name},B.id))]})}),i.jsxs("div",{className:"flex-1 flex gap-1 relative",ref:re,children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(Xn,{className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-400 w-3 h-3"}),i.jsx("input",{ref:Be,type:"text",placeholder:"Produit (Nom / SKU)...",className:"w-full h-9 pl-7 pr-2 border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20 text-sm",value:N,onChange:et,onKeyDown:st,onFocus:()=>{N&&v(!0)},autoComplete:"off"}),g&&i.jsx("div",{className:"absolute top-full left-0 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-xl max-h-60 overflow-y-auto z-50",children:ze.length===0?i.jsx("div",{className:"p-2 text-center text-slate-400 text-xs",children:"Aucun produit"}):ze.map((B,ie)=>i.jsxs("button",{className:`w-full text-left px-3 py-1.5 border-b border-slate-50 last:border-0 flex justify-between items-center group transition-colors ${ie===S?"bg-indigo-100":"hover:bg-indigo-50"}`,onClick:()=>ft(B),children:[i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("span",{className:"font-bold text-slate-800 block text-xs truncate",children:B.name}),i.jsx("span",{className:"text-[10px] text-slate-500 font-mono",children:B.sku})]}),i.jsxs("div",{className:"text-right ml-2",children:[i.jsx("span",{className:"font-bold text-indigo-600 block text-xs",children:Ze(B.price)}),i.jsxs("span",{className:`text-[10px] ${B.quantity>0?"text-emerald-600":"text-red-500"}`,children:["Stock: ",B.quantity]})]})]},B.id))})]}),i.jsx("input",{type:"number",min:"0",className:"w-14 h-9 px-1 border border-indigo-200 rounded-lg text-center font-bold text-sm",value:H,onChange:B=>Q(parseInt(B.target.value)||0),placeholder:"Qté",onKeyDown:B=>B.key==="Enter"&&yt()}),i.jsx("button",{onClick:yt,disabled:!D,className:"bg-indigo-600 text-white w-9 h-9 rounded-lg hover:bg-indigo-700 disabled:opacity-50 flex items-center justify-center shadow-sm shrink-0",children:i.jsx(Qs,{className:"w-5 h-5"})})]})]})}),i.jsx("div",{className:"flex-1 overflow-auto bg-white p-0",children:i.jsxs("table",{className:"w-full text-left border-collapse",children:[i.jsx("thead",{className:"bg-slate-100 text-slate-500 sticky top-0 z-10 shadow-sm text-[10px] uppercase font-bold",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-3 py-2",children:"Produit"}),i.jsx("th",{className:"px-3 py-2 text-center",children:"Qté"}),i.jsx("th",{className:"px-3 py-2 text-right",children:"P.U."}),i.jsx("th",{className:"px-3 py-2 text-right",children:"Total"}),i.jsx("th",{className:"px-2 py-2 w-8"})]})}),i.jsxs("tbody",{className:"divide-y divide-slate-100 text-sm",children:[U.map((B,ie)=>i.jsxs("tr",{className:"hover:bg-slate-50 group",children:[i.jsx("td",{className:"px-3 py-1.5 font-medium text-slate-800",children:B.productName}),i.jsx("td",{className:"px-3 py-1.5 text-center font-mono",children:B.quantity}),i.jsx("td",{className:"px-3 py-1.5 text-right text-slate-500",children:Ze(B.unitPrice)}),i.jsx("td",{className:"px-3 py-1.5 text-right font-bold text-slate-800",children:Ze(B.unitPrice*B.quantity)}),i.jsx("td",{className:"px-2 py-1.5 text-center",children:i.jsx("button",{onClick:()=>Qe(ie),className:"text-slate-300 hover:text-red-500 transition-colors",children:i.jsx(Vs,{className:"w-4 h-4"})})})]},ie)),U.length===0&&i.jsx("tr",{children:i.jsxs("td",{colSpan:5,className:"py-20 text-center text-slate-400 italic",children:[i.jsx(Dh,{className:"w-12 h-12 mx-auto mb-2 opacity-20"}),"Panier vide. Ajoutez des produits ci-dessus."]})})]})]})})]}),i.jsx("div",{className:"bg-slate-100 border-t border-slate-200 p-2 shrink-0",children:i.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-3",children:[i.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto justify-between md:justify-start px-2",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Total Facture (Activité)"}),i.jsx("span",{className:`text-xl md:text-2xl font-bold ${k==="PURCHASE"?"text-blue-700":"text-indigo-700"}`,children:Ze(ut)})]}),i.jsx("div",{className:"h-8 w-px bg-slate-300 hidden md:block"}),i.jsxs("div",{className:"text-xs text-slate-500 hidden md:block",children:[U.reduce((B,ie)=>B+ie.quantity,0)," Articles"]})]}),i.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto bg-white p-1.5 rounded-xl border border-slate-200 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-2 px-2 border-r border-slate-100 pr-3",children:[i.jsxs("div",{className:"flex flex-col items-end",children:[i.jsxs("label",{className:"text-[9px] font-bold text-slate-400 uppercase flex items-center",children:[i.jsx(Fr,{className:"w-3 h-3 mr-1 text-slate-400"}),k==="PURCHASE"?"Règlement (Caisse)":"Versement"]}),i.jsx("div",{className:"relative w-28",children:i.jsx("input",{type:"number",className:"w-full text-right font-bold text-slate-800 text-sm bg-transparent outline-none border-b border-slate-200 focus:border-indigo-500 p-0.5",value:Y,onChange:B=>Fe(B.target.value),placeholder:k==="SALE"?Se.toFixed(0):"0 (Non payé)"})})]}),i.jsxs("div",{className:"flex flex-col items-end",children:[i.jsx("label",{className:"text-[9px] font-bold text-slate-400 uppercase",children:"Reste Dû"}),i.jsx("span",{className:`text-sm font-mono font-bold ${lt>.01?"text-red-600":"text-emerald-600"}`,children:Ze(lt/s.rate)})]})]}),i.jsxs("button",{onClick:Et,disabled:U.length===0,className:`px-4 py-2 rounded-lg text-white font-bold text-sm shadow-md transition-all flex items-center whitespace-nowrap
                                ${U.length>0?k==="SALE"?"bg-emerald-600 hover:bg-emerald-700":"bg-blue-600 hover:bg-blue-700":"bg-slate-300 cursor-not-allowed"}`,children:[i.jsx(Ur,{className:"w-4 h-4 mr-1.5"}),"Valider"]})]})]})})]})}),Re&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/90 backdrop-blur-md flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-8 text-center animate-fade-in-up border-b-4 border-red-600 relative",children:[i.jsx("button",{onClick:()=>Xe(!1),className:"absolute top-3 right-3 text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"w-6 h-6"})}),i.jsx("div",{className:"w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner",children:i.jsx(bn,{className:"w-10 h-10 text-red-600"})}),i.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Caisse actuellement clôturée"}),i.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200 mb-6 mt-4",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Réouverture automatique"}),i.jsx("span",{className:"font-mono font-bold text-slate-800",children:Ee==null?void 0:Ee.reopeningTime})]}),i.jsxs("div",{className:"border-t border-slate-200 pt-2 flex justify-between items-center",children:[i.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Temps restant"}),i.jsx("span",{className:"font-bold text-indigo-600",children:Ee==null?void 0:Ee.remainingText})]})]}),i.jsx("button",{onClick:()=>Xe(!1),className:"w-full py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition-colors",children:"OK"})]})})]})},TN=["Directeur Général","Directeur Commercial","Directeur Financier","Directeur RH","Manager","Chef d'équipe","Superviseur","Vendeur","Conseiller Clientèle","Commercial","Caissier","Comptable","Assistant Comptable","Auditeur","Secrétaire","Assistant Administratif","Office Manager","Magasinier","Préparateur de commandes","Logisticien","Responsable Stock","Livreur","Chauffeur","Technicien","Développeur","Ingénieur","Informaticien","Agent de sécurité","Agent d'entretien","Stagiaire","Apprenti"],SN=["Direction Générale","Ressources Humaines (RH)","Comptabilité & Finance","Commercial & Vente","Marketing & Communication","Logistique & Approvisionnement","Informatique & Technique (IT)","Service Après-Vente (SAV)","Juridique","Sécurité & Entretien"],AN=({employees:n,currency:e,onAddEmployee:t,onUpdateEmployee:s,onDeleteEmployee:r,onPaySalary:a})=>{const[o,c]=w.useState(new Date().toISOString().slice(0,7)),[u,h]=w.useState(!1),[f,p]=w.useState(null),[_,A]=w.useState(!1),[P,k]=w.useState(null),[T,U]=w.useState(0),[K,D]=w.useState(""),[$,H]=w.useState(""),[Q,N]=w.useState(""),[b,g]=w.useState(""),[v,S]=w.useState(""),[E,y]=w.useState(""),[ke,Y]=w.useState(""),[Fe,J]=w.useState(0),[_e,Ce]=w.useState(new Date().toISOString().split("T")[0]),[Re,Xe]=w.useState(void 0),[Ee,Ne]=w.useState("M"),[W,ue]=w.useState(""),[Te,ye]=w.useState(""),[re,Be]=w.useState(0),[Ze,ze]=w.useState("SINGLE"),[de,dt]=w.useState(""),[et,st]=w.useState(""),[ft,yt]=w.useState(""),[Qe,ot]=w.useState(!1),[Et,ut]=w.useState(!1),[Se,oe]=w.useState(null),[lt,B]=w.useState("CONTRACT"),[ie,ve]=w.useState(""),nt=w.useRef(null),M=w.useRef(null),ge=w.useRef(null),De=w.useRef(null);w.useEffect(()=>{function V(j){ge.current&&!ge.current.contains(j.target)&&ot(!1),De.current&&!De.current.contains(j.target)&&ut(!1)}return document.addEventListener("mousedown",V),()=>document.removeEventListener("mousedown",V)},[]);const fe=w.useMemo(()=>{const V=n.map(se=>se.jobTitle).filter(Boolean),j=n.map(se=>se.department).filter(Boolean);return{titles:Array.from(new Set([...TN,...V])).sort(),departments:Array.from(new Set([...SN,...j])).sort()}},[n]),xe=fe.titles.filter(V=>V&&V.toLowerCase().includes(Q.toLowerCase())),Qt=fe.departments.filter(V=>V&&V.toLowerCase().includes(b.toLowerCase())),Rt=V=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:e.code,minimumFractionDigits:e.code==="XOF"?0:2,maximumFractionDigits:e.code==="XOF"?0:2}).format(V*e.rate),ts=()=>{p(null),H(""),N(""),g(""),S(""),y(""),Y(""),J(0),Ce(new Date().toISOString().split("T")[0]),Xe(void 0),Ne("M"),ue(""),ye(""),Be(0),ze("SINGLE"),dt(""),st(""),yt("")},ss=()=>{ts(),h(!0)},Lt=V=>{var j,se,be;p(V.id),H(V.fullName),N(V.jobTitle),g(V.department||""),S(V.phone||""),y(V.email||""),Y(V.address||""),J(V.baseSalary),Ce(V.hireDate),Xe(V.photo),Ne(V.gender||"M"),ue(V.birthDate||""),ye(V.residence||""),Be(V.childrenCount||0),ze(V.maritalStatus||"SINGLE"),dt(((j=V.emergencyContact)==null?void 0:j.name)||""),st(((se=V.emergencyContact)==null?void 0:se.relationship)||""),yt(((be=V.emergencyContact)==null?void 0:be.phone)||""),h(!0)},G=V=>{window.confirm("Êtes-vous sûr de vouloir supprimer cet employé ? Son dossier sera effacé.")&&r(V)},Je=V=>{var be;const j=(be=V.target.files)==null?void 0:be[0];if(!j)return;const se=new FileReader;se.onload=pt=>{var Ve;Xe((Ve=pt.target)==null?void 0:Ve.result)},se.readAsDataURL(j)},qe=V=>{V.preventDefault();const j=Fe/e.rate,se={fullName:$,jobTitle:Q,department:b,phone:v,email:E,address:ke,baseSalary:j,hireDate:_e,photo:Re,gender:Ee,birthDate:W,residence:Te,childrenCount:re,maritalStatus:Ze,emergencyContact:{name:de,relationship:et,phone:ft}};if(f)s(f,se);else{const be=Ue(je({},se),{id:`emp-${Date.now()}`,documents:[]});t(be)}h(!1)},Ke=V=>{var be;const j=(be=V.target.files)==null?void 0:be[0];if(!j||!Se)return;if(j.size>5*1024*1024){alert("Le fichier est trop volumineux (Max 5Mo).");return}const se=new FileReader;se.onload=pt=>{var us;const Ve=(us=pt.target)==null?void 0:us.result,Yt={id:`doc-${Date.now()}`,name:ie||j.name,type:lt,date:new Date().toISOString(),content:Ve},cs=[...Se.documents||[],Yt];s(Se.id,{documents:cs}),oe(Ue(je({},Se),{documents:cs})),ve(""),M.current&&(M.current.value="")},se.readAsDataURL(j)},vt=V=>{if(Se&&window.confirm("Supprimer ce document ?")){const j=(Se.documents||[]).filter(se=>se.id!==V);s(Se.id,{documents:j}),oe(Ue(je({},Se),{documents:j}))}},He=V=>{const j=window.open();j&&j.document.write(`<iframe src="${V.content}" frameborder="0" style="border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;" allowfullscreen></iframe>`)},Tt=V=>{k(V),U(0),D(o),A(!0)},Jt=()=>{if(!P)return;const j=P.baseSalary*e.rate+T;a(P,j,K),A(!1),k(null),alert(`Salaire de ${P.fullName} enregistré !`)};return i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsxs("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-bold text-slate-800 flex items-center",children:[i.jsx(yl,{className:"w-8 h-8 text-indigo-600 mr-3"}),"Gestion des Employés"]}),i.jsx("p",{className:"text-slate-500 mt-2",children:"Dossiers du personnel et gestion de paie."})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsxs("div",{className:"flex items-center space-x-2 bg-white p-2 rounded-xl shadow-sm border border-slate-100",children:[i.jsx(vl,{className:"w-5 h-5 text-slate-400 ml-2"}),i.jsx("span",{className:"text-sm font-medium text-slate-600 hidden sm:inline",children:"Paie du mois :"}),i.jsx("input",{type:"month",value:o,onChange:V=>c(V.target.value),className:"border-none bg-transparent font-bold text-slate-800 focus:ring-0 cursor-pointer"})]}),i.jsxs("button",{onClick:ss,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-xl font-medium flex items-center shadow-lg shadow-indigo-200 transition-colors",children:[i.jsx(Qs,{className:"w-5 h-5 mr-2"})," Nouvel Employé"]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[n.map(V=>i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden flex flex-col group relative",children:[i.jsxs("div",{className:"p-6 flex items-start space-x-4",children:[i.jsx("div",{className:"relative cursor-pointer",onClick:()=>oe(V),children:i.jsx("img",{src:V.photo||`https://ui-avatars.com/api/?name=${encodeURIComponent(V.fullName)}&background=random&color=fff`,alt:V.fullName,className:"w-16 h-16 rounded-full object-cover border-2 border-slate-100"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("h3",{className:"text-lg font-bold text-slate-800",children:V.fullName}),i.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[i.jsx("button",{onClick:()=>Lt(V),className:"p-1 text-slate-400 hover:text-indigo-600",children:i.jsx(Wi,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>G(V.id),className:"p-1 text-slate-400 hover:text-red-600",children:i.jsx(Vs,{className:"w-4 h-4"})})]})]}),i.jsxs("p",{className:"text-sm text-indigo-600 font-medium",children:[V.jobTitle," ",i.jsxs("span",{className:"text-slate-400 font-normal",children:["• ",V.department||"Général"]})]}),i.jsxs("div",{className:"mt-3 flex flex-wrap gap-3 text-xs text-slate-500",children:[V.phone&&i.jsxs("span",{className:"flex items-center",children:[i.jsx(Di,{className:"w-3 h-3 mr-1"})," ",V.phone]}),V.hireDate&&i.jsxs("span",{className:"flex items-center",children:[i.jsx(vl,{className:"w-3 h-3 mr-1"})," Embauche: ",new Date(V.hireDate).toLocaleDateString()]})]})]}),i.jsxs("button",{onClick:()=>oe(V),className:"p-2 bg-slate-50 hover:bg-indigo-50 text-slate-600 hover:text-indigo-600 rounded-lg transition-colors flex flex-col items-center text-[10px] font-bold",children:[i.jsx(Cs,{className:"w-5 h-5 mb-1"}),"Dossier"]})]}),i.jsxs("div",{className:"bg-slate-50 p-4 border-t border-slate-100 flex items-center justify-between",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-xs text-slate-500 font-bold uppercase",children:"Salaire Fixe"}),i.jsx("span",{className:"text-xl font-bold text-slate-700",children:Rt(V.baseSalary)})]}),i.jsxs("button",{onClick:()=>Tt(V),className:"bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-xl text-sm font-bold flex items-center transition-colors shadow-lg shadow-emerald-200",children:[i.jsx(Fr,{className:"w-4 h-4 mr-2"}),"Payer"]})]})]},V.id)),n.length===0&&i.jsx("div",{className:"col-span-full py-12 text-center text-slate-400 bg-white rounded-2xl border border-dashed border-slate-200",children:i.jsx("p",{children:"Aucun employé enregistré."})})]}),_&&P&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in-up",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-slate-100 pb-4",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"bg-emerald-100 p-2 rounded-full text-emerald-600",children:i.jsx(Fr,{className:"w-6 h-6"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Paiement Salaire"}),i.jsx("p",{className:"text-xs text-slate-500",children:P.fullName})]})]}),i.jsx("button",{onClick:()=>A(!1),className:"text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Mois de paie"}),i.jsx("input",{type:"month",className:"w-full px-3 py-2 border border-slate-200 rounded-lg bg-slate-50 font-bold text-slate-800",value:K,onChange:V=>D(V.target.value)})]}),i.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100 space-y-3",children:[i.jsxs("div",{className:"flex justify-between items-center text-sm",children:[i.jsx("span",{className:"text-slate-600",children:"Salaire de Base"}),i.jsx("span",{className:"font-bold text-slate-800",children:Rt(P.baseSalary)})]}),i.jsxs("div",{className:"flex justify-between items-center text-sm",children:[i.jsxs("span",{className:"text-slate-600 flex items-center",children:[i.jsx(Qs,{className:"w-3 h-3 mr-1"})," Prime / Bonus"]}),i.jsx("div",{className:"relative w-32",children:i.jsx("input",{type:"number",min:"0",className:"w-full px-2 py-1 text-right border border-indigo-200 rounded bg-white font-medium focus:ring-1 focus:ring-indigo-500 text-slate-900",value:T,onChange:V=>U(parseFloat(V.target.value)||0)})})]}),i.jsxs("div",{className:"border-t border-slate-200 pt-2 flex justify-between items-center text-lg font-bold",children:[i.jsx("span",{className:"text-indigo-900",children:"Total à Payer"}),i.jsx("span",{className:"text-emerald-600",children:Rt(P.baseSalary+T/e.rate)})]})]}),i.jsx("p",{className:"text-xs text-slate-400 text-center",children:"Cela créera une dépense et un mouvement de sortie de caisse automatiquement."}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-2",children:[i.jsx("button",{onClick:()=>A(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-medium",children:"Annuler"}),i.jsxs("button",{onClick:Jt,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 shadow-md flex items-center",children:[i.jsx(Ur,{className:"w-4 h-4 mr-2"}),"Confirmer le paiement"]})]})]})]})}),u&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl p-6 animate-fade-in-up my-8 max-h-[90vh] overflow-y-auto",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-6 border-b border-slate-100 pb-4",children:f?"Modifier la fiche employé":"Nouvel Employé"}),i.jsxs("form",{onSubmit:qe,className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("h4",{className:"text-xs font-bold text-indigo-600 uppercase flex items-center border-b border-indigo-50 pb-2",children:[i.jsx(yl,{className:"w-4 h-4 mr-1"})," Identité & Poste"]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nom complet"}),i.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20 bg-white text-slate-900",value:$,onChange:V=>H(V.target.value)})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Photo"}),i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center overflow-hidden border border-slate-200",children:Re?i.jsx("img",{src:Re,className:"w-full h-full object-cover"}):i.jsx(vs,{className:"w-5 h-5 text-slate-300"})}),i.jsxs("button",{type:"button",onClick:()=>{var V;return(V=nt.current)==null?void 0:V.click()},className:"text-xs bg-slate-100 hover:bg-slate-200 text-slate-700 px-3 py-2 rounded-lg",children:[i.jsx(lc,{className:"w-3 h-3 inline mr-1"})," Changer"]}),i.jsx("input",{type:"file",ref:nt,className:"hidden",accept:"image/*",onChange:Je})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"relative",ref:ge,children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Poste / Titre"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-slate-200 rounded-lg pr-8 bg-white text-slate-900",value:Q,onChange:V=>{N(V.target.value),ot(!0)},onFocus:()=>ot(!0),placeholder:"Ex: Magasinier",autoComplete:"off"}),i.jsx(Za,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]}),Qe&&i.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-xl max-h-48 overflow-y-auto",children:xe.length>0?xe.map(V=>i.jsx("div",{onClick:()=>{N(V||""),ot(!1)},className:"px-3 py-2 hover:bg-indigo-50 cursor-pointer text-sm text-slate-700",children:V},V)):i.jsx("div",{className:"px-3 py-2 text-xs text-slate-400 italic",children:"Aucune suggestion (saisie libre)"})})]}),i.jsxs("div",{className:"relative",ref:De,children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Département"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-slate-200 rounded-lg pr-8 bg-white text-slate-900",value:b,onChange:V=>{g(V.target.value),ut(!0)},onFocus:()=>ut(!0),placeholder:"Ex: Logistique",autoComplete:"off"}),i.jsx(Za,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]}),Et&&i.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-xl max-h-48 overflow-y-auto",children:Qt.length>0?Qt.map(V=>i.jsx("div",{onClick:()=>{g(V||""),ut(!1)},className:"px-3 py-2 hover:bg-indigo-50 cursor-pointer text-sm text-slate-700",children:V},V)):i.jsx("div",{className:"px-3 py-2 text-xs text-slate-400 italic",children:"Aucune suggestion"})})]})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("h4",{className:"text-xs font-bold text-indigo-600 uppercase flex items-center border-b border-indigo-50 pb-2",children:[i.jsx(so,{className:"w-4 h-4 mr-1"})," Contrat & Salaire"]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Salaire Fixe (",e.code,")"]}),i.jsx("input",{type:"number",min:"0",className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-lg font-bold bg-white text-slate-900",value:Fe,onChange:V=>J(parseFloat(V.target.value))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Date d'embauche"}),i.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-slate-200 rounded-lg bg-white text-slate-900",value:_e,onChange:V=>Ce(V.target.value)})]})]})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("h4",{className:"text-xs font-bold text-indigo-600 uppercase flex items-center border-b border-indigo-50 pb-2",children:[i.jsx(vs,{className:"w-4 h-4 mr-1"})," Infos Personnelles"]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Sexe"}),i.jsxs("select",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg bg-white text-slate-900",value:Ee,onChange:V=>Ne(V.target.value),children:[i.jsx("option",{value:"M",children:"Masculin"}),i.jsx("option",{value:"F",children:"Féminin"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Date de Naissance"}),i.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-slate-200 rounded-lg bg-white text-slate-900",value:W,onChange:V=>ue(V.target.value)})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Situation"}),i.jsxs("select",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg bg-white text-slate-900",value:Ze,onChange:V=>ze(V.target.value),children:[i.jsx("option",{value:"SINGLE",children:"Célibataire"}),i.jsx("option",{value:"MARRIED",children:"Marié(e)"}),i.jsx("option",{value:"DIVORCED",children:"Divorcé(e)"}),i.jsx("option",{value:"WIDOWED",children:"Veuf/Veuve"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Enfants"}),i.jsxs("div",{className:"relative",children:[i.jsx(Fu,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),i.jsx("input",{type:"number",min:"0",className:"w-full pl-9 px-3 py-2 border border-slate-200 rounded-lg bg-white text-slate-900",value:re,onChange:V=>Be(parseInt(V.target.value)||0)})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Lieu d'habitation"}),i.jsxs("div",{className:"relative",children:[i.jsx(Oh,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),i.jsx("input",{type:"text",className:"w-full pl-9 px-3 py-2 border border-slate-200 rounded-lg bg-white text-slate-900",value:Te,onChange:V=>ye(V.target.value),placeholder:"Quartier, Ville"})]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"relative",children:[i.jsx(Di,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),i.jsx("input",{type:"text",className:"w-full pl-9 px-3 py-2 border border-slate-200 rounded-lg bg-white text-slate-900",value:v,onChange:V=>S(V.target.value),placeholder:"Téléphone"})]}),i.jsxs("div",{className:"relative",children:[i.jsx(To,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),i.jsx("input",{type:"email",className:"w-full pl-9 px-3 py-2 border border-slate-200 rounded-lg bg-white text-slate-900",value:E,onChange:V=>y(V.target.value),placeholder:"Email"})]})]})]}),i.jsxs("div",{className:"bg-red-50 p-4 rounded-xl border border-red-100 space-y-4",children:[i.jsxs("h4",{className:"text-xs font-bold text-red-600 uppercase flex items-center",children:[i.jsx(cc,{className:"w-4 h-4 mr-1"})," Contact d'Urgence"]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-red-800 mb-1",children:"Nom du contact"}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-red-200 rounded-lg bg-white text-slate-900",value:de,onChange:V=>dt(V.target.value),placeholder:"Nom complet"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-red-800 mb-1",children:"Lien de parenté"}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-red-200 rounded-lg bg-white text-slate-900",value:et,onChange:V=>st(V.target.value),placeholder:"Epouse, Père..."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-red-800 mb-1",children:"Téléphone"}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-red-200 rounded-lg bg-white text-slate-900",value:ft,onChange:V=>yt(V.target.value),placeholder:"Numéro"})]})]})]})]})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-slate-100",children:[i.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Annuler"}),i.jsx("button",{type:"submit",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 shadow-md",children:f?"Mettre à jour":"Enregistrer"})]})]})]})}),Se&&i.jsx("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl p-6 animate-fade-in-up",children:[i.jsxs("div",{className:"flex justify-between items-start mb-6",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx("img",{src:Se.photo||`https://ui-avatars.com/api/?name=${encodeURIComponent(Se.fullName)}`,className:"w-20 h-20 rounded-full object-cover border-4 border-indigo-50"}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-2xl font-bold text-slate-800",children:Se.fullName}),i.jsx("p",{className:"text-slate-500 font-medium",children:Se.jobTitle}),i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsxs("span",{className:"text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded",children:["Embauche: ",new Date(Se.hireDate).toLocaleDateString()]}),Se.birthDate&&i.jsxs("span",{className:"text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded flex items-center",children:[i.jsx(Fu,{className:"w-3 h-3 mr-1"}),"Né(e) le: ",new Date(Se.birthDate).toLocaleDateString()]})]})]})]}),i.jsx("button",{onClick:()=>oe(null),className:"p-2 text-slate-400 hover:bg-slate-100 rounded-full",children:i.jsx(Vt,{className:"w-6 h-6"})})]}),i.jsxs("div",{className:"bg-slate-50 rounded-xl p-6 border border-slate-100",children:[i.jsxs("h4",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center",children:[i.jsx(Cs,{className:"w-5 h-5 mr-2 text-indigo-600"}),"Documents & Pièces Jointes"]}),i.jsxs("div",{className:"space-y-3 mb-6",children:[(Se.documents||[]).map(V=>i.jsxs("div",{className:"bg-white p-3 rounded-lg border border-slate-200 flex items-center justify-between group hover:border-indigo-300 transition-colors",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"bg-indigo-50 p-2 rounded text-indigo-600",children:i.jsx(Cs,{className:"w-5 h-5"})}),i.jsxs("div",{children:[i.jsx("p",{className:"font-bold text-slate-700 text-sm",children:V.name}),i.jsxs("p",{className:"text-xs text-slate-400",children:[V.type," • ",new Date(V.date).toLocaleDateString()]})]})]}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("button",{onClick:()=>He(V),className:"p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"Voir",children:i.jsx(en,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>vt(V.id),className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Supprimer",children:i.jsx(Vs,{className:"w-4 h-4"})})]})]},V.id)),(!Se.documents||Se.documents.length===0)&&i.jsx("p",{className:"text-center text-slate-400 text-sm py-4 italic",children:"Aucun document archivé."})]}),i.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[i.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase mb-3",children:"Ajouter un document"}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[i.jsxs("select",{value:lt,onChange:V=>B(V.target.value),className:"px-3 py-2 border border-slate-200 rounded-lg text-sm bg-white text-slate-900",children:[i.jsx("option",{value:"CONTRACT",children:"Contrat"}),i.jsx("option",{value:"ID",children:"Pièce d'identité"}),i.jsx("option",{value:"CV",children:"CV / Diplôme"}),i.jsx("option",{value:"RIB",children:"RIB"}),i.jsx("option",{value:"OTHER",children:"Autre"})]}),i.jsx("input",{type:"text",placeholder:"Nom du fichier...",value:ie,onChange:V=>ve(V.target.value),className:"flex-1 px-3 py-2 border border-slate-200 rounded-lg text-sm bg-white text-slate-900"}),i.jsxs("button",{onClick:()=>{var V;return(V=M.current)==null?void 0:V.click()},className:"px-4 py-2 bg-slate-800 text-white rounded-lg text-sm font-bold flex items-center hover:bg-slate-900 transition-colors",children:[i.jsx(wl,{className:"w-4 h-4 mr-2"}),"Charger"]}),i.jsx("input",{type:"file",ref:M,onChange:Ke,className:"hidden"})]})]})]})]})})]})},pu=({message:n="Chargement..."})=>i.jsxs("div",{className:"fixed inset-0 z-[200] flex flex-col items-center justify-center bg-slate-900/60 backdrop-blur-md transition-all duration-300",children:[i.jsxs("div",{className:"relative mb-6",children:[i.jsx("div",{className:"w-16 h-16 rounded-full border-4 border-white/20"}),i.jsx("div",{className:"absolute top-0 left-0 w-16 h-16 rounded-full border-4 border-white border-t-transparent animate-spin"})]}),i.jsx("p",{className:"text-white font-medium text-lg tracking-wide animate-pulse",children:n})]}),jN=({users:n,onLogin:e,onCreateStore:t,storeName:s,storeLogo:r,onDeleteStore:a,availableStores:o,currentStoreId:c,onSelectStore:u,onFindStore:h,onAddKnownStore:f,onVerifyRecoveryInfo:p,onResetPassword:_,lang:A="fr",isDbConnected:P,onSetupDb:k})=>{const[T,U]=w.useState(""),[K,D]=w.useState(""),[$,H]=w.useState(""),[Q,N]=w.useState(!1),[b,g]=w.useState(""),[v,S]=w.useState(!1),[E,y]=w.useState(!1),[ke,Y]=w.useState(!1),[Fe,J]=w.useState(1),[_e,Ce]=w.useState("CONTACT"),[Re,Xe]=w.useState(""),[Ee,Ne]=w.useState(""),[W,ue]=w.useState(""),[Te,ye]=w.useState(""),[re,Be]=w.useState(!1),[Ze,ze]=w.useState(""),[de,dt]=w.useState(""),[et,st]=w.useState(null),[ft,yt]=w.useState(!1),[Qe,ot]=w.useState(!1),[Et,ut]=w.useState(null),[Se,oe]=w.useState(""),[lt,B]=w.useState(""),[ie,ve]=w.useState(""),[nt,M]=w.useState(""),[ge,De]=w.useState(""),[fe,xe]=w.useState(""),[Qt,Rt]=w.useState(""),[ts,ss]=w.useState(""),[Lt,G]=w.useState(""),[Je,qe]=w.useState(""),[Ke,vt]=w.useState(""),[He,Tt]=w.useState(""),[Jt,V]=w.useState(""),[j,se]=w.useState(""),[be,pt]=w.useState(""),[Ve,Yt]=w.useState(""),[cs,us]=w.useState(""),[L,ee]=w.useState(""),[me,pe]=w.useState(void 0),[$e,Pt]=w.useState(""),[St,ct]=w.useState(""),[gs,Us]=w.useState(""),[Mt,Bs]=w.useState(null),[an,kn]=w.useState(!1),[Jo,Dn]=w.useState(!1),[Vn,hr]=w.useState(null),[on,Ts]=w.useState(""),[ni,fa]=w.useState(!1),[mr,pa]=w.useState(""),[ga,On]=w.useState(!1),[fr,ri]=w.useState(""),[ii,xa]=w.useState(""),[ba,ai]=w.useState(""),oi=w.useRef(null),qt=q=>Qi(A,q);w.useEffect(()=>{const q=localStorage.getItem("gesmind_last_username");U(q||""),D(""),H("")},[c]);const qs=q=>{q.preventDefault(),H(""),N(!0),g("Authentification..."),setTimeout(()=>{const wt=n.find(ns=>ns.name.toLowerCase()===T.toLowerCase()&&ns.pin===K);wt?(localStorage.setItem("gesmind_last_username",wt.name),e(wt)):(N(!1),H(qt("login_error")))},1500)},xs=()=>"REC-"+Math.random().toString(36).substring(2,10).toUpperCase(),pr=q=>{if(q.preventDefault(),St!==gs){alert("Les mots de passe ne correspondent pas.");return}if(St.length!==4){alert("Le code PIN doit comporter 4 chiffres.");return}if(!Ke||!$e||!Se){alert("Veuillez remplir les champs obligatoires (Nom Entreprise, Admin, Pseudo).");return}const wt=xs(),ns=new Date().toISOString(),ds={name:Ke,address:He,city:Jt,country:j,phone:cs,email:L,rccm:be,nif:Ve,logoUrl:me,recoveryKey:wt,language:"fr",cloudProvider:"NONE",themeMode:"light",themeColor:"#4f46e5",lastClosingDate:ns,githubRepo:"guyzomahi-cloud/Gesmind"},br={id:`u-${Date.now()}`,name:$e,role:"ADMIN",pin:St,avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent($e)}&background=6366f1&color=fff`,commissionRate:0,permissions:[],email:Je,phone:Lt,lastLogin:ns},Un={id:`emp-${Date.now()}`,fullName:`${lt} ${Se}`.trim(),jobTitle:"Directeur Général",department:"Direction Générale",email:Je,phone:Lt,address:ge,city:fe,country:Qt,zipCode:ts,birthDate:ie,placeOfBirth:nt,residence:`${ge} ${fe}`,baseSalary:0,hireDate:ns.split("T")[0],documents:[]};P?(t(ds,br,Un),S(!1),li()):(Bs({settings:ds,user:br,employee:Un}),S(!1),yt(!0))},gr=q=>I(Me,null,function*(){if(q.preventDefault(),dt(""),st(null),!!Ze){N(!0),g("Recherche de l'entreprise...");try{const wt=yield h(Ze);yield new Promise(ns=>setTimeout(ns,800)),wt?st(wt):dt("ID introuvable.")}catch(wt){dt("Erreur de connexion.")}finally{N(!1)}}}),_a=()=>I(Me,null,function*(){et&&f&&(N(!0),g("Connexion à la boutique..."),yield new Promise(q=>setTimeout(q,1e3)),f(et),y(!1),st(null),ze(""),N(!1))}),rt=()=>{Y(!1),J(1),Xe(""),Ne(""),ue(""),ye(""),Be(!1)},xr=q=>{if(q.preventDefault(),ye(""),!p)return;if(!Re.trim()){ye("Veuillez remplir le champ.");return}p(_e,Re)?J(2):ye("Info incorrecte.")},Ln=q=>{if(q.preventDefault(),ye(""),!!_){if(Ee.length!==4||Ee!==W){ye("Code PIN invalide ou ne correspond pas.");return}_(Ee)?(Be(!0),setTimeout(()=>rt(),2e3)):ye("Erreur.")}},Mn=()=>{c&&(navigator.clipboard.writeText(c),fa(!0),setTimeout(()=>fa(!1),2e3))},ya=q=>{yt(!1),q==="CLOUD"?(ot(!0),ut(null)):k("LOCAL")&&Mt&&(t(Mt.settings,Mt.user,Mt.employee),li(),Bs(null))},va=()=>{if(ut(null),!mr.trim().startsWith("{")){ut("Format JSON invalide.");return}k(mr)?(ot(!1),Mt&&(t(Mt.settings,Mt.user,Mt.employee),li(),Bs(null))):ut("Config invalide.")},li=()=>{oe(""),B(""),ve(""),M(""),De(""),xe(""),Rt(""),ss(""),G(""),qe(""),vt(""),Tt(""),V(""),se(""),pt(""),Yt(""),us(""),ee(""),Pt(""),ct(""),Us(""),pe(void 0)},Yo=q=>{var ds;const wt=(ds=q.target.files)==null?void 0:ds[0];if(!wt)return;if(wt.size>2*1024*1024){alert("Max 2Mo");return}const ns=new FileReader;ns.onload=br=>{var Un;return pe((Un=br.target)==null?void 0:Un.result)},ns.readAsDataURL(wt)},Xo=()=>{if(!Ke){alert("Entrez le nom de l'entreprise d'abord.");return}hr(null),Ts(""),kn(!0)},wa=()=>I(Me,null,function*(){Dn(!0);try{const q=yield tm(Ke,on);if(q){const wt=btoa(unescape(encodeURIComponent(q)));hr(`data:image/svg+xml;base64,${wt}`)}}catch(q){alert(`Erreur: ${q.message||"Connexion requise."}`),kn(!1)}finally{Dn(!1)}}),Fn=()=>{Vn&&pe(Vn),kn(!1)},Ss=q=>{q.preventDefault(),ai(""),a&&a(fr,ii)?(On(!1),ri(""),xa(""),alert("Supprimé.")):ai("Identifiants incorrects.")};return i.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-900 p-4 font-sans relative",children:[Q&&i.jsx(pu,{message:b}),i.jsx("div",{className:"absolute top-4 left-4 z-20 flex gap-2",children:o.length>0?i.jsx("div",{className:"relative group",children:i.jsxs("div",{className:"flex items-center space-x-2 bg-slate-800/50 backdrop-blur-md border border-slate-700 rounded-xl px-3 py-2 text-white cursor-pointer hover:bg-slate-800 transition-colors",children:[i.jsx(Rr,{className:"w-4 h-4 text-teal-400"}),i.jsx("select",{value:c||"",onChange:q=>u(q.target.value),className:"bg-transparent border-none outline-none text-sm font-medium appearance-none pr-6 cursor-pointer text-slate-200",style:{minWidth:"120px"},children:o.map(q=>i.jsx("option",{value:q.id,className:"text-slate-900 bg-white",children:q.name},q.id))}),i.jsx(Za,{className:"w-4 h-4 text-slate-400 absolute right-3 pointer-events-none"})]})}):i.jsxs("button",{onClick:()=>S(!0),className:"flex items-center space-x-2 bg-teal-600/20 backdrop-blur-md border border-teal-500/50 rounded-xl px-3 py-2 text-teal-300 font-bold text-sm",children:[i.jsx(Uu,{className:"w-4 h-4"})," ",i.jsx("span",{children:"Créer Boutique"})]})}),i.jsxs("div",{className:"absolute top-4 right-4 z-20 flex items-center space-x-2 bg-slate-800/30 px-3 py-1.5 rounded-full border border-slate-700/30",children:[i.jsx("span",{className:`w-2 h-2 rounded-full ${P?"bg-emerald-500 animate-pulse":"bg-amber-500"}`}),i.jsx("span",{className:"text-[10px] text-slate-500 font-mono uppercase tracking-wider flex items-center",children:P?"Sécurisé":"Local"})]}),c&&i.jsxs("div",{className:"text-center mb-8 animate-fade-in flex flex-col items-center mt-12 sm:mt-0 justify-center group relative",children:[r?i.jsx("img",{src:r,className:"w-32 h-32 object-contain mb-4 drop-shadow-2xl"}):i.jsx("div",{className:"mb-4 p-6 bg-slate-800/50 rounded-full border border-slate-700 shadow-2xl backdrop-blur-sm",children:i.jsx(Rr,{className:"w-20 h-20 text-slate-300"})}),s&&i.jsx("h2",{className:"text-3xl font-bold text-white tracking-tight drop-shadow-md",children:s}),i.jsx("button",{onClick:Mn,className:"mt-2 text-[10px] text-slate-500 bg-slate-800/50 px-3 py-1 rounded-full border border-slate-700 opacity-70 hover:opacity-100 transition-all cursor-pointer flex items-center gap-2",children:ni?i.jsxs("span",{className:"text-emerald-400 font-bold flex items-center",children:[i.jsx(rl,{className:"w-3 h-3 mr-1"})," Copié !"]}):i.jsxs(i.Fragment,{children:["ID: ",i.jsx("span",{className:"font-mono text-teal-400 select-all",children:c})," ",i.jsx(Wh,{className:"w-3 h-3"})]})})]}),i.jsx("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden animate-fade-in-up",children:o.length>0?i.jsx("div",{className:"p-8",children:i.jsxs("form",{onSubmit:qs,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-2",children:qt("username")}),i.jsxs("div",{className:"relative",children:[i.jsx(vs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400"}),i.jsx("input",{type:"text",value:T,onChange:q=>U(q.target.value),className:"block w-full pl-10 pr-3 py-3 border border-slate-200 rounded-xl bg-slate-50 text-slate-900 focus:ring-2 focus:ring-teal-500/20 focus:border-teal-500",placeholder:"Votre pseudo",required:!0})]})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("label",{className:"block text-sm font-bold text-slate-900",children:qt("password")}),i.jsx("button",{type:"button",onClick:()=>Y(!0),className:"text-xs text-indigo-600 hover:text-indigo-800 font-medium",children:"Oublié ?"})]}),i.jsxs("div",{className:"relative",children:[i.jsx(bn,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400"}),i.jsx("input",{type:"password",value:K,onChange:q=>D(q.target.value),className:"block w-full pl-10 pr-3 py-3 border border-slate-200 rounded-xl bg-slate-50 text-slate-900 focus:ring-2 focus:ring-teal-500/20 focus:border-teal-500 font-mono tracking-widest",placeholder:"••••",required:!0})]})]}),$&&i.jsx("div",{className:"bg-red-50 text-red-600 text-sm p-3 rounded-lg flex items-center animate-pulse",children:i.jsx("span",{className:"font-medium",children:$})}),i.jsxs("button",{type:"submit",className:"w-full flex justify-center py-3.5 px-4 border border-transparent rounded-xl shadow-lg shadow-teal-200 text-sm font-bold text-white bg-gradient-to-r from-teal-500 to-blue-600 hover:from-teal-600 hover:to-blue-700 transition-all transform hover:scale-[1.02]",children:[i.jsx(Pg,{className:"w-5 h-5 mr-2"})," ",qt("login_button")]})]})}):i.jsxs("div",{className:"p-12 text-center text-slate-500 flex flex-col gap-4",children:[i.jsx(il,{className:"w-16 h-16 mx-auto mb-2 text-slate-300"}),i.jsx("p",{children:qt("no_store")}),i.jsx("button",{onClick:()=>y(!0),className:"bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 shadow-lg",children:"Rejoindre (ID)"}),i.jsxs("div",{className:"relative my-2",children:[i.jsx("div",{className:"absolute inset-0 flex items-center",children:i.jsx("span",{className:"w-full border-t border-slate-200"})}),i.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:i.jsx("span",{className:"bg-white px-2 text-slate-400",children:"ou"})})]}),i.jsx("button",{onClick:()=>S(!0),className:"bg-slate-100 text-slate-600 px-6 py-3 rounded-xl font-bold hover:bg-slate-200",children:qt("create_first_store")})]})}),o.length>0&&i.jsxs("div",{className:"mt-6 w-full max-w-md flex flex-col items-center gap-4 z-10 px-2",children:[i.jsxs("div",{className:"flex justify-between w-full",children:[i.jsxs("button",{onClick:()=>y(!0),className:"flex items-center text-slate-500 hover:text-white hover:bg-white/10 transition-all py-1.5 px-3 rounded-full text-xs opacity-70 hover:opacity-100",children:[i.jsx(Xn,{className:"w-3 h-3 mr-1.5"})," Trouver"]}),i.jsxs("button",{onClick:()=>S(!0),className:"flex items-center text-slate-500 hover:text-white hover:bg-white/10 transition-all py-1.5 px-3 rounded-full text-xs opacity-70 hover:opacity-100",children:[i.jsx(Uu,{className:"w-3 h-3 mr-1.5"})," Créer Autre"]})]}),c&&i.jsxs("button",{onClick:()=>On(!0),className:"flex items-center text-[10px] text-slate-600 hover:text-red-400 font-medium transition-colors opacity-50 hover:opacity-100",children:[i.jsx(Vs,{className:"w-3 h-3 mr-1.5"})," ",qt("delete_store")]})]}),v&&i.jsx("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl p-6 animate-fade-in-up max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6 sticky top-0 bg-white z-10 py-2 border-b border-slate-100",children:[i.jsxs("div",{children:[i.jsxs("h3",{className:"text-xl font-bold text-slate-800 flex items-center",children:[i.jsx(il,{className:"w-6 h-6 mr-2 text-indigo-600"})," Nouvelle Entreprise"]}),i.jsx("p",{className:"text-sm text-slate-500",children:"Configuration complète de votre espace de travail."})]}),i.jsx("button",{onClick:()=>S(!1),className:"text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"w-6 h-6"})})]}),i.jsxs("form",{onSubmit:pr,className:"space-y-8",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("h4",{className:"text-sm font-bold text-indigo-900 uppercase tracking-wider border-b border-indigo-100 pb-2 flex items-center",children:[i.jsx(vs,{className:"w-4 h-4 mr-2"})," 1. Informations Personnelles (Administrateur)"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx("input",{type:"text",required:!0,placeholder:"Nom",className:"input-field",value:Se,onChange:q=>oe(q.target.value)}),i.jsx("input",{type:"text",required:!0,placeholder:"Prénom",className:"input-field",value:lt,onChange:q=>B(q.target.value)}),i.jsx("input",{type:"date",className:"input-field",value:ie,onChange:q=>ve(q.target.value),title:"Date de naissance"}),i.jsx("input",{type:"text",placeholder:"Lieu de naissance",className:"input-field",value:nt,onChange:q=>M(q.target.value)}),i.jsxs("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx("input",{type:"text",placeholder:"Adresse Résidence",className:"input-field md:col-span-3",value:ge,onChange:q=>De(q.target.value)}),i.jsx("input",{type:"text",placeholder:"Ville",className:"input-field",value:fe,onChange:q=>xe(q.target.value)}),i.jsx("input",{type:"text",placeholder:"Pays",className:"input-field",value:Qt,onChange:q=>Rt(q.target.value)}),i.jsx("input",{type:"text",placeholder:"Code Postal",className:"input-field",value:ts,onChange:q=>ss(q.target.value)})]}),i.jsx("input",{type:"tel",placeholder:"Téléphone Personnel",className:"input-field",value:Lt,onChange:q=>G(q.target.value)}),i.jsx("input",{type:"email",placeholder:"Email Personnel",className:"input-field",value:Je,onChange:q=>qe(q.target.value)})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("h4",{className:"text-sm font-bold text-indigo-900 uppercase tracking-wider border-b border-indigo-100 pb-2 flex items-center",children:[i.jsx(Rr,{className:"w-4 h-4 mr-2"})," 2. Informations de l'Entreprise"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("input",{type:"text",required:!0,placeholder:"Nom Commercial / Enseigne",className:"input-field font-bold",value:Ke,onChange:q=>vt(q.target.value)}),i.jsx("input",{type:"text",placeholder:"Adresse Siège Social",className:"input-field",value:He,onChange:q=>Tt(q.target.value)}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx("input",{type:"text",placeholder:"Ville",className:"input-field",value:Jt,onChange:q=>V(q.target.value)}),i.jsx("input",{type:"text",placeholder:"Pays",className:"input-field",value:j,onChange:q=>se(q.target.value)})]}),i.jsx("input",{type:"text",placeholder:"Registre Commerce (RCCM/SIRET)",className:"input-field font-mono",value:be,onChange:q=>pt(q.target.value)}),i.jsx("input",{type:"text",placeholder:"N° Impôt / Fiscal (NIF/TIN)",className:"input-field font-mono",value:Ve,onChange:q=>Yt(q.target.value)})]}),i.jsxs("div",{className:"space-y-4 bg-slate-50 p-4 rounded-xl border border-slate-100",children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Logo & Branding"}),i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx("div",{className:"w-20 h-20 bg-white rounded-lg border border-slate-200 flex items-center justify-center overflow-hidden",children:me?i.jsx("img",{src:me,className:"w-full h-full object-contain"}):i.jsx(Rr,{className:"w-8 h-8 text-slate-300"})}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("button",{type:"button",onClick:()=>{var q;return(q=oi.current)==null?void 0:q.click()},className:"text-xs bg-white border border-slate-300 px-3 py-2 rounded shadow-sm hover:bg-slate-50 text-slate-700",children:"Importer Image"}),i.jsxs("button",{type:"button",onClick:Xo,disabled:!Ke,className:"text-xs bg-indigo-100 text-indigo-700 px-3 py-2 rounded shadow-sm hover:bg-indigo-200 flex items-center",children:[i.jsx(Qn,{className:"w-3 h-3 mr-1"})," Générer IA"]}),i.jsx("input",{type:"file",ref:oi,className:"hidden",accept:"image/*",onChange:Yo})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[i.jsx("input",{type:"tel",placeholder:"Tél Entreprise",className:"input-field",value:cs,onChange:q=>us(q.target.value)}),i.jsx("input",{type:"email",placeholder:"Email Pro",className:"input-field",value:L,onChange:q=>ee(q.target.value)})]})]})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("h4",{className:"text-sm font-bold text-indigo-900 uppercase tracking-wider border-b border-indigo-100 pb-2 flex items-center",children:[i.jsx(no,{className:"w-4 h-4 mr-2"})," 3. Informations de Connexion"]}),i.jsxs("div",{className:"bg-amber-50 p-4 rounded-xl border border-amber-100 grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-amber-800 mb-1",children:"Pseudo / Identifiant"}),i.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-amber-200 rounded-lg bg-white text-slate-900 placeholder:text-slate-400",value:$e,onChange:q=>Pt(q.target.value),placeholder:"Ex: Admin88"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-amber-800 mb-1",children:"Code PIN (4 chiffres)"}),i.jsx("input",{type:"password",required:!0,maxLength:4,className:"w-full px-3 py-2 border border-amber-200 rounded-lg bg-white text-slate-900 placeholder:text-slate-400 font-mono text-center tracking-widest",value:St,onChange:q=>ct(q.target.value),placeholder:"••••"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-amber-800 mb-1",children:"Confirmer PIN"}),i.jsx("input",{type:"password",required:!0,maxLength:4,className:"w-full px-3 py-2 border border-amber-200 rounded-lg bg-white text-slate-900 placeholder:text-slate-400 font-mono text-center tracking-widest",value:gs,onChange:q=>Us(q.target.value),placeholder:"••••"})]}),i.jsx("div",{className:"md:col-span-3 text-xs text-amber-700 italic",children:"* Une clé de récupération unique sera générée automatiquement pour ce compte administrateur."})]})]}),i.jsx("div",{className:"flex justify-end pt-4 border-t border-slate-100",children:i.jsxs("button",{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-xl font-bold flex items-center shadow-lg shadow-indigo-200 transition-all transform hover:scale-[1.02]",children:[i.jsx(rl,{className:"w-5 h-5 mr-2"})," Créer & Démarrer"]})})]})]})}),E&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in-up",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-4",children:qt("change_store")}),i.jsx("p",{className:"text-slate-500 text-sm mb-6",children:"Entrez l'identifiant unique de la boutique que vous souhaitez rejoindre."}),i.jsxs("form",{onSubmit:gr,className:"space-y-4",children:[i.jsxs("div",{className:"relative",children:[i.jsx(Xn,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400"}),i.jsx("input",{type:"text",value:Ze,onChange:q=>ze(q.target.value),className:"input-field pl-10",placeholder:"ID Boutique",required:!0})]}),de&&i.jsx("p",{className:"text-red-500 text-sm font-medium",children:de}),et&&i.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-xl p-4 flex items-center space-x-3",children:[i.jsx("div",{className:"bg-white p-2 rounded-lg shadow-sm",children:i.jsx(il,{className:"w-6 h-6 text-emerald-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"font-bold text-emerald-900",children:et.name}),i.jsxs("p",{className:"text-xs text-emerald-700",children:["ID: ",et.id]})]})]}),i.jsxs("div",{className:"flex gap-3 pt-2",children:[i.jsx("button",{type:"button",onClick:()=>{y(!1),st(null),dt("")},className:"flex-1 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium",children:qt("cancel")}),et?i.jsx("button",{type:"button",onClick:_a,className:"flex-1 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold shadow-lg shadow-emerald-200",children:"Rejoindre"}):i.jsx("button",{type:"submit",className:"flex-1 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-indigo-200",children:"Chercher"})]})]})]})}),ke&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in-up",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-4",children:"Récupération Admin"}),Fe===1?i.jsxs("form",{onSubmit:xr,className:"space-y-4",children:[i.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"Veuillez vérifier votre identité."}),i.jsxs("div",{className:"flex gap-2 mb-2",children:[i.jsx("button",{type:"button",onClick:()=>Ce("CONTACT"),className:`flex-1 py-2 text-xs font-bold rounded-lg border ${_e==="CONTACT"?"bg-indigo-50 border-indigo-200 text-indigo-700":"bg-white border-slate-200 text-slate-600"}`,children:"Email / Tél"}),i.jsx("button",{type:"button",onClick:()=>Ce("KEY"),className:`flex-1 py-2 text-xs font-bold rounded-lg border ${_e==="KEY"?"bg-amber-50 border-amber-200 text-amber-700":"bg-white border-slate-200 text-slate-600"}`,children:"Clé Secours"})]}),i.jsx("input",{type:"text",value:Re,onChange:q=>Xe(q.target.value),className:"input-field",placeholder:_e==="KEY"?"Clé Admin (REC-...)":"Email ou Téléphone enregistré",required:!0}),Te&&i.jsx("p",{className:"text-red-500 text-xs font-bold",children:Te}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{type:"button",onClick:rt,className:"flex-1 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium",children:"Annuler"}),i.jsx("button",{type:"submit",className:"flex-1 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold shadow-lg",children:"Vérifier"})]})]}):i.jsx("form",{onSubmit:Ln,className:"space-y-4",children:re?i.jsxs("div",{className:"text-center py-6",children:[i.jsx("div",{className:"w-16 h-16 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(rl,{className:"w-8 h-8"})}),i.jsx("p",{className:"text-emerald-800 font-bold",children:"Code PIN réinitialisé avec succès !"})]}):i.jsxs(i.Fragment,{children:[i.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"Identité vérifiée. Définissez le nouveau PIN Admin."}),i.jsx("input",{type:"password",value:Ee,onChange:q=>Ne(q.target.value),className:"input-field text-center font-mono tracking-widest text-lg",placeholder:"Nouveau PIN",maxLength:4,required:!0}),i.jsx("input",{type:"password",value:W,onChange:q=>ue(q.target.value),className:"input-field text-center font-mono tracking-widest text-lg",placeholder:"Confirmer PIN",maxLength:4,required:!0}),Te&&i.jsx("p",{className:"text-red-500 text-xs font-bold",children:Te}),i.jsx("button",{type:"submit",className:"w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold shadow-lg",children:"Confirmer changement"})]})})]})}),ga&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-fade-in-up border-t-4 border-red-500",children:[i.jsx("h3",{className:"text-xl font-bold text-red-600 mb-2",children:qt("delete_store_title")}),i.jsx("p",{className:"text-slate-600 text-sm mb-4 leading-relaxed",children:qt("delete_store_warning")}),i.jsxs("form",{onSubmit:Ss,className:"space-y-4",children:[i.jsxs("div",{className:"bg-red-50 p-3 rounded-lg border border-red-100",children:[i.jsx("label",{className:"block text-xs font-bold text-red-800 mb-1",children:qt("delete_confirm_admin")}),i.jsx("input",{type:"text",value:fr,onChange:q=>ri(q.target.value),className:"w-full p-2 border border-red-200 rounded bg-white text-sm mb-2",placeholder:"Nom Admin",required:!0}),i.jsx("input",{type:"password",value:ii,onChange:q=>xa(q.target.value),className:"w-full p-2 border border-red-200 rounded bg-white text-sm font-mono text-center tracking-widest",placeholder:"Code PIN",maxLength:4,required:!0})]}),ba&&i.jsx("p",{className:"text-red-500 text-xs font-bold",children:ba}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{type:"button",onClick:()=>On(!1),className:"flex-1 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium",children:qt("cancel")}),i.jsx("button",{type:"submit",className:"flex-1 py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl font-bold shadow-lg",children:qt("delete_btn")})]})]})]})}),ft&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in-up",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-4",children:"Mode de Stockage"}),i.jsx("p",{className:"text-slate-500 text-sm mb-6",children:"Où souhaitez-vous stocker les données de votre entreprise ?"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("button",{onClick:()=>ya("CLOUD"),className:"w-full p-4 rounded-xl border-2 border-indigo-100 hover:border-indigo-500 bg-indigo-50/50 hover:bg-indigo-50 flex items-center transition-all group",children:[i.jsx("div",{className:"bg-indigo-100 p-3 rounded-full mr-4 group-hover:bg-indigo-200",children:i.jsx(Nl,{className:"w-6 h-6 text-indigo-600"})}),i.jsxs("div",{className:"text-left",children:[i.jsx("h4",{className:"font-bold text-indigo-900",children:"Cloud (Recommandé)"}),i.jsx("p",{className:"text-xs text-indigo-700",children:"Synchronisation multi-appareils, sauvegarde automatique."})]})]}),i.jsxs("button",{onClick:()=>ya("LOCAL"),className:"w-full p-4 rounded-xl border-2 border-slate-100 hover:border-slate-400 bg-white hover:bg-slate-50 flex items-center transition-all group",children:[i.jsx("div",{className:"bg-slate-100 p-3 rounded-full mr-4 group-hover:bg-slate-200",children:i.jsx(kg,{className:"w-6 h-6 text-slate-600"})}),i.jsxs("div",{className:"text-left",children:[i.jsx("h4",{className:"font-bold text-slate-800",children:"Local (Hors-ligne)"}),i.jsx("p",{className:"text-xs text-slate-500",children:"Données stockées uniquement sur cet appareil."})]})]})]})]})}),Qe&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-fade-in-up",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-4",children:"Configuration Cloud"}),i.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"Collez la configuration JSON de votre projet Firebase ci-dessous."}),i.jsx("textarea",{className:"w-full h-40 p-3 border border-slate-200 rounded-xl font-mono text-xs text-slate-700 bg-slate-50 focus:ring-2 focus:ring-indigo-500/20 outline-none",placeholder:'{ "apiKey": "...", "authDomain": "...", ... }',value:mr,onChange:q=>pa(q.target.value)}),Et&&i.jsx("p",{className:"text-red-500 text-xs font-bold mt-2",children:Et}),i.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[i.jsx("button",{onClick:()=>ot(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:"Annuler"}),i.jsx("button",{onClick:va,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700",children:"Valider"})]})]})}),an&&i.jsx("div",{className:"fixed inset-0 bg-slate-950/90 backdrop-blur-sm flex items-center justify-center p-4 z-[60]",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-fade-in-up border-t-4 border-indigo-500",children:[i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4 text-center",children:"Création de Logo IA"}),i.jsx("div",{className:"flex flex-col items-center justify-center py-4 min-h-[200px]",children:Jo?i.jsx("div",{className:"text-center animate-pulse",children:i.jsx("p",{className:"text-indigo-700 font-bold",children:"Création..."})}):Vn?i.jsxs("div",{className:"flex flex-col items-center w-full",children:[i.jsx("img",{src:Vn,className:"w-40 h-40 object-contain mb-6"}),i.jsxs("div",{className:"flex gap-3 w-full",children:[i.jsx("button",{onClick:wa,className:"flex-1 py-2 bg-slate-100 rounded",children:"Refaire"}),i.jsx("button",{onClick:Fn,className:"flex-1 py-2 bg-indigo-600 text-white rounded",children:"Valider"})]})]}):i.jsxs("div",{className:"w-full",children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Description (Optionnel)"}),i.jsx("textarea",{className:"w-full px-3 py-2 border rounded mb-4 h-20 text-sm",value:on,onChange:q=>Ts(q.target.value),placeholder:"Ex: Moderne, minimaliste, bleu..."}),i.jsx("button",{onClick:wa,className:"w-full py-2 bg-indigo-600 text-white rounded font-bold shadow-lg hover:bg-indigo-700 transition-colors",children:"Générer"})]})}),i.jsx("div",{className:"mt-4 text-center",children:i.jsx("button",{onClick:()=>kn(!1),className:"text-slate-400 text-xs hover:text-slate-600",children:"Annuler"})})]})}),i.jsx("style",{children:`
        .input-field {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            outline: none;
            transition: all 0.2s;
            background-color: #ffffff;
            color: #0f172a;
        }
        .input-field::placeholder { color: #94a3b8; }
        .input-field:focus { border-color: #6366f1; box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2); }
      `})]})},CN=({users:n,onAddUser:e,onUpdateUser:t,onDeleteUser:s,currentUser:r,onSupervise:a,onLoginAs:o})=>{const[c,u]=w.useState(!1),h=w.useRef(null),[f,p]=w.useState(null),[_,A]=w.useState(""),[P,k]=w.useState(""),[T,U]=w.useState(null),[K,D]=w.useState(""),[$,H]=w.useState("SELLER"),[Q,N]=w.useState(""),[b,g]=w.useState(0),[v,S]=w.useState(void 0),[E,y]=w.useState([]);if(r.role!=="ADMIN")return i.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500",children:[i.jsx(Bu,{className:"w-16 h-16 mb-4 text-red-400"}),i.jsx("h2",{className:"text-2xl font-bold text-slate-700",children:"Accès Refusé"}),i.jsx("p",{children:"Seuls les administrateurs peuvent gérer les utilisateurs."})]});const ke=W=>{if(!W)return{text:"Jamais",isOnline:!1};const ue=new Date(W),ye=new Date().getTime()-ue.getTime();return Math.floor(ye/6e4)<5?{text:"En ligne",isOnline:!0}:{text:`Le ${ue.toLocaleDateString()} à ${ue.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,isOnline:!1}},Y=W=>{y(ue=>ue.includes(W)?ue.filter(Te=>Te!==W):[...ue,W])},Fe=(W,ue)=>{const Te=ue.map(re=>`${W}.${re.id}`),ye=Te.every(re=>E.includes(re));y(ye?re=>re.filter(Be=>!Te.includes(Be)):re=>[...new Set([...re,...Te])])},J=()=>{U(null),D(""),N(""),H("SELLER"),g(0),S(void 0),y(["dashboard.view","commercial.view","commercial.sale","settings.view","settings.view_profile"])},_e=()=>{J(),u(!0)},Ce=W=>{U(W.id),D(W.name),H(W.role),N(W.pin),g(W.commissionRate||0),S(W.avatar),y(W.permissions||[]),u(!0)},Re=W=>{window.confirm("Êtes-vous sûr de vouloir supprimer cet utilisateur ? Cette action est irréversible.")&&s(W)},Xe=W=>{var ye;const ue=(ye=W.target.files)==null?void 0:ye[0];if(!ue)return;if(ue.size>2*1024*1024){alert("L'image est trop volumineuse (Max 2Mo).");return}const Te=new FileReader;Te.onload=re=>{var Be;S((Be=re.target)==null?void 0:Be.result)},Te.readAsDataURL(ue)},Ee=W=>{if(W.preventDefault(),!K||!Q)return;let ue=[...E];$==="ADMIN"&&(ue.includes("users.view")||ue.push("users.view"),ue.includes("users.manage")||ue.push("users.manage"),ue.includes("settings.view")||ue.push("settings.view"));const Te={name:K,role:$,pin:Q,commissionRate:$==="SELLER"?b:0,permissions:ue,avatar:v||`https://ui-avatars.com/api/?name=${encodeURIComponent(K)}&background=random&color=fff`};if(T)t(T,Te);else{const ye=Ue(je({},Te),{id:`u-${Date.now()}`});e(ye)}u(!1),J()},Ne=W=>{W.preventDefault(),!(!f||!o)&&(_===f.pin?(o(f),p(null),A("")):k("Code PIN incorrect."))};return i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsxs("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Gestion des Accès Utilisateurs"}),i.jsx("p",{className:"text-slate-500",children:"Créez des comptes et définissez les permissions détaillées."})]}),i.jsxs("button",{onClick:_e,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-xl font-medium flex items-center shadow-lg shadow-indigo-200 transition-colors",children:[i.jsx(Qs,{className:"w-5 h-5 mr-2"})," Nouvel Utilisateur"]})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(W=>{const ue=ke(W.lastLogin);return i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col justify-between h-full group relative",children:[i.jsxs("div",{className:"absolute top-4 right-4 flex items-center",children:[i.jsx("div",{className:`w-2 h-2 rounded-full mr-1.5 ${ue.isOnline?"bg-emerald-500 animate-pulse":"bg-slate-300"}`}),i.jsx("span",{className:`text-[10px] font-medium ${ue.isOnline?"text-emerald-600":"text-slate-400"}`,children:ue.isOnline?"En ligne":"Hors ligne"})]}),i.jsxs("div",{className:"flex items-start space-x-4 mb-4",children:[i.jsx("img",{src:W.avatar,alt:W.name,className:"w-16 h-16 rounded-full border-2 border-slate-100 object-cover"}),i.jsxs("div",{className:"flex-1 min-w-0 pt-1",children:[i.jsx("h3",{className:"text-lg font-bold text-slate-800 truncate",children:W.name}),i.jsx("div",{className:"flex flex-col gap-1 mt-1",children:i.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium w-fit ${W.role==="ADMIN"?"bg-purple-100 text-purple-700":W.role==="SELLER"?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-700"}`,children:[W.role==="ADMIN"?i.jsx(ic,{className:"w-3 h-3 mr-1"}):i.jsx(vs,{className:"w-3 h-3 mr-1"}),W.role==="ADMIN"?"Administrateur":W.role==="SELLER"?"Vendeur":"Utilisateur"]})})]})]}),i.jsxs("div",{className:"mb-4 bg-slate-50 p-2 rounded-lg border border-slate-100 flex items-center justify-between text-xs text-slate-500",children:[i.jsxs("div",{className:"flex items-center",children:[ue.isOnline?i.jsx(Lh,{className:"w-3 h-3 mr-1.5 text-emerald-500"}):i.jsx(Il,{className:"w-3 h-3 mr-1.5"}),i.jsx("span",{children:"Dernière activité :"})]}),i.jsx("span",{className:"font-medium text-slate-700",children:ue.text})]}),W.id!==r.id&&i.jsxs("div",{className:"flex gap-2 mb-3 bg-indigo-50/50 p-2 rounded-xl border border-indigo-100",children:[i.jsxs("button",{onClick:()=>a&&a(W),className:"flex-1 py-1.5 bg-white border border-indigo-100 text-indigo-700 text-xs font-bold rounded-lg hover:bg-indigo-50 transition-colors flex items-center justify-center shadow-sm",title:"Superviser (Voir comme)",children:[i.jsx(en,{className:"w-3 h-3 mr-1.5"})," Superviser"]}),i.jsxs("button",{onClick:()=>{p(W),k(""),A("")},className:"flex-1 py-1.5 bg-white border border-amber-100 text-amber-700 text-xs font-bold rounded-lg hover:bg-amber-50 transition-colors flex items-center justify-center shadow-sm",title:"Connexion (Accès complet)",children:[i.jsx(no,{className:"w-3 h-3 mr-1.5"})," Connecter"]})]}),i.jsx("div",{className:"pt-4 border-t border-slate-50 mt-auto",children:i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsxs("button",{onClick:()=>Ce(W),className:"flex-1 py-2 text-indigo-600 bg-indigo-50 hover:bg-indigo-100 rounded-lg text-xs font-bold transition-colors flex items-center justify-center",children:[i.jsx(Wi,{className:"w-3 h-3 mr-1"})," Modifier"]}),W.id!==r.id&&i.jsx("button",{onClick:()=>Re(W.id),className:"p-2 text-red-500 bg-red-50 hover:bg-red-100 rounded-lg transition-colors",title:"Supprimer",children:i.jsx(Vs,{className:"w-4 h-4"})})]})})]},W.id)})}),f&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-fade-in-up border-t-4 border-amber-500",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Connexion en tant que..."}),i.jsxs("p",{className:"text-sm text-slate-500",children:["Accéder au compte de ",i.jsx("span",{className:"font-bold text-amber-600",children:f.name})]})]}),i.jsx("button",{onClick:()=>p(null),className:"text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"bg-amber-50 p-3 rounded-lg text-xs text-amber-800 mb-4 flex items-start",children:[i.jsx(Bu,{className:"w-4 h-4 mr-2 flex-shrink-0 mt-0.5"}),"Vous allez être déconnecté de votre compte administrateur."]}),i.jsxs("form",{onSubmit:Ne,children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Code PIN de l'utilisateur"}),i.jsx("input",{type:"password",autoFocus:!0,maxLength:4,value:_,onChange:W=>A(W.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl font-mono text-center text-xl tracking-widest focus:ring-2 focus:ring-amber-500/30 text-slate-900 bg-white",placeholder:"••••"}),P&&i.jsx("p",{className:"text-red-500 text-xs mt-2 text-center font-bold",children:P}),i.jsxs("button",{type:"submit",className:"w-full mt-6 bg-slate-800 text-white py-3 rounded-xl font-bold flex items-center justify-center hover:bg-slate-900 transition-colors",children:["Valider l'accès ",i.jsx(kr,{className:"w-4 h-4 ml-2"})]})]})]})}),c&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl p-6 animate-fade-in-up my-8 max-h-[90vh] overflow-y-auto",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-6 border-b border-slate-100 pb-4",children:T?"Modifier le compte":"Nouveau Compte Utilisateur"}),i.jsxs("form",{onSubmit:Ee,className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[i.jsxs("div",{className:"space-y-4 lg:col-span-1",children:[i.jsxs("h4",{className:"text-xs font-bold text-indigo-600 uppercase flex items-center border-b border-indigo-100 pb-2",children:[i.jsx(vs,{className:"w-4 h-4 mr-1"})," Identifiants"]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nom d'utilisateur"}),i.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20 bg-white text-slate-900",value:K,onChange:W=>D(W.target.value),placeholder:"Pour la connexion"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Avatar (Optionnel)"}),i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center overflow-hidden border border-slate-200",children:v?i.jsx("img",{src:v,className:"w-full h-full object-cover"}):i.jsx(vs,{className:"w-5 h-5 text-slate-300"})}),i.jsxs("button",{type:"button",onClick:()=>{var W;return(W=h.current)==null?void 0:W.click()},className:"text-xs bg-slate-100 hover:bg-slate-200 text-slate-700 px-3 py-2 rounded-lg",children:[i.jsx(lc,{className:"w-3 h-3 inline mr-1"})," Changer"]}),i.jsx("input",{type:"file",ref:h,className:"hidden",accept:"image/*",onChange:Xe})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Code PIN"}),i.jsx("input",{type:"password",required:!0,maxLength:4,pattern:"\\d{4}",className:"w-full px-3 py-2 border border-slate-200 rounded-lg font-mono tracking-widest bg-white text-slate-900",value:Q,onChange:W=>N(W.target.value),placeholder:"••••"})]}),i.jsx("div",{className:"grid grid-cols-1 gap-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Rôle Système"}),i.jsxs("select",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg bg-white text-slate-900",value:$,onChange:W=>H(W.target.value),children:[i.jsx("option",{value:"SELLER",children:"Vendeur"}),i.jsx("option",{value:"ADMIN",children:"Administrateur"}),i.jsx("option",{value:"USER",children:"Utilisateur"})]})]})}),$==="SELLER"&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Commission Vente (%)"}),i.jsx("input",{type:"number",min:"0",max:"100",className:"w-full px-3 py-2 border border-slate-200 rounded-lg bg-white text-slate-900",value:b,onChange:W=>g(parseFloat(W.target.value))})]})]}),i.jsxs("div",{className:"lg:col-span-2 bg-slate-50 p-6 rounded-xl border border-slate-100",children:[i.jsxs("h4",{className:"text-xs font-bold text-slate-500 uppercase mb-4 flex items-center",children:[i.jsx(bn,{className:"w-3 h-3 mr-1"})," Droits d'accès détaillés"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 max-h-[60vh] overflow-y-auto pr-2",children:uc.map(W=>{const Te=W.actions.map(ye=>`${W.id}.${ye.id}`).every(ye=>E.includes(ye));return i.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[i.jsx("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-slate-100",children:i.jsxs("div",{className:"flex items-center",children:[i.jsxs("label",{className:"flex items-center cursor-pointer mr-2",title:"Tout cocher dans cette catégorie",children:[i.jsx("input",{type:"checkbox",className:"peer hidden",checked:Te,onChange:()=>Fe(W.id,W.actions)}),Te?i.jsx(qu,{className:"w-5 h-5 text-indigo-600"}):i.jsx($u,{className:"w-5 h-5 text-slate-300 hover:text-slate-400"})]}),i.jsx("h5",{className:"font-bold text-slate-800 text-sm",children:W.label})]})}),i.jsx("div",{className:"space-y-2 pl-2",children:W.actions.map(ye=>{const re=`${W.id}.${ye.id}`,Be=E.includes(re);return i.jsxs("label",{className:"flex items-start space-x-2 cursor-pointer group",children:[i.jsxs("div",{className:"relative flex items-center pt-0.5",children:[i.jsx("input",{type:"checkbox",className:"peer hidden",checked:Be,onChange:()=>Y(re)}),Be?i.jsx(qu,{className:"w-4 h-4 text-indigo-600"}):i.jsx($u,{className:"w-4 h-4 text-slate-300 group-hover:text-slate-400"})]}),i.jsx("span",{className:`text-sm ${Be?"text-slate-800 font-medium":"text-slate-500"}`,children:ye.label})]},re)})})]},W.id)})})]})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-slate-100",children:[i.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Annuler"}),i.jsx("button",{type:"submit",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 shadow-md",children:T?"Mettre à jour":"Créer Compte"})]})]})]})})]})},RN=({movements:n,closings:e,transactions:t=[],onAddMovement:s,onClosePeriod:r,onSettleTransaction:a,lastClosingDate:o,currency:c,currentUser:u,customers:h=[],supervisionTarget:f})=>{var He,Tt,Jt,V;const[p,_]=w.useState("CURRENT"),A=u.role==="ADMIN",[P,k]=w.useState(new Date().toISOString().split("T")[0]),[T,U]=w.useState(new Date().toISOString().split("T")[0]),[K,D]=w.useState(!1),[$,H]=w.useState(!1),[Q,N]=w.useState(!1),[b,g]=w.useState(1),[v,S]=w.useState(""),[E,y]=w.useState(""),[ke,Y]=w.useState(!1),[Fe,J]=w.useState(null),[_e,Ce]=w.useState(!1),[Re,Xe]=w.useState(null),[Ee,Ne]=w.useState("DEPOSIT"),[W,ue]=w.useState(0),[Te,ye]=w.useState(""),[re,Be]=w.useState(0),[Ze,ze]=w.useState(!1),[de,dt]=w.useState(null),et=!!f,st=f||u,ft=st.id,yt=st.name,Qe=A&&!et?n:n.filter(j=>j.performedBy.includes(yt)),ot=Qe.filter(j=>j.type==="SALE"||j.type==="DEPOSIT").reduce((j,se)=>j+se.amount,0),Et=Qe.filter(j=>j.type==="PURCHASE"||j.type==="WITHDRAWAL"||j.type==="EXPENSE").reduce((j,se)=>j+se.amount,0),ut=Qe.filter(j=>j.type==="BANK_DEPOSIT").reduce((j,se)=>j+se.amount,0),Se=ot-Et-ut,oe=new Date;oe.setHours(0,0,0,0);const lt=Qe.filter(j=>new Date(j.date)>=oe),B=t.filter(j=>(j.sellerId===ft||A&&!et)&&new Date(j.date)>=oe&&!j.isLocked),ie=lt.filter(j=>j.type==="SALE"||j.type==="DEPOSIT").reduce((j,se)=>j+se.amount,0),ve=lt.filter(j=>j.type==="PURCHASE"||j.type==="WITHDRAWAL"||j.type==="EXPENSE").reduce((j,se)=>j+se.amount,0),nt=lt.filter(j=>j.type==="BANK_DEPOSIT").reduce((j,se)=>j+se.amount,0),ge=(()=>{const j=new Date(P);j.setHours(0,0,0,0);const se=new Date(T);return se.setHours(23,59,59,999),Qe.filter(be=>{const pt=new Date(be.date);return pt>=j&&pt<=se})})();ge.filter(j=>j.type==="SALE"||j.type==="DEPOSIT").reduce((j,se)=>j+se.amount,0),ge.filter(j=>j.type==="PURCHASE"||j.type==="WITHDRAWAL"||j.type==="EXPENSE").reduce((j,se)=>j+se.amount,0),ge.filter(j=>j.type==="BANK_DEPOSIT").reduce((j,se)=>j+se.amount,0);const fe=t.filter(j=>j.paymentStatus!=="PAID").filter(j=>j.type==="SALE"),xe=j=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:c.code,minimumFractionDigits:c.code==="XOF"?0:2,maximumFractionDigits:c.code==="XOF"?0:2}).format(j*c.rate),Qt=j=>{if(j.customerName)return j.customerName;if(j.customerId){const se=h.find(be=>be.id===j.customerId);if(se)return se.name}return"Client de passage"},Rt=j=>{const se=j.getTime()-new Date().getTime(),be=Math.floor(se/(1e3*60*60)),pt=Math.floor(se%(1e3*60*60)/(1e3*60));dt({reopeningTime:"00h00",remainingText:`${be} heures ${pt} minutes`}),ze(!0)},ts=()=>I(Me,null,function*(){const j=localStorage.getItem("gesmind_last_store_id");if(j){const se=yield fu(j,st.id);if(se.isLocked&&se.reopenAt)return Rt(se.reopenAt),!0}return!1}),ss=j=>I(Me,null,function*(){(yield ts())||(Ne(j),D(!0))}),Lt=()=>I(Me,null,function*(){(yield ts())||Ce(!0)}),G=j=>{if(j.preventDefault(),W<=0||Ee==="BANK_DEPOSIT"&&W/c.rate>Se&&!window.confirm("Attention : Le montant du versement dépasse le solde physique disponible calculé. Continuer quand même ?"))return;const se={id:`m-${Date.now()}`,date:new Date().toISOString(),type:Ee,amount:W/c.rate,description:Te||(Ee==="DEPOSIT"?"Dépôt manuel":Ee==="BANK_DEPOSIT"?"Versement Banque":"Retrait manuel"),performedBy:u.name};s(se),D(!1),ue(0),ye("")},Je=j=>{if(!j){Xe(null),Be(0);return}const se=fe.find(be=>be.id===j);if(se){Xe(j);const be=se.totalAmount-se.amountPaid;Be(parseFloat((be*c.rate).toFixed(2)))}},qe=j=>{j.preventDefault(),Re&&re>0&&a&&(a(Re,re),N(!1),Ce(!1),Xe(null))},Ke=()=>I(Me,null,function*(){if(yield ts())return;const se=`${new Date().toISOString().split("T")[0]}_${ft}`;if(e.find(pt=>pt.id===se)){const pt=new Date,Ve=new Date(pt);Ve.setHours(24,0,0,0),Rt(Ve);return}g(1),S(""),y(""),J(null),H(!0)}),vt=()=>I(Me,null,function*(){if(!v)return;Y(!0),J(null),yield new Promise(pe=>setTimeout(pe,1500));const j=parseFloat(v)/c.rate,be=`${new Date().toISOString().split("T")[0]}_${ft}`;let pt=0,Ve=0,Yt=0,cs=0;B.forEach(pe=>{pt+=pe.totalAmount,pe.paymentMethod==="MOBILE_MONEY"?Yt+=pe.amountPaid:pe.paymentMethod==="CARD"?cs+=pe.amountPaid:Ve+=pe.amountPaid});const us=Se,L=j-us,ee={id:be,date:new Date().toISOString(),registerId:ft,closedBy:u.name,status:"closed",autoClosed:!1,totalSales:pt,amountCash:Ve,amountMobileMoney:Yt,amountCard:cs,cashExpected:us,cashReal:j,difference:L,comment:E,totalCashIn:ie,totalCashOut:ve+nt},me=B.map(pe=>pe.id);try{const pe=localStorage.getItem("gesmind_last_store_id")||"unknown";yield NN(pe,ee,me),H(!1),alert("Caisse clôturée avec succès ! Les ventes du jour sont verrouillées.")}catch(pe){J(pe.message||"Erreur lors de la clôture.")}finally{Y(!1)}});return i.jsxs("div",{className:"space-y-6",children:[ke&&i.jsx(pu,{message:"Clôture et verrouillage de la caisse..."}),i.jsxs("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-bold text-slate-800 flex items-center",children:["Trésorerie & Caisse",et&&i.jsxs("span",{className:"ml-3 text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded-full border border-amber-200 flex items-center shadow-sm",children:[i.jsx(en,{className:"w-3 h-3 mr-1"})," Supervision: ",f==null?void 0:f.name]})]}),i.jsx("p",{className:"text-slate-500",children:"Suivi de la session du jour et des mouvements."})]}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsxs("button",{onClick:Lt,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2.5 rounded-xl font-medium flex items-center shadow-lg shadow-indigo-200 transition-colors",children:[i.jsx(Dg,{className:"w-5 h-5 mr-2"})," Recouvrement"]}),i.jsxs("button",{onClick:()=>ss("BANK_DEPOSIT"),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-xl font-medium flex items-center shadow-lg shadow-blue-200 transition-colors",children:[i.jsx(Gu,{className:"w-5 h-5 mr-2"})," Versement Banque"]}),i.jsxs("button",{onClick:()=>ss("DEPOSIT"),className:"bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2.5 rounded-xl font-medium flex items-center shadow-lg shadow-emerald-200 transition-colors",children:[i.jsx(Qs,{className:"w-5 h-5 mr-2"})," Dépôt"]}),i.jsxs("button",{onClick:()=>ss("WITHDRAWAL"),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2.5 rounded-xl font-medium flex items-center shadow-lg shadow-red-200 transition-colors",children:[i.jsx(Vg,{className:"w-5 h-5 mr-2"})," Retrait"]})]})]}),p==="CURRENT"&&i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 animate-fade-in",children:[i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col justify-between",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Session Entrées"}),i.jsx("h3",{className:"text-2xl font-bold text-emerald-600 mt-1",children:xe(ie)})]}),i.jsxs("div",{className:"mt-4 flex items-center text-xs text-slate-400",children:[i.jsx(eo,{className:"w-4 h-4 mr-1 text-emerald-500"})," Ventes + Dépôts"]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col justify-between",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Session Sorties"}),i.jsx("h3",{className:"text-2xl font-bold text-red-600 mt-1",children:xe(ve)})]}),i.jsxs("div",{className:"mt-4 flex items-center text-xs text-slate-400",children:[i.jsx(ki,{className:"w-4 h-4 mr-1 text-red-500"})," Achats + Frais"]})]}),i.jsx("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-2xl shadow-lg text-white flex flex-col justify-between relative overflow-hidden",children:i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsx("span",{className:"text-xs font-bold text-slate-300 uppercase tracking-wider",children:"Solde Physique (Caisse)"}),i.jsx(Fr,{className:"w-5 h-5 text-white"})]}),i.jsx("h3",{className:"text-3xl font-bold mt-1 text-white",children:xe(Se)}),i.jsxs("div",{className:"mt-3 pt-3 border-t border-white/20 flex justify-between items-center text-xs",children:[i.jsx("span",{className:"text-slate-400",children:"Sécurisé en Banque :"}),i.jsx("span",{className:"font-bold text-blue-300",children:xe(ut)})]})]})})]}),i.jsx("div",{className:"border-b border-slate-200 overflow-x-auto",children:i.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[i.jsxs("button",{onClick:()=>_("CURRENT"),className:`${p==="CURRENT"?"border-indigo-500 text-indigo-600":"border-transparent text-slate-500 hover:text-slate-700"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center`,children:[i.jsx(Il,{className:"w-4 h-4 mr-2"})," Mouvements Session"]}),i.jsxs("button",{onClick:()=>_("RANGE"),className:`${p==="RANGE"?"border-indigo-500 text-indigo-600":"border-transparent text-slate-500 hover:text-slate-700"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center`,children:[i.jsx(Og,{className:"w-4 h-4 mr-2"})," Recherche par Date"]}),A&&!et&&i.jsxs("button",{onClick:()=>_("HISTORY"),className:`${p==="HISTORY"?"border-indigo-500 text-indigo-600":"border-transparent text-slate-500 hover:text-slate-700"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center`,children:[i.jsx(Lg,{className:"w-4 h-4 mr-2"})," Historique Clôtures"]}),i.jsxs("button",{onClick:()=>_("DEBTS"),className:`${p==="DEBTS"?"border-amber-500 text-amber-600":"border-transparent text-slate-500 hover:text-slate-700"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center`,children:[i.jsx(to,{className:"w-4 h-4 mr-2"})," Créances & Dettes"]})]})}),p==="CURRENT"&&i.jsxs("div",{className:"animate-fade-in space-y-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center bg-indigo-50 p-4 rounded-xl border border-indigo-100 gap-4",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx("div",{className:"bg-white p-2 rounded-lg text-indigo-600 shadow-sm",children:i.jsx(Qh,{className:"w-6 h-6"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-indigo-900",children:"Journal d'activité (Session)"}),i.jsxs("p",{className:"text-xs text-indigo-700",children:[A&&!et?"Tous les mouvements":"Vos mouvements"," depuis le ",o?new Date(o).toLocaleDateString():"début"]})]})]}),i.jsxs("button",{onClick:Ke,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2.5 rounded-xl font-medium shadow-md shadow-indigo-200 flex items-center transition-all",children:[i.jsx(bn,{className:"w-4 h-4 mr-2"})," Clôturer la caisse"]})]}),i.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left min-w-[800px]",children:[i.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider w-32",children:"Heure"}),i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider w-32",children:"Flux"}),i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider min-w-[300px]",children:"Description"}),i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider w-40",children:"Opérateur"}),i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-right w-40",children:"Montant"})]})}),i.jsxs("tbody",{className:"divide-y divide-slate-100",children:[lt.slice().reverse().map(j=>{const se=j.type==="SALE"||j.type==="DEPOSIT",be=j.type==="BANK_DEPOSIT";return i.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[i.jsx("td",{className:"px-6 py-4 text-sm text-slate-500 font-mono whitespace-nowrap",children:new Date(j.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.jsxs("span",{className:`inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-bold ${se?"bg-emerald-50 text-emerald-700 border border-emerald-100":be?"bg-blue-50 text-blue-700 border border-blue-100":"bg-red-50 text-red-700 border border-red-100"}`,children:[se?i.jsx(Mg,{className:"w-3 h-3 mr-1"}):be?i.jsx(Gu,{className:"w-3 h-3 mr-1"}):i.jsx(Fg,{className:"w-3 h-3 mr-1"}),j.type==="SALE"?"Vente":j.type==="PURCHASE"?"Achat":j.type==="DEPOSIT"?"Dépôt":j.type==="EXPENSE"?"Dépense":j.type==="BANK_DEPOSIT"?"Vers. Banque":"Retrait"]})}),i.jsx("td",{className:"px-6 py-4 text-sm text-slate-800 font-medium",children:i.jsx("div",{className:"whitespace-normal break-words",title:j.description,children:j.description})}),i.jsx("td",{className:"px-6 py-4 text-sm text-slate-500 whitespace-nowrap",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold text-slate-600 mr-2",children:j.performedBy.charAt(0)}),j.performedBy.split(" ")[0]]})}),i.jsxs("td",{className:`px-6 py-4 text-right font-bold font-mono text-sm whitespace-nowrap ${se?"text-emerald-600":be?"text-blue-600":"text-slate-800"}`,children:[se?"+":"-",xe(j.amount)]})]},j.id)}),lt.length===0&&i.jsx("tr",{children:i.jsxs("td",{colSpan:5,className:"px-6 py-12 text-center text-slate-400 bg-slate-50/50",children:[i.jsx(Il,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),i.jsx("p",{children:"Aucun mouvement pour votre session en cours."})]})})]})]})})})]}),p==="HISTORY"&&A&&!et&&i.jsx("div",{className:"animate-fade-in bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left min-w-[900px]",children:[i.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase w-48",children:"Date Clôture"}),i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase w-32",children:"Type"}),i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase w-40",children:"Auteur"}),i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right w-32",children:"Ventes"}),i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right w-32",children:"Réel"}),i.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right w-32",children:"Écart"})]})}),i.jsxs("tbody",{className:"divide-y divide-slate-100",children:[e.map(j=>i.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[i.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-slate-800 whitespace-nowrap",children:[new Date(j.date).toLocaleDateString()," ",i.jsx("span",{className:"text-slate-400 text-xs ml-1",children:new Date(j.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-bold border ${j.autoClosed?"bg-slate-100 text-slate-600 border-slate-200":"bg-indigo-50 text-indigo-600 border-indigo-200"}`,children:j.autoClosed?"AUTO":"MANUEL"})}),i.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 whitespace-nowrap",children:j.closedBy}),i.jsx("td",{className:"px-6 py-4 text-right text-emerald-600 text-sm font-mono whitespace-nowrap",children:xe(j.totalSales)}),i.jsx("td",{className:"px-6 py-4 text-right text-slate-800 text-sm font-mono whitespace-nowrap",children:xe(j.cashReal)}),i.jsxs("td",{className:`px-6 py-4 text-right font-bold font-mono whitespace-nowrap ${j.difference!==0?"text-red-500":"text-slate-400"}`,children:[j.difference>0?"+":"",xe(j.difference)]})]},j.id)),e.length===0&&i.jsx("tr",{children:i.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center text-slate-400",children:[i.jsx(Cs,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),"Aucune clôture archivée."]})})]})]})})}),$&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-fade-in-up border-t-4 border-indigo-600",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("div",{className:"flex items-center space-x-3 text-indigo-900",children:[i.jsx("div",{className:"bg-indigo-100 p-2 rounded-full",children:i.jsx(bn,{className:"w-6 h-6 text-indigo-600"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-bold",children:"Clôture de Caisse"}),i.jsxs("p",{className:"text-xs text-slate-500 font-mono",children:[new Date().toLocaleDateString()," • ",yt]})]})]}),i.jsx("button",{onClick:()=>H(!1),className:"text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"w-6 h-6"})})]}),b===1&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100 space-y-3",children:[i.jsxs("div",{className:"flex justify-between items-center text-sm pb-2 border-b border-slate-200",children:[i.jsx("span",{className:"text-slate-500 font-medium",children:"Fond de Caisse (Calculé)"}),i.jsx("span",{className:"font-bold text-slate-800 text-lg",children:xe(Se)})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-1",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-slate-400 uppercase",children:"Total Ventes"}),i.jsxs("p",{className:"font-bold text-emerald-600",children:["+",xe(B.reduce((j,se)=>j+se.totalAmount,0)*c.rate)]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-slate-400 uppercase",children:"Sorties / Banque"}),i.jsxs("p",{className:"font-bold text-red-600",children:["-",xe(ve+nt)]})]})]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-bold text-slate-800 mb-2 flex items-center",children:[i.jsx(so,{className:"w-4 h-4 mr-2 text-indigo-600"}),"Montant Espèces Réel (Compté)"]}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"number",min:"0",step:"0.01",autoFocus:!0,className:"w-full pl-4 pr-12 py-4 border-2 border-indigo-100 rounded-xl text-2xl font-bold text-indigo-900 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 outline-none transition-all",placeholder:"0.00",value:v,onChange:j=>S(j.target.value)}),i.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-sm font-bold text-indigo-300",children:c.code})]}),i.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Comptez les billets et pièces dans le tiroir et saisissez le total exact."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Commentaire (Facultatif)"}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm",placeholder:"Ex: Écart justifié par...",value:E,onChange:j=>y(j.target.value)})]}),i.jsx("div",{className:"flex justify-end pt-4",children:i.jsxs("button",{onClick:()=>g(2),disabled:!v,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-indigo-200 flex items-center disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:["Suivant ",i.jsx(kr,{className:"w-4 h-4 ml-2"})]})})]}),b===2&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"text-center py-4",children:[i.jsx("div",{className:"inline-block p-3 bg-amber-50 rounded-full mb-3 text-amber-600",children:i.jsx(to,{className:"w-8 h-8"})}),i.jsx("h4",{className:"text-lg font-bold text-slate-800",children:"Confirmation de Clôture"}),i.jsx("p",{className:"text-sm text-slate-500",children:"Cette action est irréversible."})]}),i.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"text-sm text-slate-500",children:"Attendu"}),i.jsx("span",{className:"font-bold text-slate-700",children:xe(Se)})]}),i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"text-sm text-slate-500",children:"Saisi (Réel)"}),i.jsx("span",{className:"font-bold text-indigo-700",children:xe(parseFloat(v||"0"))})]}),i.jsxs("div",{className:"border-t border-slate-200 pt-2 flex justify-between items-center",children:[i.jsx("span",{className:"text-sm font-bold text-slate-800",children:"Écart (Différence)"}),i.jsx("span",{className:`font-bold ${parseFloat(v||"0")-Se*c.rate===0?"text-emerald-600":"text-red-600"}`,children:xe(parseFloat(v||"0")-Se*c.rate)})]})]}),i.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg flex items-start text-xs text-blue-800",children:[i.jsx(bn,{className:"w-4 h-4 mr-2 flex-shrink-0 mt-0.5"}),i.jsx("div",{children:"Une fois validé, toutes les ventes de la journée seront verrouillées et plus aucune modification ne sera possible."})]}),Fe&&i.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg text-sm font-bold flex items-center",children:[i.jsx(cc,{className:"w-4 h-4 mr-2"}),Fe]}),i.jsxs("div",{className:"flex gap-3 pt-2",children:[i.jsx("button",{onClick:()=>g(1),className:"flex-1 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium transition-colors",disabled:ke,children:"Retour"}),i.jsx("button",{onClick:vt,disabled:ke,className:"flex-1 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold shadow-lg flex items-center justify-center transition-all disabled:opacity-70",children:"CONFIRMER"})]})]})]})}),K&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in-up",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-6",children:"Nouveau Mouvement"}),i.jsxs("form",{onSubmit:G,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Type de Mouvement"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{type:"button",onClick:()=>Ne("DEPOSIT"),className:`flex-1 py-2 rounded-lg border text-sm font-bold ${Ee==="DEPOSIT"?"bg-emerald-50 border-emerald-500 text-emerald-700":"border-slate-200 text-slate-600"}`,children:"Dépôt"}),i.jsx("button",{type:"button",onClick:()=>Ne("WITHDRAWAL"),className:`flex-1 py-2 rounded-lg border text-sm font-bold ${Ee==="WITHDRAWAL"?"bg-red-50 border-red-500 text-red-700":"border-slate-200 text-slate-600"}`,children:"Retrait"}),i.jsx("button",{type:"button",onClick:()=>Ne("BANK_DEPOSIT"),className:`flex-1 py-2 rounded-lg border text-sm font-bold ${Ee==="BANK_DEPOSIT"?"bg-blue-50 border-blue-500 text-blue-700":"border-slate-200 text-slate-600"}`,children:"Banque"})]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Montant (",c.code,")"]}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"number",min:"0",step:"0.01",required:!0,className:"w-full pl-4 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500/20 text-lg font-bold text-slate-800",value:W,onChange:j=>ue(parseFloat(j.target.value))}),i.jsx(so,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Description"}),i.jsx("input",{type:"text",className:"w-full px-4 py-2 border border-slate-200 rounded-xl",placeholder:"Motif...",value:Te,onChange:j=>ye(j.target.value)})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[i.jsx("button",{type:"button",onClick:()=>D(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:"Annuler"}),i.jsx("button",{type:"submit",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700",children:"Enregistrer"})]})]})]})}),_e&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-fade-in-up",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Recouvrement de Créances"}),i.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"Sélectionnez un client et une facture impayée pour enregistrer un règlement."}),i.jsx("div",{className:"space-y-4",children:fe.length>0?i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Facture Impayée"}),i.jsxs("select",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:Re||"",onChange:j=>Je(j.target.value),children:[i.jsx("option",{value:"",children:"-- Sélectionner --"}),fe.map(j=>i.jsxs("option",{value:j.id,children:[Qt(j)," - ",xe(j.totalAmount)," (",new Date(j.date).toLocaleDateString(),")"]},j.id))]})]}),Re&&i.jsxs("form",{onSubmit:qe,children:[i.jsxs("div",{className:"p-4 bg-amber-50 rounded-xl border border-amber-100 mb-4",children:[i.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[i.jsx("span",{className:"text-slate-600",children:"Total Facture"}),i.jsx("span",{className:"font-bold",children:xe(((He=fe.find(j=>j.id===Re))==null?void 0:He.totalAmount)||0)})]}),i.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[i.jsx("span",{className:"text-slate-600",children:"Déjà Payé"}),i.jsx("span",{className:"font-bold text-emerald-600",children:xe(((Tt=fe.find(j=>j.id===Re))==null?void 0:Tt.amountPaid)||0)})]}),i.jsxs("div",{className:"flex justify-between text-sm border-t border-amber-200 pt-2",children:[i.jsx("span",{className:"font-bold text-amber-800",children:"Reste à Payer"}),i.jsx("span",{className:"font-bold text-red-600",children:xe((((Jt=fe.find(j=>j.id===Re))==null?void 0:Jt.totalAmount)||0)-(((V=fe.find(j=>j.id===Re))==null?void 0:V.amountPaid)||0))})]})]}),i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Montant du Règlement"}),i.jsxs("div",{className:"relative mb-6",children:[i.jsx("input",{type:"number",min:"0",step:"0.01",className:"w-full pl-4 pr-12 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500/20 text-lg font-bold text-slate-800",value:re,onChange:j=>Be(parseFloat(j.target.value)||0)}),i.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold",children:c.code})]}),i.jsxs("div",{className:"flex justify-end space-x-3",children:[i.jsx("button",{type:"button",onClick:()=>Ce(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:"Annuler"}),i.jsx("button",{type:"submit",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700",children:"Confirmer"})]})]})]}):i.jsxs("div",{className:"text-center py-8 text-slate-400 bg-slate-50 rounded-xl border border-dashed border-slate-200",children:[i.jsx("p",{children:"Aucune créance client en cours."}),i.jsx("button",{type:"button",onClick:()=>Ce(!1),className:"mt-4 px-4 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 hover:bg-slate-50",children:"Fermer"})]})})]})}),Ze&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/90 backdrop-blur-md flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-8 text-center animate-fade-in-up border-b-4 border-red-600 relative",children:[i.jsx("button",{onClick:()=>ze(!1),className:"absolute top-3 right-3 text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"w-6 h-6"})}),i.jsx("div",{className:"w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner",children:i.jsx(bn,{className:"w-10 h-10 text-red-600"})}),i.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Caisse actuellement clôturée"}),i.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200 mb-6 mt-4",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Réouverture automatique"}),i.jsx("span",{className:"font-mono font-bold text-slate-800",children:de==null?void 0:de.reopeningTime})]}),i.jsxs("div",{className:"border-t border-slate-200 pt-2 flex justify-between items-center",children:[i.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Temps restant"}),i.jsx("span",{className:"font-bold text-indigo-600",children:de==null?void 0:de.remainingText})]})]}),i.jsx("button",{onClick:()=>ze(!1),className:"w-full py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition-colors",children:"OK"})]})})]})},PN=[{code:"fr",label:"Français"},{code:"en",label:"English"},{code:"es",label:"Español"},{code:"de",label:"Deutsch"},{code:"it",label:"Italiano"},{code:"pt",label:"Português"},{code:"zh",label:"中文 (Chinese)"},{code:"ja",label:"日本語 (Japanese)"},{code:"ar",label:"العربية (Arabic)"},{code:"ru",label:"Русский (Russian)"}],kN=({currentSettings:n,onUpdateSettings:e,currentCurrency:t,onUpdateCurrency:s,currentUser:r,onUpdateUser:a,onExportData:o,onImportData:c,onCloudSync:u,lang:h="fr",inventory:f,transactions:p,expenses:_,cashMovements:A})=>{const P=r.permissions.includes("settings.view_profile"),k=r.permissions.includes("settings.view_store"),T=r.permissions.includes("settings.view_data"),[U,K]=w.useState(P?"PROFILE":k?"STORE":T?"DATA":"PROFILE"),[D,$]=w.useState(n),[H,Q]=w.useState(t),[N,b]=w.useState(!1),[g,v]=w.useState(!1),[S,E]=w.useState(r.name),[y,ke]=w.useState(r.pin),[Y,Fe]=w.useState(r.email||""),[J,_e]=w.useState(r.phone||""),[Ce,Re]=w.useState(!1),[Xe,Ee]=w.useState(!1),[Ne,W]=w.useState(""),[ue,Te]=w.useState(null),[ye,re]=w.useState(!1),[Be,Ze]=w.useState(!1),[ze,de]=w.useState(null),[dt,et]=w.useState(""),[st,ft]=w.useState(void 0),[yt,Qe]=w.useState("ALL"),ot=w.useRef(null),Et=w.useRef(null),ut=w.useRef(null),Se=r.role==="ADMIN",oe=G=>Qi(h,G),lt=D.themeColor||"#4f46e5",B=!!ne,ie=G=>{G.preventDefault(),e(D),s(H),b(!0),setTimeout(()=>b(!1),3e3)},ve=G=>{G.preventDefault(),!(!S||!y)&&(a(r.id,{name:S,pin:y,email:Y,phone:J}),Re(!0),setTimeout(()=>Re(!1),3e3))},nt=G=>{var Ke;const Je=(Ke=G.target.files)==null?void 0:Ke[0];if(!Je)return;const qe=new FileReader;qe.onload=vt=>{var He;try{const Tt=JSON.parse((He=vt.target)==null?void 0:He.result);window.confirm("Attention : Cette action va écraser toutes les données actuelles (Stocks, Ventes, Utilisateurs). Êtes-vous sûr de vouloir restaurer cette sauvegarde ?")&&c(Tt)}catch(Tt){alert("Erreur : Le fichier sélectionné n'est pas valide.")}},qe.readAsText(Je),ot.current&&(ot.current.value="")},M=G=>{var Ke;const Je=(Ke=G.target.files)==null?void 0:Ke[0];if(!Je)return;if(Je.size>2*1024*1024){alert("L'image du logo est trop volumineuse (Max 2Mo).");return}const qe=new FileReader;qe.onload=vt=>{var Tt;const He=(Tt=vt.target)==null?void 0:Tt.result;$(Ue(je({},D),{logoUrl:He}))},qe.readAsDataURL(Je)},ge=G=>{var Ke;const Je=(Ke=G.target.files)==null?void 0:Ke[0];if(!Je)return;if(Je.size>4*1024*1024){alert("L'image de référence est trop volumineuse (Max 4Mo).");return}const qe=new FileReader;qe.onload=vt=>{var He;ft((He=vt.target)==null?void 0:He.result)},qe.readAsDataURL(Je)},De=()=>{const G=D.recoveryKey?"Régénérer la clé invalidera l'ancienne. Continuer ?":"Générer une nouvelle clé de secours ?";if(window.confirm(G)){const Je="REC-"+Math.random().toString(36).substring(2,10).toUpperCase();$(qe=>Ue(je({},qe),{recoveryKey:Je})),e(Ue(je({},D),{recoveryKey:Je}))}},fe=()=>{D.recoveryKey&&(navigator.clipboard.writeText(D.recoveryKey),alert("Clé copiée !"))},xe=()=>{if(Te(null),!Ne.trim()){Te("Veuillez coller la configuration JSON.");return}if(!Ne.trim().startsWith("{")){Te("Format invalide : Le texte doit être un objet JSON complet commençant par '{'.");return}mu(Ne)?(Ee(!1),window.confirm("Configuration enregistrée ! L'application doit redémarrer pour se connecter. Redémarrer maintenant ?")&&window.location.reload()):Te("Configuration invalide. Vérifiez le format JSON et les clés (apiKey, projectId).")},Qt=()=>{if(!D.name){alert("Veuillez d'abord entrer le nom de l'entreprise.");return}de(null),et(""),ft(void 0),re(!0)},Rt=()=>I(Me,null,function*(){Ze(!0);try{const G=yield tm(D.name,dt,st);if(G){const qe=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(G)))}`;de(qe)}}catch(G){console.error(G),alert(`Impossible de générer le logo.
Erreur: ${G.message||"Vérifiez la connexion internet."}`),re(!1)}finally{Ze(!1)}}),ts=()=>{ze&&$(Ue(je({},D),{logoUrl:ze})),re(!1)},ss=(G,Je,qe)=>{const Ke=new Blob([qe==="CSV"?"\uFEFF"+G:G],{type:qe==="CSV"?"text/csv;charset=utf-8;":qe==="WORD"?"application/msword":"text/plain;charset=utf-8;"}),vt=URL.createObjectURL(Ke),He=document.createElement("a");He.href=vt,He.download=Je,document.body.appendChild(He),He.click(),document.body.removeChild(He)},Lt=G=>{const Je=new Date().toISOString().split("T")[0];let qe="",Ke=`Rapport_${yt}_${Je}`;G==="CSV"&&(Ke+=".csv"),G==="WORD"&&(Ke+=".doc"),G==="TXT"&&(Ke+=".txt"),qe="Rapport Generated",ss(qe,Ke,G)};return i.jsxs("div",{className:"space-y-6 animate-fade-in text-slate-800 dark:text-slate-100",children:[i.jsxs("header",{className:"mb-6",children:[i.jsxs("h2",{className:"text-3xl font-bold flex items-center",children:[i.jsx(Vh,{className:"w-8 h-8 mr-3"}),oe("settings_title")]}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:oe("settings_subtitle")})]}),i.jsxs("div",{className:"flex border-b border-slate-200 dark:border-slate-700 mb-6 overflow-x-auto",children:[P&&i.jsxs("button",{onClick:()=>K("PROFILE"),className:`px-6 py-3 font-medium text-sm transition-colors relative whitespace-nowrap ${U==="PROFILE"?"text-indigo-600 dark:text-indigo-400":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"}`,children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(vs,{className:"w-4 h-4 mr-2"})," ",oe("tab_profile")]}),U==="PROFILE"&&i.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-indigo-600 dark:bg-indigo-400 rounded-t-full"})]}),k&&i.jsxs("button",{onClick:()=>K("STORE"),className:`px-6 py-3 font-medium text-sm transition-colors relative whitespace-nowrap ${U==="STORE"?"text-indigo-600 dark:text-indigo-400":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"}`,children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(Rr,{className:"w-4 h-4 mr-2"})," ",oe("tab_store")]}),U==="STORE"&&i.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-indigo-600 dark:bg-indigo-400 rounded-t-full"})]}),T&&i.jsxs("button",{onClick:()=>K("DATA"),className:`px-6 py-3 font-medium text-sm transition-colors relative whitespace-nowrap ${U==="DATA"?"text-indigo-600 dark:text-indigo-400":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"}`,children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(Nl,{className:"w-4 h-4 mr-2"})," ",oe("tab_data")]}),U==="DATA"&&i.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-indigo-600 dark:bg-indigo-400 rounded-t-full"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[U==="PROFILE"&&P&&i.jsxs("div",{className:"xl:col-span-2 bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 space-y-6 animate-fade-in",children:[i.jsx("h3",{className:"text-lg font-bold mb-4",children:oe("edit_profile")}),i.jsxs("form",{onSubmit:ve,className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[i.jsx("img",{src:r.avatar,alt:"Avatar",className:"w-16 h-16 rounded-full border-2 border-emerald-100"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:oe("connected_account")}),i.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${Se?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:Se?"Administrateur":"Vendeur"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:oe("username")}),i.jsx("input",{type:"text",value:S,onChange:G=>E(G.target.value),required:!0,className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 bg-white dark:bg-slate-700 dark:text-white"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 flex items-center",children:[i.jsx(no,{className:"w-4 h-4 mr-1 text-slate-400"}),oe("pin_code")]}),i.jsx("input",{type:"password",value:y,onChange:G=>ke(G.target.value),required:!0,maxLength:4,pattern:"\\d{4}",className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 font-mono tracking-widest bg-white dark:bg-slate-700 dark:text-white"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 flex items-center",children:[i.jsx(To,{className:"w-4 h-4 mr-1 text-slate-400"}),"Email Personnel"]}),i.jsx("input",{type:"email",value:Y,onChange:G=>Fe(G.target.value),placeholder:"user@example.com",className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 bg-white dark:bg-slate-700 dark:text-white"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 flex items-center",children:[i.jsx(Di,{className:"w-4 h-4 mr-1 text-slate-400"}),"Téléphone Personnel"]}),i.jsx("input",{type:"tel",value:J,onChange:G=>_e(G.target.value),placeholder:"+33 6...",className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 bg-white dark:bg-slate-700 dark:text-white"})]})]}),i.jsxs("div",{className:"flex justify-end items-center space-x-4 pt-4 border-t border-slate-50 dark:border-slate-700",children:[Ce&&i.jsxs("span",{className:"text-emerald-600 font-medium text-sm flex items-center animate-fade-in",children:[i.jsx(Ur,{className:"w-4 h-4 mr-1"})," ",oe("profile_saved")]}),i.jsx("button",{type:"submit",className:"bg-slate-800 hover:bg-slate-900 text-white px-6 py-3 rounded-xl font-medium shadow-lg shadow-slate-200 transition-all transform hover:scale-[1.02]",children:oe("save_profile")})]})]})]}),U==="STORE"&&k&&i.jsx("div",{className:"xl:col-span-2 space-y-6",children:i.jsxs("form",{onSubmit:ie,className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 space-y-6 animate-fade-in",children:[i.jsx("h3",{className:"text-lg font-bold mb-4",children:oe("general_config")}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl border border-slate-100 dark:border-slate-600",children:[i.jsxs("label",{className:"block text-sm font-bold mb-3 flex items-center",children:[D.themeMode==="dark"?i.jsx(Ug,{className:"w-4 h-4 mr-2"}):i.jsx(Bg,{className:"w-4 h-4 mr-2"}),oe("appearance")]}),i.jsxs("div",{className:"flex bg-slate-200 dark:bg-slate-800 p-1 rounded-lg",children:[i.jsx("button",{type:"button",onClick:()=>$(Ue(je({},D),{themeMode:"light"})),className:`flex-1 py-2 rounded-md text-sm font-medium transition-all ${D.themeMode!=="dark"?"bg-white shadow-sm text-slate-900":"text-slate-500 hover:text-slate-300"}`,children:oe("light")}),i.jsx("button",{type:"button",onClick:()=>$(Ue(je({},D),{themeMode:"dark"})),className:`flex-1 py-2 rounded-md text-sm font-medium transition-all ${D.themeMode==="dark"?"bg-slate-600 shadow-sm text-white":"text-slate-500 hover:text-slate-700"}`,children:oe("dark")})]})]}),i.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl border border-slate-100 dark:border-slate-600",children:[i.jsxs("label",{className:"block text-sm font-bold mb-3 flex items-center",children:[i.jsx(qg,{className:"w-4 h-4 mr-2"}),oe("primary_color")]}),i.jsx("div",{className:"flex flex-wrap gap-3",children:ax.map(G=>i.jsx("button",{type:"button",onClick:()=>$(Ue(je({},D),{themeColor:G.hex})),className:`w-8 h-8 rounded-full border-2 transition-transform hover:scale-110 focus:outline-none ${lt===G.hex?"border-slate-900 dark:border-white ring-2 ring-offset-2 ring-slate-200 dark:ring-slate-700":"border-transparent"}`,style:{backgroundColor:G.hex},title:G.label},G.id))})]})]}),i.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl border border-slate-200 dark:border-slate-600",children:[i.jsxs("label",{className:"block text-sm font-bold mb-3 flex items-center",children:[i.jsx(lc,{className:"w-4 h-4 mr-2"}),oe("company_logo")]}),i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx("div",{className:"w-20 h-20 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-600 flex items-center justify-center overflow-hidden",children:D.logoUrl?i.jsx("img",{src:D.logoUrl,alt:"Logo",className:"w-full h-full object-contain"}):i.jsx(Rr,{className:"w-8 h-8 text-slate-300"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{type:"button",onClick:()=>{var G;return(G=Et.current)==null?void 0:G.click()},className:"text-xs bg-slate-800 text-white px-3 py-2 rounded-lg hover:bg-slate-900 transition-colors",children:oe("load_logo")}),i.jsxs("button",{type:"button",onClick:Qt,disabled:!D.name,className:"text-xs bg-indigo-50 hover:bg-indigo-100 text-indigo-700 border border-indigo-200 px-3 py-2 rounded-lg transition-colors flex items-center justify-center font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx(Qn,{className:"w-3 h-3 mr-2"}),"Générer par IA"]}),D.logoUrl&&i.jsx("button",{type:"button",onClick:()=>$(Ue(je({},D),{logoUrl:void 0})),className:"text-xs bg-red-100 text-red-700 px-3 py-2 rounded-lg hover:bg-red-200 transition-colors",children:oe("remove")})]}),i.jsx("input",{type:"file",ref:Et,onChange:M,accept:"image/*",className:"hidden"})]})]})]}),i.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-xl border border-amber-100 dark:border-amber-800",children:[i.jsxs("label",{className:"block text-sm font-bold text-amber-900 dark:text-amber-400 mb-3 flex items-center",children:[i.jsx(no,{className:"w-4 h-4 mr-2"}),"Sécurité & Accès"]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-xs text-amber-800 dark:text-amber-300 font-medium",children:"Clé de Récupération (Admin)"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx("input",{type:g?"text":"password",readOnly:!0,value:D.recoveryKey||"",placeholder:D.recoveryKey?"":"Non générée - Cliquez sur Générer",className:"w-full px-3 py-2 border border-amber-200 dark:border-amber-700 bg-white dark:bg-slate-800 rounded-lg text-sm text-slate-600 dark:text-slate-300 font-mono"}),i.jsx("button",{type:"button",onClick:()=>v(!g),className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",disabled:!D.recoveryKey,children:g?i.jsx($g,{className:"w-4 h-4"}):i.jsx(en,{className:"w-4 h-4"})})]}),D.recoveryKey&&i.jsx("button",{type:"button",onClick:fe,className:"bg-white dark:bg-slate-700 border border-amber-200 dark:border-amber-700 p-2 rounded-lg hover:bg-amber-100 dark:hover:bg-slate-600 text-amber-700 dark:text-amber-400 transition-colors",title:"Copier",children:i.jsx(Wh,{className:"w-4 h-4"})}),i.jsxs("button",{type:"button",onClick:De,className:`bg-white dark:bg-slate-700 border border-amber-200 dark:border-amber-700 p-2 rounded-lg hover:bg-amber-100 dark:hover:bg-slate-600 transition-colors ${D.recoveryKey?"":"w-auto px-4 flex items-center text-xs font-bold"}`,title:D.recoveryKey?"Régénérer":"Générer Clé",children:[i.jsx(Qh,{className:`w-4 h-4 ${D.recoveryKey?"":"mr-2"}`}),D.recoveryKey?"":"Générer"]})]}),i.jsx("p",{className:"text-[10px] text-amber-700 dark:text-amber-500 mt-1",children:D.recoveryKey?"Cette clé sert à réinitialiser le code PIN admin si nécessaire.":"Aucune clé de récupération n'est définie. Veuillez en générer une maintenant."})]})]}),i.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 p-4 rounded-xl border border-indigo-100 dark:border-indigo-800 flex items-start space-x-4",children:[i.jsx("div",{className:"bg-white dark:bg-indigo-900 p-2 rounded-lg shadow-sm",children:i.jsx(Qn,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-indigo-900 dark:text-indigo-300",children:oe("ai_active")}),i.jsx("p",{className:"text-xs text-indigo-700 dark:text-indigo-400 mt-1",children:oe("ai_ready")})]})]}),i.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl border border-slate-200 dark:border-slate-600",children:[i.jsxs("label",{className:"block text-sm font-bold mb-3 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(Gg,{className:"w-4 h-4 mr-2"}),oe("software_update")]}),i.jsxs("span",{className:"text-xs bg-slate-200 dark:bg-slate-600 px-2 py-1 rounded-full font-mono",children:["v","1.0.4"]})]}),i.jsx("div",{className:"flex gap-2",children:i.jsx("input",{type:"text",value:D.githubRepo||"",onChange:G=>$(Ue(je({},D),{githubRepo:G.target.value})),className:"flex-1 px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-800",placeholder:"username/repository"})}),i.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400 mt-1",children:"Dépôt source pour la vérification automatique des nouvelles versions."})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[i.jsx(Jh,{className:"w-4 h-4 inline mr-1 text-slate-400"}),oe("currency_lang")]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx("select",{value:H,onChange:G=>Q(G.target.value),className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl bg-slate-50 dark:bg-slate-700",children:Object.values(Tl).map(G=>i.jsxs("option",{value:G.code,children:[G.label," (",G.symbol,")"]},G.code))}),i.jsx("select",{value:D.language,onChange:G=>$(Ue(je({},D),{language:G.target.value})),className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl bg-slate-50 dark:bg-slate-700",children:PN.map(G=>i.jsx("option",{value:G.code,children:G.label},G.code))})]})]}),i.jsxs("div",{className:"space-y-4 border-t border-slate-100 dark:border-slate-700 pt-4",children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:oe("company_details")}),i.jsx("input",{type:"text",value:D.name,onChange:G=>$(Ue(je({},D),{name:G.target.value})),className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700",placeholder:oe("store_name")}),i.jsx("input",{type:"text",value:D.address,onChange:G=>$(Ue(je({},D),{address:G.target.value})),className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700",placeholder:oe("address")}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx("input",{type:"text",value:D.phone,onChange:G=>$(Ue(je({},D),{phone:G.target.value})),className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700",placeholder:oe("phone")}),i.jsx("input",{type:"email",value:D.email,onChange:G=>$(Ue(je({},D),{email:G.target.value})),className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700",placeholder:oe("email")})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Registre Commerce"}),i.jsx("input",{type:"text",value:D.rccm||"",onChange:G=>$(Ue(je({},D),{rccm:G.target.value})),className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 font-mono text-sm",placeholder:"RCCM / SIRET"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Numéro Fiscal (NIF)"}),i.jsx("input",{type:"text",value:D.nif||"",onChange:G=>$(Ue(je({},D),{nif:G.target.value})),className:"w-full p-3 border border-slate-200 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 font-mono text-sm",placeholder:"NIF / TIN"})]})]})]})]}),i.jsxs("div",{className:"flex justify-end items-center space-x-4 pt-4 border-t border-slate-100 dark:border-slate-700",children:[N&&i.jsxs("span",{className:"text-emerald-600 font-medium text-sm flex items-center animate-fade-in",children:[i.jsx(Ur,{className:"w-4 h-4 mr-1"})," ",oe("settings_saved")]}),i.jsxs("button",{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-bold flex items-center shadow-xl shadow-indigo-200 transition-all transform hover:scale-[1.02]",children:[i.jsx(Eo,{className:"w-5 h-5 mr-2"}),oe("update_btn")]})]})]})}),U==="DATA"&&T&&i.jsxs("div",{className:"xl:col-span-3 grid grid-cols-1 lg:grid-cols-3 gap-6 animate-fade-in",children:[i.jsxs("div",{className:"lg:col-span-3 bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(zu,{className:`w-5 h-5 ${B?"text-emerald-500":"text-red-500"}`}),i.jsx("h3",{className:"text-lg font-bold",children:"Base de Données"})]}),i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${B?"bg-emerald-100 text-emerald-800":"bg-red-100 text-red-800"}`,children:B?"CONNECTÉ (Firebase)":"DÉCONNECTÉ (Mode Local)"})]}),i.jsx("p",{className:"text-sm text-slate-500 mb-4",children:B?"Votre application est synchronisée en temps réel avec le cloud Google Firebase. Vos données sont sécurisées.":"L'application fonctionne actuellement sans serveur. Les données ne sont pas partagées entre les appareils."})]}),i.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 space-y-6",children:[i.jsxs("div",{className:"flex items-center space-x-2 border-b border-slate-100 dark:border-slate-700 pb-4",children:[i.jsx(Nl,{className:"w-5 h-5 text-blue-500"}),i.jsx("h3",{className:"text-lg font-bold",children:oe("cloud_sync")})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:i.jsxs("div",{className:`border rounded-xl p-4 flex flex-col items-center text-center transition-all ${n.cloudProvider==="GOOGLE_DRIVE"?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 ring-2 ring-indigo-500/20":"border-slate-200 dark:border-slate-600 hover:border-slate-300"}`,children:[i.jsx("h4",{className:"font-bold",children:"Google Drive"}),i.jsx("button",{onClick:()=>u("GOOGLE_DRIVE"),className:`text-xs font-bold px-4 py-2 rounded-lg w-full mt-2 ${n.cloudProvider==="GOOGLE_DRIVE"?"bg-indigo-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-200"}`,children:n.cloudProvider==="GOOGLE_DRIVE"?oe("active"):oe("save")})]})})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 space-y-6",children:[i.jsxs("div",{className:"flex items-center space-x-2 border-b border-slate-100 dark:border-slate-700 pb-4",children:[i.jsx(Cs,{className:"w-5 h-5 text-purple-600"}),i.jsx("h3",{className:"text-lg font-bold",children:"Rapports & Exportations"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Type de données"}),i.jsxs("select",{value:yt,onChange:G=>Qe(G.target.value),className:"w-full p-2 border border-slate-200 dark:border-slate-600 rounded-lg text-sm bg-slate-50 dark:bg-slate-700",children:[i.jsx("option",{value:"ALL",children:"Tout"}),i.jsx("option",{value:"SALES",children:"Ventes"}),i.jsx("option",{value:"STOCK",children:"Stocks"}),i.jsx("option",{value:"CASH",children:"Mouvements Caisse"}),i.jsx("option",{value:"EXPENSES",children:"Dépenses"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[i.jsxs("button",{onClick:()=>Lt("CSV"),className:"flex items-center justify-center px-4 py-2 border border-slate-200 rounded-lg hover:bg-emerald-50",children:[i.jsx(Gh,{className:"w-4 h-4 mr-2 text-emerald-600"}),i.jsx("span",{className:"text-sm",children:"Excel"})]}),i.jsxs("button",{onClick:()=>Lt("WORD"),className:"flex items-center justify-center px-4 py-2 border border-slate-200 rounded-lg hover:bg-blue-50",children:[i.jsx(Cs,{className:"w-4 h-4 mr-2 text-blue-600"}),i.jsx("span",{className:"text-sm",children:"Word"})]}),i.jsxs("button",{onClick:()=>Lt("TXT"),className:"flex items-center justify-center px-4 py-2 border border-slate-200 rounded-lg hover:bg-slate-50",children:[i.jsx(zh,{className:"w-4 h-4 mr-2 text-slate-500"}),i.jsx("span",{className:"text-sm",children:"Txt"})]})]})]})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 space-y-6",children:[i.jsxs("div",{className:"flex items-center space-x-2 border-b border-slate-100 dark:border-slate-700 pb-4",children:[i.jsx(zu,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"}),i.jsx("h3",{className:"text-lg font-bold",children:oe("local_backup")})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("button",{onClick:o,className:"flex items-center w-full p-3 bg-slate-50 dark:bg-slate-700 hover:bg-slate-100 border border-slate-200 rounded-xl transition-colors",children:[i.jsx(ac,{className:"w-5 h-5 text-emerald-600 mr-3"})," ",i.jsx("span",{className:"font-bold",children:oe("export_json")})]}),i.jsxs("button",{onClick:()=>{var G;return(G=ot.current)==null?void 0:G.click()},className:"flex items-center w-full p-3 bg-slate-50 dark:bg-slate-700 hover:bg-slate-100 border border-slate-200 rounded-xl transition-colors",children:[i.jsx(wl,{className:"w-5 h-5 text-blue-600 mr-3"})," ",i.jsx("span",{className:"font-bold",children:oe("import_json")})]}),i.jsx("input",{type:"file",ref:ot,onChange:nt,accept:".json",className:"hidden"})]})]})]})]}),Xe&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/50 flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-fade-in-up",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h3",{className:"text-xl font-bold",children:"Connexion Firebase"}),i.jsx("button",{onClick:()=>Ee(!1),children:i.jsx(Vt,{className:"w-6 h-6"})})]}),i.jsx("textarea",{className:"w-full h-48 p-3 border rounded-xl font-mono text-xs",value:Ne,onChange:G=>W(G.target.value)}),i.jsx("div",{className:"flex justify-end space-x-3 mt-4",children:i.jsx("button",{onClick:xe,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold",children:"Connecter"})})]})}),ye&&i.jsx("div",{className:"fixed inset-0 bg-slate-950/90 backdrop-blur-sm flex items-center justify-center p-4 z-[60]",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-fade-in-up border-t-4 border-indigo-500",children:[i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4 text-center",children:"Création de Logo IA"}),i.jsx("div",{className:"flex flex-col items-center justify-center py-4 min-h-[200px]",children:Be?i.jsx("div",{className:"text-center animate-pulse",children:i.jsx("p",{className:"text-indigo-700 font-bold",children:"Création..."})}):ze?i.jsxs("div",{className:"flex flex-col items-center w-full",children:[i.jsx("img",{src:ze,className:"w-40 h-40 object-contain mb-6"}),i.jsxs("div",{className:"flex gap-3 w-full",children:[i.jsx("button",{onClick:Rt,className:"flex-1 py-2 bg-slate-100 rounded",children:"Refaire"}),i.jsx("button",{onClick:ts,className:"flex-1 py-2 bg-indigo-600 text-white rounded",children:"Valider"})]})]}):i.jsxs("div",{className:"w-full",children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Description (Optionnel)"}),i.jsx("textarea",{className:"w-full px-3 py-2 border rounded mb-4 h-20 text-sm",value:dt,onChange:G=>et(G.target.value),placeholder:"Ex: Moderne, minimaliste, bleu..."}),i.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Image de référence (Optionnel)"}),i.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[i.jsxs("button",{onClick:()=>{var G;return(G=ut.current)==null?void 0:G.click()},className:"flex-1 py-2 bg-slate-100 text-slate-600 rounded text-xs font-bold flex items-center justify-center hover:bg-slate-200",children:[i.jsx(wl,{className:"w-3 h-3 mr-2"}),st?"Changer l'image":"Charger une image"]}),st&&i.jsxs("div",{className:"relative group w-10 h-10 border rounded overflow-hidden",children:[i.jsx("img",{src:st,className:"w-full h-full object-cover"}),i.jsx("button",{onClick:()=>ft(void 0),className:"absolute inset-0 bg-red-500/50 flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-opacity",children:i.jsx(Vt,{className:"w-4 h-4"})})]}),i.jsx("input",{type:"file",ref:ut,onChange:ge,accept:"image/*",className:"hidden"})]}),i.jsx("button",{onClick:Rt,className:"w-full py-2 bg-indigo-600 text-white rounded font-bold shadow-lg hover:bg-indigo-700 transition-colors",children:"Générer"})]})})]})})]})},DN=({customers:n,onAddCustomer:e,onUpdateCustomer:t,onDeleteCustomer:s,currency:r})=>{const[a,o]=w.useState(""),[c,u]=w.useState(!1),[h,f]=w.useState(null),[p,_]=w.useState(""),[A,P]=w.useState(""),[k,T]=w.useState(""),[U,K]=w.useState(""),[D,$]=w.useState(""),H=n.filter(E=>E.name.toLowerCase().includes(a.toLowerCase())||E.phone.includes(a)||E.email&&E.email.toLowerCase().includes(a.toLowerCase())),Q=E=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:r.code,minimumFractionDigits:r.code==="XOF"?0:2,maximumFractionDigits:r.code==="XOF"?0:2}).format(E*r.rate),N=()=>{f(null),_(""),P(""),T(""),K(""),$("")},b=()=>{N(),u(!0)},g=E=>{f(E.id),_(E.name),P(E.phone),T(E.email||""),K(E.address||""),$(E.notes||""),u(!0)},v=E=>{window.confirm("Êtes-vous sûr de vouloir supprimer ce client ? Cette action est irréversible.")&&s(E)},S=E=>{if(E.preventDefault(),!!p){if(h)t(h,{name:p,phone:A,email:k,address:U,notes:D});else{const y={id:`c-${Date.now()}`,name:p,phone:A,email:k,address:U,notes:D,totalSpent:0};e(y)}u(!1),N()}};return i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsxs("header",{className:"flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Gestion Clients"}),i.jsx("p",{className:"text-slate-500",children:"Base de données clients et historique."})]}),i.jsxs("button",{onClick:b,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2.5 rounded-xl font-medium flex items-center shadow-lg shadow-indigo-200 transition-colors",children:[i.jsx(Qs,{className:"w-5 h-5 mr-2"})," Nouveau Client"]})]}),i.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center",children:[i.jsx(Xn,{className:"text-slate-400 w-5 h-5 mr-3"}),i.jsx("input",{type:"text",placeholder:"Rechercher par nom, téléphone ou email...",className:"flex-1 outline-none text-slate-700 placeholder-slate-400",value:a,onChange:E=>o(E.target.value)})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[H.map(E=>i.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-slate-100 hover:shadow-md transition-shadow group relative",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold text-lg",children:E.name.charAt(0).toUpperCase()}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:E.name}),i.jsxs("span",{className:"inline-flex items-center text-xs text-slate-500",children:[i.jsx(Mh,{className:"w-3 h-3 mr-1"}),"Total: ",i.jsx("span",{className:"font-semibold text-indigo-600 ml-1",children:Q(E.totalSpent)})]})]})]}),i.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[i.jsx("button",{onClick:()=>g(E),className:"p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg",children:i.jsx(Wi,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>v(E.id),className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg",children:i.jsx(Vs,{className:"w-4 h-4"})})]})]}),i.jsxs("div",{className:"space-y-3 text-sm",children:[i.jsxs("div",{className:"flex items-center text-slate-600",children:[i.jsx(Di,{className:"w-4 h-4 mr-2 text-slate-400"}),E.phone||i.jsx("span",{className:"text-slate-300 italic",children:"Non renseigné"})]}),i.jsxs("div",{className:"flex items-center text-slate-600",children:[i.jsx(To,{className:"w-4 h-4 mr-2 text-slate-400"}),E.email||i.jsx("span",{className:"text-slate-300 italic",children:"Non renseigné"})]}),i.jsxs("div",{className:"flex items-start text-slate-600",children:[i.jsx(oc,{className:"w-4 h-4 mr-2 text-slate-400 mt-0.5"}),i.jsx("span",{className:"flex-1",children:E.address||i.jsx("span",{className:"text-slate-300 italic",children:"Non renseigné"})})]}),E.notes&&i.jsxs("div",{className:"mt-3 p-3 bg-amber-50 rounded-lg border border-amber-100 text-xs text-amber-800",children:[i.jsx(Cs,{className:"w-3 h-3 inline mr-1 mb-0.5"}),E.notes]})]})]},E.id)),H.length===0&&i.jsxs("div",{className:"col-span-full py-12 text-center text-slate-400 bg-white rounded-2xl border border-dashed border-slate-200",children:[i.jsx(vs,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),i.jsx("p",{children:"Aucun client trouvé."})]})]}),c&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in-up my-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-slate-100 pb-4",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800",children:h?"Modifier le client":"Nouveau client"}),i.jsx("button",{onClick:()=>u(!1),className:"text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"w-6 h-6"})})]}),i.jsxs("form",{onSubmit:S,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nom complet"}),i.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20",value:p,onChange:E=>_(E.target.value),placeholder:"Ex: Jean Dupont"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Téléphone"}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:A,onChange:E=>P(E.target.value),placeholder:"06..."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Email"}),i.jsx("input",{type:"email",className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:k,onChange:E=>T(E.target.value),placeholder:"client@mail.com"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Adresse"}),i.jsx("textarea",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg resize-none h-20",value:U,onChange:E=>K(E.target.value),placeholder:"Adresse postale..."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Notes internes"}),i.jsx("textarea",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg resize-none h-20 bg-amber-50 border-amber-200",value:D,onChange:E=>$(E.target.value),placeholder:"Préférences, historique, etc..."})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-slate-100",children:[i.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:"Annuler"}),i.jsxs("button",{type:"submit",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 shadow-lg shadow-indigo-200 flex items-center",children:[i.jsx(Eo,{className:"w-4 h-4 mr-2"}),"Enregistrer"]})]})]})]})})]})},VN=({suppliers:n,onAddSupplier:e,onUpdateSupplier:t,onDeleteSupplier:s,currency:r})=>{const[a,o]=w.useState(""),[c,u]=w.useState(!1),[h,f]=w.useState(null),[p,_]=w.useState(""),[A,P]=w.useState(""),[k,T]=w.useState(""),[U,K]=w.useState(""),[D,$]=w.useState(""),[H,Q]=w.useState(""),[N,b]=w.useState(""),g=n.filter(Y=>Y.name.toLowerCase().includes(a.toLowerCase())||Y.phone.includes(a)||Y.email&&Y.email.toLowerCase().includes(a.toLowerCase())),v=()=>{f(null),_(""),P(""),T(""),K(""),$(""),Q(""),b("")},S=()=>{v(),u(!0)},E=Y=>{f(Y.id),_(Y.name),P(Y.contactName||""),T(Y.phone),K(Y.email||""),$(Y.address||""),Q(Y.website||""),b(Y.notes||""),u(!0)},y=Y=>{window.confirm("Êtes-vous sûr de vouloir supprimer ce fournisseur ? Cette action est irréversible.")&&s(Y)},ke=Y=>{if(Y.preventDefault(),!!p){if(h)t(h,{name:p,contactName:A,phone:k,email:U,address:D,website:H,notes:N});else{const Fe={id:`s-${Date.now()}`,name:p,contactName:A,phone:k,email:U,address:D,website:H,notes:N};e(Fe)}u(!1),v()}};return i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsxs("header",{className:"flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Gestion Fournisseurs"}),i.jsx("p",{className:"text-slate-500",children:"Carnet d'adresses pour les approvisionnements."})]}),i.jsxs("button",{onClick:S,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2.5 rounded-xl font-medium flex items-center shadow-lg shadow-indigo-200 transition-colors",children:[i.jsx(Qs,{className:"w-5 h-5 mr-2"})," Nouveau Fournisseur"]})]}),i.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center",children:[i.jsx(Xn,{className:"text-slate-400 w-5 h-5 mr-3"}),i.jsx("input",{type:"text",placeholder:"Rechercher par nom, téléphone ou email...",className:"flex-1 outline-none text-slate-700 placeholder-slate-400",value:a,onChange:Y=>o(Y.target.value)})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[g.map(Y=>i.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-slate-100 hover:shadow-md transition-shadow group relative",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-600 font-bold text-lg",children:Y.name.charAt(0).toUpperCase()}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:Y.name}),i.jsxs("span",{className:"text-xs text-slate-500 flex items-center",children:[i.jsx(vs,{className:"w-3 h-3 mr-1"}),Y.contactName||"Aucun contact"]})]})]}),i.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[i.jsx("button",{onClick:()=>E(Y),className:"p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg",children:i.jsx(Wi,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>y(Y.id),className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg",children:i.jsx(Vs,{className:"w-4 h-4"})})]})]}),i.jsxs("div",{className:"space-y-3 text-sm",children:[i.jsxs("div",{className:"flex items-center text-slate-600",children:[i.jsx(Di,{className:"w-4 h-4 mr-2 text-slate-400"}),Y.phone||i.jsx("span",{className:"text-slate-300 italic",children:"Non renseigné"})]}),i.jsxs("div",{className:"flex items-center text-slate-600",children:[i.jsx(To,{className:"w-4 h-4 mr-2 text-slate-400"}),Y.email||i.jsx("span",{className:"text-slate-300 italic",children:"Non renseigné"})]}),i.jsxs("div",{className:"flex items-center text-slate-600",children:[i.jsx(Jh,{className:"w-4 h-4 mr-2 text-slate-400"}),Y.website||i.jsx("span",{className:"text-slate-300 italic",children:"Non renseigné"})]}),i.jsxs("div",{className:"flex items-start text-slate-600",children:[i.jsx(oc,{className:"w-4 h-4 mr-2 text-slate-400 mt-0.5"}),i.jsx("span",{className:"flex-1",children:Y.address||i.jsx("span",{className:"text-slate-300 italic",children:"Non renseigné"})})]}),Y.notes&&i.jsxs("div",{className:"mt-3 p-3 bg-slate-50 rounded-lg border border-slate-100 text-xs text-slate-600",children:[i.jsx(Cs,{className:"w-3 h-3 inline mr-1 mb-0.5"}),Y.notes]})]})]},Y.id)),g.length===0&&i.jsxs("div",{className:"col-span-full py-12 text-center text-slate-400 bg-white rounded-2xl border border-dashed border-slate-200",children:[i.jsx(rc,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),i.jsx("p",{children:"Aucun fournisseur trouvé."})]})]}),c&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in-up my-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-slate-100 pb-4",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800",children:h?"Modifier le fournisseur":"Nouveau fournisseur"}),i.jsx("button",{onClick:()=>u(!1),className:"text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"w-6 h-6"})})]}),i.jsxs("form",{onSubmit:ke,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nom Entreprise"}),i.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20",value:p,onChange:Y=>_(Y.target.value),placeholder:"Ex: Grossiste Pro"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nom du Contact"}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20",value:A,onChange:Y=>P(Y.target.value),placeholder:"Ex: Marc Durant"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Téléphone"}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:k,onChange:Y=>T(Y.target.value)})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Email"}),i.jsx("input",{type:"email",className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:U,onChange:Y=>K(Y.target.value)})]})]}),i.jsx("div",{className:"grid grid-cols-2 gap-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Site Web"}),i.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-slate-200 rounded-lg",value:H,onChange:Y=>Q(Y.target.value),placeholder:"www..."})]})}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Adresse"}),i.jsx("textarea",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg resize-none h-16",value:D,onChange:Y=>$(Y.target.value)})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Notes internes"}),i.jsx("textarea",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg resize-none h-16 bg-slate-50",value:N,onChange:Y=>b(Y.target.value)})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-slate-100",children:[i.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:"Annuler"}),i.jsxs("button",{type:"submit",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 shadow-lg shadow-indigo-200 flex items-center",children:[i.jsx(Eo,{className:"w-4 h-4 mr-2"}),"Enregistrer"]})]})]})]})})]})},_i=[{id:"RENT",label:"Loyer & Locaux",color:"#6366f1"},{id:"SALARY",label:"Salaires",color:"#ec4899"},{id:"UTILITIES",label:"Électricité / Eau",color:"#eab308"},{id:"TRANSPORT",label:"Transport",color:"#f97316"},{id:"MARKETING",label:"Marketing / Pub",color:"#8b5cf6"},{id:"MAINTENANCE",label:"Maintenance",color:"#14b8a6"},{id:"TAX",label:"Taxes & Impôts",color:"#ef4444"},{id:"OTHER",label:"Autre",color:"#64748b"}],ON=({expenses:n,onAddExpense:e,onDeleteExpense:t,currency:s,currentUser:r})=>{const[a,o]=w.useState(!1),[c,u]=w.useState("ALL"),[h,f]=w.useState(null),[p,_]=w.useState(0),[A,P]=w.useState("OTHER"),[k,T]=w.useState(""),[U,K]=w.useState(new Date().toISOString().split("T")[0]),[D,$]=w.useState(!1),[H,Q]=w.useState(null),N=r.permissions.includes("expenses.manage")||r.role==="ADMIN",b=n.filter(J=>c==="ALL"||J.category===c),g=b.reduce((J,_e)=>J+_e.amount,0),v=J=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:s.code,minimumFractionDigits:s.code==="XOF"?0:2,maximumFractionDigits:s.code==="XOF"?0:2}).format(J*s.rate),S=()=>I(Me,null,function*(){const J=localStorage.getItem("gesmind_last_store_id");if(J){const _e=yield fu(J,r.id);if(_e.isLocked&&_e.reopenAt){const Ce=_e.reopenAt.getTime()-new Date().getTime(),Re=Math.floor(Ce/(1e3*60*60)),Xe=Math.floor(Ce%(1e3*60*60)/(1e3*60));Q({reopeningTime:"00h00",remainingText:`${Re} heures ${Xe} minutes`}),$(!0);return}}o(!0)}),E=J=>{if(J.preventDefault(),p<=0)return;const _e={id:`exp-${Date.now()}`,amount:p/s.rate,category:A,description:k,date:new Date(U).toISOString(),paidBy:r.name};e(_e),o(!1),y()},y=()=>{_(0),T(""),P("OTHER"),K(new Date().toISOString().split("T")[0])},ke=J=>{N&&f(J)},Y=()=>{h&&(t(h),f(null))},Fe=_i.map(J=>{const _e=n.filter(Ce=>Ce.category===J.id).reduce((Ce,Re)=>Ce+Re.amount,0);return{name:J.label,value:_e,color:J.color}}).filter(J=>J.value>0);return i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsxs("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-bold text-slate-800 flex items-center",children:[i.jsx(ki,{className:"w-8 h-8 mr-3 text-rose-500"}),"Gestion des Dépenses"]}),i.jsx("p",{className:"text-slate-500",children:"Suivi des charges, frais généraux et salaires."})]}),N&&i.jsxs("button",{onClick:S,className:"bg-rose-600 hover:bg-rose-700 text-white px-4 py-2.5 rounded-xl font-medium flex items-center shadow-lg shadow-rose-200 transition-colors",children:[i.jsx(Qs,{className:"w-5 h-5 mr-2"})," Ajouter une dépense"]})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 lg:col-span-1",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center",children:[i.jsx(Fh,{className:"w-5 h-5 mr-2 text-slate-500"})," Répartition"]}),i.jsx("div",{className:"h-64 w-full",children:Fe.length>0?i.jsx(Uh,{width:"100%",height:"100%",children:i.jsxs(zg,{children:[i.jsx(Kg,{data:Fe,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:Fe.map((J,_e)=>i.jsx(qh,{fill:J.color},`cell-${_e}`))}),i.jsx(Bh,{formatter:J=>v(J)}),i.jsx(Hg,{iconType:"circle",layout:"horizontal",verticalAlign:"bottom",align:"center",wrapperStyle:{fontSize:"10px"}})]})}):i.jsx("div",{className:"flex items-center justify-center h-full text-slate-400 text-sm",children:"Aucune donnée"})}),i.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 text-center",children:[i.jsx("span",{className:"text-slate-500 text-sm",children:"Total Dépenses"}),i.jsx("div",{className:"text-2xl font-bold text-rose-600",children:v(g)})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 lg:col-span-2 overflow-hidden flex flex-col",children:[i.jsxs("div",{className:"p-4 border-b border-slate-100 bg-slate-50 flex items-center gap-3 overflow-x-auto",children:[i.jsx(Kh,{className:"w-4 h-4 text-slate-400 flex-shrink-0"}),i.jsx("button",{onClick:()=>u("ALL"),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors ${c==="ALL"?"bg-slate-800 text-white":"bg-white border border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:"Tout voir"}),_i.map(J=>i.jsx("button",{onClick:()=>u(J.id),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors ${c===J.id?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-white border border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:J.label},J.id))]}),i.jsx("div",{className:"flex-1 overflow-auto",children:i.jsxs("table",{className:"w-full text-left",children:[i.jsx("thead",{className:"bg-white text-xs uppercase text-slate-500 font-bold sticky top-0 z-10 shadow-sm",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-4",children:"Date"}),i.jsx("th",{className:"px-6 py-4",children:"Catégorie"}),i.jsx("th",{className:"px-6 py-4",children:"Description"}),i.jsx("th",{className:"px-6 py-4 text-right",children:"Montant"}),i.jsx("th",{className:"px-6 py-4 text-center",children:"Action"})]})}),i.jsxs("tbody",{className:"divide-y divide-slate-100",children:[b.slice().reverse().map(J=>{const _e=_i.find(Ce=>Ce.id===J.category)||_i[7];return i.jsxs("tr",{className:"hover:bg-slate-50 transition-colors group",children:[i.jsx("td",{className:"px-6 py-4 text-sm text-slate-500",children:new Date(J.date).toLocaleDateString()}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium",style:{backgroundColor:`${_e.color}15`,color:_e.color},children:_e.label})}),i.jsxs("td",{className:"px-6 py-4 text-sm text-slate-700",children:[J.description," ",i.jsxs("span",{className:"text-xs text-slate-400 block",children:["Par: ",J.paidBy]})]}),i.jsxs("td",{className:"px-6 py-4 text-right font-bold text-rose-600 font-mono",children:["-",v(J.amount)]}),i.jsx("td",{className:"px-6 py-4 text-center",children:N&&i.jsx("button",{onClick:()=>ke(J.id),className:"p-2 text-slate-300 hover:text-rose-500 hover:bg-rose-50 rounded-lg transition-colors",title:"Supprimer",children:i.jsx(Vs,{className:"w-4 h-4"})})})]},J.id)}),b.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-slate-400",children:"Aucune dépense enregistrée."})})]})]})})]})]}),a&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-fade-in-up",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-6",children:"Nouvelle Dépense"}),i.jsxs("form",{onSubmit:E,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["Montant (",s.code,")"]}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"number",min:"0",step:"0.01",required:!0,className:"w-full pl-4 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-rose-500/20 focus:border-rose-500 text-lg font-bold text-slate-800",value:p,onChange:J=>_(parseFloat(J.target.value))}),i.jsx(so,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Catégorie"}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-rose-500/20 focus:border-rose-500 appearance-none bg-white",value:A,onChange:J=>P(J.target.value),children:_i.map(J=>i.jsx("option",{value:J.id,children:J.label},J.id))}),i.jsx(Wg,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Date"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"date",required:!0,className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-rose-500/20 focus:border-rose-500",value:U,onChange:J=>K(J.target.value)}),i.jsx(vl,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Description"}),i.jsx("textarea",{required:!0,className:"w-full px-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-rose-500/20 focus:border-rose-500 h-24 resize-none",placeholder:"Ex: Facture électricité Janvier...",value:k,onChange:J=>T(J.target.value)})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[i.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:"Annuler"}),i.jsx("button",{type:"submit",className:"px-6 py-2 bg-rose-600 text-white rounded-lg font-medium hover:bg-rose-700 shadow-lg shadow-rose-200",children:"Enregistrer"})]})]})]})}),D&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/90 backdrop-blur-md flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-8 text-center animate-fade-in-up border-b-4 border-red-600 relative",children:[i.jsx("button",{onClick:()=>$(!1),className:"absolute top-3 right-3 text-slate-400 hover:text-slate-600",children:i.jsx(Vt,{className:"w-6 h-6"})}),i.jsx("div",{className:"w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner",children:i.jsx(bn,{className:"w-10 h-10 text-red-600"})}),i.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Caisse actuellement clôturée"}),i.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200 mb-6 mt-4",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Réouverture automatique"}),i.jsx("span",{className:"font-mono font-bold text-slate-800",children:H==null?void 0:H.reopeningTime})]}),i.jsxs("div",{className:"border-t border-slate-200 pt-2 flex justify-between items-center",children:[i.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Temps restant"}),i.jsx("span",{className:"font-bold text-indigo-600",children:H==null?void 0:H.remainingText})]})]}),i.jsx("button",{onClick:()=>$(!1),className:"w-full py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition-colors",children:"OK"})]})}),h&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-fade-in-up border-2 border-rose-100",children:[i.jsxs("div",{className:"flex items-center space-x-3 mb-4 text-rose-600",children:[i.jsx("div",{className:"bg-rose-100 p-2 rounded-full",children:i.jsx($h,{className:"w-6 h-6"})}),i.jsx("h3",{className:"text-xl font-bold text-slate-800",children:"Supprimer ?"})]}),i.jsxs("p",{className:"text-slate-600 mb-6 text-sm leading-relaxed",children:["Êtes-vous sûr de vouloir supprimer cette dépense ?",i.jsx("br",{}),i.jsx("br",{}),i.jsx("span",{className:"font-bold text-rose-600",children:"Attention :"})," Cela annulera l'écriture comptable associée dans la trésorerie."]}),i.jsxs("div",{className:"flex justify-end space-x-3",children:[i.jsx("button",{onClick:()=>f(null),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-medium transition-colors",children:"Annuler"}),i.jsxs("button",{onClick:Y,className:"px-6 py-2 bg-rose-600 hover:bg-rose-700 text-white rounded-lg font-bold shadow-lg shadow-rose-200 flex items-center",children:[i.jsx(Vs,{className:"w-4 h-4 mr-2"}),"Supprimer"]})]})]})})]})},kh=({update:n,onClose:e,themeColor:t})=>n.hasUpdate?i.jsxs("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-600 p-4 z-50 animate-fade-in-up",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-emerald-400 to-teal-600 text-white shadow-lg",children:i.jsx(Qg,{className:"w-6 h-6 animate-pulse"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-800 dark:text-white",children:"Mise à jour disponible !"}),i.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-mono",children:["v",n.currentVersion," ",i.jsx("span",{className:"text-slate-300",children:"➜"})," ",i.jsxs("span",{className:"text-emerald-600 font-bold",children:["v",n.latestVersion]})]})]})]}),i.jsx("button",{onClick:e,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:i.jsx(Vt,{className:"w-5 h-5"})})]}),i.jsx("div",{className:"mt-3 bg-slate-50 dark:bg-slate-700/50 p-2 rounded-lg text-xs text-slate-600 dark:text-slate-300 max-h-20 overflow-y-auto",children:n.releaseNotes}),i.jsxs("div",{className:"mt-4 flex gap-3",children:[i.jsx("button",{onClick:e,className:"flex-1 py-2 text-xs font-bold text-slate-500 hover:bg-slate-100 rounded-lg transition-colors",children:"Plus tard"}),i.jsxs("a",{href:n.downloadUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 text-xs font-bold text-white rounded-lg shadow-md flex items-center justify-center transition-transform hover:scale-105",style:{backgroundColor:t},children:[i.jsx(ac,{className:"w-3 h-3 mr-1.5"}),"Installer"]})]})]}):null,_l=({message:n,type:e="success",onClose:t,duration:s=3e3})=>{w.useEffect(()=>{const o=setTimeout(()=>{t()},s);return()=>clearTimeout(o)},[s,t]);const r={success:"bg-emerald-600",error:"bg-red-600",info:"bg-indigo-600"},a={success:i.jsx(Ur,{className:"w-5 h-5 text-white"}),error:i.jsx(cc,{className:"w-5 h-5 text-white"}),info:i.jsx(Hh,{className:"w-5 h-5 text-white"})};return i.jsxs("div",{className:`fixed bottom-4 left-1/2 transform -translate-x-1/2 z-[100] flex items-center shadow-2xl rounded-full px-6 py-3 text-white ${r[e]} animate-fade-in-up transition-all`,children:[i.jsx("div",{className:"mr-3",children:a[e]}),i.jsx("span",{className:"font-medium text-sm mr-4",children:n}),i.jsx("button",{onClick:t,className:"text-white/70 hover:text-white transition-colors",children:i.jsx(Vt,{className:"w-4 h-4"})})]})},LN=({onFinish:n})=>{const[e,t]=w.useState(0),[s,r]=w.useState(.9);return w.useEffect(()=>{const a=setTimeout(()=>{t(1),r(1)},100),o=setTimeout(()=>{t(0),r(1.1),setTimeout(n,700)},2500);return()=>{clearTimeout(a),clearTimeout(o)}},[n]),i.jsxs("div",{className:"fixed inset-0 z-[100] flex flex-col items-center justify-center transition-all duration-700 ease-in-out",style:{opacity:e,background:"linear-gradient(135deg, #4CAF50 0%, #81C784 100%)"},children:[i.jsx("div",{className:"mb-16 transition-transform duration-700 ease-out",style:{transform:`scale(${s})`},children:i.jsx("div",{className:"bg-white/90 p-6 rounded-3xl shadow-2xl backdrop-blur-md",children:i.jsx(em,{className:"w-32 h-32 md:w-40 md:h-40"})})}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-white/20"}),i.jsx("div",{className:"absolute top-0 left-0 w-12 h-12 rounded-full border-4 border-white border-t-transparent animate-spin"})]}),i.jsxs("div",{className:"absolute bottom-8 text-white/80 text-xs font-medium tracking-widest font-mono",children:["GESMIND v","1.0.4"]})]})},MN=(n,e)=>{const t=n.replace(/[^0-9.]/g,"").split(".").map(Number),s=e.replace(/[^0-9.]/g,"").split(".").map(Number);for(let r=0;r<Math.max(t.length,s.length);r++){const a=t[r]||0,o=s[r]||0;if(o>a)return!0;if(o<a)return!1}return!1},FN=n=>{let e=n.trim();return e.endsWith(".git")&&(e=e.slice(0,-4)),e=e.replace("https://github.com/","").replace("http://github.com/",""),e.endsWith("/")&&(e=e.slice(0,-1)),e},UN=n=>I(Me,null,function*(){const e="1.0.4",t=FN(n);if(!t||!t.includes("/"))throw new Error("Configuration GitHub invalide. Format attendu: 'username/repo'");try{const s=yield fetch(`https://api.github.com/repos/${t}/releases/latest`);if(s.status===404)return{hasUpdate:!1,currentVersion:e,latestVersion:e,downloadUrl:"",releaseNotes:"Aucune version publiée pour le moment sur ce dépôt."};if(!s.ok)throw new Error(`Erreur GitHub: ${s.status} ${s.statusText}`);const r=yield s.json(),a=r.tag_name,o=r.assets.find(p=>p.name.endsWith(".apk")),c=r.assets.find(p=>p.name.endsWith(".exe")),u=o||c,h=u?u.browser_download_url:r.html_url;return{hasUpdate:MN(e,a),currentVersion:e,latestVersion:a,downloadUrl:h,releaseNotes:r.body||"Aucune note de version."}}catch(s){throw console.error("Update check failed:",s),s}}),BN={name:"Gesmind",address:"",phone:"",email:"",language:"fr",cloudProvider:"NONE",themeMode:"light",themeColor:"#4f46e5",githubRepo:"mahiguyzo12/Gesmind"},qN=()=>{const[n,e]=w.useState(null),[t,s]=w.useState(le.LOGIN),[r,a]=w.useState(!0),[o,c]=w.useState(!1),[u,h]=w.useState(0),[f,p]=w.useState("Initialisation..."),[_,A]=w.useState(null),[P,k]=w.useState([]),[T,U]=w.useState(null),[K,D]=w.useState(!1),[$,H]=w.useState(!!ne||localStorage.getItem("gesmind_db_mode")==="LOCAL"),[Q,N]=w.useState(null),[b,g]=w.useState([]),[v,S]=w.useState([]),[E,y]=w.useState([]),[ke,Y]=w.useState([]),[Fe,J]=w.useState([]),[_e,Ce]=w.useState([]),[Re,Xe]=w.useState([]),[Ee,Ne]=w.useState([]),[W,ue]=w.useState([]),[Te,ye]=w.useState("EUR"),[re,Be]=w.useState(BN),[Ze,ze]=w.useState(null);w.useEffect(()=>{I(Me,null,function*(){try{ne&&!$&&H(!0),yield new Promise($e=>setTimeout($e,500));const ee=localStorage.getItem("gesmind_known_stores"),me=localStorage.getItem("gesmind_last_store_id"),pe=localStorage.getItem("gesmind_local_currency");if(ee)try{const $e=JSON.parse(ee);k($e),$e.length>0&&me?U(me):$e.length>0&&U($e[0].id)}catch($e){console.error("Error loading stores",$e)}pe&&ye(pe)}catch(ee){console.error("Erreur init",ee)}})},[]),w.useEffect(()=>{P.length>0&&localStorage.setItem("gesmind_known_stores",JSON.stringify(P))},[P]),w.useEffect(()=>{T&&localStorage.setItem("gesmind_last_store_id",T)},[T]),w.useEffect(()=>{if(!T||!$)return;g([]),S([]),y([]),Y([]),J([]),Ce([]),Xe([]),Ne([]),ue([]);const L=hN(T,g),ee=mN(T,S),me=pN(T,y),pe=gN(T,Y),$e=xN(T,J),Pt=bN(T,Ce),St=fN(T,Xe),ct=_N(T,Ne),gs=yN(T,ue),Us=vN(T,Mt=>{Mt&&(Be(Mt),k(Bs=>Bs.map(an=>an.id===T?Ue(je({},an),{name:Mt.name,logoUrl:Mt.logoUrl}):an)))});return s(le.LOGIN),e(null),A(null),()=>{L(),ee(),me(),pe(),$e(),Pt(),St(),ct(),gs(),Us()}},[T,$]),w.useEffect(()=>{n&&T&&$&&setTimeout(()=>I(Me,null,function*(){const ee=yield IN(T,n.id,n.name);ee>0&&de(`${ee} journée(s) précédente(s) clôturée(s) automatiquement.`,"info")}),3e3)},[n,T,$]),w.useEffect(()=>{if(!n||!T)return;const L=()=>{const me=new Date().toISOString();ys(T,"users",n.id,{lastLogin:me})};L();const ee=setInterval(L,12e4);return()=>clearInterval(ee)},[n==null?void 0:n.id,T]),w.useEffect(()=>{const ee=setTimeout(()=>I(Me,null,function*(){if(re.githubRepo)try{const me=yield UN(re.githubRepo);me.hasUpdate&&ze(me)}catch(me){console.error("Auto update check failed",me)}}),2e3);return()=>clearTimeout(ee)},[re.githubRepo]),w.useEffect(()=>{const L=window.document.documentElement;re.themeMode==="dark"?L.classList.add("dark"):L.classList.remove("dark"),L.style.setProperty("--primary-color",re.themeColor||"#4f46e5")},[re.themeMode,re.themeColor]);const de=(L,ee="success")=>N({message:L,type:ee}),dt=L=>mu(L)?(H(!0),de("Configuration Firebase appliquée avec succès !","success"),!0):(de("Erreur de configuration. Vérifiez le format JSON.","error"),!1),et=L=>I(Me,null,function*(){const ee=P.find(pe=>pe.id===L);if(ee)return ee;const me=yield uN(L);return me||(de("Aucune boutique trouvée avec cet ID.","error"),null)}),st=L=>{P.some(ee=>ee.id===L.id)||k(ee=>[...ee,L]),U(L.id),de("Boutique sélectionnée !","success")},ft=L=>{T&&(wN(T,L),de("Paramètres sauvegardés","success"))},yt=L=>{ye(L),localStorage.setItem("gesmind_local_currency",L),de("Devise mise à jour","info")},Qe=Tl[Te]||Tl.EUR,ot=L=>{T&&(_&&(L.createdBy=_.id),_s(T,"inventory",L),de("Produit ajouté","success"))},Et=(L,ee)=>T&&ys(T,"inventory",L,ee),ut=L=>{T&&(Er(T,"inventory",L),de("Produit supprimé","info"))},Se=L=>{T&&(_s(T,"users",L),de("Utilisateur créé","success"))},oe=(L,ee)=>{T&&(ys(T,"users",L,ee),n&&n.id===L&&e(je(je({},n),ee)),de("Utilisateur mis à jour","success"))},lt=L=>T&&Er(T,"users",L),B=L=>{T&&(_s(T,"employees",L),de("Dossier employé créé","success"))},ie=(L,ee)=>T&&ys(T,"employees",L,ee),ve=L=>T&&Er(T,"employees",L),nt=L=>{T&&(_s(T,"customers",L),de("Client ajouté","success"))},M=(L,ee)=>T&&ys(T,"customers",L,ee),ge=L=>T&&Er(T,"customers",L),De=L=>{T&&(_s(T,"suppliers",L),de("Fournisseur ajouté","success"))},fe=(L,ee)=>T&&ys(T,"suppliers",L,ee),xe=L=>T&&Er(T,"suppliers",L),Qt=L=>{if(T){_&&(L.paidBy=`${n==null?void 0:n.name} (pour ${_.name})`),_s(T,"expenses",L);const ee={id:`m-exp-${Date.now()}`,date:L.date,type:"EXPENSE",amount:L.amount,description:`Dépense : ${L.description} (${L.category})`,performedBy:L.paidBy};_s(T,"cash_movements",ee),de("Dépense enregistrée","success")}},Rt=L=>T&&Er(T,"expenses",L),ts=(L,ee,me)=>{if(!T)return;const pe=ee/Qe.rate,$e={id:`exp-salary-${Date.now()}`,date:new Date().toISOString(),category:"SALARY",description:`Salaire ${me} - ${L.fullName}`,amount:pe,paidBy:(n==null?void 0:n.name)||"Admin"};Qt($e)},ss=L=>{if(T){if(_&&(L.sellerId=_.id,L.sellerName=`${n==null?void 0:n.name} (pour ${_.name})`),L.isLocked=!1,_s(T,"transactions",L),L.items.forEach(ee=>{const me=b.find(pe=>pe.id===ee.productId);if(me){const pe=L.type==="SALE"?-ee.quantity:ee.quantity,$e=Math.max(0,me.quantity+pe);ys(T,"inventory",me.id,{quantity:$e})}}),L.amountPaid>0){const ee={id:`m-auto-${Date.now()}`,date:L.date,type:L.type,amount:L.amountPaid,description:`${L.type==="SALE"?"Vente":"Règlement Achat"} (Ref: ${L.id}) ${L.paymentStatus==="PARTIAL"?"- Partiel":""}`,performedBy:L.sellerName};_s(T,"cash_movements",ee)}if(L.type==="SALE"&&L.customerId){const ee=Fe.find(me=>me.id===L.customerId);ee&&ys(T,"customers",ee.id,{totalSpent:ee.totalSpent+L.totalAmount,lastPurchaseDate:L.date})}de("Transaction validée","success")}},Lt=(L,ee)=>{if(!T)return;const me=v.find(Us=>Us.id===L);if(!me)return;const pe=ee/Qe.rate,$e=me.amountPaid+pe;let Pt="PARTIAL",St;$e>=me.totalAmount-.01&&(Pt="PAID",St=new Date().toISOString()),ys(T,"transactions",L,{amountPaid:$e,paymentStatus:Pt,paidAt:St});let ct=(n==null?void 0:n.name)||"Système";_&&(ct=`${n==null?void 0:n.name} (pour ${_.name})`);const gs={id:`m-settle-${Date.now()}`,date:new Date().toISOString(),type:me.type,amount:pe,description:`Règlement Solde ${me.type==="SALE"?"Vente":"Achat"} (Ref: ${me.id})`,performedBy:ct};_s(T,"cash_movements",gs),de("Règlement enregistré","success")},G=L=>{T&&(_&&(L.performedBy=`${n==null?void 0:n.name} (pour ${_.name})`),_s(T,"cash_movements",L),de("Mouvement de caisse ajouté","success"))},Je=(L,ee,me)=>I(Me,null,function*(){c(!0),h(0),p("Création de votre entreprise...");const pe=setInterval(()=>{h(ct=>Math.min(ct+5,90))},100),$e=`store_${Date.now()}`,Pt=[];uc.forEach(ct=>{ct.actions.forEach(gs=>{Pt.push(`${ct.id}.${gs.id}`)})}),ee.permissions=Pt;const St={id:$e,name:L.name,logoUrl:L.logoUrl};try{yield cN($e,St,L,ee,me),clearInterval(pe),h(100),p("Entreprise prête !"),setTimeout(()=>{k(ct=>[...ct,St]),U($e),c(!1),de("Entreprise créée avec succès","success")},800)}catch(ct){clearInterval(pe),c(!1),alert("Erreur lors de la création de la boutique.")}}),qe=(L,ee)=>E.find(pe=>pe.role==="ADMIN"&&pe.name.toLowerCase()===L.toLowerCase()&&pe.pin===ee)&&T?(dN(T).then(()=>{k(pe=>pe.filter($e=>$e.id!==T)),U(null),de("Entreprise supprimée","info")}),!0):!1,Ke=(L,ee)=>{if(L==="KEY")return(re.recoveryKey||"").trim()===ee.trim();if(L==="CONTACT"){const me=ee.trim(),pe=(re.email||"").trim().toLowerCase();if(pe&&pe===me.toLowerCase())return!0;const $e=ct=>ct.replace(/[^0-9]/g,""),Pt=$e(re.phone||""),St=$e(me);if(Pt&&Pt===St&&Pt.length>=4)return!0}return!1},vt=L=>{const ee=E.find(me=>me.role==="ADMIN");return ee&&T?(ys(T,"users",ee.id,{pin:L}),de("Code PIN administrateur réinitialisé !","success"),!0):!1},He=L=>{const ee=new Date().toISOString();T&&ys(T,"users",L.id,{lastLogin:ee}),e(Ue(je({},L),{lastLogin:ee})),s(le.MENU),A(null),de(`Bienvenue, ${L.name}`,"success")},Tt=()=>D(!0),Jt=()=>{D(!1),e(null),A(null),s(le.LOGIN)},V=L=>{A(L),s(le.DASHBOARD),de(`Mode Supervision : ${L.name}`,"info")},j=()=>{A(null),s(le.USERS),de("Mode Supervision désactivé","info")},se=()=>{const L={version:"1.3",timestamp:new Date().toISOString(),settings:re,currency:Te,inventory:b,users:E,employees:ke,customers:Fe,suppliers:_e,transactions:v,expenses:Re,cashMovements:Ee,cashClosings:W},ee="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(L,null,2)),me=document.createElement("a");me.href=ee,me.download=`gesmind_backup_${re.name}_${new Date().toISOString().split("T")[0]}.json`,me.click(),de("Sauvegarde exportée","success")},be=()=>alert("L'importation écrase la base de données. Fonction désactivée par sécurité en mode Cloud."),pt=()=>se(),Ve=L=>Qi(re.language,L),Yt=L=>{if(!n)return!1;const me={[le.LOGIN]:"",[le.MENU]:"",[le.DASHBOARD]:"dashboard.view",[le.INVENTORY]:"inventory.view",[le.COMMERCIAL]:"commercial.view",[le.EXPENSES]:"expenses.view",[le.PERSONNEL]:"personnel.view",[le.CUSTOMERS]:"customers.view",[le.SUPPLIERS]:"suppliers.view",[le.TREASURY]:"treasury.view",[le.USERS]:"users.view",[le.AI_INSIGHTS]:"ai.view",[le.SETTINGS]:"settings.view"}[L];return me?n.permissions.includes(me):!0};if(r)return i.jsx(LN,{onFinish:()=>a(!1)});if(o)return i.jsx(pu,{message:f});if(!n)return i.jsxs(i.Fragment,{children:[i.jsx(jN,{users:E,onLogin:He,onCreateStore:Je,storeName:re.name,storeLogo:re.logoUrl,onDeleteStore:qe,availableStores:P,currentStoreId:T,onSelectStore:U,onFindStore:et,onAddKnownStore:st,onVerifyRecoveryInfo:Ke,onResetPassword:vt,lang:re.language,isDbConnected:$,onSetupDb:dt}),Q&&i.jsx(_l,{message:Q.message,type:Q.type,onClose:()=>N(null)})]});if(t===le.MENU)return i.jsxs(i.Fragment,{children:[i.jsx(nx,{currentUser:n,onNavigate:s,onLogout:Tt,appName:re.name,logoUrl:re.logoUrl,themeColor:re.themeColor||"#4f46e5",lang:re.language,inventory:b,transactions:v,users:E,currency:Qe}),Ze&&i.jsx(kh,{update:Ze,onClose:()=>ze(null),themeColor:re.themeColor||"#4f46e5"}),K&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-sm w-full p-6 border border-slate-200 dark:border-slate-700 animate-fade-in-up",children:[i.jsxs("div",{className:"flex items-center space-x-3 mb-4 text-slate-800 dark:text-white",children:[i.jsx("div",{className:"bg-red-100 dark:bg-red-900/30 p-2 rounded-full",children:i.jsx(Xa,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),i.jsx("h3",{className:"text-lg font-bold",children:Ve("logout")})]}),i.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6",children:Ve("login_subtitle")}),i.jsxs("div",{className:"flex space-x-3",children:[i.jsx("button",{onClick:()=>D(!1),className:"flex-1 py-3 bg-slate-100 dark:bg-slate-700 rounded-xl",children:Ve("cancel")}),i.jsx("button",{onClick:Jt,className:"flex-1 py-3 bg-red-600 text-white rounded-xl",children:Ve("confirm")})]})]})}),Q&&i.jsx(_l,{message:Q.message,type:Q.type,onClose:()=>N(null)})]});const cs=()=>{if(!Yt(t))return i.jsxs("div",{className:"p-8 text-center text-slate-500",children:["Accès Refusé ",i.jsx("br",{}),i.jsx("button",{onClick:()=>s(le.MENU),className:"text-indigo-600 font-bold mt-2",children:"Retour au menu"})]});switch(t){case le.DASHBOARD:return i.jsx(ix,{inventory:b,currency:Qe,transactions:v,expenses:Re,currentUser:n,supervisionTarget:_});case le.INVENTORY:return i.jsx(dx,{items:b,onAddItem:ot,onDeleteItem:ut,onUpdateItem:Et,currency:Qe,currentUser:n,suppliers:_e,supervisionTarget:_});case le.COMMERCIAL:return i.jsx(EN,{inventory:b,transactions:v,onAddTransaction:ss,currency:Qe,currentUser:n,customers:Fe,suppliers:_e,storeSettings:re,supervisionTarget:_});case le.EXPENSES:return i.jsx(ON,{expenses:Re,onAddExpense:Qt,onDeleteExpense:Rt,currency:Qe,currentUser:n});case le.PERSONNEL:return i.jsx(AN,{employees:ke,currency:Qe,onAddEmployee:B,onUpdateEmployee:ie,onDeleteEmployee:ve,onPaySalary:ts});case le.CUSTOMERS:return i.jsx(DN,{customers:Fe,onAddCustomer:nt,onUpdateCustomer:M,onDeleteCustomer:ge,currency:Qe});case le.SUPPLIERS:return i.jsx(VN,{suppliers:_e,onAddSupplier:De,onUpdateSupplier:fe,onDeleteSupplier:xe,currency:Qe});case le.TREASURY:return i.jsx(RN,{movements:Ee,closings:W,transactions:v,onAddMovement:G,onClosePeriod:()=>{},onSettleTransaction:Lt,lastClosingDate:re.lastClosingDate,currency:Qe,currentUser:n,customers:Fe,supervisionTarget:_});case le.USERS:return i.jsx(CN,{users:E,onAddUser:Se,onUpdateUser:oe,onDeleteUser:lt,currentUser:n,onSupervise:V,onLoginAs:He});case le.AI_INSIGHTS:return i.jsx(hx,{items:b,currency:Qe});case le.SETTINGS:return i.jsx(kN,{currentSettings:re,onUpdateSettings:ft,currentCurrency:Te,onUpdateCurrency:yt,currentUser:n,onUpdateUser:oe,onExportData:se,onImportData:be,onCloudSync:pt,lang:re.language,inventory:b,transactions:v,expenses:Re,cashMovements:Ee});default:return i.jsx("div",{children:"Vue non trouvée"})}},us=()=>{switch(t){case le.DASHBOARD:return Ve("menu_dashboard");case le.INVENTORY:return Ve("menu_inventory");case le.COMMERCIAL:return Ve("menu_commercial");case le.EXPENSES:return Ve("menu_expenses");case le.TREASURY:return Ve("menu_treasury");case le.CUSTOMERS:return Ve("menu_customers");case le.SUPPLIERS:return Ve("menu_suppliers");case le.USERS:return Ve("menu_users");case le.AI_INSIGHTS:return Ve("menu_ai");case le.SETTINGS:return Ve("menu_settings");case le.PERSONNEL:return Ve("menu_personnel");default:return""}};return i.jsxs("div",{className:"flex flex-col min-h-screen bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 font-sans select-none transition-colors duration-300",children:[_&&i.jsxs("div",{className:"bg-amber-500 text-white px-4 py-2 text-sm font-bold flex justify-between items-center shadow-lg z-50",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(en,{className:"w-5 h-5 mr-2 animate-pulse"})," MODE SUPERVISION : Vous agissez en tant que ",_.name]}),i.jsxs("button",{onClick:j,className:"bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-lg text-xs transition-colors flex items-center",children:[i.jsx(Vt,{className:"w-3 h-3 mr-1"})," Quitter"]})]}),i.jsx(rx,{currentView:t,onNavigate:s,currentUser:n,onLogout:Tt,title:us(),themeColor:re.themeColor,lang:re.language}),i.jsx("main",{className:"flex-1 w-full p-4 md:p-8 overflow-y-auto",children:i.jsxs("div",{className:"max-w-7xl mx-auto animate-fade-in",children:[i.jsx(Zh,{inventory:b,transactions:v,users:E,onNavigate:s,currency:Qe,currentUser:n,supervisionTarget:_}),cs()]})}),Ze&&i.jsx(kh,{update:Ze,onClose:()=>ze(null),themeColor:re.themeColor||"#4f46e5"}),Q&&i.jsx(_l,{message:Q.message,type:Q.type,onClose:()=>N(null)}),K&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-sm w-full p-6 border border-slate-200 dark:border-slate-700 animate-fade-in-up",children:[i.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center",children:[i.jsx(Xa,{className:"w-6 h-6 mr-2 text-red-500"})," ",Ve("logout")]}),i.jsx("p",{className:"mb-6 text-slate-600 dark:text-slate-300",children:"Êtes-vous sûr de vouloir vous déconnecter ?"}),i.jsxs("div",{className:"flex space-x-3",children:[i.jsx("button",{onClick:()=>D(!1),className:"flex-1 py-3 bg-slate-100 dark:bg-slate-700 rounded-xl",children:Ve("cancel")}),i.jsx("button",{onClick:Jt,className:"flex-1 py-3 bg-red-600 text-white rounded-xl",children:Ve("confirm")})]})]})})]})},eg=document.getElementById("root");if(!eg)throw new Error("Could not find root element to mount to");"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/serviceWorker.ts").then(n=>{console.log("StockMind PWA ServiceWorker registered: ",n.scope)}).catch(n=>{console.log("StockMind PWA ServiceWorker registration failed: ",n)})});const $N=El.createRoot(eg);$N.render(i.jsx(Jg.StrictMode,{children:i.jsx(qN,{})}))});export default GN();
